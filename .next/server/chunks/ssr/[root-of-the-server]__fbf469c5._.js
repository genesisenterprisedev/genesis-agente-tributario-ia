module.exports=[33405,(a,b,c)=>{b.exports=a.x("child_process",()=>require("child_process"))},22734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},97599,(a,b,c)=>{"use strict";var d=Object.prototype.hasOwnProperty,e=Object.prototype.toString,f=Object.defineProperty,g=Object.getOwnPropertyDescriptor,h=function(a){return"function"==typeof Array.isArray?Array.isArray(a):"[object Array]"===e.call(a)},i=function(a){if(!a||"[object Object]"!==e.call(a))return!1;var b,c=d.call(a,"constructor"),f=a.constructor&&a.constructor.prototype&&d.call(a.constructor.prototype,"isPrototypeOf");if(a.constructor&&!c&&!f)return!1;for(b in a);return void 0===b||d.call(a,b)},j=function(a,b){f&&"__proto__"===b.name?f(a,b.name,{enumerable:!0,configurable:!0,value:b.newValue,writable:!0}):a[b.name]=b.newValue},k=function(a,b){if("__proto__"===b){if(!d.call(a,b))return;else if(g)return g(a,b).value}return a[b]};b.exports=function a(){var b,c,d,e,f,g,l=arguments[0],m=1,n=arguments.length,o=!1;for("boolean"==typeof l&&(o=l,l=arguments[1]||{},m=2),(null==l||"object"!=typeof l&&"function"!=typeof l)&&(l={});m<n;++m)if(b=arguments[m],null!=b)for(c in b)d=k(l,c),l!==(e=k(b,c))&&(o&&e&&(i(e)||(f=h(e)))?(f?(f=!1,g=d&&h(d)?d:[]):g=d&&i(d)?d:{},j(l,{name:c,newValue:a(o,g,e)})):void 0!==e&&j(l,{name:c,newValue:e}));return l}},451,a=>{a.v({name:"gaxios",version:"7.1.3",description:"A simple common HTTP client specifically for Google APIs and services.",main:"build/cjs/src/index.js",types:"build/cjs/src/index.d.ts",files:["build/"],exports:{".":{import:{types:"./build/esm/src/index.d.ts",default:"./build/esm/src/index.js"},require:{types:"./build/cjs/src/index.d.ts",default:"./build/cjs/src/index.js"}}},scripts:{lint:"gts check --no-inline-config",test:"c8 mocha build/esm/test","presystem-test":"npm run compile","system-test":"mocha build/esm/system-test --timeout 80000",compile:"tsc -b ./tsconfig.json ./tsconfig.cjs.json && node utils/enable-esm.mjs",fix:"gts fix",prepare:"npm run compile",pretest:"npm run compile",webpack:"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js",docs:"jsdoc -c .jsdoc.js","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../",prelint:"cd samples; npm link ../; npm install",clean:"gts clean"},repository:{type:"git",directory:"packages/gaxios",url:"https://github.com/googleapis/google-cloud-node-core.git"},keywords:["google"],engines:{node:">=18"},author:"Google, LLC",license:"Apache-2.0",devDependencies:{"@babel/plugin-proposal-private-methods":"^7.18.6","@types/cors":"^2.8.6","@types/express":"^5.0.0","@types/extend":"^3.0.1","@types/mocha":"^10.0.10","@types/multiparty":"4.2.1","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","@types/tmp":"0.2.6",assert:"^2.0.0",browserify:"^17.0.0",c8:"^10.0.0",cors:"^2.8.5",express:"^5.0.0",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",linkinator:"^6.1.2",mocha:"^11.1.0",multiparty:"^4.2.1",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.0-beta.13","null-loader":"^4.0.0","pack-n-play":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","stream-browserify":"^3.0.0",tmp:"0.2.5","ts-loader":"^9.5.2",typescript:"^5.8.3",webpack:"^5.35.0","webpack-cli":"^6.0.1"},dependencies:{extend:"^3.0.2","https-proxy-agent":"^7.0.1","node-fetch":"^3.3.2",rimraf:"^5.0.1"},homepage:"https://github.com/googleapis/google-cloud-node-core/tree/main/packages/gaxios"})},52947,(a,b,c)=>{"use strict";b.exports={pkg:a.r(451)}},69565,(a,b,c)=>{"use strict";var d=a.e&&a.e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0}),c.GaxiosError=c.GAXIOS_ERROR_SYMBOL=void 0,c.defaultErrorRedactor=function a(b){let c="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function d(a){a&&a.forEach((b,d)=>{(/^authentication$/i.test(d)||/^authorization$/i.test(d)||/secret/i.test(d))&&a.set(d,c)})}function e(a,b){if("object"==typeof a&&null!==a&&"string"==typeof a[b]){let d=a[b];(/grant_type=/i.test(d)||/assertion=/i.test(d)||/secret/i.test(d))&&(a[b]=c)}}function f(a){!a||"object"!=typeof a||(a instanceof FormData||a instanceof URLSearchParams||"forEach"in a&&"set"in a?a.forEach((b,d)=>{(["grant_type","assertion"].includes(d)||/secret/.test(d))&&a.set(d,c)}):("grant_type"in a&&(a.grant_type=c),"assertion"in a&&(a.assertion=c),"client_secret"in a&&(a.client_secret=c)))}return b.config&&(d(b.config.headers),e(b.config,"data"),f(b.config.data),e(b.config,"body"),f(b.config.body),b.config.url.searchParams.has("token")&&b.config.url.searchParams.set("token",c),b.config.url.searchParams.has("client_secret")&&b.config.url.searchParams.set("client_secret",c)),b.response&&(a({config:b.response.config}),d(b.response.headers),b.response.bodyUsed&&(e(b.response,"data"),f(b.response.data))),b};let e=d(a.r(97599)),f=d(a.r(52947)).default.pkg;c.GAXIOS_ERROR_SYMBOL=Symbol.for(`${f.name}-gaxios-error`);class g extends Error{config;response;code;status;error;[c.GAXIOS_ERROR_SYMBOL]=f.version;static[Symbol.hasInstance](a){return!!a&&"object"==typeof a&&c.GAXIOS_ERROR_SYMBOL in a&&a[c.GAXIOS_ERROR_SYMBOL]===f.version||Function.prototype[Symbol.hasInstance].call(g,a)}constructor(a,b,c,d){if(super(a,{cause:d}),this.config=b,this.response=c,this.error=d instanceof Error?d:void 0,this.config=(0,e.default)(!0,{},b),this.response&&(this.response.config=(0,e.default)(!0,{},this.response.config)),this.response){try{this.response.data=function(a,b){switch(a){case"stream":default:return b;case"json":return JSON.parse(JSON.stringify(b));case"arraybuffer":return JSON.parse(Buffer.from(b).toString("utf8"));case"blob":return JSON.parse(b.text())}}(this.config.responseType,this.response?.bodyUsed?this.response?.data:void 0)}catch{}this.status=this.response.status}d instanceof DOMException?this.code=d.name:d&&"object"==typeof d&&"code"in d&&("string"==typeof d.code||"number"==typeof d.code)&&(this.code=d.code)}static extractAPIErrorFromResponse(a,b="The request failed"){let c=b;if("string"==typeof a.data&&(c=a.data),a.data&&"object"==typeof a.data&&"error"in a.data&&a.data.error&&!a.ok){if("string"==typeof a.data.error)return{message:a.data.error,code:a.status,status:a.statusText};if("object"==typeof a.data.error){c="message"in a.data.error&&"string"==typeof a.data.error.message?a.data.error.message:c;let b="status"in a.data.error&&"string"==typeof a.data.error.status?a.data.error.status:a.statusText,d="code"in a.data.error&&"number"==typeof a.data.error.code?a.data.error.code:a.status;if("errors"in a.data.error&&Array.isArray(a.data.error.errors)){let e=[];for(let b of a.data.error.errors)"object"==typeof b&&"message"in b&&"string"==typeof b.message&&e.push(b.message);return Object.assign({message:e.join("\n")||c,code:d,status:b},a.data.error)}return Object.assign({message:c,code:d,status:b},a.data.error)}}return{message:c,code:a.status,status:a.statusText}}}c.GaxiosError=g},63492,(a,b,c)=>{"use strict";async function d(a){var b;let c=f(a);if(!a||!a.config||!c&&!a.config.retry)return{shouldRetry:!1};(c=c||{}).currentRetryAttempt=c.currentRetryAttempt||0,c.retry=void 0===c.retry||null===c.retry?3:c.retry,c.httpMethodsToRetry=c.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],c.noResponseRetries=void 0===c.noResponseRetries||null===c.noResponseRetries?2:c.noResponseRetries,c.retryDelayMultiplier=c.retryDelayMultiplier?c.retryDelayMultiplier:2,c.timeOfFirstRequest=c.timeOfFirstRequest?c.timeOfFirstRequest:Date.now(),c.totalTimeout=c.totalTimeout?c.totalTimeout:Number.MAX_SAFE_INTEGER,c.maxRetryDelay=c.maxRetryDelay?c.maxRetryDelay:Number.MAX_SAFE_INTEGER,c.statusCodesToRetry=c.statusCodesToRetry||[[100,199],[408,408],[429,429],[500,599]],a.config.retryConfig=c;let d=c.shouldRetry||e;if(!await d(a))return{shouldRetry:!1,config:a.config};let g=Math.min(((b=c).currentRetryAttempt?0:b.retryDelay??100)+(Math.pow(b.retryDelayMultiplier,b.currentRetryAttempt)-1)/2*1e3,b.totalTimeout-(Date.now()-b.timeOfFirstRequest),b.maxRetryDelay);a.config.retryConfig.currentRetryAttempt+=1;let h=c.retryBackoff?c.retryBackoff(a,g):new Promise(a=>{setTimeout(a,g)});return c.onRetryAttempt&&await c.onRetryAttempt(a),await h,{shouldRetry:!0,config:a.config}}function e(a){let b=f(a);if(a.config.signal?.aborted&&"TimeoutError"!==a.code||"AbortError"===a.code||!b||0===b.retry||!a.response&&(b.currentRetryAttempt||0)>=b.noResponseRetries||!b.httpMethodsToRetry||!b.httpMethodsToRetry.includes(a.config.method?.toUpperCase()||"GET"))return!1;if(a.response&&a.response.status){let c=!1;for(let[d,e]of b.statusCodesToRetry){let b=a.response.status;if(b>=d&&b<=e){c=!0;break}}if(!c)return!1}return b.currentRetryAttempt=b.currentRetryAttempt||0,!(b.currentRetryAttempt>=b.retry)}function f(a){if(a&&a.config&&a.config.retryConfig)return a.config.retryConfig}Object.defineProperty(c,"__esModule",{value:!0}),c.getRetryConfig=d},88947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},69706,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.GaxiosInterceptorManager=void 0;class d extends Set{}c.GaxiosInterceptorManager=d},76176,(a,b,c)=>{"use strict";var d,e=a.e&&a.e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0}),c.Gaxios=void 0;let f=e(a.r(97599)),g=a.r(24836),h=a.r(69565),i=a.r(63492),j=a.r(88947),k=a.r(69706),l=async()=>globalThis.crypto?.randomUUID()||(await a.A(85685)).randomUUID();class m{agentCache=new Map;defaults;interceptors;constructor(a){this.defaults=a||{},this.interceptors={request:new k.GaxiosInterceptorManager,response:new k.GaxiosInterceptorManager}}fetch(...a){let b,c=a[0],e=a[1],f=new Headers;return("string"==typeof c?b=new URL(c):c instanceof URL?b=c:c&&c.url&&(b=new URL(c.url)),c&&"object"==typeof c&&"headers"in c&&d.mergeHeaders(f,c.headers),e&&d.mergeHeaders(f,new Headers(e.headers)),"object"!=typeof c||c instanceof URL)?this.request({...e,headers:f,url:b}):this.request({...e,...c,headers:f,url:b})}async request(a={}){let b=await this.#a(a);return b=await this.#b(b),this.#c(this._request(b))}async _defaultAdapter(a){let b=a.fetchImplementation||this.defaults.fetchImplementation||await d.#d(),c={...a};delete c.data;let e=await b(a.url,c),f=await this.getResponseData(a,e);return Object.getOwnPropertyDescriptor(e,"data")?.configurable||Object.defineProperties(e,{data:{configurable:!0,writable:!0,enumerable:!0,value:f}}),Object.assign(e,{config:a,data:f})}async _request(a){try{let b;if(b=a.adapter?await a.adapter(a,this._defaultAdapter.bind(this)):await this._defaultAdapter(a),!a.validateStatus(b.status)){if("stream"===a.responseType){let a=[];for await(let c of b.data)a.push(c);b.data=a.toString()}let c=h.GaxiosError.extractAPIErrorFromResponse(b,`Request failed with status code ${b.status}`);throw new h.GaxiosError(c?.message,a,b,c)}return b}catch(e){let b;b=e instanceof h.GaxiosError?e:e instanceof Error?new h.GaxiosError(e.message,a,void 0,e):new h.GaxiosError("Unexpected Gaxios Error",a,void 0,e);let{shouldRetry:c,config:d}=await (0,i.getRetryConfig)(b);if(c&&d)return b.config.retryConfig.currentRetryAttempt=d.retryConfig.currentRetryAttempt,a.retryConfig=b.config?.retryConfig,this.#e(a),this._request(a);throw a.errorRedactor&&a.errorRedactor(b),b}}async getResponseData(a,b){if(204===b.status)return"";if(a.maxContentLength&&b.headers.has("content-length")&&a.maxContentLength<Number.parseInt(b.headers?.get("content-length")||""))throw new h.GaxiosError("Response's `Content-Length` is over the limit.",a,Object.assign(b,{config:a}));switch(a.responseType){case"stream":return b.body;case"json":{let a=await b.text();try{return JSON.parse(a)}catch{return a}}case"arraybuffer":return b.arrayBuffer();case"blob":return b.blob();case"text":return b.text();default:return this.getResponseDataFromContentType(b)}}#f(a,b=[]){let c=new URL(a),d=[...b];for(let a of(process.env.NO_PROXY??process.env.no_proxy)?.split(",")||[])d.push(a.trim());for(let a of d)if(a instanceof RegExp){if(a.test(c.toString()))return!1}else if(a instanceof URL){if(a.origin===c.origin)return!1}else if(a.startsWith("*.")||a.startsWith(".")){let b=a.replace(/^\*\./,".");if(c.hostname.endsWith(b))return!1}else if(a===c.origin||a===c.hostname||a===c.href)return!1;return!0}async #b(a){let b=Promise.resolve(a);for(let a of this.interceptors.request.values())a&&(b=b.then(a.resolved,a.rejected));return b}async #c(a){let b=Promise.resolve(a);for(let a of this.interceptors.response.values())a&&(b=b.then(a.resolved,a.rejected));return b}async #a(a){let b=new Headers(this.defaults.headers);d.mergeHeaders(b,a.headers);let c=(0,f.default)(!0,{},this.defaults,a);if(!c.url)throw Error("URL is required.");if(c.baseURL&&(c.url=new URL(c.url,c.baseURL)),c.url=new URL(c.url),c.params)if(c.paramsSerializer){let a=c.paramsSerializer(c.params);a.startsWith("?")&&(a=a.slice(1));let b=c.url.toString().includes("?")?"&":"?";c.url=c.url+b+a}else{let a=c.url instanceof URL?c.url:new URL(c.url);for(let[b,d]of new URLSearchParams(c.params))a.searchParams.append(b,d);c.url=a}"number"==typeof a.maxContentLength&&(c.size=a.maxContentLength),"number"==typeof a.maxRedirects&&(c.follow=a.maxRedirects);let e="string"==typeof c.data||c.data instanceof ArrayBuffer||c.data instanceof Blob||globalThis.File&&c.data instanceof File||c.data instanceof FormData||c.data instanceof j.Readable||c.data instanceof ReadableStream||c.data instanceof String||c.data instanceof URLSearchParams||ArrayBuffer.isView(c.data)||["Blob","File","FormData"].includes(c.data?.constructor?.name||"");if(c.multipart?.length){let a=await l();b.set("content-type",`multipart/related; boundary=${a}`),c.body=j.Readable.from(this.getMultipartRequest(c.multipart,a))}else e?c.body=c.data:"object"==typeof c.data?"application/x-www-form-urlencoded"===b.get("Content-Type")?c.body=c.paramsSerializer?c.paramsSerializer(c.data):new URLSearchParams(c.data):(b.has("content-type")||b.set("content-type","application/json"),c.body=JSON.stringify(c.data)):c.data&&(c.body=c.data);c.validateStatus=c.validateStatus||this.validateStatus,c.responseType=c.responseType||"unknown",b.has("accept")||"json"!==c.responseType||b.set("accept","application/json");let i=c.proxy||process?.env?.HTTPS_PROXY||process?.env?.https_proxy||process?.env?.HTTP_PROXY||process?.env?.http_proxy;if(c.agent);else if(i&&this.#f(c.url,c.noProxy)){let a=await d.#g();this.agentCache.has(i)?c.agent=this.agentCache.get(i):(c.agent=new a(i,{cert:c.cert,key:c.key}),this.agentCache.set(i,c.agent))}else c.cert&&c.key&&(this.agentCache.has(c.key)?c.agent=this.agentCache.get(c.key):(c.agent=new g.Agent({cert:c.cert,key:c.key}),this.agentCache.set(c.key,c.agent)));return"function"!=typeof c.errorRedactor&&!1!==c.errorRedactor&&(c.errorRedactor=h.defaultErrorRedactor),!c.body||"duplex"in c||(c.duplex="half"),this.#e(c),Object.assign(c,{headers:b,url:c.url instanceof URL?c.url:new URL(c.url)})}#e(a){if(a.timeout){let b=AbortSignal.timeout(a.timeout);a.signal&&!a.signal.aborted?a.signal=AbortSignal.any([a.signal,b]):a.signal=b}}validateStatus(a){return a>=200&&a<300}async getResponseDataFromContentType(a){let b=a.headers.get("Content-Type");if(null===b)return a.text();if((b=b.toLowerCase()).includes("application/json")){let b=await a.text();try{b=JSON.parse(b)}catch{}return b}return b.match(/^text\//)?a.text():a.blob()}async *getMultipartRequest(a,b){let c=`--${b}--`;for(let c of a){let a=c.headers.get("Content-Type")||"application/octet-stream",d=`--${b}\r
Content-Type: ${a}\r
\r
`;yield d,"string"==typeof c.content?yield c.content:yield*c.content,yield"\r\n"}yield c}static #h;static #i;static async #g(){return this.#h||=(await a.A(57882)).HttpsProxyAgent,this.#h}static async #d(){return this.#i||=(await a.A(69375)).default,this.#i}static mergeHeaders(a,...b){for(let c of(a=a instanceof Headers?a:new Headers(a),b))(c instanceof Headers?c:new Headers(c)).forEach((b,c)=>{"set-cookie"===c?a.append(c,b):a.set(c,b)});return a}}c.Gaxios=m,d=m},99853,(a,b,c)=>{"use strict";var d=a.e&&a.e.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),e=a.e&&a.e.__exportStar||function(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||d(b,a,c)};Object.defineProperty(c,"__esModule",{value:!0}),c.instance=c.Gaxios=c.GaxiosError=void 0,c.request=h;let f=a.r(76176);Object.defineProperty(c,"Gaxios",{enumerable:!0,get:function(){return f.Gaxios}});var g=a.r(69565);async function h(a){return c.instance.request(a)}Object.defineProperty(c,"GaxiosError",{enumerable:!0,get:function(){return g.GaxiosError}}),e(a.r(69706),c),c.instance=new f.Gaxios},37062,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.GCE_LINUX_BIOS_PATHS=void 0,c.isGoogleCloudServerless=g,c.isGoogleComputeEngineLinux=h,c.isGoogleComputeEngineMACAddress=i,c.isGoogleComputeEngine=j,c.detectGCPResidency=function(){return g()||j()};let d=a.r(22734),e=a.r(46786);c.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};let f=/^42:01/;function g(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function h(){(0,e.platform)();try{(0,d.statSync)(c.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let a=(0,d.readFileSync)(c.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(a)}catch{return!1}}function i(){for(let a of Object.values((0,e.networkInterfaces)()))if(a){for(let{mac:b}of a)if(f.test(b))return!0}return!1}function j(){return h()||i()}},30168,(a,b,c)=>{!function(c){"use strict";var d,e=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,f=Math.ceil,g=Math.floor,h="[BigNumber Error] ",i=h+"Number primitive has more than 15 significant digits: ",j=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13];function k(a){var b=0|a;return a>0||a===b?b:b-1}function l(a){for(var b,c,d=1,e=a.length,f=a[0]+"";d<e;){for(c=14-(b=a[d++]+"").length;c--;b="0"+b);f+=b}for(e=f.length;48===f.charCodeAt(--e););return f.slice(0,e+1||1)}function m(a,b){var c,d,e=a.c,f=b.c,g=a.s,h=b.s,i=a.e,j=b.e;if(!g||!h)return null;if(c=e&&!e[0],d=f&&!f[0],c||d)return c?d?0:-h:g;if(g!=h)return g;if(c=g<0,d=i==j,!e||!f)return d?0:!e^c?1:-1;if(!d)return i>j^c?1:-1;for(g=0,h=(i=e.length)<(j=f.length)?i:j;g<h;g++)if(e[g]!=f[g])return e[g]>f[g]^c?1:-1;return i==j?0:i>j^c?1:-1}function n(a,b,c,d){if(a<b||a>c||a!==g(a))throw Error(h+(d||"Argument")+("number"==typeof a?a<b||a>c?" out of range: ":" not an integer: ":" not a primitive number: ")+String(a))}function o(a){var b=a.c.length-1;return k(a.e/14)==b&&a.c[b]%2!=0}function p(a,b){return(a.length>1?a.charAt(0)+"."+a.slice(1):a)+(b<0?"e":"e+")+b}function q(a,b,c){var d,e;if(b<0){for(e=c+".";++b;e+=c);a=e+a}else if(d=a.length,++b>d){for(e=c,b-=d;--b;e+=c);a+=e}else b<d&&(a=a.slice(0,b)+"."+a.slice(b));return a}if((d=function a(b){var c,d,r,s,t,u,v,w,x,y=M.prototype={constructor:M,toString:null,valueOf:null},z=new M(1),A=20,B=4,C=-7,D=21,E=-1e7,F=1e7,G=!1,H=1,I=0,J={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},K="0123456789abcdefghijklmnopqrstuvwxyz",L=!0;function M(a,b){var c,d,f,h,j,k,l,m,o=this;if(!(o instanceof M))return new M(a,b);if(null==b){if(a&&!0===a._isBigNumber){o.s=a.s,!a.c||a.e>F?o.c=o.e=null:a.e<E?o.c=[o.e=0]:(o.e=a.e,o.c=a.c.slice());return}if((k="number"==typeof a)&&0*a==0){if(o.s=1/a<0?(a=-a,-1):1,a===~~a){for(h=0,j=a;j>=10;j/=10,h++);h>F?o.c=o.e=null:(o.e=h,o.c=[a]);return}m=String(a)}else{if(!e.test(m=String(a)))return x(o,m,k);o.s=45==m.charCodeAt(0)?(m=m.slice(1),-1):1}(h=m.indexOf("."))>-1&&(m=m.replace(".","")),(j=m.search(/e/i))>0?(h<0&&(h=j),h+=+m.slice(j+1),m=m.substring(0,j)):h<0&&(h=m.length)}else{if(n(b,2,K.length,"Base"),10==b&&L)return Q(o=new M(a),A+o.e+1,B);if(m=String(a),k="number"==typeof a){if(0*a!=0)return x(o,m,k,b);if(o.s=1/a<0?(m=m.slice(1),-1):1,M.DEBUG&&m.replace(/^0\.0*|\./,"").length>15)throw Error(i+a)}else o.s=45===m.charCodeAt(0)?(m=m.slice(1),-1):1;for(c=K.slice(0,b),h=j=0,l=m.length;j<l;j++)if(0>c.indexOf(d=m.charAt(j))){if("."==d){if(j>h){h=l;continue}}else if(!f&&(m==m.toUpperCase()&&(m=m.toLowerCase())||m==m.toLowerCase()&&(m=m.toUpperCase()))){f=!0,j=-1,h=0;continue}return x(o,String(a),k,b)}k=!1,(h=(m=w(m,b,10,o.s)).indexOf("."))>-1?m=m.replace(".",""):h=m.length}for(j=0;48===m.charCodeAt(j);j++);for(l=m.length;48===m.charCodeAt(--l););if(m=m.slice(j,++l)){if(l-=j,k&&M.DEBUG&&l>15&&(a>0x1fffffffffffff||a!==g(a)))throw Error(i+o.s*a);if((h=h-j-1)>F)o.c=o.e=null;else if(h<E)o.c=[o.e=0];else{if(o.e=h,o.c=[],j=(h+1)%14,h<0&&(j+=14),j<l){for(j&&o.c.push(+m.slice(0,j)),l-=14;j<l;)o.c.push(+m.slice(j,j+=14));j=14-(m=m.slice(j)).length}else j-=l;for(;j--;m+="0");o.c.push(+m)}}else o.c=[o.e=0]}function N(a,b,c,d){var e,f,g,h,i;if(null==c?c=B:n(c,0,8),!a.c)return a.toString();if(e=a.c[0],g=a.e,null==b)i=l(a.c),i=1==d||2==d&&(g<=C||g>=D)?p(i,g):q(i,g,"0");else if(f=(a=Q(new M(a),b,c)).e,h=(i=l(a.c)).length,1==d||2==d&&(b<=f||f<=C)){for(;h<b;i+="0",h++);i=p(i,f)}else if(b-=g+(2===d&&f>g),i=q(i,f,"0"),f+1>h){if(--b>0)for(i+=".";b--;i+="0");}else if((b+=f-h)>0)for(f+1==h&&(i+=".");b--;i+="0");return a.s<0&&e?"-"+i:i}function O(a,b){for(var c,d,e=1,f=new M(a[0]);e<a.length;e++)(d=new M(a[e])).s&&(c=m(f,d))!==b&&(0!==c||f.s!==b)||(f=d);return f}function P(a,b,c){for(var d=1,e=b.length;!b[--e];b.pop());for(e=b[0];e>=10;e/=10,d++);return(c=d+14*c-1)>F?a.c=a.e=null:c<E?a.c=[a.e=0]:(a.e=c,a.c=b),a}function Q(a,b,c,d){var e,h,i,k,l,m,n,o=a.c;if(o){a:{for(e=1,k=o[0];k>=10;k/=10,e++);if((h=b-e)<0)h+=14,i=b,n=g((l=o[m=0])/j[e-i-1]%10);else if((m=f((h+1)/14))>=o.length)if(d){for(;o.length<=m;o.push(0));l=n=0,e=1,h%=14,i=h-14+1}else break a;else{for(e=1,l=k=o[m];k>=10;k/=10,e++);h%=14,n=(i=h-14+e)<0?0:g(l/j[e-i-1]%10)}if(d=d||b<0||null!=o[m+1]||(i<0?l:l%j[e-i-1]),d=c<4?(n||d)&&(0==c||c==(a.s<0?3:2)):n>5||5==n&&(4==c||d||6==c&&(h>0?i>0?l/j[e-i]:0:o[m-1])%10&1||c==(a.s<0?8:7)),b<1||!o[0])return o.length=0,d?(b-=a.e+1,o[0]=j[(14-b%14)%14],a.e=-b||0):o[0]=a.e=0,a;if(0==h?(o.length=m,k=1,m--):(o.length=m+1,k=j[14-h],o[m]=i>0?g(l/j[e-i]%j[i])*k:0),d)for(;;)if(0==m){for(h=1,i=o[0];i>=10;i/=10,h++);for(i=o[0]+=k,k=1;i>=10;i/=10,k++);h!=k&&(a.e++,1e14==o[0]&&(o[0]=1));break}else{if(o[m]+=k,1e14!=o[m])break;o[m--]=0,k=1}for(h=o.length;0===o[--h];o.pop());}a.e>F?a.c=a.e=null:a.e<E&&(a.c=[a.e=0])}return a}function R(a){var b,c=a.e;return null===c?a.toString():(b=l(a.c),b=c<=C||c>=D?p(b,c):q(b,c,"0"),a.s<0?"-"+b:b)}return M.clone=a,M.ROUND_UP=0,M.ROUND_DOWN=1,M.ROUND_CEIL=2,M.ROUND_FLOOR=3,M.ROUND_HALF_UP=4,M.ROUND_HALF_DOWN=5,M.ROUND_HALF_EVEN=6,M.ROUND_HALF_CEIL=7,M.ROUND_HALF_FLOOR=8,M.EUCLID=9,M.config=M.set=function(a){var b,c;if(null!=a)if("object"==typeof a){if(a.hasOwnProperty(b="DECIMAL_PLACES")&&(n(c=a[b],0,1e9,b),A=c),a.hasOwnProperty(b="ROUNDING_MODE")&&(n(c=a[b],0,8,b),B=c),a.hasOwnProperty(b="EXPONENTIAL_AT")&&((c=a[b])&&c.pop?(n(c[0],-1e9,0,b),n(c[1],0,1e9,b),C=c[0],D=c[1]):(n(c,-1e9,1e9,b),C=-(D=c<0?-c:c))),a.hasOwnProperty(b="RANGE"))if((c=a[b])&&c.pop)n(c[0],-1e9,-1,b),n(c[1],1,1e9,b),E=c[0],F=c[1];else if(n(c,-1e9,1e9,b),c)E=-(F=c<0?-c:c);else throw Error(h+b+" cannot be zero: "+c);if(a.hasOwnProperty(b="CRYPTO"))if(!!(c=a[b])===c)if(c)if("undefined"!=typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))G=c;else throw G=!c,Error(h+"crypto unavailable");else G=c;else throw Error(h+b+" not true or false: "+c);if(a.hasOwnProperty(b="MODULO_MODE")&&(n(c=a[b],0,9,b),H=c),a.hasOwnProperty(b="POW_PRECISION")&&(n(c=a[b],0,1e9,b),I=c),a.hasOwnProperty(b="FORMAT"))if("object"==typeof(c=a[b]))J=c;else throw Error(h+b+" not an object: "+c);if(a.hasOwnProperty(b="ALPHABET")){if("string"!=typeof(c=a[b])||/^.?$|[+\-.\s]|(.).*\1/.test(c))throw Error(h+b+" invalid: "+c);L="0123456789"==c.slice(0,10),K=c}}else throw Error(h+"Object expected: "+a);return{DECIMAL_PLACES:A,ROUNDING_MODE:B,EXPONENTIAL_AT:[C,D],RANGE:[E,F],CRYPTO:G,MODULO_MODE:H,POW_PRECISION:I,FORMAT:J,ALPHABET:K}},M.isBigNumber=function(a){if(!a||!0!==a._isBigNumber)return!1;if(!M.DEBUG)return!0;var b,c,d=a.c,e=a.e,f=a.s;a:if("[object Array]"==({}).toString.call(d)){if((1===f||-1===f)&&e>=-1e9&&e<=1e9&&e===g(e)){if(0===d[0]){if(0===e&&1===d.length)return!0;break a}if((b=(e+1)%14)<1&&(b+=14),String(d[0]).length==b){for(b=0;b<d.length;b++)if((c=d[b])<0||c>=1e14||c!==g(c))break a;if(0!==c)return!0}}}else if(null===d&&null===e&&(null===f||1===f||-1===f))return!0;throw Error(h+"Invalid BigNumber: "+a)},M.maximum=M.max=function(){return O(arguments,-1)},M.minimum=M.min=function(){return O(arguments,1)},c=0x20000000000000*Math.random()&2097151?function(){return g(0x20000000000000*Math.random())}:function(){return(0x40000000*Math.random()|0)*8388608+(8388608*Math.random()|0)},M.random=function(a){var b,d,e,i,k,l=0,m=[],o=new M(z);if(null==a?a=A:n(a,0,1e9),i=f(a/14),G)if(crypto.getRandomValues){for(b=crypto.getRandomValues(new Uint32Array(i*=2));l<i;)(k=131072*b[l]+(b[l+1]>>>11))>=9e15?(d=crypto.getRandomValues(new Uint32Array(2)),b[l]=d[0],b[l+1]=d[1]):(m.push(k%1e14),l+=2);l=i/2}else if(crypto.randomBytes){for(b=crypto.randomBytes(i*=7);l<i;)(k=(31&b[l])*0x1000000000000+0x10000000000*b[l+1]+0x100000000*b[l+2]+0x1000000*b[l+3]+(b[l+4]<<16)+(b[l+5]<<8)+b[l+6])>=9e15?crypto.randomBytes(7).copy(b,l):(m.push(k%1e14),l+=7);l=i/7}else throw G=!1,Error(h+"crypto unavailable");if(!G)for(;l<i;)(k=c())<9e15&&(m[l++]=k%1e14);for(i=m[--l],a%=14,i&&a&&(k=j[14-a],m[l]=g(i/k)*k);0===m[l];m.pop(),l--);if(l<0)m=[e=0];else{for(e=-1;0===m[0];m.splice(0,1),e-=14);for(l=1,k=m[0];k>=10;k/=10,l++);l<14&&(e-=14-l)}return o.e=e,o.c=m,o},M.sum=function(){for(var a=1,b=arguments,c=new M(b[0]);a<b.length;)c=c.plus(b[a++]);return c},w=function(){var a="0123456789";function b(a,b,c,d){for(var e,f,g=[0],h=0,i=a.length;h<i;){for(f=g.length;f--;g[f]*=b);for(g[0]+=d.indexOf(a.charAt(h++)),e=0;e<g.length;e++)g[e]>c-1&&(null==g[e+1]&&(g[e+1]=0),g[e+1]+=g[e]/c|0,g[e]%=c)}return g.reverse()}return function(c,d,e,f,g){var h,i,j,k,m,n,o,p,r=c.indexOf("."),s=A,t=B;for(r>=0&&(k=I,I=0,c=c.replace(".",""),n=(p=new M(d)).pow(c.length-r),I=k,p.c=b(q(l(n.c),n.e,"0"),10,e,a),p.e=p.c.length),j=k=(o=b(c,d,e,g?(h=K,a):(h=a,K))).length;0==o[--k];o.pop());if(!o[0])return h.charAt(0);if(r<0?--j:(n.c=o,n.e=j,n.s=f,o=(n=v(n,p,s,t,e)).c,m=n.r,j=n.e),r=o[i=j+s+1],k=e/2,m=m||i<0||null!=o[i+1],m=t<4?(null!=r||m)&&(0==t||t==(n.s<0?3:2)):r>k||r==k&&(4==t||m||6==t&&1&o[i-1]||t==(n.s<0?8:7)),i<1||!o[0])c=m?q(h.charAt(1),-s,h.charAt(0)):h.charAt(0);else{if(o.length=i,m)for(--e;++o[--i]>e;)o[i]=0,i||(++j,o=[1].concat(o));for(k=o.length;!o[--k];);for(r=0,c="";r<=k;c+=h.charAt(o[r++]));c=q(c,j,h.charAt(0))}return c}}(),v=function(){function a(a,b,c){var d,e,f,g,h=0,i=a.length,j=b%1e7,k=b/1e7|0;for(a=a.slice();i--;)d=k*(f=a[i]%1e7)+(g=a[i]/1e7|0)*j,h=((e=j*f+d%1e7*1e7+h)/c|0)+(d/1e7|0)+k*g,a[i]=e%c;return h&&(a=[h].concat(a)),a}function b(a,b,c,d){var e,f;if(c!=d)f=c>d?1:-1;else for(e=f=0;e<c;e++)if(a[e]!=b[e]){f=a[e]>b[e]?1:-1;break}return f}function c(a,b,c,d){for(var e=0;c--;)a[c]-=e,e=+(a[c]<b[c]),a[c]=e*d+a[c]-b[c];for(;!a[0]&&a.length>1;a.splice(0,1));}return function(d,e,f,h,i){var j,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=d.s==e.s?1:-1,C=d.c,D=e.c;if(!C||!C[0]||!D||!D[0])return new M(!d.s||!e.s||(C?D&&C[0]==D[0]:!D)?NaN:C&&0==C[0]||!D?0*B:B/0);for(s=(r=new M(B)).c=[],B=f+(l=d.e-e.e)+1,i||(i=1e14,l=k(d.e/14)-k(e.e/14),B=B/14|0),m=0;D[m]==(C[m]||0);m++);if(D[m]>(C[m]||0)&&l--,B<0)s.push(1),n=!0;else{for(x=C.length,z=D.length,m=0,B+=2,(o=g(i/(D[0]+1)))>1&&(D=a(D,o,i),C=a(C,o,i),z=D.length,x=C.length),w=z,u=(t=C.slice(0,z)).length;u<z;t[u++]=0);A=[0].concat(A=D.slice()),y=D[0],D[1]>=i/2&&y++;do{if(o=0,(j=b(D,t,z,u))<0){if(v=t[0],z!=u&&(v=v*i+(t[1]||0)),(o=g(v/y))>1)for(o>=i&&(o=i-1),q=(p=a(D,o,i)).length,u=t.length;1==b(p,t,q,u);)o--,c(p,z<q?A:D,q,i),q=p.length,j=1;else 0==o&&(j=o=1),q=(p=D.slice()).length;if(q<u&&(p=[0].concat(p)),c(t,p,u,i),u=t.length,-1==j)for(;1>b(D,t,z,u);)o++,c(t,z<u?A:D,u,i),u=t.length}else 0===j&&(o++,t=[0]);s[m++]=o,t[0]?t[u++]=C[w]||0:(t=[C[w]],u=1)}while((w++<x||null!=t[0])&&B--)n=null!=t[0],s[0]||s.splice(0,1)}if(1e14==i){for(m=1,B=s[0];B>=10;B/=10,m++);Q(r,f+(r.e=m+14*l-1)+1,h,n)}else r.e=l,r.r=+n;return r}}(),d=/^(-?)0([xbo])(?=\w[\w.]*$)/i,r=/^([^.]+)\.$/,s=/^\.([^.]+)$/,t=/^-?(Infinity|NaN)$/,u=/^\s*\+(?=[\w.])|^\s+|\s+$/g,x=function(a,b,c,e){var f,g=c?b:b.replace(u,"");if(t.test(g))a.s=isNaN(g)?null:g<0?-1:1;else{if(!c&&(g=g.replace(d,function(a,b,c){return f="x"==(c=c.toLowerCase())?16:"b"==c?2:8,e&&e!=f?a:b}),e&&(f=e,g=g.replace(r,"$1").replace(s,"0.$1")),b!=g))return new M(g,f);if(M.DEBUG)throw Error(h+"Not a"+(e?" base "+e:"")+" number: "+b);a.s=null}a.c=a.e=null},y.absoluteValue=y.abs=function(){var a=new M(this);return a.s<0&&(a.s=1),a},y.comparedTo=function(a,b){return m(this,new M(a,b))},y.decimalPlaces=y.dp=function(a,b){var c,d,e;if(null!=a)return n(a,0,1e9),null==b?b=B:n(b,0,8),Q(new M(this),a+this.e+1,b);if(!(c=this.c))return null;if(d=((e=c.length-1)-k(this.e/14))*14,e=c[e])for(;e%10==0;e/=10,d--);return d<0&&(d=0),d},y.dividedBy=y.div=function(a,b){return v(this,new M(a,b),A,B)},y.dividedToIntegerBy=y.idiv=function(a,b){return v(this,new M(a,b),0,1)},y.exponentiatedBy=y.pow=function(a,b){var c,d,e,i,j,k,l,m,n,p=this;if((a=new M(a)).c&&!a.isInteger())throw Error(h+"Exponent not an integer: "+R(a));if(null!=b&&(b=new M(b)),k=a.e>14,!p.c||!p.c[0]||1==p.c[0]&&!p.e&&1==p.c.length||!a.c||!a.c[0])return n=new M(Math.pow(+R(p),k?a.s*(2-o(a)):+R(a))),b?n.mod(b):n;if(l=a.s<0,b){if(b.c?!b.c[0]:!b.s)return new M(NaN);(d=!l&&p.isInteger()&&b.isInteger())&&(p=p.mod(b))}else{if(a.e>9&&(p.e>0||p.e<-1||(0==p.e?p.c[0]>1||k&&p.c[1]>=24e7:p.c[0]<8e13||k&&p.c[0]<=9999975e7)))return i=p.s<0&&o(a)?-0:0,p.e>-1&&(i=1/i),new M(l?1/i:i);I&&(i=f(I/14+2))}for(k?(c=new M(.5),l&&(a.s=1),m=o(a)):m=(e=Math.abs(+R(a)))%2,n=new M(z);;){if(m){if(!(n=n.times(p)).c)break;i?n.c.length>i&&(n.c.length=i):d&&(n=n.mod(b))}if(e){if(0===(e=g(e/2)))break;m=e%2}else if(Q(a=a.times(c),a.e+1,1),a.e>14)m=o(a);else{if(0==(e=+R(a)))break;m=e%2}p=p.times(p),i?p.c&&p.c.length>i&&(p.c.length=i):d&&(p=p.mod(b))}return d?n:(l&&(n=z.div(n)),b?n.mod(b):i?Q(n,I,B,j):n)},y.integerValue=function(a){var b=new M(this);return null==a?a=B:n(a,0,8),Q(b,b.e+1,a)},y.isEqualTo=y.eq=function(a,b){return 0===m(this,new M(a,b))},y.isFinite=function(){return!!this.c},y.isGreaterThan=y.gt=function(a,b){return m(this,new M(a,b))>0},y.isGreaterThanOrEqualTo=y.gte=function(a,b){return 1===(b=m(this,new M(a,b)))||0===b},y.isInteger=function(){return!!this.c&&k(this.e/14)>this.c.length-2},y.isLessThan=y.lt=function(a,b){return 0>m(this,new M(a,b))},y.isLessThanOrEqualTo=y.lte=function(a,b){return -1===(b=m(this,new M(a,b)))||0===b},y.isNaN=function(){return!this.s},y.isNegative=function(){return this.s<0},y.isPositive=function(){return this.s>0},y.isZero=function(){return!!this.c&&0==this.c[0]},y.minus=function(a,b){var c,d,e,f,g=this.s;if(b=(a=new M(a,b)).s,!g||!b)return new M(NaN);if(g!=b)return a.s=-b,this.plus(a);var h=this.e/14,i=a.e/14,j=this.c,l=a.c;if(!h||!i){if(!j||!l)return j?(a.s=-b,a):new M(l?this:NaN);if(!j[0]||!l[0])return l[0]?(a.s=-b,a):new M(j[0]?this:3==B?-0:0)}if(h=k(h),i=k(i),j=j.slice(),g=h-i){for((f=g<0)?(g=-g,e=j):(i=h,e=l),e.reverse(),b=g;b--;e.push(0));e.reverse()}else for(d=(f=(g=j.length)<(b=l.length))?g:b,g=b=0;b<d;b++)if(j[b]!=l[b]){f=j[b]<l[b];break}if(f&&(e=j,j=l,l=e,a.s=-a.s),(b=(d=l.length)-(c=j.length))>0)for(;b--;j[c++]=0);for(b=1e14-1;d>g;){if(j[--d]<l[d]){for(c=d;c&&!j[--c];j[c]=b);--j[c],j[d]+=1e14}j[d]-=l[d]}for(;0==j[0];j.splice(0,1),--i);return j[0]?P(a,j,i):(a.s=3==B?-1:1,a.c=[a.e=0],a)},y.modulo=y.mod=function(a,b){var c,d;return(a=new M(a,b),this.c&&a.s&&(!a.c||a.c[0]))?a.c&&(!this.c||this.c[0])?(9==H?(d=a.s,a.s=1,c=v(this,a,0,3),a.s=d,c.s*=d):c=v(this,a,0,H),(a=this.minus(c.times(a))).c[0]||1!=H||(a.s=this.s),a):new M(this):new M(NaN)},y.multipliedBy=y.times=function(a,b){var c,d,e,f,g,h,i,j,l,m,n,o,p,q=this.c,r=(a=new M(a,b)).c;if(!q||!r||!q[0]||!r[0])return this.s&&a.s&&(!q||q[0]||r)&&(!r||r[0]||q)?(a.s*=this.s,q&&r?(a.c=[0],a.e=0):a.c=a.e=null):a.c=a.e=a.s=null,a;for(d=k(this.e/14)+k(a.e/14),a.s*=this.s,(i=q.length)<(m=r.length)&&(p=q,q=r,r=p,e=i,i=m,m=e),e=i+m,p=[];e--;p.push(0));for(e=m;--e>=0;){for(c=0,n=r[e]%1e7,o=r[e]/1e7|0,f=e+(g=i);f>e;)h=o*(j=q[--g]%1e7)+(l=q[g]/1e7|0)*n,c=((j=n*j+h%1e7*1e7+p[f]+c)/1e14|0)+(h/1e7|0)+o*l,p[f--]=j%1e14;p[f]=c}return c?++d:p.splice(0,1),P(a,p,d)},y.negated=function(){var a=new M(this);return a.s=-a.s||null,a},y.plus=function(a,b){var c,d=this.s;if(b=(a=new M(a,b)).s,!d||!b)return new M(NaN);if(d!=b)return a.s=-b,this.minus(a);var e=this.e/14,f=a.e/14,g=this.c,h=a.c;if(!e||!f){if(!g||!h)return new M(d/0);if(!g[0]||!h[0])return h[0]?a:new M(g[0]?this:0*d)}if(e=k(e),f=k(f),g=g.slice(),d=e-f){for(d>0?(f=e,c=h):(d=-d,c=g),c.reverse();d--;c.push(0));c.reverse()}for((d=g.length)-(b=h.length)<0&&(c=h,h=g,g=c,b=d),d=0;b;)d=(g[--b]=g[b]+h[b]+d)/1e14|0,g[b]=1e14===g[b]?0:g[b]%1e14;return d&&(g=[d].concat(g),++f),P(a,g,f)},y.precision=y.sd=function(a,b){var c,d,e;if(null!=a&&!!a!==a)return n(a,1,1e9),null==b?b=B:n(b,0,8),Q(new M(this),a,b);if(!(c=this.c))return null;if(d=14*(e=c.length-1)+1,e=c[e]){for(;e%10==0;e/=10,d--);for(e=c[0];e>=10;e/=10,d++);}return a&&this.e+1>d&&(d=this.e+1),d},y.shiftedBy=function(a){return n(a,-0x1fffffffffffff,0x1fffffffffffff),this.times("1e"+a)},y.squareRoot=y.sqrt=function(){var a,b,c,d,e,f=this.c,g=this.s,h=this.e,i=A+4,j=new M("0.5");if(1!==g||!f||!f[0])return new M(!g||g<0&&(!f||f[0])?NaN:f?this:1/0);if(0==(g=Math.sqrt(+R(this)))||g==1/0?(((b=l(f)).length+h)%2==0&&(b+="0"),g=Math.sqrt(+b),h=k((h+1)/2)-(h<0||h%2),c=new M(b=g==1/0?"5e"+h:(b=g.toExponential()).slice(0,b.indexOf("e")+1)+h)):c=new M(g+""),c.c[0]){for((g=(h=c.e)+i)<3&&(g=0);;)if(e=c,c=j.times(e.plus(v(this,e,i,1))),l(e.c).slice(0,g)===(b=l(c.c)).slice(0,g)){if(c.e<h&&--g,"9999"!=(b=b.slice(g-3,g+1))&&(d||"4999"!=b)){+b&&(+b.slice(1)||"5"!=b.charAt(0))||(Q(c,c.e+A+2,1),a=!c.times(c).eq(this));break}if(!d&&(Q(e,e.e+A+2,0),e.times(e).eq(this))){c=e;break}i+=4,g+=4,d=1}}return Q(c,c.e+A+1,B,a)},y.toExponential=function(a,b){return null!=a&&(n(a,0,1e9),a++),N(this,a,b,1)},y.toFixed=function(a,b){return null!=a&&(n(a,0,1e9),a=a+this.e+1),N(this,a,b)},y.toFormat=function(a,b,c){var d;if(null==c)null!=a&&b&&"object"==typeof b?(c=b,b=null):a&&"object"==typeof a?(c=a,a=b=null):c=J;else if("object"!=typeof c)throw Error(h+"Argument not an object: "+c);if(d=this.toFixed(a,b),this.c){var e,f=d.split("."),g=+c.groupSize,i=+c.secondaryGroupSize,j=c.groupSeparator||"",k=f[0],l=f[1],m=this.s<0,n=m?k.slice(1):k,o=n.length;if(i&&(e=g,g=i,i=e,o-=e),g>0&&o>0){for(e=o%g||g,k=n.substr(0,e);e<o;e+=g)k+=j+n.substr(e,g);i>0&&(k+=j+n.slice(e)),m&&(k="-"+k)}d=l?k+(c.decimalSeparator||"")+((i=+c.fractionGroupSize)?l.replace(RegExp("\\d{"+i+"}\\B","g"),"$&"+(c.fractionGroupSeparator||"")):l):k}return(c.prefix||"")+d+(c.suffix||"")},y.toFraction=function(a){var b,c,d,e,f,g,i,k,m,n,o,p,q=this.c;if(null!=a&&(!(i=new M(a)).isInteger()&&(i.c||1!==i.s)||i.lt(z)))throw Error(h+"Argument "+(i.isInteger()?"out of range: ":"not an integer: ")+R(i));if(!q)return new M(this);for(b=new M(z),m=c=new M(z),d=k=new M(z),p=l(q),f=b.e=p.length-this.e-1,b.c[0]=j[(g=f%14)<0?14+g:g],a=!a||i.comparedTo(b)>0?f>0?b:m:i,g=F,F=1/0,i=new M(p),k.c[0]=0;n=v(i,b,0,1),1!=(e=c.plus(n.times(d))).comparedTo(a);)c=d,d=e,m=k.plus(n.times(e=m)),k=e,b=i.minus(n.times(e=b)),i=e;return e=v(a.minus(c),d,0,1),k=k.plus(e.times(m)),c=c.plus(e.times(d)),k.s=m.s=this.s,f*=2,o=1>v(m,d,f,B).minus(this).abs().comparedTo(v(k,c,f,B).minus(this).abs())?[m,d]:[k,c],F=g,o},y.toNumber=function(){return+R(this)},y.toPrecision=function(a,b){return null!=a&&n(a,1,1e9),N(this,a,b,2)},y.toString=function(a){var b,c=this,d=c.s,e=c.e;return null===e?d?(b="Infinity",d<0&&(b="-"+b)):b="NaN":(null==a?b=e<=C||e>=D?p(l(c.c),e):q(l(c.c),e,"0"):10===a&&L?b=q(l((c=Q(new M(c),A+e+1,B)).c),c.e,"0"):(n(a,2,K.length,"Base"),b=w(q(l(c.c),e,"0"),10,a,d,!0)),d<0&&c.c[0]&&(b="-"+b)),b},y.valueOf=y.toJSON=function(){return R(this)},y._isBigNumber=!0,null!=b&&M.set(b),M}()).default=d.BigNumber=d,"function"==typeof define&&define.amd)a.r,void 0!==d&&a.v(d);else b.exports?b.exports=d:(c||(c="undefined"!=typeof self&&self?self:window),c.BigNumber=d)}(a.e)},47006,(a,b,c)=>{var d=a.r(30168),e=b.exports;!function(){"use strict";var a,b,c,f=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,g={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function h(a){return f.lastIndex=0,f.test(a)?'"'+a.replace(f,function(a){var b=g[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}"function"!=typeof e.stringify&&(e.stringify=function(e,f,g){var i;if(a="",b="","number"==typeof g)for(i=0;i<g;i+=1)b+=" ";else"string"==typeof g&&(b=g);if(c=f,f&&"function"!=typeof f&&("object"!=typeof f||"number"!=typeof f.length))throw Error("JSON.stringify");return function e(f,g){var i,j,k,l,m,n=a,o=g[f],p=null!=o&&(o instanceof d||d.isBigNumber(o));switch(o&&"object"==typeof o&&"function"==typeof o.toJSON&&(o=o.toJSON(f)),"function"==typeof c&&(o=c.call(g,f,o)),typeof o){case"string":if(p)return o;return h(o);case"number":return isFinite(o)?String(o):"null";case"boolean":case"null":case"bigint":return String(o);case"object":if(!o)return"null";if(a+=b,m=[],"[object Array]"===Object.prototype.toString.apply(o)){for(i=0,l=o.length;i<l;i+=1)m[i]=e(i,o)||"null";return k=0===m.length?"[]":a?"[\n"+a+m.join(",\n"+a)+"\n"+n+"]":"["+m.join(",")+"]",a=n,k}if(c&&"object"==typeof c)for(i=0,l=c.length;i<l;i+=1)"string"==typeof c[i]&&(k=e(j=c[i],o))&&m.push(h(j)+(a?": ":":")+k);else Object.keys(o).forEach(function(b){var c=e(b,o);c&&m.push(h(b)+(a?": ":":")+c)});return k=0===m.length?"{}":a?"{\n"+a+m.join(",\n"+a)+"\n"+n+"}":"{"+m.join(",")+"}",a=n,k}}("",{"":e})})}()},27545,(a,b,c)=>{var d=null;let e=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,f=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/;b.exports=function(b){"use strict";var c={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(null!=b){if(!0===b.strict&&(c.strict=!0),!0===b.storeAsString&&(c.storeAsString=!0),c.alwaysParseAsBig=!0===b.alwaysParseAsBig&&b.alwaysParseAsBig,c.useNativeBigInt=!0===b.useNativeBigInt&&b.useNativeBigInt,void 0!==b.constructorAction)if("error"===b.constructorAction||"ignore"===b.constructorAction||"preserve"===b.constructorAction)c.constructorAction=b.constructorAction;else throw Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${b.constructorAction}`);if(void 0!==b.protoAction)if("error"===b.protoAction||"ignore"===b.protoAction||"preserve"===b.protoAction)c.protoAction=b.protoAction;else throw Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${b.protoAction}`)}var g,h,i,j,k={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},l=function(a){throw{name:"SyntaxError",message:a,at:g,text:i}},m=function(a){return a&&a!==h&&l("Expected '"+a+"' instead of '"+h+"'"),h=i.charAt(g),g+=1,h},n=function(){var b,e="";for("-"===h&&(e="-",m("-"));h>="0"&&h<="9";)e+=h,m();if("."===h)for(e+=".";m()&&h>="0"&&h<="9";)e+=h;if("e"===h||"E"===h)for(e+=h,m(),("-"===h||"+"===h)&&(e+=h,m());h>="0"&&h<="9";)e+=h,m();if(isFinite(b=+e))return(null==d&&(d=a.r(30168)),e.length>15)?c.storeAsString?e:c.useNativeBigInt?BigInt(e):new d(e):c.alwaysParseAsBig?c.useNativeBigInt?BigInt(b):new d(b):b;l("Bad number")},o=function(){var a,b,c,d="";if('"'===h)for(var e=g;m();){if('"'===h)return g-1>e&&(d+=i.substring(e,g-1)),m(),d;if("\\"===h){if(g-1>e&&(d+=i.substring(e,g-1)),m(),"u"===h){for(b=0,c=0;b<4&&isFinite(a=parseInt(m(),16));b+=1)c=16*c+a;d+=String.fromCharCode(c)}else if("string"==typeof k[h])d+=k[h];else break;e=g}}l("Bad string")},p=function(){for(;h&&h<=" ";)m()},q=function(){switch(h){case"t":return m("t"),m("r"),m("u"),m("e"),!0;case"f":return m("f"),m("a"),m("l"),m("s"),m("e"),!1;case"n":return m("n"),m("u"),m("l"),m("l"),null}l("Unexpected '"+h+"'")},r=function(){var a=[];if("["===h){if(m("["),p(),"]"===h)return m("]"),a;for(;h;){if(a.push(j()),p(),"]"===h)return m("]"),a;m(","),p()}}l("Bad array")},s=function(){var a,b=Object.create(null);if("{"===h){if(m("{"),p(),"}"===h)return m("}"),b;for(;h;){if(a=o(),p(),m(":"),!0===c.strict&&Object.hasOwnProperty.call(b,a)&&l('Duplicate key "'+a+'"'),!0===e.test(a)?"error"===c.protoAction?l("Object contains forbidden prototype property"):"ignore"===c.protoAction?j():b[a]=j():!0===f.test(a)?"error"===c.constructorAction?l("Object contains forbidden constructor property"):"ignore"===c.constructorAction?j():b[a]=j():b[a]=j(),p(),"}"===h)return m("}"),b;m(","),p()}}l("Bad object")};return j=function(){switch(p(),h){case"{":return s();case"[":return r();case'"':return o();case"-":return n();default:return h>="0"&&h<="9"?n():q()}},function(a,b){var c;return i=a+"",g=0,h=" ",c=j(),p(),h&&l("Syntax error"),"function"==typeof b?function a(c,d){var e,f=c[d];return f&&"object"==typeof f&&Object.keys(f).forEach(function(b){void 0!==(e=a(f,b))?f[b]=e:delete f[b]}),b.call(c,d,f)}({"":c},""):c}}},31553,(a,b,c)=>{var d=a.r(47006).stringify,e=a.r(27545);b.exports=function(a){return{parse:e(a),stringify:d}},b.exports.parse=e(),b.exports.stringify=d},27699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},5365,(a,b,c)=>{b.exports=a.x("process",()=>require("process"))},22852,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Colours=void 0;class d{static isEnabled(a){return a&&a.isTTY&&("function"!=typeof a.getColorDepth||a.getColorDepth()>2)}static refresh(){d.enabled=d.isEnabled(null==process?void 0:process.stderr),this.enabled?(d.reset="\x1b[0m",d.bright="\x1b[1m",d.dim="\x1b[2m",d.red="\x1b[31m",d.green="\x1b[32m",d.yellow="\x1b[33m",d.blue="\x1b[34m",d.magenta="\x1b[35m",d.cyan="\x1b[36m",d.white="\x1b[37m",d.grey="\x1b[90m"):(d.reset="",d.bright="",d.dim="",d.red="",d.green="",d.yellow="",d.blue="",d.magenta="",d.cyan="",d.white="",d.grey="")}}c.Colours=d,d.enabled=!1,d.reset="",d.bright="",d.dim="",d.red="",d.green="",d.yellow="",d.blue="",d.magenta="",d.cyan="",d.white="",d.grey="",d.refresh()},91100,(a,b,c)=>{"use strict";let d;var e,f,g,h=a.e&&a.e.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),i=a.e&&a.e.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:!0,value:b})}:function(a,b){a.default=b}),j=a.e&&a.e.__importStar||(e=function(a){return(e=Object.getOwnPropertyNames||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[b.length]=c);return b})(a)},function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c=e(a),d=0;d<c.length;d++)"default"!==c[d]&&h(b,a,c[d]);return i(b,a),b});Object.defineProperty(c,"__esModule",{value:!0}),c.env=c.DebugLogBackendBase=c.placeholder=c.AdhocDebugLogger=c.LogSeverity=void 0,c.getNodeBackend=r,c.getDebugBackend=function(a){return new s(a)},c.getStructuredBackend=function(a){return new t(a)},c.setBackend=function(a){d=a,u.clear()},c.log=v;let k=a.r(27699),l=j(a.r(5365)),m=j(a.r(24361)),n=a.r(22852);(f=g||(c.LogSeverity=g={})).DEFAULT="DEFAULT",f.DEBUG="DEBUG",f.INFO="INFO",f.WARNING="WARNING",f.ERROR="ERROR";class o extends k.EventEmitter{constructor(a,b){super(),this.namespace=a,this.upstream=b,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(a,b)=>this.on(a,b)}),this.func.debug=(...a)=>this.invokeSeverity(g.DEBUG,...a),this.func.info=(...a)=>this.invokeSeverity(g.INFO,...a),this.func.warn=(...a)=>this.invokeSeverity(g.WARNING,...a),this.func.error=(...a)=>this.invokeSeverity(g.ERROR,...a),this.func.sublog=a=>v(a,this.func)}invoke(a,...b){if(this.upstream)try{this.upstream(a,...b)}catch(a){}try{this.emit("log",a,b)}catch(a){}}invokeSeverity(a,...b){this.invoke({severity:a},...b)}}c.AdhocDebugLogger=o,c.placeholder=new o("",()=>{}).func;class p{constructor(){var a;this.cached=new Map,this.filters=[],this.filtersSet=!1;let b=null!=(a=l.env[c.env.nodeEnables])?a:"*";"all"===b&&(b="*"),this.filters=b.split(",")}log(a,b,...c){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let d=this.cached.get(a);d||(d=this.makeLogger(a),this.cached.set(a,d)),d(b,...c)}catch(a){console.error(a)}}}c.DebugLogBackendBase=p;class q extends p{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(a){return this.enabledRegexp.test(a)}makeLogger(a){return this.enabledRegexp.test(a)?(b,...c)=>{var d;let e,f=`${n.Colours.green}${a}${n.Colours.reset}`,h=`${n.Colours.yellow}${l.pid}${n.Colours.reset}`;switch(b.severity){case g.ERROR:e=`${n.Colours.red}${b.severity}${n.Colours.reset}`;break;case g.INFO:e=`${n.Colours.magenta}${b.severity}${n.Colours.reset}`;break;case g.WARNING:e=`${n.Colours.yellow}${b.severity}${n.Colours.reset}`;break;default:e=null!=(d=b.severity)?d:g.DEFAULT}let i=m.formatWithOptions({colors:n.Colours.enabled},...c),j=Object.assign({},b);delete j.severity;let k=Object.getOwnPropertyNames(j).length?JSON.stringify(j):"",o=k?`${n.Colours.grey}${k}${n.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",h,f,e,i,k?` ${o}`:"")}:()=>{}}setFilters(){let a=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=RegExp(`^${a}$`,"i")}}function r(){return new q}class s extends p{constructor(a){super(),this.debugPkg=a}makeLogger(a){let b=this.debugPkg(a);return(a,...c)=>{b(c[0],...c.slice(1))}}setFilters(){var a;let b=null!=(a=l.env.NODE_DEBUG)?a:"";l.env.NODE_DEBUG=`${b}${b?",":""}${this.filters.join(",")}`}}class t extends p{constructor(a){super(),this.upstream=null!=a?a:void 0}makeLogger(a){var b;let c=null==(b=this.upstream)?void 0:b.makeLogger(a);return(a,...b)=>{var d;let e=JSON.stringify(Object.assign({severity:null!=(d=a.severity)?d:g.INFO,message:m.format(...b)},a));c?c(a,e):console.log("%s",e)}}setFilters(){var a;null==(a=this.upstream)||a.setFilters()}}c.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};let u=new Map;function v(a,b){let e;if(!d&&!l.env[c.env.nodeEnables]||!a)return c.placeholder;b&&(a=`${b.instance.namespace}:${a}`);let f=u.get(a);if(f)return f.func;if(null===d)return c.placeholder;void 0===d&&(d=r());let g=new o(a,(b,...c)=>{if(e!==d){if(null===d)return;void 0===d&&(d=r()),e=d}null==d||d.log(a,b,...c)});return u.set(a,g),g.func}},15979,(a,b,c)=>{"use strict";var d=a.e&&a.e.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),e=a.e&&a.e.__exportStar||function(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||d(b,a,c)};Object.defineProperty(c,"__esModule",{value:!0}),e(a.r(91100),c)},54145,(a,b,c)=>{"use strict";let d;var e,f=a.e&&a.e.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),g=a.e&&a.e.__setModuleDefault||(Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:!0,value:b})}:function(a,b){a.default=b}),h=a.e&&a.e.__importStar||(e=function(a){return(e=Object.getOwnPropertyNames||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[b.length]=c);return b})(a)},function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c=e(a),d=0;d<c.length;d++)"default"!==c[d]&&f(b,a,c[d]);return g(b,a),b}),i=a.e&&a.e.__exportStar||function(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||f(b,a,c)};Object.defineProperty(c,"__esModule",{value:!0}),c.gcpResidencyCache=c.METADATA_SERVER_DETECTION=c.HEADERS=c.HEADER_VALUE=c.HEADER_NAME=c.SECONDARY_HOST_ADDRESS=c.HOST_ADDRESS=c.BASE_PATH=void 0,c.instance=function(a){return p("instance",a)},c.project=function(a){return p("project",a)},c.universe=function(a){return p("universe",a)},c.bulk=r,c.isAvailable=s,c.resetIsAvailableCache=function(){d=void 0},c.getGCPResidency=t,c.setGCPResidency=u,c.requestTimeout=v;let j=a.r(99853),k=a.r(31553),l=a.r(37062),m=h(a.r(15979));c.BASE_PATH="/computeMetadata/v1",c.HOST_ADDRESS="http://169.254.169.254",c.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.",c.HEADER_NAME="Metadata-Flavor",c.HEADER_VALUE="Google",c.HEADERS=Object.freeze({[c.HEADER_NAME]:c.HEADER_VALUE});let n=m.log("gcp-metadata");function o(a){return a||(a=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||c.HOST_ADDRESS),/^https?:\/\//.test(a)||(a=`http://${a}`),new URL(c.BASE_PATH,a).href}async function p(a,b={},d=3,e=!1){let f=new Headers(c.HEADERS),g="",h={};("object"==typeof a?(new Headers(a.headers).forEach((a,b)=>f.set(b,a)),g=a.metadataKey,h=a.params||h,d=a.noResponseRetries||d,e=a.fastFail||e):g=a,"string"==typeof b)?g+=`/${b}`:(Object.keys(b).forEach(a=>{switch(a){case"params":case"property":case"headers":break;case"qs":throw Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw Error(`'${a}' is not a valid configuration option.`)}}),b.property&&(g+=`/${b.property}`),new Headers(b.headers).forEach((a,b)=>f.set(b,a)),h=b.params||h);let i=e?q:j.request,l={url:`${o()}/${g}`,headers:f,retryConfig:{noResponseRetries:d},params:h,responseType:"text",timeout:v()};n.info("instance request %j",l);let m=await i(l);n.info("instance metadata is %s",m.data);let r=m.headers.get(c.HEADER_NAME);if(r!==c.HEADER_VALUE)throw RangeError(`Invalid response from metadata service: incorrect ${c.HEADER_NAME} header. Expected '${c.HEADER_VALUE}', got ${r?`'${r}'`:"no header"}`);if("string"==typeof m.data)try{return k.parse(m.data)}catch{}return m.data}async function q(a){let b={...a,url:a.url?.toString().replace(o(),o(c.SECONDARY_HOST_ADDRESS))};return Promise.any([(0,j.request)(a),(0,j.request)(b)])}async function r(a){let b={};return await Promise.all(a.map(a=>(async()=>{let c=await p(a);b[a.metadataKey]=c})())),b}async function s(){if(process.env.METADATA_SERVER_DETECTION){let a=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(a in c.METADATA_SERVER_DETECTION))throw RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${a}\`, but it should be \`${Object.keys(c.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(a){case"assume-present":return!0;case"none":return!1;case"bios-only":return t()}}try{return void 0===d&&(d=p("instance",void 0,process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0,!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await d,!0}catch(a){if(process.env.DEBUG_AUTH&&console.info(a),"request-timeout"===a.type||a.response&&404===a.response.status)return!1;if(!(a.response&&404===a.response.status)&&(!a.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(a.code.toString()))){let b="UNKNOWN";a.code&&(b=a.code.toString()),process.emitWarning(`received unexpected error = ${a.message} code = ${b}`,"MetadataLookupWarning")}return!1}}function t(){return null===c.gcpResidencyCache&&u(),c.gcpResidencyCache}function u(a=null){c.gcpResidencyCache=null!==a?a:(0,l.detectGCPResidency)()}function v(){return 3e3*!t()}c.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"}),c.gcpResidencyCache=null,i(a.r(37062),c)},35863,(a,b,c)=>{"use strict";c.byteLength=function(a){var b=j(a),c=b[0],d=b[1];return(c+d)*3/4-d},c.toByteArray=function(a){var b,c,d=j(a),g=d[0],h=d[1],i=new f((g+h)*3/4-h),k=0,l=h>0?g-4:g;for(c=0;c<l;c+=4)b=e[a.charCodeAt(c)]<<18|e[a.charCodeAt(c+1)]<<12|e[a.charCodeAt(c+2)]<<6|e[a.charCodeAt(c+3)],i[k++]=b>>16&255,i[k++]=b>>8&255,i[k++]=255&b;return 2===h&&(b=e[a.charCodeAt(c)]<<2|e[a.charCodeAt(c+1)]>>4,i[k++]=255&b),1===h&&(b=e[a.charCodeAt(c)]<<10|e[a.charCodeAt(c+1)]<<4|e[a.charCodeAt(c+2)]>>2,i[k++]=b>>8&255,i[k++]=255&b),i},c.fromByteArray=function(a){for(var b,c=a.length,e=c%3,f=[],g=0,h=c-e;g<h;g+=16383)f.push(function(a,b,c){for(var e,f=[],g=b;g<c;g+=3)e=(a[g]<<16&0xff0000)+(a[g+1]<<8&65280)+(255&a[g+2]),f.push(d[e>>18&63]+d[e>>12&63]+d[e>>6&63]+d[63&e]);return f.join("")}(a,g,g+16383>h?h:g+16383));return 1===e?f.push(d[(b=a[c-1])>>2]+d[b<<4&63]+"=="):2===e&&f.push(d[(b=(a[c-2]<<8)+a[c-1])>>10]+d[b>>4&63]+d[b<<2&63]+"="),f.join("")};for(var d=[],e=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,i=g.length;h<i;++h)d[h]=g[h],e[g.charCodeAt(h)]=h;function j(a){var b=a.length;if(b%4>0)throw Error("Invalid string. Length must be a multiple of 4");var c=a.indexOf("=");-1===c&&(c=b);var d=c===b?0:4-c%4;return[c,d]}e[45]=62,e[95]=63},66051,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.fromArrayBufferToHex=function(a){return Array.from(new Uint8Array(a)).map(a=>a.toString(16).padStart(2,"0")).join("")}},26410,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BrowserCrypto=void 0;let d=a.r(35863),e=a.r(66051);class f{constructor(){throw Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(a){let b=new TextEncoder().encode(a),c=await window.crypto.subtle.digest("SHA-256",b);return d.fromByteArray(new Uint8Array(c))}randomBytesBase64(a){let b=new Uint8Array(a);return window.crypto.getRandomValues(b),d.fromByteArray(b)}static padBase64(a){for(;a.length%4!=0;)a+="=";return a}async verify(a,b,c){let e={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},g=new TextEncoder().encode(b),h=d.toByteArray(f.padBase64(c)),i=await window.crypto.subtle.importKey("jwk",a,e,!0,["verify"]);return await window.crypto.subtle.verify(e,i,h,g)}async sign(a,b){let c={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},e=new TextEncoder().encode(b),f=await window.crypto.subtle.importKey("jwk",a,c,!0,["sign"]),g=await window.crypto.subtle.sign(c,f,e);return d.fromByteArray(new Uint8Array(g))}decodeBase64StringUtf8(a){let b=d.toByteArray(f.padBase64(a));return new TextDecoder().decode(b)}encodeBase64StringUtf8(a){let b=new TextEncoder().encode(a);return d.fromByteArray(b)}async sha256DigestHex(a){let b=new TextEncoder().encode(a),c=await window.crypto.subtle.digest("SHA-256",b);return(0,e.fromArrayBufferToHex)(c)}async signWithHmacSha256(a,b){let c="string"==typeof a?a:String.fromCharCode(...new Uint16Array(a)),d=new TextEncoder,e=await window.crypto.subtle.importKey("raw",d.encode(c),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",e,d.encode(b))}}c.BrowserCrypto=f},66414,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.NodeCrypto=void 0;let d=a.r(54799);c.NodeCrypto=class{async sha256DigestBase64(a){return d.createHash("sha256").update(a).digest("base64")}randomBytesBase64(a){return d.randomBytes(a).toString("base64")}async verify(a,b,c){let e=d.createVerify("RSA-SHA256");return e.update(b),e.end(),e.verify(a,c,"base64")}async sign(a,b){let c=d.createSign("RSA-SHA256");return c.update(b),c.end(),c.sign(a,"base64")}decodeBase64StringUtf8(a){return Buffer.from(a,"base64").toString("utf-8")}encodeBase64StringUtf8(a){return Buffer.from(a,"utf-8").toString("base64")}async sha256DigestHex(a){return d.createHash("sha256").update(a).digest("hex")}async signWithHmacSha256(a,b){var c,e;let f="string"==typeof a?a:(c=a,Buffer.from(c));return(e=d.createHmac("sha256",f).update(b).digest()).buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}}},65726,(a,b,c)=>{"use strict";var d=a.e&&a.e.__createBinding||(Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]}),e=a.e&&a.e.__exportStar||function(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||d(b,a,c)};Object.defineProperty(c,"__esModule",{value:!0}),c.createCrypto=function(){return function(){;}(),new f.NodeCrypto},c.hasBrowserCrypto=g,a.r(26410);let f=a.r(66414);function g(){return!1}e(a.r(66051),c)},45706,(a,b,c)=>{b.exports=a.x("querystring",()=>require("querystring"))},74898,(a,b,c)=>{var d=a.r(874),e=d.Buffer;function f(a,b){for(var c in a)b[c]=a[c]}function g(a,b,c){return e(a,b,c)}e.from&&e.alloc&&e.allocUnsafe&&e.allocUnsafeSlow?b.exports=d:(f(d,c),c.Buffer=g),g.prototype=Object.create(e.prototype),f(e,g),g.from=function(a,b,c){if("number"==typeof a)throw TypeError("Argument must not be a number");return e(a,b,c)},g.alloc=function(a,b,c){if("number"!=typeof a)throw TypeError("Argument must be a number");var d=e(a);return void 0!==b?"string"==typeof c?d.fill(b,c):d.fill(b):d.fill(0),d},g.allocUnsafe=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return e(a)},g.allocUnsafeSlow=function(a){if("number"!=typeof a)throw TypeError("Argument must be a number");return d.SlowBuffer(a)}},79106,(a,b,c)=>{"use strict";function d(a){return(a/8|0)+ +(a%8!=0)}var e={ES256:d(256),ES384:d(384),ES512:d(521)};b.exports=function(a){var b=e[a];if(b)return b;throw Error('Unknown algorithm "'+a+'"')}},8863,(a,b,c)=>{"use strict";var d=a.r(74898).Buffer,e=a.r(79106);function f(a){if(d.isBuffer(a))return a;if("string"==typeof a)return d.from(a,"base64");throw TypeError("ECDSA signature must be a Base64 string or a Buffer")}function g(a,b,c){for(var d=0;b+d<c&&0===a[b+d];)++d;return a[b+d]>=128&&--d,d}b.exports={derToJose:function(a,b){a=f(a);var c=e(b),g=c+1,h=a.length,i=0;if(48!==a[i++])throw Error('Could not find expected "seq"');var j=a[i++];if(129===j&&(j=a[i++]),h-i<j)throw Error('"seq" specified length of "'+j+'", only "'+(h-i)+'" remaining');if(2!==a[i++])throw Error('Could not find expected "int" for "r"');var k=a[i++];if(h-i-2<k)throw Error('"r" specified length of "'+k+'", only "'+(h-i-2)+'" available');if(g<k)throw Error('"r" specified length of "'+k+'", max of "'+g+'" is acceptable');var l=i;if(i+=k,2!==a[i++])throw Error('Could not find expected "int" for "s"');var m=a[i++];if(h-i!==m)throw Error('"s" specified length of "'+m+'", expected "'+(h-i)+'"');if(g<m)throw Error('"s" specified length of "'+m+'", max of "'+g+'" is acceptable');var n=i;if((i+=m)!==h)throw Error('Expected to consume entire buffer, but "'+(h-i)+'" bytes remain');var o=c-k,p=c-m,q=d.allocUnsafe(o+k+p+m);for(i=0;i<o;++i)q[i]=0;a.copy(q,i,l+Math.max(-o,0),l+k),i=c;for(var r=i;i<r+p;++i)q[i]=0;return a.copy(q,i,n+Math.max(-p,0),n+m),q=(q=q.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},joseToDer:function(a,b){a=f(a);var c=e(b),h=a.length;if(h!==2*c)throw TypeError('"'+b+'" signatures must be "'+2*c+'" bytes, saw "'+h+'"');var i=g(a,0,c),j=g(a,c,a.length),k=c-i,l=c-j,m=2+k+1+1+l,n=m<128,o=d.allocUnsafe((n?2:3)+m),p=0;return o[p++]=48,n?o[p++]=m:(o[p++]=129,o[p++]=255&m),o[p++]=2,o[p++]=k,i<0?(o[p++]=0,p+=a.copy(o,p,0,c)):p+=a.copy(o,p,i,c),o[p++]=2,o[p++]=l,j<0?(o[p++]=0,a.copy(o,p,c)):a.copy(o,p,c+j),o}}},98126,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.LRUCache=void 0,c.snakeToCamel=h,c.originalOrCamelOptions=function(a){return{get:function(b){let c=a||{};return c[b]??c[h(b)]}}},c.removeUndefinedValuesInObject=function(a){return Object.entries(a).forEach(([b,c])=>{(void 0===c||"undefined"===c)&&delete a[b]}),a},c.isValidFile=j,c.getWellKnownCertificateConfigFileLocation=function(){let a=process.env.CLOUDSDK_CONFIG||(e.platform().startsWith("win")?f.join(process.env.APPDATA||"",g):f.join(process.env.HOME||"",".config",g));return f.join(a,"certificate_config.json")};let d=a.r(22734),e=a.r(46786),f=a.r(14747),g="gcloud";function h(a){return a.replace(/([_][^_])/g,a=>a.slice(1).toUpperCase())}class i{capacity;#j=new Map;maxAge;constructor(a){this.capacity=a.capacity,this.maxAge=a.maxAge}#k(a,b){this.#j.delete(a),this.#j.set(a,{value:b,lastAccessed:Date.now()})}set(a,b){this.#k(a,b),this.#l()}get(a){let b=this.#j.get(a);if(b)return this.#k(a,b.value),this.#l(),b.value}#l(){let a=this.maxAge?Date.now()-this.maxAge:0,b=this.#j.entries().next();for(;!b.done&&(this.#j.size>this.capacity||b.value[1].lastAccessed<a);)this.#j.delete(b.value[0]),b=this.#j.entries().next()}}async function j(a){try{return(await d.promises.lstat(a)).isFile()}catch(a){return!1}}c.LRUCache=i},91829,a=>{a.v({name:"google-auth-library",version:"10.5.0",author:"Google Inc.",description:"Google APIs Authentication Client Library for Node.js",engines:{node:">=18"},main:"./build/src/index.js",types:"./build/src/index.d.ts",repository:"googleapis/google-auth-library-nodejs.git",keywords:["google","api","google apis","client","client library"],dependencies:{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11",gaxios:"^7.0.0","gcp-metadata":"^8.0.0","google-logging-utils":"^1.0.0",gtoken:"^8.0.0",jws:"^4.0.0"},devDependencies:{"@types/base64-js":"^1.2.5","@types/jws":"^3.1.0","@types/mocha":"^10.0.10","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0",c8:"^10.0.0",codecov:"^3.0.2",gts:"^6.0.0","is-docker":"^3.0.0",jsdoc:"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0",karma:"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1",keypair:"^1.0.4",mocha:"^11.1.0",mv:"^2.1.1",ncp:"^2.0.0",nock:"^14.0.5","null-loader":"^4.0.0",puppeteer:"^24.0.0",sinon:"^21.0.0","ts-loader":"^8.0.0",typescript:"5.8.2",webpack:"^5.21.2","webpack-cli":"^4.0.0"},files:["build/src","!build/src/**/*.map"],scripts:{test:"c8 mocha build/test",clean:"gts clean",prepare:"npm run compile",lint:"gts check --no-inline-config",compile:"tsc -p .",fix:"gts fix",pretest:"npm run compile -- --sourceMap",docs:"jsdoc -c .jsdoc.js","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap",webpack:"webpack","browser-test":"karma start","docs-test":"echo 'disabled until linkinator is fixed'","predocs-test":"npm run docs",prelint:"cd samples; npm link ../; npm install"},license:"Apache-2.0"})},15204,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.USER_AGENT=c.PRODUCT_NAME=c.pkg=void 0;let d=a.r(91829);c.pkg=d;let e="google-api-nodejs-client";c.PRODUCT_NAME=e,c.USER_AGENT=`${e}/${d.version}`},30190,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.AuthClient=c.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=c.DEFAULT_UNIVERSE=void 0;let d=a.r(27699),e=a.r(99853),f=a.r(98126),g=a.r(15979),h=a.r(15204);c.DEFAULT_UNIVERSE="googleapis.com",c.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=3e5;class i extends d.EventEmitter{apiKey;projectId;quotaProjectId;transporter;credentials={};eagerRefreshThresholdMillis=c.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS;forceRefreshOnFailure=!1;universeDomain=c.DEFAULT_UNIVERSE;static RequestMethodNameSymbol=Symbol("request method name");static RequestLogIdSymbol=Symbol("request log id");constructor(a={}){super();const b=(0,f.originalOrCamelOptions)(a);this.apiKey=a.apiKey,this.projectId=b.get("project_id")??null,this.quotaProjectId=b.get("quota_project_id"),this.credentials=b.get("credentials")??{},this.universeDomain=b.get("universe_domain")??c.DEFAULT_UNIVERSE,this.transporter=a.transporter??new e.Gaxios(a.transporterOptions),!1!==b.get("useAuthRequestParameters")&&(this.transporter.interceptors.request.add(i.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(i.DEFAULT_RESPONSE_INTERCEPTOR)),a.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=a.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=a.forceRefreshOnFailure??!1}fetch(...a){let b,c=a[0],d=a[1],f=new Headers;return("string"==typeof c?b=new URL(c):c instanceof URL?b=c:c&&c.url&&(b=new URL(c.url)),c&&"object"==typeof c&&"headers"in c&&e.Gaxios.mergeHeaders(f,c.headers),d&&e.Gaxios.mergeHeaders(f,new Headers(d.headers)),"object"!=typeof c||c instanceof URL)?this.request({...d,headers:f,url:b}):this.request({...d,...c,headers:f,url:b})}setCredentials(a){this.credentials=a}addSharedMetadataHeaders(a){return!a.has("x-goog-user-project")&&this.quotaProjectId&&a.set("x-goog-user-project",this.quotaProjectId),a}addUserProjectAndAuthHeaders(a,b){let c=b.get("x-goog-user-project"),d=b.get("authorization");return c&&a.set("x-goog-user-project",c),d&&a.set("authorization",d),a}static log=(0,g.log)("auth");static DEFAULT_REQUEST_INTERCEPTOR={resolved:async a=>{if(!a.headers.has("x-goog-api-client")){let b=process.version.replace(/^v/,"");a.headers.set("x-goog-api-client",`gl-node/${b}`)}let b=a.headers.get("User-Agent");b?b.includes(`${h.PRODUCT_NAME}/`)||a.headers.set("User-Agent",`${b} ${h.USER_AGENT}`):a.headers.set("User-Agent",h.USER_AGENT);try{let b=a[i.RequestMethodNameSymbol],c=`${Math.floor(1e3*Math.random())}`;a[i.RequestLogIdSymbol]=c;let d={url:a.url,headers:a.headers};b?i.log.info("%s [%s] request %j",b,c,d):i.log.info("[%s] request %j",c,d)}catch(a){}return a}};static DEFAULT_RESPONSE_INTERCEPTOR={resolved:async a=>{try{let b=a.config,c=b[i.RequestMethodNameSymbol],d=b[i.RequestLogIdSymbol];c?i.log.info("%s [%s] response %j",c,d,a.data):i.log.info("[%s] response %j",d,a.data)}catch(a){}return a},rejected:async a=>{try{let b=a.config,c=b[i.RequestMethodNameSymbol],d=b[i.RequestLogIdSymbol];c?i.log.info("%s [%s] error %j",c,d,a.response?.data):i.log.error("[%s] error %j",d,a.response?.data)}catch(a){}throw a}};static setMethodName(a,b){try{a[i.RequestMethodNameSymbol]=b}catch(a){}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}c.AuthClient=i},98463,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.LoginTicket=void 0,c.LoginTicket=class{envelope;payload;constructor(a,b){this.envelope=a,this.payload=b}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let a=this.getPayload();return a&&a.sub?a.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}}},94347,(a,b,c)=>{"use strict";var d,e,f,g,h,i;Object.defineProperty(c,"__esModule",{value:!0}),c.OAuth2Client=c.ClientAuthentication=c.CertificateFormat=c.CodeChallengeMethod=void 0;let j=a.r(99853),k=a.r(45706),l=a.r(88947),m=a.r(8863),n=a.r(98126),o=a.r(65726),p=a.r(30190),q=a.r(98463);(g=d||(c.CodeChallengeMethod=d={})).Plain="plain",g.S256="S256",(h=e||(c.CertificateFormat=e={})).PEM="PEM",h.JWK="JWK",(i=f||(c.ClientAuthentication=f={})).ClientSecretPost="ClientSecretPost",i.ClientSecretBasic="ClientSecretBasic",i.None="None";class r extends p.AuthClient{redirectUri;certificateCache={};certificateExpiry=null;certificateCacheFormat=e.PEM;refreshTokenPromises=new Map;endpoints;issuers;clientAuthentication;_clientId;_clientSecret;refreshHandler;constructor(a={},b,c){super("object"==typeof a?a:{}),"object"!=typeof a&&(a={clientId:a,clientSecret:b,redirectUri:c}),this._clientId=a.clientId||a.client_id,this._clientSecret=a.clientSecret||a.client_secret,this.redirectUri=a.redirectUri||a.redirect_uris?.[0],this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...a.endpoints},this.clientAuthentication=a.clientAuthentication||f.ClientSecretPost,this.issuers=a.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}static GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo";static CLOCK_SKEW_SECS_=300;static DEFAULT_MAX_TOKEN_LIFETIME_SECS_=86400;generateAuthUrl(a={}){if(a.code_challenge_method&&!a.code_challenge)throw Error("If a code_challenge_method is provided, code_challenge must be included.");return a.response_type=a.response_type||"code",a.client_id=a.client_id||this._clientId,a.redirect_uri=a.redirect_uri||this.redirectUri,Array.isArray(a.scope)&&(a.scope=a.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+k.stringify(a)}generateCodeVerifier(){throw Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let a=(0,o.createCrypto)(),b=a.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),c=(await a.sha256DigestBase64(b)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:b,codeChallenge:c}}getToken(a,b){let c="string"==typeof a?{code:a}:a;if(!b)return this.getTokenAsync(c);this.getTokenAsync(c).then(a=>b(null,a.tokens,a.res),a=>b(a,null,a.response))}async getTokenAsync(a){let b=this.endpoints.oauth2TokenUrl.toString(),c=new Headers,d={client_id:a.client_id||this._clientId,code_verifier:a.codeVerifier,code:a.code,grant_type:"authorization_code",redirect_uri:a.redirect_uri||this.redirectUri};if(this.clientAuthentication===f.ClientSecretBasic){let a=Buffer.from(`${this._clientId}:${this._clientSecret}`);c.set("authorization",`Basic ${a.toString("base64")}`)}this.clientAuthentication===f.ClientSecretPost&&(d.client_secret=this._clientSecret);let e={...r.RETRY_CONFIG,method:"POST",url:b,data:new URLSearchParams((0,n.removeUndefinedValuesInObject)(d)),headers:c};p.AuthClient.setMethodName(e,"getTokenAsync");let g=await this.transporter.request(e),h=g.data;return g.data&&g.data.expires_in&&(h.expiry_date=new Date().getTime()+1e3*g.data.expires_in,delete h.expires_in),this.emit("tokens",h),{tokens:h,res:g}}async refreshToken(a){if(!a)return this.refreshTokenNoCache(a);if(this.refreshTokenPromises.has(a))return this.refreshTokenPromises.get(a);let b=this.refreshTokenNoCache(a).then(b=>(this.refreshTokenPromises.delete(a),b),b=>{throw this.refreshTokenPromises.delete(a),b});return this.refreshTokenPromises.set(a,b),b}async refreshTokenNoCache(a){let b;if(!a)throw Error("No refresh token is set.");let c=this.endpoints.oauth2TokenUrl.toString(),d={refresh_token:a,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"};try{let a={...r.RETRY_CONFIG,method:"POST",url:c,data:new URLSearchParams((0,n.removeUndefinedValuesInObject)(d))};p.AuthClient.setMethodName(a,"refreshTokenNoCache"),b=await this.transporter.request(a)}catch(a){throw a instanceof j.GaxiosError&&"invalid_grant"===a.message&&a.response?.data&&/ReAuth/i.test(a.response.data.error_description)&&(a.message=JSON.stringify(a.response.data)),a}let e=b.data;return b.data&&b.data.expires_in&&(e.expiry_date=new Date().getTime()+1e3*b.data.expires_in,delete e.expires_in),this.emit("tokens",e),{tokens:e,res:b}}refreshAccessToken(a){if(!a)return this.refreshAccessTokenAsync();this.refreshAccessTokenAsync().then(b=>a(null,b.credentials,b.res),a)}async refreshAccessTokenAsync(){let a=await this.refreshToken(this.credentials.refresh_token),b=a.tokens;return b.refresh_token=this.credentials.refresh_token,this.credentials=b,{credentials:this.credentials,res:a.res}}getAccessToken(a){if(!a)return this.getAccessTokenAsync();this.getAccessTokenAsync().then(b=>a(null,b.token,b.res),a)}async getAccessTokenAsync(){if(!(!this.credentials.access_token||this.isTokenExpiring()))return{token:this.credentials.access_token};{if(!this.credentials.refresh_token)if(this.refreshHandler){let a=await this.processAndValidateRefreshHandler();if(a?.access_token)return this.setCredentials(a),{token:this.credentials.access_token}}else throw Error("No refresh token or refresh handler callback is set.");let a=await this.refreshAccessTokenAsync();if(!a.credentials||a.credentials&&!a.credentials.access_token)throw Error("Could not refresh access token.");return{token:a.credentials.access_token,res:a.res}}}async getRequestHeaders(a){return(await this.getRequestMetadataAsync(a)).headers}async getRequestMetadataAsync(a){let b=this.credentials;if(!b.access_token&&!b.refresh_token&&!this.apiKey&&!this.refreshHandler)throw Error("No access, refresh token, API key or refresh handler callback is set.");if(b.access_token&&!this.isTokenExpiring()){b.token_type=b.token_type||"Bearer";let a=new Headers({authorization:b.token_type+" "+b.access_token});return{headers:this.addSharedMetadataHeaders(a)}}if(this.refreshHandler){let a=await this.processAndValidateRefreshHandler();if(a?.access_token){this.setCredentials(a);let b=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(b)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let c=null,d=null;try{d=(c=await this.refreshToken(b.refresh_token)).tokens}catch(a){throw a.response&&(403===a.response.status||404===a.response.status)&&(a.message=`Could not refresh access token: ${a.message}`),a}let e=this.credentials;e.token_type=e.token_type||"Bearer",d.refresh_token=e.refresh_token,this.credentials=d;let f=new Headers({authorization:e.token_type+" "+d.access_token});return{headers:this.addSharedMetadataHeaders(f),res:c.res}}static getRevokeTokenUrl(a){return new r().getRevokeTokenURL(a).toString()}getRevokeTokenURL(a){let b=new URL(this.endpoints.oauth2RevokeUrl);return b.searchParams.append("token",a),b}revokeToken(a,b){let c={...r.RETRY_CONFIG,url:this.getRevokeTokenURL(a).toString(),method:"POST"};if(p.AuthClient.setMethodName(c,"revokeToken"),!b)return this.transporter.request(c);this.transporter.request(c).then(a=>b(null,a),b)}revokeCredentials(a){if(!a)return this.revokeCredentialsAsync();this.revokeCredentialsAsync().then(b=>a(null,b),a)}async revokeCredentialsAsync(){let a=this.credentials.access_token;if(this.credentials={},a)return this.revokeToken(a);throw Error("No access token to revoke.")}request(a,b){if(!b)return this.requestAsync(a);this.requestAsync(a).then(a=>b(null,a),a=>b(a,a.response))}async requestAsync(a,b=!1){try{let b=await this.getRequestMetadataAsync();return a.headers=j.Gaxios.mergeHeaders(a.headers),this.addUserProjectAndAuthHeaders(a.headers,b.headers),this.apiKey&&a.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(a)}catch(d){let c=d.response;if(c){let d=c.status,e=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),f=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,g=c.config.data instanceof l.Readable,h=401===d||403===d;if(!b&&h&&!g&&e)return await this.refreshAccessTokenAsync(),this.requestAsync(a,!0);if(!b&&h&&!g&&f){let b=await this.processAndValidateRefreshHandler();return b?.access_token&&this.setCredentials(b),this.requestAsync(a,!0)}}throw d}}verifyIdToken(a,b){if(b&&"function"!=typeof b)throw Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(!b)return this.verifyIdTokenAsync(a);this.verifyIdTokenAsync(a).then(a=>b(null,a),b)}async verifyIdTokenAsync(a){if(!a.idToken)throw Error("The verifyIdToken method requires an ID Token");let b=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(a.idToken,b.certs,a.audience,this.issuers,a.maxExpiry)}async getTokenInfo(a){let{data:b}=await this.transporter.request({...r.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${a}`},url:this.endpoints.tokenInfoUrl.toString()}),c=Object.assign({expiry_date:new Date().getTime()+1e3*b.expires_in,scopes:b.scope.split(" ")},b);return delete c.expires_in,delete c.scope,c}getFederatedSignonCerts(a){if(!a)return this.getFederatedSignonCertsAsync();this.getFederatedSignonCertsAsync().then(b=>a(null,b.certs,b.res),a)}async getFederatedSignonCertsAsync(){let a,b,c=new Date().getTime(),d=(0,o.hasBrowserCrypto)()?e.JWK:e.PEM;if(this.certificateExpiry&&c<this.certificateExpiry.getTime()&&this.certificateCacheFormat===d)return{certs:this.certificateCache,format:d};switch(d){case e.PEM:b=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case e.JWK:b=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw Error(`Unsupported certificate format ${d}`)}try{let c={...r.RETRY_CONFIG,url:b};p.AuthClient.setMethodName(c,"getFederatedSignonCertsAsync"),a=await this.transporter.request(c)}catch(a){throw a instanceof Error&&(a.message=`Failed to retrieve verification certificates: ${a.message}`),a}let f=a?.headers.get("cache-control"),g=-1;if(f){let a=/max-age=(?<maxAge>[0-9]+)/.exec(f)?.groups?.maxAge;a&&(g=1e3*Number(a))}let h={};switch(d){case e.PEM:h=a.data;break;case e.JWK:for(let b of a.data.keys)h[b.kid]=b;break;default:throw Error(`Unsupported certificate format ${d}`)}let i=new Date;return this.certificateExpiry=-1===g?null:new Date(i.getTime()+g),this.certificateCache=h,this.certificateCacheFormat=d,{certs:h,format:d,res:a}}getIapPublicKeys(a){if(!a)return this.getIapPublicKeysAsync();this.getIapPublicKeysAsync().then(b=>a(null,b.pubkeys,b.res),a)}async getIapPublicKeysAsync(){let a,b=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let c={...r.RETRY_CONFIG,url:b};p.AuthClient.setMethodName(c,"getIapPublicKeysAsync"),a=await this.transporter.request(c)}catch(a){throw a instanceof Error&&(a.message=`Failed to retrieve verification certificates: ${a.message}`),a}return{pubkeys:a.data,res:a}}verifySignedJwtWithCerts(){throw Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(a,b,c,d,e){let f,g,h=(0,o.createCrypto)();e||(e=r.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let i=a.split(".");if(3!==i.length)throw Error("Wrong number of segments in token: "+a);let j=i[0]+"."+i[1],k=i[2];try{f=JSON.parse(h.decodeBase64StringUtf8(i[0]))}catch(a){throw a instanceof Error&&(a.message=`Can't parse token envelope: ${i[0]}': ${a.message}`),a}if(!f)throw Error("Can't parse token envelope: "+i[0]);try{g=JSON.parse(h.decodeBase64StringUtf8(i[1]))}catch(a){throw a instanceof Error&&(a.message=`Can't parse token payload '${i[0]}`),a}if(!g)throw Error("Can't parse token payload: "+i[1]);if(!Object.prototype.hasOwnProperty.call(b,f.kid))throw Error("No pem found for envelope: "+JSON.stringify(f));let l=b[f.kid];if("ES256"===f.alg&&(k=m.joseToDer(k,"ES256").toString("base64")),!await h.verify(l,j,k))throw Error("Invalid token signature: "+a);if(!g.iat)throw Error("No issue time in token: "+JSON.stringify(g));if(!g.exp)throw Error("No expiration time in token: "+JSON.stringify(g));let n=Number(g.iat);if(isNaN(n))throw Error("iat field using invalid format");let p=Number(g.exp);if(isNaN(p))throw Error("exp field using invalid format");let s=new Date().getTime()/1e3;if(p>=s+e)throw Error("Expiration time too far in future: "+JSON.stringify(g));let t=n-r.CLOCK_SKEW_SECS_,u=p+r.CLOCK_SKEW_SECS_;if(s<t)throw Error("Token used too early, "+s+" < "+t+": "+JSON.stringify(g));if(s>u)throw Error("Token used too late, "+s+" > "+u+": "+JSON.stringify(g));if(d&&0>d.indexOf(g.iss))throw Error("Invalid issuer, expected one of ["+d+"], but got "+g.iss);if(null!=c){let a=g.aud;if(!(c.constructor===Array?c.indexOf(a)>-1:a===c))throw Error("Wrong recipient, payload audience != requiredAudience")}return new q.LoginTicket(f,g)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let a=await this.refreshHandler();if(!a.access_token)throw Error("No access token is returned by the refreshHandler callback.");return a}}isTokenExpiring(){let a=this.credentials.expiry_date;return!!a&&a<=new Date().getTime()+this.eagerRefreshThresholdMillis}}c.OAuth2Client=r},48889,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Compute=void 0;let d=a.r(99853),e=a.r(54145),f=a.r(94347);class g extends f.OAuth2Client{serviceAccountEmail;scopes;constructor(a={}){super(a),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=a.serviceAccountEmail||"default",this.scopes=Array.isArray(a.scopes)?a.scopes:a.scopes?[a.scopes]:[]}async refreshTokenNoCache(){let a,b=`service-accounts/${this.serviceAccountEmail}/token`;try{let c={property:b};this.scopes.length>0&&(c.params={scopes:this.scopes.join(",")}),a=await e.instance(c)}catch(a){throw a instanceof d.GaxiosError&&(a.message=`Could not refresh access token: ${a.message}`,this.wrapError(a)),a}let c=a;return a&&a.expires_in&&(c.expiry_date=new Date().getTime()+1e3*a.expires_in,delete c.expires_in),this.emit("tokens",c),{tokens:c,res:null}}async fetchIdToken(a){let b,c=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${a}`;try{b=await e.instance({property:c})}catch(a){throw a instanceof Error&&(a.message=`Could not fetch ID token: ${a.message}`),a}return b}wrapError(a){let b=a.response;b&&b.status&&(a.status=b.status,403===b.status?a.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+a.message:404===b.status&&(a.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+a.message))}}c.Compute=g},70241,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.IdTokenClient=void 0;let d=a.r(94347);class e extends d.OAuth2Client{targetAudience;idTokenProvider;constructor(a){super(a),this.targetAudience=a.targetAudience,this.idTokenProvider=a.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let a=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:a,expiry_date:this.getIdTokenExpiryDate(a)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(a){let b=a.split(".")[1];if(b)return 1e3*JSON.parse(Buffer.from(b,"base64").toString("ascii")).exp}}c.IdTokenClient=e},51747,(a,b,c)=>{"use strict";var d,e;let f;Object.defineProperty(c,"__esModule",{value:!0}),c.GCPEnv=void 0,c.clear=function(){f=void 0},c.getEnv=h;let g=a.r(54145);async function h(){return f||(f=i())}async function i(){d.NONE;return process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME?d.APP_ENGINE:process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET?d.CLOUD_FUNCTIONS:await k()?await j()?d.KUBERNETES_ENGINE:process.env.K_CONFIGURATION?d.CLOUD_RUN:process.env.CLOUD_RUN_JOB?d.CLOUD_RUN_JOBS:d.COMPUTE_ENGINE:d.NONE}async function j(){try{return await g.instance("attributes/cluster-name"),!0}catch(a){return!1}}async function k(){return g.isAvailable()}(e=d||(c.GCPEnv=d={})).APP_ENGINE="APP_ENGINE",e.KUBERNETES_ENGINE="KUBERNETES_ENGINE",e.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",e.COMPUTE_ENGINE="COMPUTE_ENGINE",e.CLOUD_RUN="CLOUD_RUN",e.CLOUD_RUN_JOBS="CLOUD_RUN_JOBS",e.NONE="NONE"},60597,(a,b,c)=>{var d=a.r(74898).Buffer,e=a.r(88947);function f(a){if(this.buffer=null,this.writable=!0,this.readable=!0,!a)return this.buffer=d.alloc(0),this;if("function"==typeof a.pipe)return this.buffer=d.alloc(0),a.pipe(this),this;if(a.length||"object"==typeof a)return this.buffer=a,this.writable=!1,process.nextTick((function(){this.emit("end",a),this.readable=!1,this.emit("close")}).bind(this)),this;throw TypeError("Unexpected data type ("+typeof a+")")}a.r(24361).inherits(f,e),f.prototype.write=function(a){this.buffer=d.concat([this.buffer,d.from(a)]),this.emit("data",a)},f.prototype.end=function(a){a&&this.write(a),this.emit("end",a),this.emit("close"),this.writable=!1,this.readable=!1},b.exports=f},89815,(a,b,c)=>{"use strict";var d=a.r(874).Buffer,e=a.r(874).SlowBuffer;function f(a,b){if(!d.isBuffer(a)||!d.isBuffer(b)||a.length!==b.length)return!1;for(var c=0,e=0;e<a.length;e++)c|=a[e]^b[e];return 0===c}b.exports=f,f.install=function(){d.prototype.equal=e.prototype.equal=function(a){return f(this,a)}};var g=d.prototype.equal,h=e.prototype.equal;f.restore=function(){d.prototype.equal=g,e.prototype.equal=h}},79418,(a,b,c)=>{var d,e=a.r(74898).Buffer,f=a.r(54799),g=a.r(8863),h=a.r(24361),i="secret must be a string or buffer",j="key must be a string or a buffer",k="function"==typeof f.createPublicKey;function l(a){if(!e.isBuffer(a)&&"string"!=typeof a&&(!k||"object"!=typeof a||"string"!=typeof a.type||"string"!=typeof a.asymmetricKeyType||"function"!=typeof a.export))throw p(j)}function m(a){if(!e.isBuffer(a)&&"string"!=typeof a&&"object"!=typeof a)throw p("key must be a string, a buffer or an object")}function n(a){return a.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function o(a){var b=4-(a=a.toString()).length%4;if(4!==b)for(var c=0;c<b;++c)a+="=";return a.replace(/\-/g,"+").replace(/_/g,"/")}function p(a){var b=[].slice.call(arguments,1);return TypeError(h.format.bind(h,a).apply(null,b))}function q(a){var b;return b=a,e.isBuffer(b)||"string"==typeof b||(a=JSON.stringify(a)),a}function r(a){return function(b,c){!function(a){if(!e.isBuffer(a)){if("string"!=typeof a){if(!k||"object"!=typeof a||"secret"!==a.type||"function"!=typeof a.export)throw p(i)}}}(c),b=q(b);var d=f.createHmac("sha"+a,c);return n((d.update(b),d.digest("base64")))}}k&&(j+=" or a KeyObject",i+="or a KeyObject");var s="timingSafeEqual"in f?function(a,b){return a.byteLength===b.byteLength&&f.timingSafeEqual(a,b)}:function(b,c){return d||(d=a.r(89815)),d(b,c)};function t(a){return function(b,c,d){var f=r(a)(b,d);return s(e.from(c),e.from(f))}}function u(a){return function(b,c){m(c),b=q(b);var d=f.createSign("RSA-SHA"+a);return n((d.update(b),d.sign(c,"base64")))}}function v(a){return function(b,c,d){l(d),b=q(b),c=o(c);var e=f.createVerify("RSA-SHA"+a);return e.update(b),e.verify(d,c,"base64")}}function w(a){return function(b,c){m(c),b=q(b);var d=f.createSign("RSA-SHA"+a);return n((d.update(b),d.sign({key:c,padding:f.constants.RSA_PKCS1_PSS_PADDING,saltLength:f.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function x(a){return function(b,c,d){l(d),b=q(b),c=o(c);var e=f.createVerify("RSA-SHA"+a);return e.update(b),e.verify({key:d,padding:f.constants.RSA_PKCS1_PSS_PADDING,saltLength:f.constants.RSA_PSS_SALTLEN_DIGEST},c,"base64")}}function y(a){var b=u(a);return function(){var c=b.apply(null,arguments);return g.derToJose(c,"ES"+a)}}function z(a){var b=v(a);return function(c,d,e){return b(c,d=g.joseToDer(d,"ES"+a).toString("base64"),e)}}function A(){return function(){return""}}function B(){return function(a,b){return""===b}}b.exports=function(a){var b=a.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!b)throw p('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',a);var c=(b[1]||b[3]).toLowerCase(),d=b[2];return{sign:({hs:r,rs:u,ps:w,es:y,none:A})[c](d),verify:({hs:t,rs:v,ps:x,es:z,none:B})[c](d)}}},53379,(a,b,c)=>{var d=a.r(874).Buffer;b.exports=function(a){return"string"==typeof a?a:"number"==typeof a||d.isBuffer(a)?a.toString():JSON.stringify(a)}},73546,(a,b,c)=>{var d=a.r(74898).Buffer,e=a.r(60597),f=a.r(79418),g=a.r(88947),h=a.r(53379),i=a.r(24361);function j(a,b){return d.from(a,b).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function k(a){var b,c,d,e=a.header,g=a.payload,k=a.secret||a.privateKey,l=a.encoding,m=f(e.alg),n=(b=(b=l)||"utf8",c=j(h(e),"binary"),d=j(h(g),b),i.format("%s.%s",c,d)),o=m.sign(n,k);return i.format("%s.%s",n,o)}function l(a){var b=new e(a.secret||a.privateKey||a.key);this.readable=!0,this.header=a.header,this.encoding=a.encoding,this.secret=this.privateKey=this.key=b,this.payload=new e(a.payload),this.secret.once("close",(function(){!this.payload.writable&&this.readable&&this.sign()}).bind(this)),this.payload.once("close",(function(){!this.secret.writable&&this.readable&&this.sign()}).bind(this))}i.inherits(l,g),l.prototype.sign=function(){try{var a=k({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",a),this.emit("data",a),this.emit("end"),this.readable=!1,a}catch(a){this.readable=!1,this.emit("error",a),this.emit("close")}},l.sign=k,b.exports=l},45712,(a,b,c)=>{var d=a.r(74898).Buffer,e=a.r(60597),f=a.r(79418),g=a.r(88947),h=a.r(53379),i=a.r(24361),j=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function k(a){var b=a.split(".",1)[0],c=d.from(b,"base64").toString("binary");if("[object Object]"===Object.prototype.toString.call(c))return c;try{return JSON.parse(c)}catch(a){return}}function l(a){return a.split(".")[2]}function m(a){return j.test(a)&&!!k(a)}function n(a,b,c){if(!b){var d=Error("Missing algorithm parameter for jws.verify");throw d.code="MISSING_ALGORITHM",d}var e=l(a=h(a)),g=a.split(".",2).join(".");return f(b).verify(g,e,c)}function o(a,b){if(b=b||{},!m(a=h(a)))return null;var c,e,f=k(a);if(!f)return null;var g=(c=c||"utf8",e=a.split(".")[1],d.from(e,"base64").toString(c));return("JWT"===f.typ||b.json)&&(g=JSON.parse(g,b.encoding)),{header:f,payload:g,signature:l(a)}}function p(a){var b=new e((a=a||{}).secret||a.publicKey||a.key);this.readable=!0,this.algorithm=a.algorithm,this.encoding=a.encoding,this.secret=this.publicKey=this.key=b,this.signature=new e(a.signature),this.secret.once("close",(function(){!this.signature.writable&&this.readable&&this.verify()}).bind(this)),this.signature.once("close",(function(){!this.secret.writable&&this.readable&&this.verify()}).bind(this))}i.inherits(p,g),p.prototype.verify=function(){try{var a=n(this.signature.buffer,this.algorithm,this.key.buffer),b=o(this.signature.buffer,this.encoding);return this.emit("done",a,b),this.emit("data",a),this.emit("end"),this.readable=!1,a}catch(a){this.readable=!1,this.emit("error",a),this.emit("close")}},p.decode=o,p.isValid=m,p.verify=n,b.exports=p},38823,(a,b,c)=>{var d=a.r(73546),e=a.r(45712);c.ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],c.sign=d.sign,c.verify=e.verify,c.decode=e.decode,c.isValid=e.isValid,c.createSign=function(a){return new d(a)},c.createVerify=function(a){return new e(a)}},6122,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.GoogleToken=void 0;var d,e=j(a.r(22734)),f=a.r(99853),g=j(a.r(38823)),h=j(a.r(14747)),i=a.r(24361);function j(a,b){if("function"==typeof WeakMap)var c=new WeakMap,d=new WeakMap;return(j=function(a,b){if(!b&&a&&a.__esModule)return a;var e,f,g={__proto__:null,default:a};if(null===a||"object"!=k(a)&&"function"!=typeof a)return g;if(e=b?d:c){if(e.has(a))return e.get(a);e.set(a,g)}for(var h in a)"default"!==h&&({}).hasOwnProperty.call(a,h)&&((f=(e=Object.defineProperty)&&Object.getOwnPropertyDescriptor(a,h))&&(f.get||f.set)?e(g,h,f):g[h]=a[h]);return g})(a,b)}function k(a){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function l(a,b){if(b.has(a))throw TypeError("Cannot initialize the same private elements twice on an object")}function m(a,b,c){return a.set(n(a,b),c),c}function n(a,b,c){if("function"==typeof a?a===b:a.has(b))return arguments.length<3?b:c;throw TypeError("Private element is not present on this object")}function o(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,w(d.key),d)}}function p(a,b,c){return b&&o(a.prototype,b),c&&o(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function q(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}function r(a){var b="function"==typeof Map?new Map:void 0;return(r=function(a){if(null===a||!function(a){try{return -1!==Function.toString.call(a).indexOf("[native code]")}catch(b){return"function"==typeof a}}(a))return a;if("function"!=typeof a)throw TypeError("Super expression must either be null or a function");if(void 0!==b){if(b.has(a))return b.get(a);b.set(a,c)}function c(){return function(a,b,c){if(s())return Reflect.construct.apply(null,arguments);var d=[null];d.push.apply(d,b);var e=new(a.bind.apply(a,d));return c&&t(e,c.prototype),e}(a,arguments,u(this).constructor)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),t(c,a)})(a)}function s(){try{var a=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(a){}return(s=function(){return!!a})()}function t(a,b){return(t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,b){return a.__proto__=b,a})(a,b)}function u(a){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)})(a)}function v(a,b,c){return(b=w(b))in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function w(a){var b=function(a,b){if("object"!=k(a)||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b||"default");if("object"!=k(d))return d;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===b?String:Number)(a)}(a,"string");return"symbol"==k(b)?b:b+""}function x(){var a,b,c="function"==typeof Symbol?Symbol:{},d=c.iterator||"@@iterator",e=c.toStringTag||"@@toStringTag";function f(c,d,e,f){var i=Object.create((d&&d.prototype instanceof h?d:h).prototype);return y(i,"_invoke",function(c,d,e){var f,h,i,j=0,k=e||[],l=!1,m={p:0,n:0,v:a,a:n,f:n.bind(a,4),d:function(b,c){return f=b,h=0,i=a,m.n=c,g}};function n(c,d){for(h=c,i=d,b=0;!l&&j&&!e&&b<k.length;b++){var e,f=k[b],n=m.p,o=f[2];c>3?(e=o===d)&&(i=f[(h=f[4])?5:(h=3,3)],f[4]=f[5]=a):f[0]<=n&&((e=c<2&&n<f[1])?(h=0,m.v=d,m.n=f[1]):n<o&&(e=c<3||f[0]>d||d>o)&&(f[4]=c,f[5]=d,m.n=o,h=0))}if(e||c>1)return g;throw l=!0,d}return function(e,k,o){if(j>1)throw TypeError("Generator is already running");for(l&&1===k&&n(k,o),h=k,i=o;(b=h<2?a:i)||!l;){f||(h?h<3?(h>1&&(m.n=-1),n(h,i)):m.n=i:m.v=i);try{if(j=2,f){if(h||(e="next"),b=f[e]){if(!(b=b.call(f,i)))throw TypeError("iterator result is not an object");if(!b.done)return b;i=b.value,h<2&&(h=0)}else 1===h&&(b=f.return)&&b.call(f),h<2&&(i=TypeError("The iterator does not provide a '"+e+"' method"),h=1);f=a}else if((b=(l=m.n<0)?i:c.call(d,m))!==g)break}catch(b){f=a,h=1,i=b}finally{j=1}}return{value:b,done:l}}}(c,e,f),!0),i}var g={};function h(){}function i(){}function j(){}b=Object.getPrototypeOf;var k=j.prototype=h.prototype=Object.create([][d]?b(b([][d]())):(y(b={},d,function(){return this}),b));function l(a){return Object.setPrototypeOf?Object.setPrototypeOf(a,j):(a.__proto__=j,y(a,e,"GeneratorFunction")),a.prototype=Object.create(k),a}return i.prototype=j,y(k,"constructor",j),y(j,"constructor",i),i.displayName="GeneratorFunction",y(j,e,"GeneratorFunction"),y(k),y(k,e,"Generator"),y(k,d,function(){return this}),y(k,"toString",function(){return"[object Generator]"}),(x=function(){return{w:f,m:l}})()}function y(a,b,c,d){var e=Object.defineProperty;try{e({},"",{})}catch(a){e=0}(y=function(a,b,c,d){if(b)e?e(a,b,{value:c,enumerable:!d,configurable:!d,writable:!d}):a[b]=c;else{var f=function(b,c){y(a,b,function(a){return this._invoke(b,c,a)})};f("next",0),f("throw",1),f("return",2)}})(a,b,c,d)}function z(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){return void c(a)}h.done?b(i):Promise.resolve(i).then(d,e)}function A(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var f=a.apply(b,c);function g(a){z(f,d,e,g,h,"next",a)}function h(a){z(f,d,e,g,h,"throw",a)}g(void 0)})}}var B=e.readFile?(0,i.promisify)(e.readFile):A(x().m(function a(){return x().w(function(a){for(;;)switch(a.n){case 0:throw new D("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return a.a(2)}},a)})),C="https://oauth2.googleapis.com/token",D=function(a){function b(a,c){var d,e,f;return q(this,b),e=b,f=[a],e=u(e),v(d=function(a,b){if(b&&("object"==k(b)||"function"==typeof b))return b;if(void 0!==b)throw TypeError("Derived constructors may only return object or undefined");var c=a;if(void 0===c)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return c}(this,s()?Reflect.construct(e,f||[],u(this).constructor):e.apply(this,f)),"code",void 0),d.code=c,d}if("function"!=typeof a&&null!==a)throw TypeError("Super expression must either be null or a function");return b.prototype=Object.create(a&&a.prototype,{constructor:{value:b,writable:!0,configurable:!0}}),Object.defineProperty(b,"prototype",{writable:!1}),a&&t(b,a),p(b)}(r(Error)),E=new WeakMap,F=new WeakSet;function G(a){return H.apply(this,arguments)}function H(){return(H=A(x().m(function a(b){return x().w(function(a){for(;;)switch(a.n){case 0:if(!E.get(n(E,this))||b.forceRefresh){a.n=1;break}return a.a(2,E.get(n(E,this)));case 1:return a.p=1,a.n=2,m(E,this,n(F,this,I).call(this,b));case 2:return a.a(2,a.v);case 3:return a.p=3,m(E,this,void 0),a.f(3);case 4:return a.a(2)}},a,this,[[1,,3,4]])}))).apply(this,arguments)}function I(a){return J.apply(this,arguments)}function J(){return(J=A(x().m(function a(b){var c;return x().w(function(a){for(;;)switch(a.n){case 0:if(!1!==this.isTokenExpiring()||!1!==b.forceRefresh){a.n=1;break}return a.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){a.n=2;break}throw Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){a.n=4;break}return a.n=3,this.getCredentials(this.keyFile);case 3:c=a.v,this.key=c.privateKey,this.iss=c.clientEmail||this.iss,c.clientEmail||n(F,this,K).call(this);case 4:return a.a(2,n(F,this,O).call(this))}},a,this)}))).apply(this,arguments)}function K(){if(!this.iss)throw new D("email is required.","MISSING_CREDENTIALS")}function L(){return M.apply(this,arguments)}function M(){return(M=A(x().m(function a(){var b;return x().w(function(a){for(;;)switch(a.n){case 0:if(this.accessToken){a.n=1;break}throw Error("No token to revoke.");case 1:return b="https://oauth2.googleapis.com/revoke?token="+this.accessToken,a.n=2,this.transporter.request({url:b,retry:!0});case 2:n(F,this,N).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return a.a(2)}},a,this)}))).apply(this,arguments)}function N(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.keyFile=a.keyFile,this.key=a.key,this.rawToken=void 0,this.iss=a.email||a.iss,this.sub=a.sub,this.additionalClaims=a.additionalClaims,"object"===k(a.scope)?this.scope=a.scope.join(" "):this.scope=a.scope,this.eagerRefreshThresholdMillis=a.eagerRefreshThresholdMillis,a.transporter&&(this.transporter=a.transporter)}function O(){return P.apply(this,arguments)}function P(){return(P=A(x().m(function a(){var b,c,d,e,f,h,i,j,k,l;return x().w(function(a){for(;;)switch(a.n){case 0:return b=Math.floor(new Date().getTime()/1e3),c=this.additionalClaims||{},d=Object.assign({iss:this.iss,scope:this.scope,aud:C,exp:b+3600,iat:b,sub:this.sub},c),e=g.sign({header:{alg:"RS256"},payload:d,secret:this.key}),a.p=1,a.n=2,this.transporter.request({method:"POST",url:C,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:e}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return f=a.v,this.rawToken=f.data,this.expiresAt=null===f.data.expires_in||void 0===f.data.expires_in?void 0:(b+f.data.expires_in)*1e3,a.a(2,this.rawToken);case 3:throw a.p=3,l=a.v,this.rawToken=void 0,this.tokenExpires=void 0,(j=l.response&&null!=(h=l.response)&&h.data?null==(i=l.response)?void 0:i.data:{}).error&&(k=j.error_description?": ".concat(j.error_description):"",l.message="".concat(j.error).concat(k)),l;case 4:return a.a(2)}},a,this,[[1,3]])}))).apply(this,arguments)}c.GoogleToken=p(function a(b){q(this,a),l(this,F),F.add(this),v(this,"expiresAt",void 0),v(this,"key",void 0),v(this,"keyFile",void 0),v(this,"iss",void 0),v(this,"sub",void 0),v(this,"scope",void 0),v(this,"rawToken",void 0),v(this,"tokenExpires",void 0),v(this,"email",void 0),v(this,"additionalClaims",void 0),v(this,"eagerRefreshThresholdMillis",void 0),v(this,"transporter",{request:function(a){return(0,f.request)(a)}}),l(this,E),E.set(this,void 0),n(F,this,N).call(this,b)},[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var a=new Date().getTime();return!this.rawToken||!this.expiresAt||a>=this.expiresAt}},{key:"isTokenExpiring",value:function(){var a,b=new Date().getTime(),c=null!=(a=this.eagerRefreshThresholdMillis)?a:0;return!this.rawToken||!this.expiresAt||this.expiresAt<=b+c}},{key:"getToken",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"===k(a)&&(b=a,a=void 0),b=Object.assign({forceRefresh:!1},b),a){var c=a;n(F,this,G).call(this,b).then(function(a){return c(null,a)},a);return}return n(F,this,G).call(this,b)}},{key:"getCredentials",value:(d=A(x().m(function a(b){var c,d,e,f,g;return x().w(function(a){for(;;)switch(a.n){case 0:a.n=".json"===(g=h.extname(b))?1:".der"===g||".crt"===g||".pem"===g?4:".p12"===g||".pfx"===g?6:7;break;case 1:return a.n=2,B(b,"utf8");case 2:if(d=(c=JSON.parse(a.v)).private_key,e=c.client_email,!(!d||!e)){a.n=3;break}throw new D("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return a.a(2,{privateKey:d,clientEmail:e});case 4:return a.n=5,B(b,"utf8");case 5:return f=a.v,a.a(2,{privateKey:f});case 6:throw new D("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new D("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return a.a(2)}},a)})),function(a){return d.apply(this,arguments)})},{key:"revokeToken",value:function(a){return a?void n(F,this,L).call(this).then(function(){return a()},a):n(F,this,L).call(this)}}])},88329,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.JWTAccess=void 0;let d=a.r(38823),e=a.r(98126),f={alg:"RS256",typ:"JWT"};class g{email;key;keyId;projectId;eagerRefreshThresholdMillis;cache=new e.LRUCache({capacity:500,maxAge:36e5});constructor(a,b,c,d){this.email=a,this.key=b,this.keyId=c,this.eagerRefreshThresholdMillis=d??3e5}getCachedKey(a,b){let c=a;if(b&&Array.isArray(b)&&b.length?c=a?`${a}_${b.join("_")}`:`${b.join("_")}`:"string"==typeof b&&(c=a?`${a}_${b}`:b),!c)throw Error("Scopes or url must be provided");return c}getRequestHeaders(a,b,c){let e,h=this.getCachedKey(a,c),i=this.cache.get(h),j=Date.now();if(i&&i.expiration-j>this.eagerRefreshThresholdMillis)return new Headers(i.headers);let k=Math.floor(Date.now()/1e3),l=g.getExpirationTime(k);if(Array.isArray(c)&&(c=c.join(" ")),e=c?{iss:this.email,sub:this.email,scope:c,exp:l,iat:k}:{iss:this.email,sub:this.email,aud:a,exp:l,iat:k},b){for(let a in e)if(b[a])throw Error(`The '${a}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let m=this.keyId?{...f,kid:this.keyId}:f,n=Object.assign(e,b),o=d.sign({header:m,payload:n,secret:this.key}),p=new Headers({authorization:`Bearer ${o}`});return this.cache.set(h,{expiration:1e3*l,headers:p}),p}static getExpirationTime(a){return a+3600}fromJSON(a){if(!a)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!a.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!a.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=a.client_email,this.key=a.private_key,this.keyId=a.private_key_id,this.projectId=a.project_id}fromStream(a,b){if(!b)return this.fromStreamAsync(a);this.fromStreamAsync(a).then(()=>b(),b)}fromStreamAsync(a){return new Promise((b,c)=>{a||c(Error("Must pass in a stream containing the service account auth settings."));let d="";a.setEncoding("utf8").on("data",a=>d+=a).on("error",c).on("end",()=>{try{let a=JSON.parse(d);this.fromJSON(a),b()}catch(a){c(a)}})})}}c.JWTAccess=g},42911,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.JWT=void 0;let d=a.r(6122),e=a.r(88329),f=a.r(94347),g=a.r(30190);class h extends f.OAuth2Client{email;keyFile;key;keyId;defaultScopes;scopes;scope;subject;gtoken;additionalClaims;useJWTAccessWithScope;defaultServicePath;access;constructor(a={}){super(a),this.email=a.email,this.keyFile=a.keyFile,this.key=a.key,this.keyId=a.keyId,this.scopes=a.scopes,this.subject=a.subject,this.additionalClaims=a.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(a){let b=new h(this);return b.scopes=a,b}async getRequestMetadataAsync(a){a=this.defaultServicePath?`https://${this.defaultServicePath}/`:a;let b=!this.hasUserScopes()&&a||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==g.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==g.DEFAULT_UNIVERSE)throw RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${g.DEFAULT_UNIVERSE}`);if(!this.apiKey&&b)if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:a}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${a.id_token}`}))}}else{let b;this.access||(this.access=new e.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis)),this.hasUserScopes()?b=this.scopes:a||(b=this.defaultScopes);let c=this.useJWTAccessWithScope||this.universeDomain!==g.DEFAULT_UNIVERSE,d=await this.access.getRequestHeaders(a??void 0,this.additionalClaims,c?b:void 0);return{headers:this.addSharedMetadataHeaders(d)}}return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(a):{headers:new Headers}}async fetchIdToken(a){let b=new d.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:a},transporter:this.transporter});if(await b.getToken({forceRefresh:!0}),!b.idToken)throw Error("Unknown error: Failed to fetch ID token");return b.idToken}hasUserScopes(){return!!this.scopes&&this.scopes.length>0}hasAnyScopes(){return!!this.scopes&&!!(this.scopes.length>0)||!!this.defaultScopes&&!!(this.defaultScopes.length>0)}authorize(a){if(!a)return this.authorizeAsync();this.authorizeAsync().then(b=>a(null,b),a)}async authorizeAsync(){let a=await this.refreshToken();if(!a)throw Error("No result returned");return this.credentials=a.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,a.tokens}async refreshTokenNoCache(){let a=this.createGToken(),b={access_token:(await a.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:a.expiresAt,id_token:a.idToken};return this.emit("tokens",b),{res:null,tokens:b}}createGToken(){return this.gtoken||(this.gtoken=new d.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(a){if(!a)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!a.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!a.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=a.client_email,this.key=a.private_key,this.keyId=a.private_key_id,this.projectId=a.project_id,this.quotaProjectId=a.quota_project_id,this.universeDomain=a.universe_domain||this.universeDomain}fromStream(a,b){if(!b)return this.fromStreamAsync(a);this.fromStreamAsync(a).then(()=>b(),b)}fromStreamAsync(a){return new Promise((b,c)=>{if(!a)throw Error("Must pass in a stream containing the service account auth settings.");let d="";a.setEncoding("utf8").on("error",c).on("data",a=>d+=a).on("end",()=>{try{let a=JSON.parse(d);this.fromJSON(a),b()}catch(a){c(a)}})})}fromAPIKey(a){if("string"!=typeof a)throw Error("Must provide an API Key string.");this.apiKey=a}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let a=this.createGToken(),b=await a.getCredentials(this.keyFile);return{private_key:b.privateKey,client_email:b.clientEmail}}throw Error("A key or a keyFile must be provided to getCredentials.")}}c.JWT=h},92114,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.UserRefreshClient=c.USER_REFRESH_ACCOUNT_TYPE=void 0;let d=a.r(94347),e=a.r(30190);c.USER_REFRESH_ACCOUNT_TYPE="authorized_user";class f extends d.OAuth2Client{_refreshToken;constructor(a,b,c,d,e){const f=a&&"object"==typeof a?a:{clientId:a,clientSecret:b,refreshToken:c,eagerRefreshThresholdMillis:d,forceRefreshOnFailure:e};super(f),this._refreshToken=f.refreshToken,this.credentials.refresh_token=f.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(a){let b={...f.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:a})};return e.AuthClient.setMethodName(b,"fetchIdToken"),(await this.transporter.request(b)).data.id_token}fromJSON(a){if(!a)throw Error("Must pass in a JSON object containing the user refresh token");if("authorized_user"!==a.type)throw Error('The incoming JSON object does not have the "authorized_user" type');if(!a.client_id)throw Error("The incoming JSON object does not contain a client_id field");if(!a.client_secret)throw Error("The incoming JSON object does not contain a client_secret field");if(!a.refresh_token)throw Error("The incoming JSON object does not contain a refresh_token field");this._clientId=a.client_id,this._clientSecret=a.client_secret,this._refreshToken=a.refresh_token,this.credentials.refresh_token=a.refresh_token,this.quotaProjectId=a.quota_project_id,this.universeDomain=a.universe_domain||this.universeDomain}fromStream(a,b){if(!b)return this.fromStreamAsync(a);this.fromStreamAsync(a).then(()=>b(),b)}async fromStreamAsync(a){return new Promise((b,c)=>{if(!a)return c(Error("Must pass in a stream containing the user refresh token."));let d="";a.setEncoding("utf8").on("error",c).on("data",a=>d+=a).on("end",()=>{try{let a=JSON.parse(d);return this.fromJSON(a),b()}catch(a){return c(a)}})})}static fromJSON(a){let b=new f;return b.fromJSON(a),b}}c.UserRefreshClient=f},61576,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.Impersonated=c.IMPERSONATED_ACCOUNT_TYPE=void 0;let d=a.r(94347),e=a.r(99853),f=a.r(98126);c.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";class g extends d.OAuth2Client{sourceClient;targetPrincipal;targetScopes;delegates;lifetime;endpoint;constructor(a={}){if(super(a),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=a.sourceClient??new d.OAuth2Client,this.targetPrincipal=a.targetPrincipal??"",this.delegates=a.delegates??[],this.targetScopes=a.targetScopes??[],this.lifetime=a.lifetime??3600,(0,f.originalOrCamelOptions)(a).get("universe_domain")){if(this.sourceClient.universeDomain!==this.universeDomain)throw RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`)}else this.universeDomain=this.sourceClient.universeDomain;this.endpoint=a.endpoint??`https://iamcredentials.${this.universeDomain}`}async sign(a){await this.sourceClient.getAccessToken();let b=`projects/-/serviceAccounts/${this.targetPrincipal}`,c=`${this.endpoint}/v1/${b}:signBlob`,d={delegates:this.delegates,payload:Buffer.from(a).toString("base64")};return(await this.sourceClient.request({...g.RETRY_CONFIG,url:c,data:d,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){try{await this.sourceClient.getAccessToken();let a="projects/-/serviceAccounts/"+this.targetPrincipal,b=`${this.endpoint}/v1/${a}:generateAccessToken`,c={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},d=await this.sourceClient.request({...g.RETRY_CONFIG,url:b,data:c,method:"POST"}),e=d.data;return this.credentials.access_token=e.accessToken,this.credentials.expiry_date=Date.parse(e.expireTime),{tokens:this.credentials,res:d}}catch(c){if(!(c instanceof Error))throw c;let a=0,b="";if(c instanceof e.GaxiosError&&(a=c?.response?.data?.error?.status,b=c?.response?.data?.error?.message),a&&b)throw c.message=`${a}: unable to impersonate: ${b}`,c;throw c.message=`unable to impersonate: ${c}`,c}}async fetchIdToken(a,b){await this.sourceClient.getAccessToken();let c=`projects/-/serviceAccounts/${this.targetPrincipal}`,d=`${this.endpoint}/v1/${c}:generateIdToken`,e={delegates:this.delegates,audience:a,includeEmail:b?.includeEmail??!0,useEmailAzp:b?.includeEmail??!0};return(await this.sourceClient.request({...g.RETRY_CONFIG,url:d,data:e,method:"POST"})).data.token}}c.Impersonated=g},21575,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.OAuthClientAuthHandler=void 0,c.getErrorFromOAuthErrorResponse=function(a,b){let c=a.error,d=a.error_description,e=a.error_uri,f=`Error code ${c}`;void 0!==d&&(f+=`: ${d}`),void 0!==e&&(f+=` - ${e}`);let g=Error(f);if(b){let a=Object.keys(b);b.stack&&a.push("stack"),a.forEach(a=>{"message"!==a&&Object.defineProperty(g,a,{value:b[a],writable:!1,enumerable:!0})})}return g};let d=a.r(99853),e=a.r(65726),f=["PUT","POST","PATCH"];class g{#m=(0,e.createCrypto)();#n;transporter;constructor(a){a&&"clientId"in a?(this.#n=a,this.transporter=new d.Gaxios):(this.#n=a?.clientAuthentication,this.transporter=a?.transporter||new d.Gaxios)}applyClientAuthenticationOptions(a,b){a.headers=d.Gaxios.mergeHeaders(a.headers),this.injectAuthenticatedHeaders(a,b),b||this.injectAuthenticatedRequestBody(a)}injectAuthenticatedHeaders(a,b){if(b)a.headers=d.Gaxios.mergeHeaders(a.headers,{authorization:`Bearer ${b}`});else if(this.#n?.confidentialClientType==="basic"){a.headers=d.Gaxios.mergeHeaders(a.headers);let b=this.#n.clientId,c=this.#n.clientSecret||"",e=this.#m.encodeBase64StringUtf8(`${b}:${c}`);d.Gaxios.mergeHeaders(a.headers,{authorization:`Basic ${e}`})}}injectAuthenticatedRequestBody(a){if(this.#n?.confidentialClientType==="request-body"){let b=(a.method||"GET").toUpperCase();if(!f.includes(b))throw Error(`${b} HTTP method does not support ${this.#n.confidentialClientType} client authentication`);let c=new Headers(a.headers).get("content-type");if(c?.startsWith("application/x-www-form-urlencoded")||a.data instanceof URLSearchParams){let b=new URLSearchParams(a.data??"");b.append("client_id",this.#n.clientId),b.append("client_secret",this.#n.clientSecret||""),a.data=b}else if(c?.startsWith("application/json"))a.data=a.data||{},Object.assign(a.data,{client_id:this.#n.clientId,client_secret:this.#n.clientSecret||""});else throw Error(`${c} content-types are not supported with ${this.#n.confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}c.OAuthClientAuthHandler=g},78794,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.StsCredentials=void 0;let d=a.r(99853),e=a.r(30190),f=a.r(21575),g=a.r(98126);class h extends f.OAuthClientAuthHandler{#o;constructor(a={tokenExchangeEndpoint:""},b){("object"!=typeof a||a instanceof URL)&&(a={tokenExchangeEndpoint:a,clientAuthentication:b}),super(a),this.#o=a.tokenExchangeEndpoint}async exchangeToken(a,b,c){let i={grant_type:a.grantType,resource:a.resource,audience:a.audience,scope:a.scope?.join(" "),requested_token_type:a.requestedTokenType,subject_token:a.subjectToken,subject_token_type:a.subjectTokenType,actor_token:a.actingParty?.actorToken,actor_token_type:a.actingParty?.actorTokenType,options:c&&JSON.stringify(c)},j={...h.RETRY_CONFIG,url:this.#o.toString(),method:"POST",headers:b,data:new URLSearchParams((0,g.removeUndefinedValuesInObject)(i))};e.AuthClient.setMethodName(j,"exchangeToken"),this.applyClientAuthenticationOptions(j);try{let a=await this.transporter.request(j),b=a.data;return b.res=a,b}catch(a){if(a instanceof d.GaxiosError&&a.response)throw(0,f.getErrorFromOAuthErrorResponse)(a.response.data,a);throw a}}}c.StsCredentials=h},20382,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.BaseExternalAccountClient=c.CLOUD_RESOURCE_MANAGER=c.EXTERNAL_ACCOUNT_TYPE=c.EXPIRATION_TIME_OFFSET=void 0;let d=a.r(99853),e=a.r(88947),f=a.r(30190),g=a.r(78794),h=a.r(98126),i=a.r(15204),j="https://www.googleapis.com/auth/cloud-platform";c.EXPIRATION_TIME_OFFSET=3e5,c.EXTERNAL_ACCOUNT_TYPE="external_account",c.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";class k extends f.AuthClient{scopes;projectNumber;audience;subjectTokenType;stsCredential;clientAuth;credentialSourceType;cachedAccessToken;serviceAccountImpersonationUrl;serviceAccountImpersonationLifetime;workforcePoolUserProject;configLifetimeRequested;tokenUrl;cloudResourceManagerURL;supplierContext;#p=null;constructor(a){super(a);const b=(0,h.originalOrCamelOptions)(a),d=b.get("type");if(d&&d!==c.EXTERNAL_ACCOUNT_TYPE)throw Error(`Expected "${c.EXTERNAL_ACCOUNT_TYPE}" type but received "${a.type}"`);const e=b.get("client_id"),f=b.get("client_secret");this.tokenUrl=b.get("token_url")??"https://sts.{universeDomain}/v1/token".replace("{universeDomain}",this.universeDomain);const i=b.get("subject_token_type"),k=b.get("workforce_pool_user_project"),l=b.get("service_account_impersonation_url"),m=b.get("service_account_impersonation"),n=(0,h.originalOrCamelOptions)(m).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(b.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),e&&(this.clientAuth={confidentialClientType:"basic",clientId:e,clientSecret:f}),this.stsCredential=new g.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=b.get("scopes")||[j],this.cachedAccessToken=null,this.audience=b.get("audience"),this.subjectTokenType=i,this.workforcePoolUserProject=k;const o=RegExp("//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+");if(this.workforcePoolUserProject&&!this.audience.match(o))throw Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=l,this.serviceAccountImpersonationLifetime=n,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=3600),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);let a=/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl);return a?.groups?.email||null}return null}setCredentials(a){super.setCredentials(a),this.cachedAccessToken=a}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let a=await this.getAccessToken(),b=new Headers({authorization:`Bearer ${a.token}`});return this.addSharedMetadataHeaders(b)}request(a,b){if(!b)return this.requestAsync(a);this.requestAsync(a).then(a=>b(null,a),a=>b(a,a.response))}async getProjectId(){let a=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(a){let b=await this.getRequestHeaders(),c={...k.RETRY_CONFIG,headers:b,url:`${this.cloudResourceManagerURL.toString()}${a}`};f.AuthClient.setMethodName(c,"getProjectId");let d=await this.transporter.request(c);return this.projectId=d.data.projectId,this.projectId}return null}async requestAsync(a,b=!1){let c;try{let b=await this.getRequestHeaders();a.headers=d.Gaxios.mergeHeaders(a.headers),this.addUserProjectAndAuthHeaders(a.headers,b),c=await this.transporter.request(a)}catch(d){let c=d.response;if(c){let d=c.status,f=c.config.data instanceof e.Readable;if(!b&&(401===d||403===d)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(a,!0)}throw d}return c}async refreshAccessTokenAsync(){this.#p=this.#p||this.#q();try{return await this.#p}finally{this.#p=null}}async #q(){let a=await this.retrieveSubjectToken(),b={grantType:"urn:ietf:params:oauth:grant-type:token-exchange",audience:this.audience,requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:a,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[j]:this.getScopesArray()},c=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,d=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),e=await this.stsCredential.exchangeToken(b,d,c);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(e.access_token):e.expires_in?this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+1e3*e.expires_in,res:e.res}:this.cachedAccessToken={access_token:e.access_token,res:e.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(a){let b=a.match(/\/projects\/([^/]+)/);return b?b[1]:null}async getImpersonatedAccessToken(a){let b={...k.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${a}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};f.AuthClient.setMethodName(b,"getImpersonatedAccessToken");let c=await this.transporter.request(b),d=c.data;return{access_token:d.accessToken,expiry_date:new Date(d.expireTime).getTime(),res:c}}isExpired(a){let b=new Date().getTime();return!!a.expiry_date&&b>=a.expiry_date-this.eagerRefreshThresholdMillis}getScopesArray(){return"string"==typeof this.scopes?[this.scopes]:this.scopes||[j]}getMetricsHeaderValue(){let a=process.version.replace(/^v/,""),b=void 0!==this.serviceAccountImpersonationUrl,c=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${a} auth/${i.pkg.version} google-byoid-sdk source/${c} sa-impersonation/${b} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}}c.BaseExternalAccountClient=k},80689,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.FileSubjectTokenSupplier=void 0;let d=a.r(24361),e=a.r(22734),f=(0,d.promisify)(e.readFile??(()=>{})),g=(0,d.promisify)(e.realpath??(()=>{})),h=(0,d.promisify)(e.lstat??(()=>{}));c.FileSubjectTokenSupplier=class{filePath;formatType;subjectTokenFieldName;constructor(a){this.filePath=a.filePath,this.formatType=a.formatType,this.subjectTokenFieldName=a.subjectTokenFieldName}async getSubjectToken(){let a,b=this.filePath;try{if(b=await g(b),!(await h(b)).isFile())throw Error()}catch(a){throw a instanceof Error&&(a.message=`The file at ${b} does not exist, or it is not a file. ${a.message}`),a}let c=await f(b,{encoding:"utf8"});if("text"===this.formatType?a=c:"json"===this.formatType&&this.subjectTokenFieldName&&(a=JSON.parse(c)[this.subjectTokenFieldName]),!a)throw Error("Unable to parse the subject_token from the credential_source file");return a}}},58405,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.UrlSubjectTokenSupplier=void 0;let d=a.r(30190);c.UrlSubjectTokenSupplier=class{url;headers;formatType;subjectTokenFieldName;additionalGaxiosOptions;constructor(a){this.url=a.url,this.formatType=a.formatType,this.subjectTokenFieldName=a.subjectTokenFieldName,this.headers=a.headers,this.additionalGaxiosOptions=a.additionalGaxiosOptions}async getSubjectToken(a){let b,c={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};if(d.AuthClient.setMethodName(c,"getSubjectToken"),"text"===this.formatType?b=(await a.transporter.request(c)).data:"json"===this.formatType&&this.subjectTokenFieldName&&(b=(await a.transporter.request(c)).data[this.subjectTokenFieldName]),!b)throw Error("Unable to parse the subject_token from the credential_source URL");return b}}},61890,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.CertificateSubjectTokenSupplier=c.InvalidConfigurationError=c.CertificateSourceUnavailableError=c.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;let d=a.r(98126),e=a.r(22734),f=a.r(54799),g=a.r(24836);c.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";class h extends Error{constructor(a){super(a),this.name="CertificateSourceUnavailableError"}}c.CertificateSourceUnavailableError=h;class i extends Error{constructor(a){super(a),this.name="InvalidConfigurationError"}}c.InvalidConfigurationError=i,c.CertificateSubjectTokenSupplier=class{certificateConfigPath;trustChainPath;cert;key;constructor(a){if(!a.useDefaultCertificateConfig&&!a.certificateConfigLocation)throw new i("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(a.useDefaultCertificateConfig&&a.certificateConfigLocation)throw new i("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=a.trustChainPath,this.certificateConfigPath=a.certificateConfigLocation??""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new i("Cannot create mTLS Agent with missing certificate or key");return new g.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await this.#r();let{certPath:a,keyPath:b}=await this.#s();return{cert:this.cert,key:this.key}=await this.#t(a,b),await this.#u(this.cert)}async #r(){let a=this.certificateConfigPath;if(a){if(await (0,d.isValidFile)(a))return a;throw new h(`Provided certificate config path is invalid: ${a}`)}let b=process.env[c.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(b){if(await (0,d.isValidFile)(b))return b;throw new h(`Path from environment variable "${c.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${b}`)}let e=(0,d.getWellKnownCertificateConfigFileLocation)();if(await (0,d.isValidFile)(e))return e;throw new h(`Could not find certificate configuration file. Searched override path, the "${c.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${e}).`)}async #s(){let a,b=this.certificateConfigPath;try{a=await e.promises.readFile(b,"utf8")}catch(a){throw new h(`Failed to read certificate config file at: ${b}`)}try{let c=JSON.parse(a),d=c?.cert_configs?.workload?.cert_path,e=c?.cert_configs?.workload?.key_path;if(!d||!e)throw new i(`Certificate config file (${b}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:d,keyPath:e}}catch(a){if(a instanceof i)throw a;throw new i(`Failed to parse certificate config from ${b}: ${a.message}`)}}async #t(a,b){let c,d;try{c=await e.promises.readFile(a),new f.X509Certificate(c)}catch(c){let b=c instanceof Error?c.message:String(c);throw new h(`Failed to read certificate file at ${a}: ${b}`)}try{d=await e.promises.readFile(b),(0,f.createPrivateKey)(d)}catch(c){let a=c instanceof Error?c.message:String(c);throw new h(`Failed to read private key file at ${b}: ${a}`)}return{cert:c,key:d}}async #u(a){let b=new f.X509Certificate(a);if(!this.trustChainPath)return JSON.stringify([b.raw.toString("base64")]);try{let a,c=((await e.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g)??[]).map((a,b)=>{try{return new f.X509Certificate(a)}catch(c){let a=c instanceof Error?c.message:String(c);throw new i(`Failed to parse certificate at index ${b} in trust chain file ${this.trustChainPath}: ${a}`)}}),d=c.findIndex(a=>b.raw.equals(a.raw));if(-1===d)a=[b,...c];else if(0===d)a=c;else throw new i(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${d}).`);return JSON.stringify(a.map(a=>a.raw.toString("base64")))}catch(b){if(b instanceof i)throw b;let a=b instanceof Error?b.message:String(b);throw new h(`Failed to process certificate chain from ${this.trustChainPath}: ${a}`)}}}},32386,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.IdentityPoolClient=void 0;let d=a.r(20382),e=a.r(98126),f=a.r(80689),g=a.r(58405),h=a.r(61890),i=a.r(78794),j=a.r(99853);class k extends d.BaseExternalAccountClient{subjectTokenSupplier;constructor(a){super(a);const b=(0,e.originalOrCamelOptions)(a),c=b.get("credential_source"),d=b.get("subject_token_supplier");if(!c&&!d)throw Error("A credential source or subject token supplier must be specified.");if(c&&d)throw Error("Only one of credential source or subject token supplier can be specified.");if(d)this.subjectTokenSupplier=d,this.credentialSourceType="programmatic";else{const a=(0,e.originalOrCamelOptions)(c),b=(0,e.originalOrCamelOptions)(a.get("format")),d=b.get("type")||"text",i=b.get("subject_token_field_name");if("json"!==d&&"text"!==d)throw Error(`Invalid credential_source format "${d}"`);if("json"===d&&!i)throw Error("Missing subject_token_field_name for JSON credential_source format");const j=a.get("file"),l=a.get("url"),m=a.get("certificate"),n=a.get("headers");if(j&&l||l&&m||j&&m)throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(j)this.credentialSourceType="file",this.subjectTokenSupplier=new f.FileSubjectTokenSupplier({filePath:j,formatType:d,subjectTokenFieldName:i});else if(l)this.credentialSourceType="url",this.subjectTokenSupplier=new g.UrlSubjectTokenSupplier({url:l,formatType:d,subjectTokenFieldName:i,headers:n,additionalGaxiosOptions:k.RETRY_CONFIG});else if(m){this.credentialSourceType="certificate";const a=new h.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:m.use_default_certificate_config,certificateConfigLocation:m.certificate_config_location,trustChainPath:m.trust_chain_path});this.subjectTokenSupplier=a}else throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let a=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof h.CertificateSubjectTokenSupplier){let a=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new i.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new j.Gaxios({agent:a})}),this.transporter=new j.Gaxios({...this.transporter.defaults||{},agent:a})}return a}}c.IdentityPoolClient=k},59660,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.AwsRequestSigner=void 0;let d=a.r(99853),e=a.r(65726),f="AWS4-HMAC-SHA256";async function g(a,b,c){return await a.signWithHmacSha256(b,c)}async function h(a,b,c,d,e){let f=await g(a,`AWS4${b}`,c),h=await g(a,f,d),i=await g(a,h,e);return await g(a,i,"aws4_request")}async function i(a){let b=d.Gaxios.mergeHeaders(a.additionalAmzHeaders),c=a.requestPayload||"",i=a.host.split(".")[0],j=new Date,k=j.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),l=j.toISOString().replace(/[-]/g,"").replace(/T.*/,"");a.securityCredentials.token&&b.set("x-amz-security-token",a.securityCredentials.token);let m=d.Gaxios.mergeHeaders({host:a.host},b.has("date")?{}:{"x-amz-date":k},b),n="",o=[...m.keys()].sort();o.forEach(a=>{n+=`${a}:${m.get(a)}
`});let p=o.join(";"),q=await a.crypto.sha256DigestHex(c),r=`${a.method.toUpperCase()}
${a.canonicalUri}
${a.canonicalQuerystring}
${n}
${p}
${q}`,s=`${l}/${a.region}/${i}/aws4_request`,t=`${f}
${k}
${s}
`+await a.crypto.sha256DigestHex(r),u=await h(a.crypto,a.securityCredentials.secretAccessKey,l,a.region,i),v=await g(a.crypto,u,t),w=`${f} Credential=${a.securityCredentials.accessKeyId}/${s}, SignedHeaders=${p}, Signature=${(0,e.fromArrayBufferToHex)(v)}`;return{amzDate:b.has("date")?void 0:k,authorizationHeader:w,canonicalQuerystring:a.canonicalQuerystring}}c.AwsRequestSigner=class{getCredentials;region;crypto;constructor(a,b){this.getCredentials=a,this.region=b,this.crypto=(0,e.createCrypto)()}async getRequestOptions(a){if(!a.url)throw RangeError('"url" is required in "amzOptions"');let b="object"==typeof a.data?JSON.stringify(a.data):a.data,c=a.url,e=a.method||"GET",f=a.body||b,g=a.headers,h=await this.getCredentials(),j=new URL(c);if("string"!=typeof f&&void 0!==f)throw TypeError(`'requestPayload' is expected to be a string if provided. Got: ${f}`);let k=await i({crypto:this.crypto,host:j.host,canonicalUri:j.pathname,canonicalQuerystring:j.search.slice(1),method:e,region:this.region,securityCredentials:h,requestPayload:f,additionalAmzHeaders:g}),l=d.Gaxios.mergeHeaders(k.amzDate?{"x-amz-date":k.amzDate}:{},{authorization:k.authorizationHeader,host:j.host},g||{});h.token&&d.Gaxios.mergeHeaders(l,{"x-amz-security-token":h.token});let m={url:c,method:e,headers:l};return void 0!==f&&(m.body=f),m}}},29723,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.DefaultAwsSecurityCredentialsSupplier=void 0;let d=a.r(30190);c.DefaultAwsSecurityCredentialsSupplier=class{regionUrl;securityCredentialsUrl;imdsV2SessionTokenUrl;additionalGaxiosOptions;constructor(a){this.regionUrl=a.regionUrl,this.securityCredentialsUrl=a.securityCredentialsUrl,this.imdsV2SessionTokenUrl=a.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=a.additionalGaxiosOptions}async getAwsRegion(a){if(this.#v)return this.#v;let b=new Headers;if(!this.#v&&this.imdsV2SessionTokenUrl&&b.set("x-aws-ec2-metadata-token",await this.#w(a.transporter)),!this.regionUrl)throw RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let c={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:b};d.AuthClient.setMethodName(c,"getAwsRegion");let e=await a.transporter.request(c);return e.data.substr(0,e.data.length-1)}async getAwsSecurityCredentials(a){if(this.#x)return this.#x;let b=new Headers;this.imdsV2SessionTokenUrl&&b.set("x-aws-ec2-metadata-token",await this.#w(a.transporter));let c=await this.#y(b,a.transporter),d=await this.#z(c,b,a.transporter);return{accessKeyId:d.AccessKeyId,secretAccessKey:d.SecretAccessKey,token:d.Token}}async #w(a){let b={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return d.AuthClient.setMethodName(b,"#getImdsV2SessionToken"),(await a.request(b)).data}async #y(a,b){if(!this.securityCredentialsUrl)throw Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let c={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:a};return d.AuthClient.setMethodName(c,"#getAwsRoleName"),(await b.request(c)).data}async #z(a,b,c){let e={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${a}`,headers:b};return d.AuthClient.setMethodName(e,"#retrieveAwsSecurityCredentials"),(await c.request(e)).data}get #v(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null}get #x(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}}},77961,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.AwsClient=void 0;let d=a.r(59660),e=a.r(20382),f=a.r(29723),g=a.r(98126),h=a.r(99853);class i extends e.BaseExternalAccountClient{environmentId;awsSecurityCredentialsSupplier;regionalCredVerificationUrl;awsRequestSigner;region;static #A="https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15";static AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";static AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254";constructor(a){super(a);const b=(0,g.originalOrCamelOptions)(a),c=b.get("credential_source"),d=b.get("aws_security_credentials_supplier");if(!c&&!d)throw Error("A credential source or AWS security credentials supplier must be specified.");if(c&&d)throw Error("Only one of credential source or AWS security credentials supplier can be specified.");if(d)this.awsSecurityCredentialsSupplier=d,this.regionalCredVerificationUrl=i.#A,this.credentialSourceType="programmatic";else{const a=(0,g.originalOrCamelOptions)(c);this.environmentId=a.get("environment_id");const b=a.get("region_url"),d=a.get("url"),e=a.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new f.DefaultAwsSecurityCredentialsSupplier({regionUrl:b,securityCredentialsUrl:d,imdsV2SessionTokenUrl:e}),this.regionalCredVerificationUrl=a.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){let a=this.environmentId?.match(/^(aws)(\d+)$/);if(a&&this.regionalCredVerificationUrl){if(1!==parseInt(a[2],10))throw Error(`aws version "${a[2]}" is not supported in the current build.`)}else throw Error('No valid AWS "credential_source" provided')}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new d.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let a=await this.awsRequestSigner.getRequestOptions({...i.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),b=[];return h.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},a.headers).forEach((a,c)=>b.push({key:c,value:a})),encodeURIComponent(JSON.stringify({url:a.url,method:a.method,headers:b}))}}c.AwsClient=i},71544,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.InvalidSubjectTokenError=c.InvalidMessageFieldError=c.InvalidCodeFieldError=c.InvalidTokenTypeFieldError=c.InvalidExpirationTimeFieldError=c.InvalidSuccessFieldError=c.InvalidVersionFieldError=c.ExecutableResponseError=c.ExecutableResponse=void 0;let d="urn:ietf:params:oauth:token-type:saml2",e="urn:ietf:params:oauth:token-type:id_token",f="urn:ietf:params:oauth:token-type:jwt";c.ExecutableResponse=class{version;success;expirationTime;tokenType;errorCode;errorMessage;subjectToken;constructor(a){if(!a.version)throw new h("Executable response must contain a 'version' field.");if(void 0===a.success)throw new i("Executable response must contain a 'success' field.");if(this.version=a.version,this.success=a.success,this.success){if(this.expirationTime=a.expiration_time,this.tokenType=a.token_type,this.tokenType!==d&&this.tokenType!==e&&this.tokenType!==f)throw new j(`Executable response must contain a 'token_type' field when successful and it must be one of ${e}, ${f}, or ${d}.`);if(this.tokenType===d){if(!a.saml_response)throw new m(`Executable response must contain a 'saml_response' field when token_type=${d}.`);this.subjectToken=a.saml_response}else{if(!a.id_token)throw new m(`Executable response must contain a 'id_token' field when token_type=${e} or ${f}.`);this.subjectToken=a.id_token}}else{if(!a.code)throw new k("Executable response must contain a 'code' field when unsuccessful.");if(!a.message)throw new l("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=a.code,this.errorMessage=a.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return void 0!==this.expirationTime&&this.expirationTime<Math.round(Date.now()/1e3)}};class g extends Error{constructor(a){super(a),Object.setPrototypeOf(this,new.target.prototype)}}c.ExecutableResponseError=g;class h extends g{}c.InvalidVersionFieldError=h;class i extends g{}c.InvalidSuccessFieldError=i,c.InvalidExpirationTimeFieldError=class extends g{};class j extends g{}c.InvalidTokenTypeFieldError=j;class k extends g{}c.InvalidCodeFieldError=k;class l extends g{}c.InvalidMessageFieldError=l;class m extends g{}c.InvalidSubjectTokenError=m},20361,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.PluggableAuthHandler=c.ExecutableError=void 0;let d=a.r(71544),e=a.r(33405),f=a.r(22734);class g extends Error{code;constructor(a,b){super(`The executable failed with exit code: ${b} and error message: ${a}.`),this.code=b,Object.setPrototypeOf(this,new.target.prototype)}}c.ExecutableError=g;class h{commandComponents;timeoutMillis;outputFile;constructor(a){if(!a.command)throw Error("No command provided.");if(this.commandComponents=h.parseCommand(a.command),this.timeoutMillis=a.timeoutMillis,!this.timeoutMillis)throw Error("No timeoutMillis provided.");this.outputFile=a.outputFile}retrieveResponseFromExecutable(a){return new Promise((b,c)=>{let f=e.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(a)}}),h="";f.stdout.on("data",a=>{h+=a}),f.stderr.on("data",a=>{h+=a});let i=setTimeout(()=>(f.removeAllListeners(),f.kill(),c(Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);f.on("close",a=>{if(clearTimeout(i),0!==a)return c(new g(h,a.toString()));try{let a=JSON.parse(h),c=new d.ExecutableResponse(a);return b(c)}catch(a){if(a instanceof d.ExecutableResponseError)return c(a);return c(new d.ExecutableResponseError(`The executable returned an invalid response: ${h}`))}})})}async retrieveCachedResponse(){let a;if(!this.outputFile||0===this.outputFile.length)return;try{a=await f.promises.realpath(this.outputFile)}catch{return}if(!(await f.promises.lstat(a)).isFile())return;let b=await f.promises.readFile(a,{encoding:"utf8"});if(""!==b)try{let a=JSON.parse(b);if(new d.ExecutableResponse(a).isValid())return new d.ExecutableResponse(a);return}catch(a){if(a instanceof d.ExecutableResponseError)throw a;throw new d.ExecutableResponseError(`The output file contained an invalid response: ${b}`)}}static parseCommand(a){let b=a.match(/(?:[^\s"]+|"[^"]*")+/g);if(!b)throw Error(`Provided command: "${a}" could not be parsed.`);for(let a=0;a<b.length;a++)'"'===b[a][0]&&'"'===b[a].slice(-1)&&(b[a]=b[a].slice(1,-1));return b}}c.PluggableAuthHandler=h},18451,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.PluggableAuthClient=c.ExecutableError=void 0;let d=a.r(20382),e=a.r(71544),f=a.r(20361);var g=a.r(20361);Object.defineProperty(c,"ExecutableError",{enumerable:!0,get:function(){return g.ExecutableError}});class h extends d.BaseExternalAccountClient{command;timeoutMillis;outputFile;handler;constructor(a){if(super(a),!a.credential_source.executable||(this.command=a.credential_source.executable.command,!this.command))throw Error('No valid Pluggable Auth "credential_source" provided.');if(void 0===a.credential_source.executable.timeout_millis)this.timeoutMillis=3e4;else if(this.timeoutMillis=a.credential_source.executable.timeout_millis,this.timeoutMillis<5e3||this.timeoutMillis>12e4)throw Error("Timeout must be between 5000120000 milliseconds.");this.outputFile=a.credential_source.executable.output_file,this.handler=new f.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){let a;if("1"!==process.env.GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES)throw Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");if(this.outputFile&&(a=await this.handler.retrieveCachedResponse()),!a){let b=new Map;b.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),b.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),b.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&b.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let c=this.getServiceAccountEmail();c&&b.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",c),a=await this.handler.retrieveResponseFromExecutable(b)}if(a.version>1)throw Error("Version of executable is not currently supported, maximum supported version is 1.");if(!a.success)throw new f.ExecutableError(a.errorMessage,a.errorCode);if(this.outputFile&&!a.expirationTime)throw new e.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(a.isExpired())throw Error("Executable response is expired.");return a.subjectToken}}c.PluggableAuthClient=h},50489,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ExternalAccountClient=void 0;let d=a.r(20382),e=a.r(32386),f=a.r(77961),g=a.r(18451);c.ExternalAccountClient=class{constructor(){throw Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(a){return a&&a.type===d.EXTERNAL_ACCOUNT_TYPE?a.credential_source?.environment_id?new f.AwsClient(a):a.credential_source?.executable?new g.PluggableAuthClient(a):new e.IdentityPoolClient(a):null}}},44737,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.ExternalAccountAuthorizedUserClient=c.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;let d=a.r(30190),e=a.r(21575),f=a.r(99853),g=a.r(88947),h=a.r(20382);c.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";class i extends e.OAuthClientAuthHandler{#B;constructor(a){super(a),this.#B=a.tokenRefreshEndpoint}async refreshToken(a,b){let c={...i.RETRY_CONFIG,url:this.#B,method:"POST",headers:b,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:a})};d.AuthClient.setMethodName(c,"refreshToken"),this.applyClientAuthenticationOptions(c);try{let a=await this.transporter.request(c),b=a.data;return b.res=a,b}catch(a){if(a instanceof f.GaxiosError&&a.response)throw(0,e.getErrorFromOAuthErrorResponse)(a.response.data,a);throw a}}}class j extends d.AuthClient{cachedAccessToken;externalAccountAuthorizedUserHandler;refreshToken;constructor(a){super(a),a.universe_domain&&(this.universeDomain=a.universe_domain),this.refreshToken=a.refresh_token;const b={confidentialClientType:"basic",clientId:a.client_id,clientSecret:a.client_secret};this.externalAccountAuthorizedUserHandler=new i({tokenRefreshEndpoint:a.token_url??"https://sts.{universeDomain}/v1/oauthtoken".replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:b}),this.cachedAccessToken=null,this.quotaProjectId=a.quota_project_id,"number"!=typeof a?.eagerRefreshThresholdMillis?this.eagerRefreshThresholdMillis=h.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=a.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!a?.forceRefreshOnFailure}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let a=await this.getAccessToken(),b=new Headers({authorization:`Bearer ${a.token}`});return this.addSharedMetadataHeaders(b)}request(a,b){if(!b)return this.requestAsync(a);this.requestAsync(a).then(a=>b(null,a),a=>b(a,a.response))}async requestAsync(a,b=!1){let c;try{let b=await this.getRequestHeaders();a.headers=f.Gaxios.mergeHeaders(a.headers),this.addUserProjectAndAuthHeaders(a.headers,b),c=await this.transporter.request(a)}catch(d){let c=d.response;if(c){let d=c.status,e=c.config.data instanceof g.Readable;if(!b&&(401===d||403===d)&&!e&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(a,!0)}throw d}return c}async refreshAccessTokenAsync(){let a=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:a.access_token,expiry_date:new Date().getTime()+1e3*a.expires_in,res:a.res},void 0!==a.refresh_token&&(this.refreshToken=a.refresh_token),this.cachedAccessToken}isExpired(a){let b=new Date().getTime();return!!a.expiry_date&&b>=a.expiry_date-this.eagerRefreshThresholdMillis}}c.ExternalAccountAuthorizedUserClient=j},35058,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.GoogleAuth=c.GoogleAuthExceptionMessages=void 0;let d=a.r(33405),e=a.r(22734),f=a.r(99853),g=a.r(54145),h=a.r(46786),i=a.r(14747),j=a.r(65726),k=a.r(48889),l=a.r(70241),m=a.r(51747),n=a.r(42911),o=a.r(92114),p=a.r(61576),q=a.r(50489),r=a.r(20382),s=a.r(30190),t=a.r(44737),u=a.r(98126);c.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:"Unable to detect a Project Id in the current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_CREDENTIALS_FOUND:"Unable to find credentials in current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:"Unable to detect a Universe Domain in the current environment.\nTo learn more about Universe Domain retrieval, visit: \nhttps://cloud.google.com/compute/docs/metadata/predefined-metadata-keys"},c.GoogleAuth=class{checkIsGCE=void 0;useJWTAccessWithScope;defaultServicePath;get isGCE(){return this.checkIsGCE}_findProjectIdPromise;_cachedProjectId;jsonContent=null;apiKey;cachedCredential=null;#C=null;defaultScopes;keyFilename;scopes;clientOptions={};constructor(a={}){if(this._cachedProjectId=a.projectId||null,this.cachedCredential=a.authClient||null,this.keyFilename=a.keyFilename||a.keyFile,this.scopes=a.scopes,this.clientOptions=a.clientOptions||{},this.jsonContent=a.credentials||null,this.apiKey=a.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw RangeError(c.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);a.universeDomain&&(this.clientOptions.universeDomain=a.universeDomain)}setGapicJWTValues(a){a.defaultServicePath=this.defaultServicePath,a.useJWTAccessWithScope=this.useJWTAccessWithScope,a.defaultScopes=this.defaultScopes}getProjectId(a){if(!a)return this.getProjectIdAsync();this.getProjectIdAsync().then(b=>a(null,b),a)}async getProjectIdOptional(){try{return await this.getProjectId()}catch(a){if(a instanceof Error&&a.message===c.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw a}}async findAndCacheProjectId(){let a=null;if(a||=await this.getProductionProjectId(),a||=await this.getFileProjectId(),a||=await this.getDefaultServiceProjectId(),a||=await this.getGCEProjectId(),a||=await this.getExternalAccountClientProjectId())return this._cachedProjectId=a,a;throw Error(c.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){let a;try{a=await g.universe("universe-domain"),a||=s.DEFAULT_UNIVERSE}catch(b){if(b&&b?.response?.status===404)a=s.DEFAULT_UNIVERSE;else throw b}return a}async getUniverseDomain(){let a=(0,u.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{a??=(await this.getClient()).universeDomain}catch{a??=s.DEFAULT_UNIVERSE}return a}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(a={},b){let c;if("function"==typeof a?b=a:c=a,!b)return this.getApplicationDefaultAsync(c);this.getApplicationDefaultAsync(c).then(a=>b(null,a.credential,a.projectId),b)}async getApplicationDefaultAsync(a={}){let b;if(this.cachedCredential)return await this.#D(this.cachedCredential,null);if((b=await this._tryGetApplicationCredentialsFromEnvironmentVariable(a))||(b=await this._tryGetApplicationCredentialsFromWellKnownFile(a)))return b instanceof n.JWT?b.scopes=this.scopes:b instanceof r.BaseExternalAccountClient&&(b.scopes=this.getAnyScopes()),await this.#D(b);if(await this._checkIsGCE())return a.scopes=this.getAnyScopes(),await this.#D(new k.Compute(a));throw Error(c.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async #D(a,b=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let c=await this.getProjectIdOptional();return b&&(a.quotaProjectId=b),this.cachedCredential=a,{credential:a,projectId:c}}async _checkIsGCE(){return void 0===this.checkIsGCE&&(this.checkIsGCE=g.getGCPResidency()||await g.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(a){let b=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!b||0===b.length)return null;try{return this._getApplicationCredentialsFromFilePath(b,a)}catch(a){throw a instanceof Error&&(a.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${a.message}`),a}}async _tryGetApplicationCredentialsFromWellKnownFile(a){let b=null;if(this._isWindows())b=process.env.APPDATA;else{let a=process.env.HOME;a&&(b=i.join(a,".config"))}return(b&&(b=i.join(b,"gcloud","application_default_credentials.json"),e.existsSync(b)||(b=null)),b)?await this._getApplicationCredentialsFromFilePath(b,a):null}async _getApplicationCredentialsFromFilePath(a,b={}){if(!a||0===a.length)throw Error("The file path is invalid.");try{if(a=e.realpathSync(a),!e.lstatSync(a).isFile())throw Error()}catch(b){throw b instanceof Error&&(b.message=`The file at ${a} does not exist, or it is not a file. ${b.message}`),b}let c=e.createReadStream(a);return this.fromStream(c,b)}fromImpersonatedJSON(a){if(!a)throw Error("Must pass in a JSON object containing an  impersonated refresh token");if(a.type!==p.IMPERSONATED_ACCOUNT_TYPE)throw Error(`The incoming JSON object does not have the "${p.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!a.source_credentials)throw Error("The incoming JSON object does not contain a source_credentials field");if(!a.service_account_impersonation_url)throw Error("The incoming JSON object does not contain a service_account_impersonation_url field");let b=this.fromJSON(a.source_credentials);if(a.service_account_impersonation_url?.length>256)throw RangeError(`Target principal is too long: ${a.service_account_impersonation_url}`);let c=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(a.service_account_impersonation_url)?.groups?.target;if(!c)throw RangeError(`Cannot extract target principal from ${a.service_account_impersonation_url}`);let d=(this.scopes||a.scopes||this.defaultScopes)??[];return new p.Impersonated({...a,sourceClient:b,targetPrincipal:c,targetScopes:Array.isArray(d)?d:[d]})}fromJSON(a,b={}){let c,d=(0,u.originalOrCamelOptions)(b).get("universe_domain");return a.type===o.USER_REFRESH_ACCOUNT_TYPE?(c=new o.UserRefreshClient(b)).fromJSON(a):a.type===p.IMPERSONATED_ACCOUNT_TYPE?c=this.fromImpersonatedJSON(a):a.type===r.EXTERNAL_ACCOUNT_TYPE?(c=q.ExternalAccountClient.fromJSON({...a,...b})).scopes=this.getAnyScopes():a.type===t.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?c=new t.ExternalAccountAuthorizedUserClient({...a,...b}):(b.scopes=this.scopes,c=new n.JWT(b),this.setGapicJWTValues(c),c.fromJSON(a)),d&&(c.universeDomain=d),c}_cacheClientFromJSON(a,b){let c=this.fromJSON(a,b);return this.jsonContent=a,this.cachedCredential=c,c}fromStream(a,b={},c){let d={};if("function"==typeof b?c=b:d=b,!c)return this.fromStreamAsync(a,d);this.fromStreamAsync(a,d).then(a=>c(null,a),c)}fromStreamAsync(a,b){return new Promise((c,d)=>{if(!a)throw Error("Must pass in a stream containing the Google auth settings.");let e=[];a.setEncoding("utf8").on("error",d).on("data",a=>e.push(a)).on("end",()=>{try{try{let a=JSON.parse(e.join("")),d=this._cacheClientFromJSON(a,b);return c(d)}catch(b){if(!this.keyFilename)throw b;let a=new n.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=a,this.setGapicJWTValues(a),c(a)}}catch(a){return d(a)}})})}fromAPIKey(a,b={}){return new n.JWT({...b,apiKey:a})}_isWindows(){let a=h.platform();return!!a&&!!(a.length>=3)&&"win"===a.substring(0,3).toLowerCase()}async getDefaultServiceProjectId(){return new Promise(a=>{(0,d.exec)("gcloud config config-helper --format json",(b,c)=>{if(!b&&c)try{let b=JSON.parse(c).configuration.properties.core.project;a(b);return}catch(a){}a(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let a=await this.getClient();if(a&&a.projectId)return a.projectId}let a=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return a?a.projectId:null}async getExternalAccountClientProjectId(){if(!this.jsonContent||this.jsonContent.type!==r.EXTERNAL_ACCOUNT_TYPE)return null;let a=await this.getClient();return await a.getProjectId()}async getGCEProjectId(){try{return await g.project("project-id")}catch(a){return null}}getCredentials(a){if(!a)return this.getCredentialsAsync();this.getCredentialsAsync().then(b=>a(null,b),a)}async getCredentialsAsync(){let a=await this.getClient();if(a instanceof p.Impersonated)return{client_email:a.getTargetPrincipal()};if(a instanceof r.BaseExternalAccountClient){let b=a.getServiceAccountEmail();if(b)return{client_email:b,universe_domain:a.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[a,b]=await Promise.all([g.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:a,universe_domain:b}}throw Error(c.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;this.#C=this.#C||this.#E();try{return await this.#C}finally{this.#C=null}}async #E(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let a=i.resolve(this.keyFilename),b=e.createReadStream(a);return await this.fromStreamAsync(b,this.clientOptions)}if(this.apiKey){let a=await this.fromAPIKey(this.apiKey,this.clientOptions);a.scopes=this.scopes;let{credential:b}=await this.#D(a);return b}{let{credential:a}=await this.getApplicationDefaultAsync(this.clientOptions);return a}}async getIdTokenClient(a){let b=await this.getClient();if(!("fetchIdToken"in b))throw Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new l.IdTokenClient({targetAudience:a,idTokenProvider:b})}async getAccessToken(){let a=await this.getClient();return(await a.getAccessToken()).token}async getRequestHeaders(a){return(await this.getClient()).getRequestHeaders(a)}async authorizeRequest(a={}){let b=a.url,c=await this.getClient(),d=await c.getRequestHeaders(b);return a.headers=f.Gaxios.mergeHeaders(a.headers,d),a}async fetch(...a){return(await this.getClient()).fetch(...a)}async request(a){return(await this.getClient()).request(a)}getEnv(){return(0,m.getEnv)()}async sign(a,b){let c=await this.getClient(),d=await this.getUniverseDomain();if(b=b||`https://iamcredentials.${d}/v1/projects/-/serviceAccounts/`,c instanceof p.Impersonated)return(await c.sign(a)).signedBlob;let e=(0,j.createCrypto)();if(c instanceof n.JWT&&c.key)return await e.sign(c.key,a);let f=await this.getCredentials();if(!f.client_email)throw Error("Cannot sign data without `client_email`.");return this.signBlob(e,f.client_email,a,b)}async signBlob(a,b,c,d){let e=new URL(d+`${b}:signBlob`);return(await this.request({method:"POST",url:e.href,data:{payload:a.encodeBase64StringUtf8(c)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}}},79746,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.IAMAuth=void 0,c.IAMAuth=class{selector;token;constructor(a,b){this.selector=a,this.token=b,this.selector=a,this.token=b}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}}},43581,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.DownscopedClient=c.EXPIRATION_TIME_OFFSET=c.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;let d=a.r(99853),e=a.r(88947),f=a.r(30190),g=a.r(78794);c.MAX_ACCESS_BOUNDARY_RULES_COUNT=10,c.EXPIRATION_TIME_OFFSET=3e5;class h extends f.AuthClient{authClient;credentialAccessBoundary;cachedDownscopedAccessToken;stsCredential;constructor(a,b={accessBoundary:{accessBoundaryRules:[]}}){if(super(a instanceof f.AuthClient?{}:a),a instanceof f.AuthClient?(this.authClient=a,this.credentialAccessBoundary=b):(this.authClient=a.authClient,this.credentialAccessBoundary=a.credentialAccessBoundary),0===this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length)throw Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>c.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw Error(`The provided access boundary has more than ${c.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(const a of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(0===a.availablePermissions.length)throw Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new g.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(a){if(!a.expiry_date)throw Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(a),this.cachedDownscopedAccessToken=a}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let a=await this.getAccessToken(),b=new Headers({authorization:`Bearer ${a.token}`});return this.addSharedMetadataHeaders(b)}request(a,b){if(!b)return this.requestAsync(a);this.requestAsync(a).then(a=>b(null,a),a=>b(a,a.response))}async requestAsync(a,b=!1){let c;try{let b=await this.getRequestHeaders();a.headers=d.Gaxios.mergeHeaders(a.headers),this.addUserProjectAndAuthHeaders(a.headers,b),c=await this.transporter.request(a)}catch(d){let c=d.response;if(c){let d=c.status,f=c.config.data instanceof e.Readable;if(!b&&(401===d||403===d)&&!f&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(a,!0)}throw d}return c}async refreshAccessTokenAsync(){let a=(await this.authClient.getAccessToken()).token,b=await this.stsCredential.exchangeToken({grantType:"urn:ietf:params:oauth:grant-type:token-exchange",requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:a,subjectTokenType:"urn:ietf:params:oauth:token-type:access_token"},void 0,this.credentialAccessBoundary),c=this.authClient.credentials?.expiry_date||null,d=b.expires_in?new Date().getTime()+1e3*b.expires_in:c;return this.cachedDownscopedAccessToken={access_token:b.access_token,expiry_date:d,res:b.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(a){let b=new Date().getTime();return!!a.expiry_date&&b>=a.expiry_date-this.eagerRefreshThresholdMillis}}c.DownscopedClient=h},46183,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.PassThroughClient=void 0;let d=a.r(30190);class e extends d.AuthClient{async request(a){return this.transporter.request(a)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}}c.PassThroughClient=e},28684,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.GoogleAuth=c.auth=c.PassThroughClient=c.ExternalAccountAuthorizedUserClient=c.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=c.ExecutableError=c.PluggableAuthClient=c.DownscopedClient=c.BaseExternalAccountClient=c.ExternalAccountClient=c.IdentityPoolClient=c.AwsRequestSigner=c.AwsClient=c.UserRefreshClient=c.LoginTicket=c.ClientAuthentication=c.OAuth2Client=c.CodeChallengeMethod=c.Impersonated=c.JWT=c.JWTAccess=c.IdTokenClient=c.IAMAuth=c.GCPEnv=c.Compute=c.DEFAULT_UNIVERSE=c.AuthClient=c.gaxios=c.gcpMetadata=void 0;let d=a.r(35058);Object.defineProperty(c,"GoogleAuth",{enumerable:!0,get:function(){return d.GoogleAuth}}),c.gcpMetadata=a.r(54145),c.gaxios=a.r(99853);var e=a.r(30190);Object.defineProperty(c,"AuthClient",{enumerable:!0,get:function(){return e.AuthClient}}),Object.defineProperty(c,"DEFAULT_UNIVERSE",{enumerable:!0,get:function(){return e.DEFAULT_UNIVERSE}});var f=a.r(48889);Object.defineProperty(c,"Compute",{enumerable:!0,get:function(){return f.Compute}});var g=a.r(51747);Object.defineProperty(c,"GCPEnv",{enumerable:!0,get:function(){return g.GCPEnv}});var h=a.r(79746);Object.defineProperty(c,"IAMAuth",{enumerable:!0,get:function(){return h.IAMAuth}});var i=a.r(70241);Object.defineProperty(c,"IdTokenClient",{enumerable:!0,get:function(){return i.IdTokenClient}});var j=a.r(88329);Object.defineProperty(c,"JWTAccess",{enumerable:!0,get:function(){return j.JWTAccess}});var k=a.r(42911);Object.defineProperty(c,"JWT",{enumerable:!0,get:function(){return k.JWT}});var l=a.r(61576);Object.defineProperty(c,"Impersonated",{enumerable:!0,get:function(){return l.Impersonated}});var m=a.r(94347);Object.defineProperty(c,"CodeChallengeMethod",{enumerable:!0,get:function(){return m.CodeChallengeMethod}}),Object.defineProperty(c,"OAuth2Client",{enumerable:!0,get:function(){return m.OAuth2Client}}),Object.defineProperty(c,"ClientAuthentication",{enumerable:!0,get:function(){return m.ClientAuthentication}});var n=a.r(98463);Object.defineProperty(c,"LoginTicket",{enumerable:!0,get:function(){return n.LoginTicket}});var o=a.r(92114);Object.defineProperty(c,"UserRefreshClient",{enumerable:!0,get:function(){return o.UserRefreshClient}});var p=a.r(77961);Object.defineProperty(c,"AwsClient",{enumerable:!0,get:function(){return p.AwsClient}});var q=a.r(59660);Object.defineProperty(c,"AwsRequestSigner",{enumerable:!0,get:function(){return q.AwsRequestSigner}});var r=a.r(32386);Object.defineProperty(c,"IdentityPoolClient",{enumerable:!0,get:function(){return r.IdentityPoolClient}});var s=a.r(50489);Object.defineProperty(c,"ExternalAccountClient",{enumerable:!0,get:function(){return s.ExternalAccountClient}});var t=a.r(20382);Object.defineProperty(c,"BaseExternalAccountClient",{enumerable:!0,get:function(){return t.BaseExternalAccountClient}});var u=a.r(43581);Object.defineProperty(c,"DownscopedClient",{enumerable:!0,get:function(){return u.DownscopedClient}});var v=a.r(18451);Object.defineProperty(c,"PluggableAuthClient",{enumerable:!0,get:function(){return v.PluggableAuthClient}}),Object.defineProperty(c,"ExecutableError",{enumerable:!0,get:function(){return v.ExecutableError}});var w=a.r(44737);Object.defineProperty(c,"EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE",{enumerable:!0,get:function(){return w.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE}}),Object.defineProperty(c,"ExternalAccountAuthorizedUserClient",{enumerable:!0,get:function(){return w.ExternalAccountAuthorizedUserClient}});var x=a.r(46183);Object.defineProperty(c,"PassThroughClient",{enumerable:!0,get:function(){return x.PassThroughClient}}),c.auth=new d.GoogleAuth},24868,(a,b,c)=>{b.exports=a.x("fs/promises",()=>require("fs/promises"))},88646,(a,b,c)=>{b.exports=a.x("node:stream/promises",()=>require("node:stream/promises"))},6461,(a,b,c)=>{b.exports=a.x("zlib",()=>require("zlib"))},65514,(a,b,c)=>{"use strict";let d=["nodebuffer","arraybuffer","fragments"],e="undefined"!=typeof Blob;e&&d.push("blob"),b.exports={BINARY_TYPES:d,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:e,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},40352,(a,b,c)=>{"use strict";let{EMPTY_BUFFER:d}=a.r(65514),e=Buffer[Symbol.species];function f(a,b,c,d,e){for(let f=0;f<e;f++)c[d+f]=a[f]^b[3&f]}function g(a,b){for(let c=0;c<a.length;c++)a[c]^=b[3&c]}function h(a){let b;return(h.readOnly=!0,Buffer.isBuffer(a))?a:(a instanceof ArrayBuffer?b=new e(a):ArrayBuffer.isView(a)?b=new e(a.buffer,a.byteOffset,a.byteLength):(b=Buffer.from(a),h.readOnly=!1),b)}if(b.exports={concat:function(a,b){if(0===a.length)return d;if(1===a.length)return a[0];let c=Buffer.allocUnsafe(b),f=0;for(let b=0;b<a.length;b++){let d=a[b];c.set(d,f),f+=d.length}return f<b?new e(c.buffer,c.byteOffset,f):c},mask:f,toArrayBuffer:function(a){return a.length===a.buffer.byteLength?a.buffer:a.buffer.slice(a.byteOffset,a.byteOffset+a.length)},toBuffer:h,unmask:g},!process.env.WS_NO_BUFFER_UTIL)try{let a=(()=>{let a=Error("Cannot find module 'bufferutil'");throw a.code="MODULE_NOT_FOUND",a})();b.exports.mask=function(b,c,d,e,g){g<48?f(b,c,d,e,g):a.mask(b,c,d,e,g)},b.exports.unmask=function(b,c){b.length<32?g(b,c):a.unmask(b,c)}}catch(a){}},29110,(a,b,c)=>{"use strict";let d=Symbol("kDone"),e=Symbol("kRun");b.exports=class{constructor(a){this[d]=()=>{this.pending--,this[e]()},this.concurrency=a||1/0,this.jobs=[],this.pending=0}add(a){this.jobs.push(a),this[e]()}[e](){if(this.pending!==this.concurrency&&this.jobs.length){let a=this.jobs.shift();this.pending++,a(this[d])}}}},19199,(a,b,c)=>{"use strict";let d,e=a.r(6461),f=a.r(40352),g=a.r(29110),{kStatusCode:h}=a.r(65514),i=Buffer[Symbol.species],j=Buffer.from([0,0,255,255]),k=Symbol("permessage-deflate"),l=Symbol("total-length"),m=Symbol("callback"),n=Symbol("buffers"),o=Symbol("error");function p(a){this[n].push(a),this[l]+=a.length}function q(a){(this[l]+=a.length,this[k]._maxPayload<1||this[l]<=this[k]._maxPayload)?this[n].push(a):(this[o]=RangeError("Max payload size exceeded"),this[o].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[o][h]=1009,this.removeListener("data",q),this.reset())}function r(a){(this[k]._inflate=null,this[o])?this[m](this[o]):(a[h]=1007,this[m](a))}b.exports=class{constructor(a,b,c){this._maxPayload=0|c,this._options=a||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!b,this._deflate=null,this._inflate=null,this.params=null,d||(d=new g(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let a={};return this._options.serverNoContextTakeover&&(a.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(a.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(a.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?a.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(a.client_max_window_bits=!0),a}accept(a){return a=this.normalizeParams(a),this.params=this._isServer?this.acceptAsServer(a):this.acceptAsClient(a),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let a=this._deflate[m];this._deflate.close(),this._deflate=null,a&&a(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(a){let b=this._options,c=a.find(a=>(!1!==b.serverNoContextTakeover||!a.server_no_context_takeover)&&(!a.server_max_window_bits||!1!==b.serverMaxWindowBits&&("number"!=typeof b.serverMaxWindowBits||!(b.serverMaxWindowBits>a.server_max_window_bits)))&&("number"!=typeof b.clientMaxWindowBits||!!a.client_max_window_bits));if(!c)throw Error("None of the extension offers can be accepted");return b.serverNoContextTakeover&&(c.server_no_context_takeover=!0),b.clientNoContextTakeover&&(c.client_no_context_takeover=!0),"number"==typeof b.serverMaxWindowBits&&(c.server_max_window_bits=b.serverMaxWindowBits),"number"==typeof b.clientMaxWindowBits?c.client_max_window_bits=b.clientMaxWindowBits:(!0===c.client_max_window_bits||!1===b.clientMaxWindowBits)&&delete c.client_max_window_bits,c}acceptAsClient(a){let b=a[0];if(!1===this._options.clientNoContextTakeover&&b.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(b.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&b.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(b.client_max_window_bits=this._options.clientMaxWindowBits);return b}normalizeParams(a){return a.forEach(a=>{Object.keys(a).forEach(b=>{let c=a[b];if(c.length>1)throw Error(`Parameter "${b}" must have only a single value`);if(c=c[0],"client_max_window_bits"===b){if(!0!==c){let a=+c;if(!Number.isInteger(a)||a<8||a>15)throw TypeError(`Invalid value for parameter "${b}": ${c}`);c=a}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${b}": ${c}`)}else if("server_max_window_bits"===b){let a=+c;if(!Number.isInteger(a)||a<8||a>15)throw TypeError(`Invalid value for parameter "${b}": ${c}`);c=a}else if("client_no_context_takeover"===b||"server_no_context_takeover"===b){if(!0!==c)throw TypeError(`Invalid value for parameter "${b}": ${c}`)}else throw Error(`Unknown parameter "${b}"`);a[b]=c})}),a}decompress(a,b,c){d.add(d=>{this._decompress(a,b,(a,b)=>{d(),c(a,b)})})}compress(a,b,c){d.add(d=>{this._compress(a,b,(a,b)=>{d(),c(a,b)})})}_decompress(a,b,c){let d=this._isServer?"client":"server";if(!this._inflate){let a=`${d}_max_window_bits`,b="number"!=typeof this.params[a]?e.Z_DEFAULT_WINDOWBITS:this.params[a];this._inflate=e.createInflateRaw({...this._options.zlibInflateOptions,windowBits:b}),this._inflate[k]=this,this._inflate[l]=0,this._inflate[n]=[],this._inflate.on("error",r),this._inflate.on("data",q)}this._inflate[m]=c,this._inflate.write(a),b&&this._inflate.write(j),this._inflate.flush(()=>{let a=this._inflate[o];if(a){this._inflate.close(),this._inflate=null,c(a);return}let e=f.concat(this._inflate[n],this._inflate[l]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[l]=0,this._inflate[n]=[],b&&this.params[`${d}_no_context_takeover`]&&this._inflate.reset()),c(null,e)})}_compress(a,b,c){let d=this._isServer?"server":"client";if(!this._deflate){let a=`${d}_max_window_bits`,b="number"!=typeof this.params[a]?e.Z_DEFAULT_WINDOWBITS:this.params[a];this._deflate=e.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:b}),this._deflate[l]=0,this._deflate[n]=[],this._deflate.on("data",p)}this._deflate[m]=c,this._deflate.write(a),this._deflate.flush(e.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let a=f.concat(this._deflate[n],this._deflate[l]);b&&(a=new i(a.buffer,a.byteOffset,a.length-4)),this._deflate[m]=null,this._deflate[l]=0,this._deflate[n]=[],b&&this.params[`${d}_no_context_takeover`]&&this._deflate.reset(),c(null,a)})}}},55572,(a,b,c)=>{"use strict";let{isUtf8:d}=a.r(874),{hasBlob:e}=a.r(65514);function f(a){let b=a.length,c=0;for(;c<b;)if((128&a[c])==0)c++;else if((224&a[c])==192){if(c+1===b||(192&a[c+1])!=128||(254&a[c])==192)return!1;c+=2}else if((240&a[c])==224){if(c+2>=b||(192&a[c+1])!=128||(192&a[c+2])!=128||224===a[c]&&(224&a[c+1])==128||237===a[c]&&(224&a[c+1])==160)return!1;c+=3}else{if((248&a[c])!=240||c+3>=b||(192&a[c+1])!=128||(192&a[c+2])!=128||(192&a[c+3])!=128||240===a[c]&&(240&a[c+1])==128||244===a[c]&&a[c+1]>143||a[c]>244)return!1;c+=4}return!0}if(b.exports={isBlob:function(a){return e&&"object"==typeof a&&"function"==typeof a.arrayBuffer&&"string"==typeof a.type&&"function"==typeof a.stream&&("Blob"===a[Symbol.toStringTag]||"File"===a[Symbol.toStringTag])},isValidStatusCode:function(a){return a>=1e3&&a<=1014&&1004!==a&&1005!==a&&1006!==a||a>=3e3&&a<=4999},isValidUTF8:f,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},d)b.exports.isValidUTF8=function(a){return a.length<24?f(a):d(a)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let a=(()=>{let a=Error("Cannot find module 'utf-8-validate'");throw a.code="MODULE_NOT_FOUND",a})();b.exports.isValidUTF8=function(b){return b.length<32?f(b):a(b)}}catch(a){}},74160,(a,b,c)=>{"use strict";let{Writable:d}=a.r(88947),e=a.r(19199),{BINARY_TYPES:f,EMPTY_BUFFER:g,kStatusCode:h,kWebSocket:i}=a.r(65514),{concat:j,toArrayBuffer:k,unmask:l}=a.r(40352),{isValidStatusCode:m,isValidUTF8:n}=a.r(55572),o=Buffer[Symbol.species];b.exports=class extends d{constructor(a={}){super(),this._allowSynchronousEvents=void 0===a.allowSynchronousEvents||a.allowSynchronousEvents,this._binaryType=a.binaryType||f[0],this._extensions=a.extensions||{},this._isServer=!!a.isServer,this._maxPayload=0|a.maxPayload,this._skipUTF8Validation=!!a.skipUTF8Validation,this[i]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(a,b,c){if(8===this._opcode&&0==this._state)return c();this._bufferedBytes+=a.length,this._buffers.push(a),this.startLoop(c)}consume(a){if(this._bufferedBytes-=a,a===this._buffers[0].length)return this._buffers.shift();if(a<this._buffers[0].length){let b=this._buffers[0];return this._buffers[0]=new o(b.buffer,b.byteOffset+a,b.length-a),new o(b.buffer,b.byteOffset,a)}let b=Buffer.allocUnsafe(a);do{let c=this._buffers[0],d=b.length-a;a>=c.length?b.set(this._buffers.shift(),d):(b.set(new Uint8Array(c.buffer,c.byteOffset,a),d),this._buffers[0]=new o(c.buffer,c.byteOffset+a,c.length-a)),a-=c.length}while(a>0)return b}startLoop(a){this._loop=!0;do switch(this._state){case 0:this.getInfo(a);break;case 1:this.getPayloadLength16(a);break;case 2:this.getPayloadLength64(a);break;case 3:this.getMask();break;case 4:this.getData(a);break;case 5:case 6:this._loop=!1;return}while(this._loop)this._errored||a()}getInfo(a){if(this._bufferedBytes<2){this._loop=!1;return}let b=this.consume(2);if((48&b[0])!=0)return void a(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));let c=(64&b[0])==64;if(c&&!this._extensions[e.extensionName])return void a(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._fin=(128&b[0])==128,this._opcode=15&b[0],this._payloadLength=127&b[1],0===this._opcode){if(c)return void a(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void a(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void a(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=c}else{if(!(this._opcode>7)||!(this._opcode<11))return void a(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void a(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(c)return void a(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void a(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&b[1])==128,this._isServer){if(!this._masked)return void a(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void a(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(a)}getPayloadLength16(a){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(a)}getPayloadLength64(a){if(this._bufferedBytes<8){this._loop=!1;return}let b=this.consume(8),c=b.readUInt32BE(0);c>2097151?a(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=0x100000000*c+b.readUInt32BE(4),this.haveLength(a))}haveLength(a){this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)?a(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")):this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(a){let b=g;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}b=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&l(b,this._mask)}if(this._opcode>7)return void this.controlMessage(b,a);if(this._compressed){this._state=5,this.decompress(b,a);return}b.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(b)),this.dataMessage(a)}decompress(a,b){this._extensions[e.extensionName].decompress(a,this._fin,(a,c)=>{if(a)return b(a);if(c.length){if(this._messageLength+=c.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return void b(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(c)}this.dataMessage(b),0===this._state&&this.startLoop(b)})}dataMessage(a){if(!this._fin){this._state=0;return}let b=this._messageLength,c=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let d;d="nodebuffer"===this._binaryType?j(c,b):"arraybuffer"===this._binaryType?k(j(c,b)):"blob"===this._binaryType?new Blob(c):c,this._allowSynchronousEvents?(this.emit("message",d,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",d,!0),this._state=0,this.startLoop(a)}))}else{let d=j(c,b);if(!this._skipUTF8Validation&&!n(d))return void a(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));5===this._state||this._allowSynchronousEvents?(this.emit("message",d,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",d,!1),this._state=0,this.startLoop(a)}))}}controlMessage(a,b){if(8===this._opcode){if(0===a.length)this._loop=!1,this.emit("conclude",1005,g),this.end();else{let c=a.readUInt16BE(0);if(!m(c))return void b(this.createError(RangeError,`invalid status code ${c}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));let d=new o(a.buffer,a.byteOffset+2,a.length-2);if(!this._skipUTF8Validation&&!n(d))return void b(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));this._loop=!1,this.emit("conclude",c,d),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",a),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",a),this._state=0,this.startLoop(b)}))}createError(a,b,c,d,e){this._loop=!1,this._errored=!0;let f=new a(c?`Invalid WebSocket frame: ${b}`:b);return Error.captureStackTrace(f,this.createError),f.code=e,f[h]=d,f}}},10697,(a,b,c)=>{"use strict";let d,{Duplex:e}=a.r(88947),{randomFillSync:f}=a.r(54799),g=a.r(19199),{EMPTY_BUFFER:h,kWebSocket:i,NOOP:j}=a.r(65514),{isBlob:k,isValidStatusCode:l}=a.r(55572),{mask:m,toBuffer:n}=a.r(40352),o=Symbol("kByteLength"),p=Buffer.alloc(4),q=8192;class r{constructor(a,b,c){this._extensions=b||{},c&&(this._generateMask=c,this._maskBuffer=Buffer.alloc(4)),this._socket=a,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=j,this[i]=void 0}static frame(a,b){let c,e,g=!1,h=2,i=!1;b.mask&&(c=b.maskBuffer||p,b.generateMask?b.generateMask(c):(8192===q&&(void 0===d&&(d=Buffer.alloc(8192)),f(d,0,8192),q=0),c[0]=d[q++],c[1]=d[q++],c[2]=d[q++],c[3]=d[q++]),i=(c[0]|c[1]|c[2]|c[3])==0,h=6),"string"==typeof a?e=(!b.mask||i)&&void 0!==b[o]?b[o]:(a=Buffer.from(a)).length:(e=a.length,g=b.mask&&b.readOnly&&!i);let j=e;e>=65536?(h+=8,j=127):e>125&&(h+=2,j=126);let k=Buffer.allocUnsafe(g?e+h:h);return(k[0]=b.fin?128|b.opcode:b.opcode,b.rsv1&&(k[0]|=64),k[1]=j,126===j?k.writeUInt16BE(e,2):127===j&&(k[2]=k[3]=0,k.writeUIntBE(e,4,6)),b.mask)?(k[1]|=128,k[h-4]=c[0],k[h-3]=c[1],k[h-2]=c[2],k[h-1]=c[3],i)?[k,a]:g?(m(a,c,k,h,e),[k]):(m(a,c,a,0,e),[k,a]):[k,a]}close(a,b,c,d){let e;if(void 0===a)e=h;else if("number"==typeof a&&l(a))if(void 0!==b&&b.length){let c=Buffer.byteLength(b);if(c>123)throw RangeError("The message must not be greater than 123 bytes");(e=Buffer.allocUnsafe(2+c)).writeUInt16BE(a,0),"string"==typeof b?e.write(b,2):e.set(b,2)}else(e=Buffer.allocUnsafe(2)).writeUInt16BE(a,0);else throw TypeError("First argument must be a valid error code number");let f={[o]:e.length,fin:!0,generateMask:this._generateMask,mask:c,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,e,!1,f,d]):this.sendFrame(r.frame(e,f),d)}ping(a,b,c){let d,e;if("string"==typeof a?(d=Buffer.byteLength(a),e=!1):k(a)?(d=a.size,e=!1):(d=(a=n(a)).length,e=n.readOnly),d>125)throw RangeError("The data size must not be greater than 125 bytes");let f={[o]:d,fin:!0,generateMask:this._generateMask,mask:b,maskBuffer:this._maskBuffer,opcode:9,readOnly:e,rsv1:!1};k(a)?0!==this._state?this.enqueue([this.getBlobData,a,!1,f,c]):this.getBlobData(a,!1,f,c):0!==this._state?this.enqueue([this.dispatch,a,!1,f,c]):this.sendFrame(r.frame(a,f),c)}pong(a,b,c){let d,e;if("string"==typeof a?(d=Buffer.byteLength(a),e=!1):k(a)?(d=a.size,e=!1):(d=(a=n(a)).length,e=n.readOnly),d>125)throw RangeError("The data size must not be greater than 125 bytes");let f={[o]:d,fin:!0,generateMask:this._generateMask,mask:b,maskBuffer:this._maskBuffer,opcode:10,readOnly:e,rsv1:!1};k(a)?0!==this._state?this.enqueue([this.getBlobData,a,!1,f,c]):this.getBlobData(a,!1,f,c):0!==this._state?this.enqueue([this.dispatch,a,!1,f,c]):this.sendFrame(r.frame(a,f),c)}send(a,b,c){let d,e,f=this._extensions[g.extensionName],h=b.binary?2:1,i=b.compress;"string"==typeof a?(d=Buffer.byteLength(a),e=!1):k(a)?(d=a.size,e=!1):(d=(a=n(a)).length,e=n.readOnly),this._firstFragment?(this._firstFragment=!1,i&&f&&f.params[f._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(i=d>=f._threshold),this._compress=i):(i=!1,h=0),b.fin&&(this._firstFragment=!0);let j={[o]:d,fin:b.fin,generateMask:this._generateMask,mask:b.mask,maskBuffer:this._maskBuffer,opcode:h,readOnly:e,rsv1:i};k(a)?0!==this._state?this.enqueue([this.getBlobData,a,this._compress,j,c]):this.getBlobData(a,this._compress,j,c):0!==this._state?this.enqueue([this.dispatch,a,this._compress,j,c]):this.dispatch(a,this._compress,j,c)}getBlobData(a,b,c,d){this._bufferedBytes+=c[o],this._state=2,a.arrayBuffer().then(a=>{if(this._socket.destroyed){let a=Error("The socket was closed while the blob was being read");process.nextTick(s,this,a,d);return}this._bufferedBytes-=c[o];let e=n(a);b?this.dispatch(e,b,c,d):(this._state=0,this.sendFrame(r.frame(e,c),d),this.dequeue())}).catch(a=>{process.nextTick(t,this,a,d)})}dispatch(a,b,c,d){if(!b)return void this.sendFrame(r.frame(a,c),d);let e=this._extensions[g.extensionName];this._bufferedBytes+=c[o],this._state=1,e.compress(a,c.fin,(a,b)=>{this._socket.destroyed?s(this,Error("The socket was closed while data was being compressed"),d):(this._bufferedBytes-=c[o],this._state=0,c.readOnly=!1,this.sendFrame(r.frame(b,c),d),this.dequeue())})}dequeue(){for(;0===this._state&&this._queue.length;){let a=this._queue.shift();this._bufferedBytes-=a[3][o],Reflect.apply(a[0],this,a.slice(1))}}enqueue(a){this._bufferedBytes+=a[3][o],this._queue.push(a)}sendFrame(a,b){2===a.length?(this._socket.cork(),this._socket.write(a[0]),this._socket.write(a[1],b),this._socket.uncork()):this._socket.write(a[0],b)}}function s(a,b,c){"function"==typeof c&&c(b);for(let c=0;c<a._queue.length;c++){let d=a._queue[c],e=d[d.length-1];"function"==typeof e&&e(b)}}function t(a,b,c){s(a,b,c),a.onerror(b)}b.exports=r},4049,(a,b,c)=>{"use strict";let{kForOnEventAttribute:d,kListener:e}=a.r(65514),f=Symbol("kCode"),g=Symbol("kData"),h=Symbol("kError"),i=Symbol("kMessage"),j=Symbol("kReason"),k=Symbol("kTarget"),l=Symbol("kType"),m=Symbol("kWasClean");class n{constructor(a){this[k]=null,this[l]=a}get target(){return this[k]}get type(){return this[l]}}Object.defineProperty(n.prototype,"target",{enumerable:!0}),Object.defineProperty(n.prototype,"type",{enumerable:!0});class o extends n{constructor(a,b={}){super(a),this[f]=void 0===b.code?0:b.code,this[j]=void 0===b.reason?"":b.reason,this[m]=void 0!==b.wasClean&&b.wasClean}get code(){return this[f]}get reason(){return this[j]}get wasClean(){return this[m]}}Object.defineProperty(o.prototype,"code",{enumerable:!0}),Object.defineProperty(o.prototype,"reason",{enumerable:!0}),Object.defineProperty(o.prototype,"wasClean",{enumerable:!0});class p extends n{constructor(a,b={}){super(a),this[h]=void 0===b.error?null:b.error,this[i]=void 0===b.message?"":b.message}get error(){return this[h]}get message(){return this[i]}}Object.defineProperty(p.prototype,"error",{enumerable:!0}),Object.defineProperty(p.prototype,"message",{enumerable:!0});class q extends n{constructor(a,b={}){super(a),this[g]=void 0===b.data?null:b.data}get data(){return this[g]}}function r(a,b,c){"object"==typeof a&&a.handleEvent?a.handleEvent.call(a,c):a.call(b,c)}Object.defineProperty(q.prototype,"data",{enumerable:!0}),b.exports={CloseEvent:o,ErrorEvent:p,Event:n,EventTarget:{addEventListener(a,b,c={}){let f;for(let f of this.listeners(a))if(!c[d]&&f[e]===b&&!f[d])return;if("message"===a)f=function(a,c){let d=new q("message",{data:c?a:a.toString()});d[k]=this,r(b,this,d)};else if("close"===a)f=function(a,c){let d=new o("close",{code:a,reason:c.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});d[k]=this,r(b,this,d)};else if("error"===a)f=function(a){let c=new p("error",{error:a,message:a.message});c[k]=this,r(b,this,c)};else{if("open"!==a)return;f=function(){let a=new n("open");a[k]=this,r(b,this,a)}}f[d]=!!c[d],f[e]=b,c.once?this.once(a,f):this.on(a,f)},removeEventListener(a,b){for(let c of this.listeners(a))if(c[e]===b&&!c[d]){this.removeListener(a,c);break}}},MessageEvent:q}},20529,(a,b,c)=>{"use strict";let{tokenChars:d}=a.r(55572);function e(a,b,c){void 0===a[b]?a[b]=[c]:a[b].push(c)}b.exports={format:function(a){return Object.keys(a).map(b=>{let c=a[b];return Array.isArray(c)||(c=[c]),c.map(a=>[b].concat(Object.keys(a).map(b=>{let c=a[b];return Array.isArray(c)||(c=[c]),c.map(a=>!0===a?b:`${b}=${a}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(a){let b,c,f=Object.create(null),g=Object.create(null),h=!1,i=!1,j=!1,k=-1,l=-1,m=-1,n=0;for(;n<a.length;n++)if(l=a.charCodeAt(n),void 0===b)if(-1===m&&1===d[l])-1===k&&(k=n);else if(0!==n&&(32===l||9===l))-1===m&&-1!==k&&(m=n);else if(59===l||44===l){if(-1===k)throw SyntaxError(`Unexpected character at index ${n}`);-1===m&&(m=n);let c=a.slice(k,m);44===l?(e(f,c,g),g=Object.create(null)):b=c,k=m=-1}else throw SyntaxError(`Unexpected character at index ${n}`);else if(void 0===c)if(-1===m&&1===d[l])-1===k&&(k=n);else if(32===l||9===l)-1===m&&-1!==k&&(m=n);else if(59===l||44===l){if(-1===k)throw SyntaxError(`Unexpected character at index ${n}`);-1===m&&(m=n),e(g,a.slice(k,m),!0),44===l&&(e(f,b,g),g=Object.create(null),b=void 0),k=m=-1}else if(61===l&&-1!==k&&-1===m)c=a.slice(k,n),k=m=-1;else throw SyntaxError(`Unexpected character at index ${n}`);else if(i){if(1!==d[l])throw SyntaxError(`Unexpected character at index ${n}`);-1===k?k=n:h||(h=!0),i=!1}else if(j)if(1===d[l])-1===k&&(k=n);else if(34===l&&-1!==k)j=!1,m=n;else if(92===l)i=!0;else throw SyntaxError(`Unexpected character at index ${n}`);else if(34===l&&61===a.charCodeAt(n-1))j=!0;else if(-1===m&&1===d[l])-1===k&&(k=n);else if(-1!==k&&(32===l||9===l))-1===m&&(m=n);else if(59===l||44===l){if(-1===k)throw SyntaxError(`Unexpected character at index ${n}`);-1===m&&(m=n);let d=a.slice(k,m);h&&(d=d.replace(/\\/g,""),h=!1),e(g,c,d),44===l&&(e(f,b,g),g=Object.create(null),b=void 0),c=void 0,k=m=-1}else throw SyntaxError(`Unexpected character at index ${n}`);if(-1===k||j||32===l||9===l)throw SyntaxError("Unexpected end of input");-1===m&&(m=n);let o=a.slice(k,m);return void 0===b?e(f,o,g):(void 0===c?e(g,o,!0):h?e(g,c,o.replace(/\\/g,"")):e(g,c,o),e(f,b,g)),f}}},89877,(a,b,c)=>{"use strict";let d=a.r(27699),e=a.r(24836),f=a.r(21517),g=a.r(4446),h=a.r(55004),{randomBytes:i,createHash:j}=a.r(54799),{Duplex:k,Readable:l}=a.r(88947),{URL:m}=a.r(92509),n=a.r(19199),o=a.r(74160),p=a.r(10697),{isBlob:q}=a.r(55572),{BINARY_TYPES:r,EMPTY_BUFFER:s,GUID:t,kForOnEventAttribute:u,kListener:v,kStatusCode:w,kWebSocket:x,NOOP:y}=a.r(65514),{EventTarget:{addEventListener:z,removeEventListener:A}}=a.r(4049),{format:B,parse:C}=a.r(20529),{toBuffer:D}=a.r(40352),E=Symbol("kAborted"),F=[8,13],G=["CONNECTING","OPEN","CLOSING","CLOSED"],H=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class I extends d{constructor(a,b,c){super(),this._binaryType=r[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=s,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=I.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==a?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===b?b=[]:Array.isArray(b)||("object"==typeof b&&null!==b?(c=b,b=[]):b=[b]),function a(b,c,d,g){let h,k,l,o,p={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:F[1],maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...g,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(b._autoPong=p.autoPong,!F.includes(p.protocolVersion))throw RangeError(`Unsupported protocol version: ${p.protocolVersion} (supported versions: ${F.join(", ")})`);if(c instanceof m)h=c;else try{h=new m(c)}catch(a){throw SyntaxError(`Invalid URL: ${c}`)}"http:"===h.protocol?h.protocol="ws:":"https:"===h.protocol&&(h.protocol="wss:"),b._url=h.href;let q="wss:"===h.protocol,r="ws+unix:"===h.protocol;if("ws:"===h.protocol||q||r?r&&!h.pathname?k="The URL's pathname is empty":h.hash&&(k="The URL contains a fragment identifier"):k='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',k){let a=SyntaxError(k);if(0!==b._redirects)return void J(b,a);throw a}let s=q?443:80,u=i(16).toString("base64"),v=q?e.request:f.request,w=new Set;if(p.createConnection=p.createConnection||(q?L:K),p.defaultPort=p.defaultPort||s,p.port=h.port||s,p.host=h.hostname.startsWith("[")?h.hostname.slice(1,-1):h.hostname,p.headers={...p.headers,"Sec-WebSocket-Version":p.protocolVersion,"Sec-WebSocket-Key":u,Connection:"Upgrade",Upgrade:"websocket"},p.path=h.pathname+h.search,p.timeout=p.handshakeTimeout,p.perMessageDeflate&&(l=new n(!0!==p.perMessageDeflate?p.perMessageDeflate:{},!1,p.maxPayload),p.headers["Sec-WebSocket-Extensions"]=B({[n.extensionName]:l.offer()})),d.length){for(let a of d){if("string"!=typeof a||!H.test(a)||w.has(a))throw SyntaxError("An invalid or duplicated subprotocol was specified");w.add(a)}p.headers["Sec-WebSocket-Protocol"]=d.join(",")}if(p.origin&&(p.protocolVersion<13?p.headers["Sec-WebSocket-Origin"]=p.origin:p.headers.Origin=p.origin),(h.username||h.password)&&(p.auth=`${h.username}:${h.password}`),r){let a=p.path.split(":");p.socketPath=a[0],p.path=a[1]}if(p.followRedirects){if(0===b._redirects){b._originalIpc=r,b._originalSecure=q,b._originalHostOrSocketPath=r?p.socketPath:h.host;let a=g&&g.headers;if(g={...g,headers:{}},a)for(let[b,c]of Object.entries(a))g.headers[b.toLowerCase()]=c}else if(0===b.listenerCount("redirect")){let a=r?!!b._originalIpc&&p.socketPath===b._originalHostOrSocketPath:!b._originalIpc&&h.host===b._originalHostOrSocketPath;a&&(!b._originalSecure||q)||(delete p.headers.authorization,delete p.headers.cookie,a||delete p.headers.host,p.auth=void 0)}p.auth&&!g.headers.authorization&&(g.headers.authorization="Basic "+Buffer.from(p.auth).toString("base64")),o=b._req=v(p),b._redirects&&b.emit("redirect",b.url,o)}else o=b._req=v(p);p.timeout&&o.on("timeout",()=>{M(b,o,"Opening handshake has timed out")}),o.on("error",a=>{null===o||o[E]||(o=b._req=null,J(b,a))}),o.on("response",e=>{let f=e.headers.location,h=e.statusCode;if(f&&p.followRedirects&&h>=300&&h<400){let e;if(++b._redirects>p.maxRedirects)return void M(b,o,"Maximum redirects exceeded");o.abort();try{e=new m(f,c)}catch(a){J(b,SyntaxError(`Invalid URL: ${f}`));return}a(b,e,d,g)}else b.emit("unexpected-response",o,e)||M(b,o,`Unexpected server response: ${e.statusCode}`)}),o.on("upgrade",(a,c,d)=>{let e;if(b.emit("upgrade",a),b.readyState!==I.CONNECTING)return;o=b._req=null;let f=a.headers.upgrade;if(void 0===f||"websocket"!==f.toLowerCase())return void M(b,c,"Invalid Upgrade header");let g=j("sha1").update(u+t).digest("base64");if(a.headers["sec-websocket-accept"]!==g)return void M(b,c,"Invalid Sec-WebSocket-Accept header");let h=a.headers["sec-websocket-protocol"];if(void 0!==h?w.size?w.has(h)||(e="Server sent an invalid subprotocol"):e="Server sent a subprotocol but none was requested":w.size&&(e="Server sent no subprotocol"),e)return void M(b,c,e);h&&(b._protocol=h);let i=a.headers["sec-websocket-extensions"];if(void 0!==i){let a;if(!l)return void M(b,c,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");try{a=C(i)}catch(a){M(b,c,"Invalid Sec-WebSocket-Extensions header");return}let d=Object.keys(a);if(1!==d.length||d[0]!==n.extensionName)return void M(b,c,"Server indicated an extension that was not requested");try{l.accept(a[n.extensionName])}catch(a){M(b,c,"Invalid Sec-WebSocket-Extensions header");return}b._extensions[n.extensionName]=l}b.setSocket(c,d,{allowSynchronousEvents:p.allowSynchronousEvents,generateMask:p.generateMask,maxPayload:p.maxPayload,skipUTF8Validation:p.skipUTF8Validation})}),p.finishRequest?p.finishRequest(o,b):o.end()}(this,a,b,c)):(this._autoPong=c.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(a){r.includes(a)&&(this._binaryType=a,this._receiver&&(this._receiver._binaryType=a))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(a,b,c){let d=new o({allowSynchronousEvents:c.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:c.maxPayload,skipUTF8Validation:c.skipUTF8Validation}),e=new p(a,this._extensions,c.generateMask);this._receiver=d,this._sender=e,this._socket=a,d[x]=this,e[x]=this,a[x]=this,d.on("conclude",O),d.on("drain",P),d.on("error",Q),d.on("message",S),d.on("ping",T),d.on("pong",U),e.onerror=W,a.setTimeout&&a.setTimeout(0),a.setNoDelay&&a.setNoDelay(),b.length>0&&a.unshift(b),a.on("close",Y),a.on("data",Z),a.on("end",$),a.on("error",_),this._readyState=I.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=I.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[n.extensionName]&&this._extensions[n.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=I.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(a,b){if(this.readyState!==I.CLOSED){if(this.readyState===I.CONNECTING)return void M(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===I.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=I.CLOSING,this._sender.close(a,b,!this._isServer,a=>{!a&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),X(this)}}pause(){this.readyState!==I.CONNECTING&&this.readyState!==I.CLOSED&&(this._paused=!0,this._socket.pause())}ping(a,b,c){if(this.readyState===I.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof a?(c=a,a=b=void 0):"function"==typeof b&&(c=b,b=void 0),"number"==typeof a&&(a=a.toString()),this.readyState!==I.OPEN)?N(this,a,c):(void 0===b&&(b=!this._isServer),this._sender.ping(a||s,b,c))}pong(a,b,c){if(this.readyState===I.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof a?(c=a,a=b=void 0):"function"==typeof b&&(c=b,b=void 0),"number"==typeof a&&(a=a.toString()),this.readyState!==I.OPEN)?N(this,a,c):(void 0===b&&(b=!this._isServer),this._sender.pong(a||s,b,c))}resume(){this.readyState!==I.CONNECTING&&this.readyState!==I.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(a,b,c){if(this.readyState===I.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof b&&(c=b,b={}),"number"==typeof a&&(a=a.toString()),this.readyState!==I.OPEN)return void N(this,a,c);let d={binary:"string"!=typeof a,mask:!this._isServer,compress:!0,fin:!0,...b};this._extensions[n.extensionName]||(d.compress=!1),this._sender.send(a||s,d,c)}terminate(){if(this.readyState!==I.CLOSED){if(this.readyState===I.CONNECTING)return void M(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=I.CLOSING,this._socket.destroy())}}}function J(a,b){a._readyState=I.CLOSING,a._errorEmitted=!0,a.emit("error",b),a.emitClose()}function K(a){return a.path=a.socketPath,g.connect(a)}function L(a){return a.path=void 0,a.servername||""===a.servername||(a.servername=g.isIP(a.host)?"":a.host),h.connect(a)}function M(a,b,c){a._readyState=I.CLOSING;let d=Error(c);Error.captureStackTrace(d,M),b.setHeader?(b[E]=!0,b.abort(),b.socket&&!b.socket.destroyed&&b.socket.destroy(),process.nextTick(J,a,d)):(b.destroy(d),b.once("error",a.emit.bind(a,"error")),b.once("close",a.emitClose.bind(a)))}function N(a,b,c){if(b){let c=q(b)?b.size:D(b).length;a._socket?a._sender._bufferedBytes+=c:a._bufferedAmount+=c}if(c){let b=Error(`WebSocket is not open: readyState ${a.readyState} (${G[a.readyState]})`);process.nextTick(c,b)}}function O(a,b){let c=this[x];c._closeFrameReceived=!0,c._closeMessage=b,c._closeCode=a,void 0!==c._socket[x]&&(c._socket.removeListener("data",Z),process.nextTick(V,c._socket),1005===a?c.close():c.close(a,b))}function P(){let a=this[x];a.isPaused||a._socket.resume()}function Q(a){let b=this[x];void 0!==b._socket[x]&&(b._socket.removeListener("data",Z),process.nextTick(V,b._socket),b.close(a[w])),b._errorEmitted||(b._errorEmitted=!0,b.emit("error",a))}function R(){this[x].emitClose()}function S(a,b){this[x].emit("message",a,b)}function T(a){let b=this[x];b._autoPong&&b.pong(a,!this._isServer,y),b.emit("ping",a)}function U(a){this[x].emit("pong",a)}function V(a){a.resume()}function W(a){let b=this[x];b.readyState!==I.CLOSED&&(b.readyState===I.OPEN&&(b._readyState=I.CLOSING,X(b)),this._socket.end(),b._errorEmitted||(b._errorEmitted=!0,b.emit("error",a)))}function X(a){a._closeTimer=setTimeout(a._socket.destroy.bind(a._socket),3e4)}function Y(){let a,b=this[x];this.removeListener("close",Y),this.removeListener("data",Z),this.removeListener("end",$),b._readyState=I.CLOSING,this._readableState.endEmitted||b._closeFrameReceived||b._receiver._writableState.errorEmitted||null===(a=b._socket.read())||b._receiver.write(a),b._receiver.end(),this[x]=void 0,clearTimeout(b._closeTimer),b._receiver._writableState.finished||b._receiver._writableState.errorEmitted?b.emitClose():(b._receiver.on("error",R),b._receiver.on("finish",R))}function Z(a){this[x]._receiver.write(a)||this.pause()}function $(){let a=this[x];a._readyState=I.CLOSING,a._receiver.end(),this.end()}function _(){let a=this[x];this.removeListener("error",_),this.on("error",y),a&&(a._readyState=I.CLOSING,this.destroy())}Object.defineProperty(I,"CONNECTING",{enumerable:!0,value:G.indexOf("CONNECTING")}),Object.defineProperty(I.prototype,"CONNECTING",{enumerable:!0,value:G.indexOf("CONNECTING")}),Object.defineProperty(I,"OPEN",{enumerable:!0,value:G.indexOf("OPEN")}),Object.defineProperty(I.prototype,"OPEN",{enumerable:!0,value:G.indexOf("OPEN")}),Object.defineProperty(I,"CLOSING",{enumerable:!0,value:G.indexOf("CLOSING")}),Object.defineProperty(I.prototype,"CLOSING",{enumerable:!0,value:G.indexOf("CLOSING")}),Object.defineProperty(I,"CLOSED",{enumerable:!0,value:G.indexOf("CLOSED")}),Object.defineProperty(I.prototype,"CLOSED",{enumerable:!0,value:G.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(a=>{Object.defineProperty(I.prototype,a,{enumerable:!0})}),["open","error","close","message"].forEach(a=>{Object.defineProperty(I.prototype,`on${a}`,{enumerable:!0,get(){for(let b of this.listeners(a))if(b[u])return b[v];return null},set(b){for(let b of this.listeners(a))if(b[u]){this.removeListener(a,b);break}"function"==typeof b&&this.addEventListener(a,b,{[u]:!0})}})}),I.prototype.addEventListener=z,I.prototype.removeEventListener=A,b.exports=I},29e3,(a,b,c)=>{"use strict";a.r(89877);let{Duplex:d}=a.r(88947);function e(a){a.emit("close")}function f(){!this.destroyed&&this._writableState.finished&&this.destroy()}function g(a){this.removeListener("error",g),this.destroy(),0===this.listenerCount("error")&&this.emit("error",a)}b.exports=function(a,b){let c=!0,h=new d({...b,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return a.on("message",function(b,c){let d=!c&&h._readableState.objectMode?b.toString():b;h.push(d)||a.pause()}),a.once("error",function(a){h.destroyed||(c=!1,h.destroy(a))}),a.once("close",function(){h.destroyed||h.push(null)}),h._destroy=function(b,d){if(a.readyState===a.CLOSED){d(b),process.nextTick(e,h);return}let f=!1;a.once("error",function(a){f=!0,d(a)}),a.once("close",function(){f||d(b),process.nextTick(e,h)}),c&&a.terminate()},h._final=function(b){a.readyState===a.CONNECTING?a.once("open",function(){h._final(b)}):null!==a._socket&&(a._socket._writableState.finished?(b(),h._readableState.endEmitted&&h.destroy()):(a._socket.once("finish",function(){b()}),a.close()))},h._read=function(){a.isPaused&&a.resume()},h._write=function(b,c,d){a.readyState===a.CONNECTING?a.once("open",function(){h._write(b,c,d)}):a.send(b,d)},h.on("end",f),h.on("error",g),h}},71553,(a,b,c)=>{"use strict";let{tokenChars:d}=a.r(55572);b.exports={parse:function(a){let b=new Set,c=-1,e=-1,f=0;for(;f<a.length;f++){let g=a.charCodeAt(f);if(-1===e&&1===d[g])-1===c&&(c=f);else if(0!==f&&(32===g||9===g))-1===e&&-1!==c&&(e=f);else if(44===g){if(-1===c)throw SyntaxError(`Unexpected character at index ${f}`);-1===e&&(e=f);let d=a.slice(c,e);if(b.has(d))throw SyntaxError(`The "${d}" subprotocol is duplicated`);b.add(d),c=e=-1}else throw SyntaxError(`Unexpected character at index ${f}`)}if(-1===c||-1!==e)throw SyntaxError("Unexpected end of input");let g=a.slice(c,f);if(b.has(g))throw SyntaxError(`The "${g}" subprotocol is duplicated`);return b.add(g),b}}},95837,(a,b,c)=>{"use strict";let d=a.r(27699),e=a.r(21517),{Duplex:f}=a.r(88947),{createHash:g}=a.r(54799),h=a.r(20529),i=a.r(19199),j=a.r(71553),k=a.r(89877),{GUID:l,kWebSocket:m}=a.r(65514),n=/^[+/0-9A-Za-z]{22}==$/;function o(a){a._state=2,a.emit("close")}function p(){this.destroy()}function q(a,b,c,d){c=c||e.STATUS_CODES[b],d={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(c),...d},a.once("finish",a.destroy),a.end(`HTTP/1.1 ${b} ${e.STATUS_CODES[b]}\r
`+Object.keys(d).map(a=>`${a}: ${d[a]}`).join("\r\n")+"\r\n\r\n"+c)}function r(a,b,c,d,e,f){if(a.listenerCount("wsClientError")){let d=Error(e);Error.captureStackTrace(d,r),a.emit("wsClientError",d,c,b)}else q(c,d,e,f)}b.exports=class extends d{constructor(a,b){if(super(),null==(a={allowSynchronousEvents:!0,autoPong:!0,maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:k,...a}).port&&!a.server&&!a.noServer||null!=a.port&&(a.server||a.noServer)||a.server&&a.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=a.port?(this._server=e.createServer((a,b)=>{let c=e.STATUS_CODES[426];b.writeHead(426,{"Content-Length":c.length,"Content-Type":"text/plain"}),b.end(c)}),this._server.listen(a.port,a.host,a.backlog,b)):a.server&&(this._server=a.server),this._server){const a=this.emit.bind(this,"connection");this._removeListeners=function(a,b){for(let c of Object.keys(b))a.on(c,b[c]);return function(){for(let c of Object.keys(b))a.removeListener(c,b[c])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(b,c,d)=>{this.handleUpgrade(b,c,d,a)}})}!0===a.perMessageDeflate&&(a.perMessageDeflate={}),a.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=a,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(a){if(2===this._state){a&&this.once("close",()=>{a(Error("The server is not running"))}),process.nextTick(o,this);return}if(a&&this.once("close",a),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(o,this);else{let a=this._server;this._removeListeners(),this._removeListeners=this._server=null,a.close(()=>{o(this)})}}shouldHandle(a){if(this.options.path){let b=a.url.indexOf("?");if((-1!==b?a.url.slice(0,b):a.url)!==this.options.path)return!1}return!0}handleUpgrade(a,b,c,d){b.on("error",p);let e=a.headers["sec-websocket-key"],f=a.headers.upgrade,g=+a.headers["sec-websocket-version"];if("GET"!==a.method)return void r(this,a,b,405,"Invalid HTTP method");if(void 0===f||"websocket"!==f.toLowerCase())return void r(this,a,b,400,"Invalid Upgrade header");if(void 0===e||!n.test(e))return void r(this,a,b,400,"Missing or invalid Sec-WebSocket-Key header");if(13!==g&&8!==g)return void r(this,a,b,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});if(!this.shouldHandle(a))return void q(b,400);let k=a.headers["sec-websocket-protocol"],l=new Set;if(void 0!==k)try{l=j.parse(k)}catch(c){r(this,a,b,400,"Invalid Sec-WebSocket-Protocol header");return}let m=a.headers["sec-websocket-extensions"],o={};if(this.options.perMessageDeflate&&void 0!==m){let c=new i(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let a=h.parse(m);a[i.extensionName]&&(c.accept(a[i.extensionName]),o[i.extensionName]=c)}catch(c){r(this,a,b,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let f={origin:a.headers[`${8===g?"sec-websocket-origin":"origin"}`],secure:!!(a.socket.authorized||a.socket.encrypted),req:a};if(2===this.options.verifyClient.length)return void this.options.verifyClient(f,(f,g,h,i)=>{if(!f)return q(b,g||401,h,i);this.completeUpgrade(o,e,l,a,b,c,d)});if(!this.options.verifyClient(f))return q(b,401)}this.completeUpgrade(o,e,l,a,b,c,d)}completeUpgrade(a,b,c,d,e,f,j){if(!e.readable||!e.writable)return e.destroy();if(e[m])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return q(e,503);let k=g("sha1").update(b+l).digest("base64"),n=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${k}`],r=new this.options.WebSocket(null,void 0,this.options);if(c.size){let a=this.options.handleProtocols?this.options.handleProtocols(c,d):c.values().next().value;a&&(n.push(`Sec-WebSocket-Protocol: ${a}`),r._protocol=a)}if(a[i.extensionName]){let b=a[i.extensionName].params,c=h.format({[i.extensionName]:[b]});n.push(`Sec-WebSocket-Extensions: ${c}`),r._extensions=a}this.emit("headers",n,d),e.write(n.concat("\r\n").join("\r\n")),e.removeListener("error",p),r.setSocket(e,f,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(r),r.on("close",()=>{this.clients.delete(r),this._shouldEmitClose&&!this.clients.size&&process.nextTick(o,this)})),j(r,d)}}},52100,a=>{"use strict";var b=function(a,c){return(b=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])})(a,c)};function c(a,c){if("function"!=typeof c&&null!==c)throw TypeError("Class extends value "+String(c)+" is not a constructor or null");function d(){this.constructor=a}b(a,c),a.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}var d=function(){return(d=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function e(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c}function f(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g}function g(a,b){return function(c,d){b(c,d,a)}}function h(a,b,c,d,e,f){function g(a){if(void 0!==a&&"function"!=typeof a)throw TypeError("Function expected");return a}for(var h,i=d.kind,j="getter"===i?"get":"setter"===i?"set":"value",k=!b&&a?d.static?a:a.prototype:null,l=b||(k?Object.getOwnPropertyDescriptor(k,d.name):{}),m=!1,n=c.length-1;n>=0;n--){var o={};for(var p in d)o[p]="access"===p?{}:d[p];for(var p in d.access)o.access[p]=d.access[p];o.addInitializer=function(a){if(m)throw TypeError("Cannot add initializers after decoration has completed");f.push(g(a||null))};var q=(0,c[n])("accessor"===i?{get:l.get,set:l.set}:l[j],o);if("accessor"===i){if(void 0===q)continue;if(null===q||"object"!=typeof q)throw TypeError("Object expected");(h=g(q.get))&&(l.get=h),(h=g(q.set))&&(l.set=h),(h=g(q.init))&&e.unshift(h)}else(h=g(q))&&("field"===i?e.unshift(h):l[j]=h)}k&&Object.defineProperty(k,d.name,l),m=!0}function i(a,b,c){for(var d=arguments.length>2,e=0;e<b.length;e++)c=d?b[e].call(a,c):b[e].call(a);return d?c:void 0}function j(a){return"symbol"==typeof a?a:"".concat(a)}function k(a,b,c){return"symbol"==typeof b&&(b=b.description?"[".concat(b.description,"]"):""),Object.defineProperty(a,"name",{configurable:!0,value:c?"".concat(c," ",b):b})}function l(a,b){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(a,b)}function m(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}function n(a,b){var c,d,e,f={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]},g=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return g.next=h(0),g.throw=h(1),g.return=h(2),"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function h(h){return function(i){var j=[h,i];if(c)throw TypeError("Generator is already executing.");for(;g&&(g=0,j[0]&&(f=0)),f;)try{if(c=1,d&&(e=2&j[0]?d.return:j[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,j[1])).done)return e;switch(d=0,e&&(j=[2&j[0],e.value]),j[0]){case 0:case 1:e=j;break;case 4:return f.label++,{value:j[1],done:!1};case 5:f.label++,d=j[1],j=[0];continue;case 7:j=f.ops.pop(),f.trys.pop();continue;default:if(!(e=(e=f.trys).length>0&&e[e.length-1])&&(6===j[0]||2===j[0])){f=0;continue}if(3===j[0]&&(!e||j[1]>e[0]&&j[1]<e[3])){f.label=j[1];break}if(6===j[0]&&f.label<e[1]){f.label=e[1],e=j;break}if(e&&f.label<e[2]){f.label=e[2],f.ops.push(j);break}e[2]&&f.ops.pop(),f.trys.pop();continue}j=b.call(a,f)}catch(a){j=[6,a],d=0}finally{c=e=0}if(5&j[0])throw j[1];return{value:j[0]?j[1]:void 0,done:!0}}}}var o=Object.create?function(a,b,c,d){void 0===d&&(d=c);var e=Object.getOwnPropertyDescriptor(b,c);(!e||("get"in e?!b.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return b[c]}}),Object.defineProperty(a,d,e)}:function(a,b,c,d){void 0===d&&(d=c),a[d]=b[c]};function p(a,b){for(var c in a)"default"===c||Object.prototype.hasOwnProperty.call(b,c)||o(b,a,c)}function q(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function r(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}function s(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(r(arguments[b]));return a}function t(){for(var a=0,b=0,c=arguments.length;b<c;b++)a+=arguments[b].length;for(var d=Array(a),e=0,b=0;b<c;b++)for(var f=arguments[b],g=0,h=f.length;g<h;g++,e++)d[e]=f[g];return d}function u(a,b,c){if(c||2==arguments.length)for(var d,e=0,f=b.length;e<f;e++)!d&&e in b||(d||(d=Array.prototype.slice.call(b,0,e)),d[e]=b[e]);return a.concat(d||Array.prototype.slice.call(b))}function v(a){return this instanceof v?(this.v=a,this):new v(a)}function w(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),g("next"),g("throw"),g("return",function(a){return function(b){return Promise.resolve(b).then(a,j)}}),d[Symbol.asyncIterator]=function(){return this},d;function g(a,b){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})},b&&(d[a]=b(d[a])))}function h(a,b){try{var c;(c=e[a](b)).value instanceof v?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}function x(a){var b,c;return b={},d("next"),d("throw",function(a){throw a}),d("return"),b[Symbol.iterator]=function(){return this},b;function d(d,e){b[d]=a[d]?function(b){return(c=!c)?{value:v(a[d](b)),done:!1}:e?e(b):b}:e}}function y(a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var b,c=a[Symbol.asyncIterator];return c?c.call(a):(a=q(a),b={},d("next"),d("throw"),d("return"),b[Symbol.asyncIterator]=function(){return this},b);function d(c){b[c]=a[c]&&function(b){return new Promise(function(d,e){var f,g,h;f=d,g=e,h=(b=a[c](b)).done,Promise.resolve(b.value).then(function(a){f({value:a,done:h})},g)})}}}function z(a,b){return Object.defineProperty?Object.defineProperty(a,"raw",{value:b}):a.raw=b,a}var A=Object.create?function(a,b){Object.defineProperty(a,"default",{enumerable:!0,value:b})}:function(a,b){a.default=b},B=function(a){return(B=Object.getOwnPropertyNames||function(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[b.length]=c);return b})(a)};function C(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c=B(a),d=0;d<c.length;d++)"default"!==c[d]&&o(b,a,c[d]);return A(b,a),b}function D(a){return a&&a.__esModule?a:{default:a}}function E(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)}function F(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c}function G(a,b){if(null===b||"object"!=typeof b&&"function"!=typeof b)throw TypeError("Cannot use 'in' operator on non-object");return"function"==typeof a?b===a:a.has(b)}function H(a,b,c){if(null!=b){var d,e;if("object"!=typeof b&&"function"!=typeof b)throw TypeError("Object expected.");if(c){if(!Symbol.asyncDispose)throw TypeError("Symbol.asyncDispose is not defined.");d=b[Symbol.asyncDispose]}if(void 0===d){if(!Symbol.dispose)throw TypeError("Symbol.dispose is not defined.");d=b[Symbol.dispose],c&&(e=d)}if("function"!=typeof d)throw TypeError("Object not disposable.");e&&(d=function(){try{e.call(this)}catch(a){return Promise.reject(a)}}),a.stack.push({value:b,dispose:d,async:c})}else c&&a.stack.push({async:!0});return b}var I="function"==typeof SuppressedError?SuppressedError:function(a,b,c){var d=Error(c);return d.name="SuppressedError",d.error=a,d.suppressed=b,d};function J(a){function b(b){a.error=a.hasError?new I(b,a.error,"An error was suppressed during disposal."):b,a.hasError=!0}var c,d=0;return function e(){for(;c=a.stack.pop();)try{if(!c.async&&1===d)return d=0,a.stack.push(c),Promise.resolve().then(e);if(c.dispose){var f=c.dispose.call(c.value);if(c.async)return d|=2,Promise.resolve(f).then(e,function(a){return b(a),e()})}else d|=1}catch(a){b(a)}if(1===d)return a.hasError?Promise.reject(a.error):Promise.resolve();if(a.hasError)throw a.error}()}function K(a,b){return"string"==typeof a&&/^\.\.?\//.test(a)?a.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(a,c,d,e,f){return c?b?".jsx":".js":!d||e&&f?d+e+"."+f.toLowerCase()+"js":a}):a}let L={__extends:c,__assign:d,__rest:e,__decorate:f,__param:g,__esDecorate:h,__runInitializers:i,__propKey:j,__setFunctionName:k,__metadata:l,__awaiter:m,__generator:n,__createBinding:o,__exportStar:p,__values:q,__read:r,__spread:s,__spreadArrays:t,__spreadArray:u,__await:v,__asyncGenerator:w,__asyncDelegator:x,__asyncValues:y,__makeTemplateObject:z,__importStar:C,__importDefault:D,__classPrivateFieldGet:E,__classPrivateFieldSet:F,__classPrivateFieldIn:G,__addDisposableResource:H,__disposeResources:J,__rewriteRelativeImportExtension:K};a.s(["__addDisposableResource",()=>H,"__assign",()=>d,"__asyncDelegator",()=>x,"__asyncGenerator",()=>w,"__asyncValues",()=>y,"__await",()=>v,"__awaiter",()=>m,"__classPrivateFieldGet",()=>E,"__classPrivateFieldIn",()=>G,"__classPrivateFieldSet",()=>F,"__createBinding",()=>o,"__decorate",()=>f,"__disposeResources",()=>J,"__esDecorate",()=>h,"__exportStar",()=>p,"__extends",()=>c,"__generator",()=>n,"__importDefault",()=>D,"__importStar",()=>C,"__makeTemplateObject",()=>z,"__metadata",()=>l,"__param",()=>g,"__propKey",()=>j,"__read",()=>r,"__rest",()=>e,"__rewriteRelativeImportExtension",()=>K,"__runInitializers",()=>i,"__setFunctionName",()=>k,"__spread",()=>s,"__spreadArray",()=>u,"__spreadArrays",()=>t,"__values",()=>q,"default",0,L])},72124,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=class extends Error{constructor(a){super(a.message),this.name="PostgrestError",this.details=a.details,this.hint=a.hint,this.code=a.code}}},56592,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(52100).__importDefault(a.r(72124));c.default=class{constructor(a){var b,c;this.shouldThrowOnError=!1,this.method=a.method,this.url=a.url,this.headers=new Headers(a.headers),this.schema=a.schema,this.body=a.body,this.shouldThrowOnError=null!=(b=a.shouldThrowOnError)&&b,this.signal=a.signal,this.isMaybeSingle=null!=(c=a.isMaybeSingle)&&c,a.fetch?this.fetch=a.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(a,b){return this.headers=new Headers(this.headers),this.headers.set(a,b),this}then(a,b){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let c=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async a=>{var b,c,e,f;let g=null,h=null,i=null,j=a.status,k=a.statusText;if(a.ok){if("HEAD"!==this.method){let c=await a.text();""===c||(h="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null==(b=this.headers.get("Accept"))?void 0:b.includes("application/vnd.pgrst.plan+text"))?c:JSON.parse(c))}let d=null==(c=this.headers.get("Prefer"))?void 0:c.match(/count=(exact|planned|estimated)/),f=null==(e=a.headers.get("content-range"))?void 0:e.split("/");d&&f&&f.length>1&&(i=parseInt(f[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(h)&&(h.length>1?(g={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,i=null,j=406,k="Not Acceptable"):h=1===h.length?h[0]:null)}else{let b=await a.text();try{g=JSON.parse(b),Array.isArray(g)&&404===a.status&&(h=[],g=null,j=200,k="OK")}catch(c){404===a.status&&""===b?(j=204,k="No Content"):g={message:b}}if(g&&this.isMaybeSingle&&(null==(f=null==g?void 0:g.details)?void 0:f.includes("0 rows"))&&(g=null,j=200,k="OK"),g&&this.shouldThrowOnError)throw new d.default(g)}return{error:g,data:h,count:i,status:j,statusText:k}});return this.shouldThrowOnError||(c=c.catch(a=>{var b,c,d;return{error:{message:`${null!=(b=null==a?void 0:a.name)?b:"FetchError"}: ${null==a?void 0:a.message}`,details:`${null!=(c=null==a?void 0:a.stack)?c:""}`,hint:"",code:`${null!=(d=null==a?void 0:a.code)?d:""}`},data:null,count:null,status:0,statusText:""}})),c.then(a,b)}returns(){return this}overrideTypes(){return this}}},98564,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(52100).__importDefault(a.r(56592));class e extends d.default{select(a){let b=!1,c=(null!=a?a:"*").split("").map(a=>/\s/.test(a)&&!b?"":('"'===a&&(b=!b),a)).join("");return this.url.searchParams.set("select",c),this.headers.append("Prefer","return=representation"),this}order(a,{ascending:b=!0,nullsFirst:c,foreignTable:d,referencedTable:e=d}={}){let f=e?`${e}.order`:"order",g=this.url.searchParams.get(f);return this.url.searchParams.set(f,`${g?`${g},`:""}${a}.${b?"asc":"desc"}${void 0===c?"":c?".nullsfirst":".nullslast"}`),this}limit(a,{foreignTable:b,referencedTable:c=b}={}){let d=void 0===c?"limit":`${c}.limit`;return this.url.searchParams.set(d,`${a}`),this}range(a,b,{foreignTable:c,referencedTable:d=c}={}){let e=void 0===d?"offset":`${d}.offset`,f=void 0===d?"limit":`${d}.limit`;return this.url.searchParams.set(e,`${a}`),this.url.searchParams.set(f,`${b-a+1}`),this}abortSignal(a){return this.signal=a,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:a=!1,verbose:b=!1,settings:c=!1,buffers:d=!1,wal:e=!1,format:f="text"}={}){var g;let h=[a?"analyze":null,b?"verbose":null,c?"settings":null,d?"buffers":null,e?"wal":null].filter(Boolean).join("|"),i=null!=(g=this.headers.get("Accept"))?g:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${f}; for="${i}"; options=${h};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(a){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${a}`),this}}c.default=e},19001,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(52100).__importDefault(a.r(98564)),e=RegExp("[,()]");class f extends d.default{eq(a,b){return this.url.searchParams.append(a,`eq.${b}`),this}neq(a,b){return this.url.searchParams.append(a,`neq.${b}`),this}gt(a,b){return this.url.searchParams.append(a,`gt.${b}`),this}gte(a,b){return this.url.searchParams.append(a,`gte.${b}`),this}lt(a,b){return this.url.searchParams.append(a,`lt.${b}`),this}lte(a,b){return this.url.searchParams.append(a,`lte.${b}`),this}like(a,b){return this.url.searchParams.append(a,`like.${b}`),this}likeAllOf(a,b){return this.url.searchParams.append(a,`like(all).{${b.join(",")}}`),this}likeAnyOf(a,b){return this.url.searchParams.append(a,`like(any).{${b.join(",")}}`),this}ilike(a,b){return this.url.searchParams.append(a,`ilike.${b}`),this}ilikeAllOf(a,b){return this.url.searchParams.append(a,`ilike(all).{${b.join(",")}}`),this}ilikeAnyOf(a,b){return this.url.searchParams.append(a,`ilike(any).{${b.join(",")}}`),this}is(a,b){return this.url.searchParams.append(a,`is.${b}`),this}in(a,b){let c=Array.from(new Set(b)).map(a=>"string"==typeof a&&e.test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(a,`in.(${c})`),this}contains(a,b){return"string"==typeof b?this.url.searchParams.append(a,`cs.${b}`):Array.isArray(b)?this.url.searchParams.append(a,`cs.{${b.join(",")}}`):this.url.searchParams.append(a,`cs.${JSON.stringify(b)}`),this}containedBy(a,b){return"string"==typeof b?this.url.searchParams.append(a,`cd.${b}`):Array.isArray(b)?this.url.searchParams.append(a,`cd.{${b.join(",")}}`):this.url.searchParams.append(a,`cd.${JSON.stringify(b)}`),this}rangeGt(a,b){return this.url.searchParams.append(a,`sr.${b}`),this}rangeGte(a,b){return this.url.searchParams.append(a,`nxl.${b}`),this}rangeLt(a,b){return this.url.searchParams.append(a,`sl.${b}`),this}rangeLte(a,b){return this.url.searchParams.append(a,`nxr.${b}`),this}rangeAdjacent(a,b){return this.url.searchParams.append(a,`adj.${b}`),this}overlaps(a,b){return"string"==typeof b?this.url.searchParams.append(a,`ov.${b}`):this.url.searchParams.append(a,`ov.{${b.join(",")}}`),this}textSearch(a,b,{config:c,type:d}={}){let e="";"plain"===d?e="pl":"phrase"===d?e="ph":"websearch"===d&&(e="w");let f=void 0===c?"":`(${c})`;return this.url.searchParams.append(a,`${e}fts${f}.${b}`),this}match(a){return Object.entries(a).forEach(([a,b])=>{this.url.searchParams.append(a,`eq.${b}`)}),this}not(a,b,c){return this.url.searchParams.append(a,`not.${b}.${c}`),this}or(a,{foreignTable:b,referencedTable:c=b}={}){let d=c?`${c}.or`:"or";return this.url.searchParams.append(d,`(${a})`),this}filter(a,b,c){return this.url.searchParams.append(a,`${b}.${c}`),this}}c.default=f},3619,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(52100).__importDefault(a.r(19001));c.default=class{constructor(a,{headers:b={},schema:c,fetch:d}){this.url=a,this.headers=new Headers(b),this.schema=c,this.fetch=d}select(a,b){let{head:c=!1,count:e}=null!=b?b:{},f=!1,g=(null!=a?a:"*").split("").map(a=>/\s/.test(a)&&!f?"":('"'===a&&(f=!f),a)).join("");return this.url.searchParams.set("select",g),e&&this.headers.append("Prefer",`count=${e}`),new d.default({method:c?"HEAD":"GET",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(a,{count:b,defaultToNull:c=!0}={}){var e;if(b&&this.headers.append("Prefer",`count=${b}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(a)){let b=a.reduce((a,b)=>a.concat(Object.keys(b)),[]);if(b.length>0){let a=[...new Set(b)].map(a=>`"${a}"`);this.url.searchParams.set("columns",a.join(","))}}return new d.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:null!=(e=this.fetch)?e:fetch})}upsert(a,{onConflict:b,ignoreDuplicates:c=!1,count:e,defaultToNull:f=!0}={}){var g;if(this.headers.append("Prefer",`resolution=${c?"ignore":"merge"}-duplicates`),void 0!==b&&this.url.searchParams.set("on_conflict",b),e&&this.headers.append("Prefer",`count=${e}`),f||this.headers.append("Prefer","missing=default"),Array.isArray(a)){let b=a.reduce((a,b)=>a.concat(Object.keys(b)),[]);if(b.length>0){let a=[...new Set(b)].map(a=>`"${a}"`);this.url.searchParams.set("columns",a.join(","))}}return new d.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:null!=(g=this.fetch)?g:fetch})}update(a,{count:b}={}){var c;return b&&this.headers.append("Prefer",`count=${b}`),new d.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:null!=(c=this.fetch)?c:fetch})}delete({count:a}={}){var b;return a&&this.headers.append("Prefer",`count=${a}`),new d.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!=(b=this.fetch)?b:fetch})}}},27749,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});let d=a.r(52100),e=d.__importDefault(a.r(3619)),f=d.__importDefault(a.r(19001));class g{constructor(a,{headers:b={},schema:c,fetch:d}={}){this.url=a,this.headers=new Headers(b),this.schemaName=c,this.fetch=d}from(a){let b=new URL(`${this.url}/${a}`);return new e.default(b,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new g(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,b={},{head:c=!1,get:d=!1,count:e}={}){var g;let h,i,j=new URL(`${this.url}/rpc/${a}`);c||d?(h=c?"HEAD":"GET",Object.entries(b).filter(([a,b])=>void 0!==b).map(([a,b])=>[a,Array.isArray(b)?`{${b.join(",")}}`:`${b}`]).forEach(([a,b])=>{j.searchParams.append(a,b)})):(h="POST",i=b);let k=new Headers(this.headers);return e&&k.set("Prefer",`count=${e}`),new f.default({method:h,url:j,headers:k,schema:this.schemaName,body:i,fetch:null!=(g=this.fetch)?g:fetch})}}c.default=g},79614,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.PostgrestError=c.PostgrestBuilder=c.PostgrestTransformBuilder=c.PostgrestFilterBuilder=c.PostgrestQueryBuilder=c.PostgrestClient=void 0;let d=a.r(52100),e=d.__importDefault(a.r(27749));c.PostgrestClient=e.default;let f=d.__importDefault(a.r(3619));c.PostgrestQueryBuilder=f.default;let g=d.__importDefault(a.r(19001));c.PostgrestFilterBuilder=g.default;let h=d.__importDefault(a.r(98564));c.PostgrestTransformBuilder=h.default;let i=d.__importDefault(a.r(56592));c.PostgrestBuilder=i.default;let j=d.__importDefault(a.r(72124));c.PostgrestError=j.default,c.default={PostgrestClient:e.default,PostgrestQueryBuilder:f.default,PostgrestFilterBuilder:g.default,PostgrestTransformBuilder:h.default,PostgrestBuilder:i.default,PostgrestError:j.default}},60350,a=>{"use strict";let b,c;var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a$,a_,a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br=a.i(87924),bs=a.i(72131);let bt=a=>{let b,c=new Set,d=(a,d)=>{let e="function"==typeof a?a(b):a;if(!Object.is(e,b)){let a=b;b=(null!=d?d:"object"!=typeof e||null===e)?e:Object.assign({},b,e),c.forEach(c=>c(b,a))}},e=()=>b,f={setState:d,getState:e,getInitialState:()=>g,subscribe:a=>(c.add(a),()=>c.delete(a))},g=b=a(d,e,f);return f},bu=a=>{let b=a?bt(a):bt,c=a=>(function(a,b=a=>a){let c=bs.default.useSyncExternalStore(a.subscribe,bs.default.useCallback(()=>b(a.getState()),[a,b]),bs.default.useCallback(()=>b(a.getInitialState()),[a,b]));return bs.default.useDebugValue(c),c})(b,a);return Object.assign(c,b),c},bv=a=>a?bu(a):bu;var bw=a.i(28684),bx=a.i(22734),by=a.i(24868),bz=a.i(81111),bA=a.i(88646);a.i(29e3),a.i(74160),a.i(10697);var bB=a.i(89877);a.i(95837),bB.default;var bC=a.i(14747);class bD{}function bE(a,b){return a.replace(/\{([^}]+)\}/g,(a,c)=>{if(Object.prototype.hasOwnProperty.call(b,c)){let a=b[c];return null!=a?String(a):""}throw Error(`Key '${c}' not found in valueMap.`)})}function bF(a,b,c){for(let d=0;d<b.length-1;d++){let e=b[d];if(e.endsWith("[]")){let f=e.slice(0,-2);if(!(f in a))if(Array.isArray(c))a[f]=Array.from({length:c.length},()=>({}));else throw Error(`Value must be a list given an array path ${e}`);if(Array.isArray(a[f])){let e=a[f];if(Array.isArray(c))for(let a=0;a<e.length;a++)bF(e[a],b.slice(d+1),c[a]);else for(let a of e)bF(a,b.slice(d+1),c)}return}if(e.endsWith("[0]")){let f=e.slice(0,-3);f in a||(a[f]=[{}]),bF(a[f][0],b.slice(d+1),c);return}a[e]&&"object"==typeof a[e]||(a[e]={}),a=a[e]}let d=b[b.length-1],e=a[d];if(void 0!==e){if(!c||"object"==typeof c&&0===Object.keys(c).length||c===e)return;if("object"==typeof e&&"object"==typeof c&&null!==e&&null!==c)Object.assign(e,c);else throw Error(`Cannot set value for an existing key. Key: ${d}`)}else"_self"!==d||"object"!=typeof c||null===c||Array.isArray(c)?a[d]=c:Object.assign(a,c)}function bG(a,b,c){try{if(1===b.length&&"_self"===b[0])return a;for(let d=0;d<b.length;d++){if("object"!=typeof a||null===a)return c;let e=b[d];if(e.endsWith("[]")){let f=e.slice(0,-2);if(!(f in a))return c;{let e=a[f];if(!Array.isArray(e))return c;return e.map(a=>bG(a,b.slice(d+1),c))}}a=a[e]}return a}catch(a){if(a instanceof TypeError)return c;throw a}}function bH(a){if("string"!=typeof a)throw Error("fromImageBytes must be a string");return a}function bI(a){var b;let c,d,e,f,g={},h=bG(a,["name"]);null!=h&&bF(g,["name"],h);let i=bG(a,["metadata"]);null!=i&&bF(g,["metadata"],i);let j=bG(a,["done"]);null!=j&&bF(g,["done"],j);let k=bG(a,["error"]);null!=k&&bF(g,["error"],k);let l=bG(a,["response"]);return null!=l&&bF(g,["response"],(c={},null!=(d=bG(b=l,["sdkHttpResponse"]))&&bF(c,["sdkHttpResponse"],d),null!=(e=bG(b,["parent"]))&&bF(c,["parent"],e),null!=(f=bG(b,["documentName"]))&&bF(c,["documentName"],f),c)),g}(d=ao||(ao={})).OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",d.OUTCOME_OK="OUTCOME_OK",d.OUTCOME_FAILED="OUTCOME_FAILED",d.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED",(e=ap||(ap={})).LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON",(f=aq||(aq={})).SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",f.SILENT="SILENT",f.WHEN_IDLE="WHEN_IDLE",f.INTERRUPT="INTERRUPT",(g=ar||(ar={})).TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",g.STRING="STRING",g.NUMBER="NUMBER",g.INTEGER="INTEGER",g.BOOLEAN="BOOLEAN",g.ARRAY="ARRAY",g.OBJECT="OBJECT",g.NULL="NULL",(h=as||(as={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",h.MODE_DYNAMIC="MODE_DYNAMIC",(i=at||(at={})).API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",i.SIMPLE_SEARCH="SIMPLE_SEARCH",i.ELASTIC_SEARCH="ELASTIC_SEARCH",(j=au||(au={})).AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",j.NO_AUTH="NO_AUTH",j.API_KEY_AUTH="API_KEY_AUTH",j.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",j.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",j.OAUTH="OAUTH",j.OIDC_AUTH="OIDC_AUTH",(k=av||(av={})).HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",k.HTTP_IN_QUERY="HTTP_IN_QUERY",k.HTTP_IN_HEADER="HTTP_IN_HEADER",k.HTTP_IN_PATH="HTTP_IN_PATH",k.HTTP_IN_BODY="HTTP_IN_BODY",k.HTTP_IN_COOKIE="HTTP_IN_COOKIE",(l=aw||(aw={})).PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",l.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",l.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",l.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",l.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",l.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",l.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH",(m=ax||(ax={})).HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",m.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",m.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",m.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",m.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",m.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",m.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",m.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",m.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",m.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",m.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK",(n=ay||(ay={})).HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY",(o=az||(az={})).HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",o.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",o.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",o.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",o.BLOCK_NONE="BLOCK_NONE",o.OFF="OFF",(p=aA||(aA={})).FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",p.STOP="STOP",p.MAX_TOKENS="MAX_TOKENS",p.SAFETY="SAFETY",p.RECITATION="RECITATION",p.LANGUAGE="LANGUAGE",p.OTHER="OTHER",p.BLOCKLIST="BLOCKLIST",p.PROHIBITED_CONTENT="PROHIBITED_CONTENT",p.SPII="SPII",p.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",p.IMAGE_SAFETY="IMAGE_SAFETY",p.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",p.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",p.NO_IMAGE="NO_IMAGE",(q=aB||(aB={})).HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",q.NEGLIGIBLE="NEGLIGIBLE",q.LOW="LOW",q.MEDIUM="MEDIUM",q.HIGH="HIGH",(r=aC||(aC={})).HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",r.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",r.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",r.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",r.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH",(s=aD||(aD={})).URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",s.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",s.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",s.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",s.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE",(t=aE||(aE={})).BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.IMAGE_SAFETY="IMAGE_SAFETY",t.MODEL_ARMOR="MODEL_ARMOR",t.JAILBREAK="JAILBREAK",(u=aF||(aF={})).TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",u.ON_DEMAND="ON_DEMAND",u.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT",(v=aG||(aG={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",v.TEXT="TEXT",v.IMAGE="IMAGE",v.AUDIO="AUDIO",(w=aH||(aH={})).MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",w.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",w.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",w.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",(x=aI||(aI={})).TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",x.TUNING_MODE_FULL="TUNING_MODE_FULL",x.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER",(y=aJ||(aJ={})).ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",y.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",y.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",y.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",y.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",y.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",y.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO",(z=aK||(aK={})).JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",z.JOB_STATE_QUEUED="JOB_STATE_QUEUED",z.JOB_STATE_PENDING="JOB_STATE_PENDING",z.JOB_STATE_RUNNING="JOB_STATE_RUNNING",z.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",z.JOB_STATE_FAILED="JOB_STATE_FAILED",z.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",z.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",z.JOB_STATE_PAUSED="JOB_STATE_PAUSED",z.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",z.JOB_STATE_UPDATING="JOB_STATE_UPDATING",z.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED",(A=aL||(aL={})).TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",A.TUNING_TASK_I2V="TUNING_TASK_I2V",A.TUNING_TASK_T2V="TUNING_TASK_T2V",A.TUNING_TASK_R2V="TUNING_TASK_R2V",(B=aM||(aM={})).FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",B.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",B.BALANCED="BALANCED",B.PRIORITIZE_COST="PRIORITIZE_COST",(C=aN||(aN={})).UNSPECIFIED="UNSPECIFIED",C.BLOCKING="BLOCKING",C.NON_BLOCKING="NON_BLOCKING",(D=aO||(aO={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",D.MODE_DYNAMIC="MODE_DYNAMIC",(E=aP||(aP={})).ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",E.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER",(F=aQ||(aQ={})).MODE_UNSPECIFIED="MODE_UNSPECIFIED",F.AUTO="AUTO",F.ANY="ANY",F.NONE="NONE",F.VALIDATED="VALIDATED",(G=aR||(aR={})).BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",G.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",G.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",G.BLOCK_NONE="BLOCK_NONE",(H=aS||(aS={})).DONT_ALLOW="DONT_ALLOW",H.ALLOW_ADULT="ALLOW_ADULT",H.ALLOW_ALL="ALLOW_ALL",(I=aT||(aT={})).auto="auto",I.en="en",I.ja="ja",I.ko="ko",I.hi="hi",I.zh="zh",I.pt="pt",I.es="es",(J=aU||(aU={})).MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",J.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",J.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",J.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",J.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC",(K=aV||(aV={})).CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",K.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",K.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",K.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH",(L=aW||(aW={})).SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",L.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",L.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",L.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT",(M=aX||(aX={})).EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",M.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",M.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",M.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",M.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",M.EDIT_MODE_STYLE="EDIT_MODE_STYLE",M.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",M.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE",(N=aY||(aY={})).FOREGROUND="FOREGROUND",N.BACKGROUND="BACKGROUND",N.PROMPT="PROMPT",N.SEMANTIC="SEMANTIC",N.INTERACTIVE="INTERACTIVE",(O=aZ||(aZ={})).ASSET="ASSET",O.STYLE="STYLE",(P=a$||(a$={})).INSERT="INSERT",P.REMOVE="REMOVE",P.REMOVE_STATIC="REMOVE_STATIC",P.OUTPAINT="OUTPAINT",(Q=a_||(a_={})).OPTIMIZED="OPTIMIZED",Q.LOSSLESS="LOSSLESS",(R=a0||(a0={})).SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",R.PREFERENCE_TUNING="PREFERENCE_TUNING",(S=a1||(a1={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",S.STATE_PENDING="STATE_PENDING",S.STATE_ACTIVE="STATE_ACTIVE",S.STATE_FAILED="STATE_FAILED",(T=a2||(a2={})).STATE_UNSPECIFIED="STATE_UNSPECIFIED",T.PROCESSING="PROCESSING",T.ACTIVE="ACTIVE",T.FAILED="FAILED",(U=a3||(a3={})).SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",U.UPLOADED="UPLOADED",U.GENERATED="GENERATED",(V=a4||(a4={})).TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",V.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",V.RESPONSE_REJECTED="RESPONSE_REJECTED",V.NEED_MORE_INPUT="NEED_MORE_INPUT",(W=a5||(a5={})).MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",W.TEXT="TEXT",W.IMAGE="IMAGE",W.VIDEO="VIDEO",W.AUDIO="AUDIO",W.DOCUMENT="DOCUMENT",(X=a6||(a6={})).START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",X.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",X.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW",(Y=a7||(a7={})).END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",Y.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",Y.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW",(Z=a8||(a8={})).ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",Z.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",Z.NO_INTERRUPTION="NO_INTERRUPTION",($=a9||(a9={})).TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",$.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",$.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT",(_=ba||(ba={})).SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",_.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",_.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",_.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",_.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",_.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",_.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",_.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",_.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",_.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",_.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",_.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",_.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR",(aa=bb||(bb={})).MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",aa.QUALITY="QUALITY",aa.DIVERSITY="DIVERSITY",aa.VOCALIZATION="VOCALIZATION",(ab=bc||(bc={})).PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",ab.PLAY="PLAY",ab.PAUSE="PAUSE",ab.STOP="STOP",ab.RESET_CONTEXT="RESET_CONTEXT";class bJ{constructor(a){const b={};for(const c of a.headers.entries())b[c[0]]=c[1];this.headers=b,this.responseInternal=a}json(){return this.responseInternal.json()}}class bK{get text(){var a,b,c,d,e,f,g,h;if((null==(d=null==(c=null==(b=null==(a=this.candidates)?void 0:a[0])?void 0:b.content)?void 0:c.parts)?void 0:d.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let i="",j=!1,k=[];for(let a of null!=(h=null==(g=null==(f=null==(e=this.candidates)?void 0:e[0])?void 0:f.content)?void 0:g.parts)?h:[]){for(let[b,c]of Object.entries(a))"text"!==b&&"thought"!==b&&"thoughtSignature"!==b&&(null!==c||void 0!==c)&&k.push(b);if("string"==typeof a.text){if("boolean"==typeof a.thought&&a.thought)continue;j=!0,i+=a.text}}return k.length>0&&console.warn(`there are non-text parts ${k} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),j?i:void 0}get data(){var a,b,c,d,e,f,g,h;if((null==(d=null==(c=null==(b=null==(a=this.candidates)?void 0:a[0])?void 0:b.content)?void 0:c.parts)?void 0:d.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let i="",j=[];for(let a of null!=(h=null==(g=null==(f=null==(e=this.candidates)?void 0:e[0])?void 0:f.content)?void 0:g.parts)?h:[]){for(let[b,c]of Object.entries(a))"inlineData"!==b&&(null!==c||void 0!==c)&&j.push(b);a.inlineData&&"string"==typeof a.inlineData.data&&(i+=atob(a.inlineData.data))}return j.length>0&&console.warn(`there are non-data parts ${j} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}get functionCalls(){var a,b,c,d,e,f,g,h;if((null==(d=null==(c=null==(b=null==(a=this.candidates)?void 0:a[0])?void 0:b.content)?void 0:c.parts)?void 0:d.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let i=null==(h=null==(g=null==(f=null==(e=this.candidates)?void 0:e[0])?void 0:f.content)?void 0:g.parts)?void 0:h.filter(a=>a.functionCall).map(a=>a.functionCall).filter(a=>void 0!==a);if((null==i?void 0:i.length)!==0)return i}get executableCode(){var a,b,c,d,e,f,g,h,i;if((null==(d=null==(c=null==(b=null==(a=this.candidates)?void 0:a[0])?void 0:b.content)?void 0:c.parts)?void 0:d.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let j=null==(h=null==(g=null==(f=null==(e=this.candidates)?void 0:e[0])?void 0:f.content)?void 0:g.parts)?void 0:h.filter(a=>a.executableCode).map(a=>a.executableCode).filter(a=>void 0!==a);if((null==j?void 0:j.length)!==0)return null==(i=null==j?void 0:j[0])?void 0:i.code}get codeExecutionResult(){var a,b,c,d,e,f,g,h,i;if((null==(d=null==(c=null==(b=null==(a=this.candidates)?void 0:a[0])?void 0:b.content)?void 0:c.parts)?void 0:d.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let j=null==(h=null==(g=null==(f=null==(e=this.candidates)?void 0:e[0])?void 0:f.content)?void 0:g.parts)?void 0:h.filter(a=>a.codeExecutionResult).map(a=>a.codeExecutionResult).filter(a=>void 0!==a);if((null==j?void 0:j.length)!==0)return null==(i=null==j?void 0:j[0])?void 0:i.output}}class bL{}class bM{}class bN{}class bO{}class bP{}class bQ{}class bR{}class bS{}class bT{}class bU{}class bV{_fromAPIResponse({apiResponse:a,_isVertexAI:b}){let c,d=new bV;if(b){let b,d,e,f,g,h;b={},null!=(d=bG(a,["name"]))&&bF(b,["name"],d),null!=(e=bG(a,["metadata"]))&&bF(b,["metadata"],e),null!=(f=bG(a,["done"]))&&bF(b,["done"],f),null!=(g=bG(a,["error"]))&&bF(b,["error"],g),null!=(h=bG(a,["response"]))&&bF(b,["response"],function(a){let b={},c=bG(a,["videos"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>{var b;let c,d,e,f,g,h;return c={},null!=(d=bG(a,["_self"]))&&bF(c,["video"],(e={},null!=(f=bG(b=d,["gcsUri"]))&&bF(e,["uri"],f),null!=(g=bG(b,["bytesBase64Encoded"]))&&bF(e,["videoBytes"],bH(g)),null!=(h=bG(b,["mimeType"]))&&bF(e,["mimeType"],h),e)),c})),bF(b,["generatedVideos"],a)}let d=bG(a,["raiMediaFilteredCount"]);null!=d&&bF(b,["raiMediaFilteredCount"],d);let e=bG(a,["raiMediaFilteredReasons"]);return null!=e&&bF(b,["raiMediaFilteredReasons"],e),b}(h)),c=b}else{let b,d,e,f,g,h;b={},null!=(d=bG(a,["name"]))&&bF(b,["name"],d),null!=(e=bG(a,["metadata"]))&&bF(b,["metadata"],e),null!=(f=bG(a,["done"]))&&bF(b,["done"],f),null!=(g=bG(a,["error"]))&&bF(b,["error"],g),null!=(h=bG(a,["response","generateVideoResponse"]))&&bF(b,["response"],function(a){let b={},c=bG(a,["generatedSamples"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>{var b;let c,d,e,f,g,h;return c={},null!=(d=bG(a,["video"]))&&bF(c,["video"],(e={},null!=(f=bG(b=d,["uri"]))&&bF(e,["uri"],f),null!=(g=bG(b,["encodedVideo"]))&&bF(e,["videoBytes"],bH(g)),null!=(h=bG(b,["encoding"]))&&bF(e,["mimeType"],h),e)),c})),bF(b,["generatedVideos"],a)}let d=bG(a,["raiMediaFilteredCount"]);null!=d&&bF(b,["raiMediaFilteredCount"],d);let e=bG(a,["raiMediaFilteredReasons"]);return null!=e&&bF(b,["raiMediaFilteredReasons"],e),b}(h)),c=b}return Object.assign(d,c),d}}class bW{}class bX{}class bY{}class bZ{}class b${}class b_{}class b0{_fromAPIResponse({apiResponse:a,_isVertexAI:b}){var c;let d,e,f,g,h,i,j,k,l,m,n=new b0;return Object.assign(n,(h={},null!=(i=bG(a,["name"]))&&bF(h,["name"],i),null!=(j=bG(a,["metadata"]))&&bF(h,["metadata"],j),null!=(k=bG(a,["done"]))&&bF(h,["done"],k),null!=(l=bG(a,["error"]))&&bF(h,["error"],l),null!=(m=bG(a,["response"]))&&bF(h,["response"],(d={},null!=(e=bG(c=m,["sdkHttpResponse"]))&&bF(d,["sdkHttpResponse"],e),null!=(f=bG(c,["parent"]))&&bF(d,["parent"],f),null!=(g=bG(c,["documentName"]))&&bF(d,["documentName"],g),d)),h)),n}}class b1{}class b2{}class b3{}class b4{}class b5{get text(){var a,b,c;let d="",e=!1,f=[];for(let g of null!=(c=null==(b=null==(a=this.serverContent)?void 0:a.modelTurn)?void 0:b.parts)?c:[]){for(let[a,b]of Object.entries(g))"text"!==a&&"thought"!==a&&null!==b&&f.push(a);if("string"==typeof g.text){if("boolean"==typeof g.thought&&g.thought)continue;e=!0,d+=g.text}}return f.length>0&&console.warn(`there are non-text parts ${f} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),e?d:void 0}get data(){var a,b,c;let d="",e=[];for(let f of null!=(c=null==(b=null==(a=this.serverContent)?void 0:a.modelTurn)?void 0:b.parts)?c:[]){for(let[a,b]of Object.entries(f))"inlineData"!==a&&null!==b&&e.push(a);f.inlineData&&"string"==typeof f.inlineData.data&&(d+=atob(f.inlineData.data))}return e.length>0&&console.warn(`there are non-data parts ${e} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}}class b6{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class b7{_fromAPIResponse({apiResponse:a,_isVertexAI:b}){let c=new b7;return Object.assign(c,bI(a)),c}}function b8(a,b){if(!b||"string"!=typeof b)throw Error("model is required and must be a string");if(b.includes("..")||b.includes("?")||b.includes("&"))throw Error("invalid model parameter");if(a.isVertexAI())if(b.startsWith("publishers/")||b.startsWith("projects/")||b.startsWith("models/"))return b;else{if(!(b.indexOf("/")>=0))return`publishers/google/models/${b}`;let a=b.split("/",2);return`publishers/${a[0]}/models/${a[1]}`}return b.startsWith("models/")||b.startsWith("tunedModels/")?b:`models/${b}`}function b9(a,b){let c=b8(a,b);return c?c.startsWith("publishers/")&&a.isVertexAI()?`projects/${a.getProject()}/locations/${a.getLocation()}/${c}`:c.startsWith("models/")&&a.isVertexAI()?`projects/${a.getProject()}/locations/${a.getLocation()}/publishers/google/${c}`:c:""}function ca(a){return Array.isArray(a)?a.map(a=>cb(a)):[cb(a)]}function cb(a){if("object"==typeof a&&null!==a)return a;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof a}`)}function cc(a){let b=cb(a);if(b.mimeType&&b.mimeType.startsWith("image/"))return b;throw Error(`Unsupported mime type: ${b.mimeType}`)}function cd(a){let b=cb(a);if(b.mimeType&&b.mimeType.startsWith("audio/"))return b;throw Error(`Unsupported mime type: ${b.mimeType}`)}function ce(a){if(null==a)throw Error("PartUnion is required");if("object"==typeof a)return a;if("string"==typeof a)return{text:a};throw Error(`Unsupported part type: ${typeof a}`)}function cf(a){if(null==a||Array.isArray(a)&&0===a.length)throw Error("PartListUnion is required");return Array.isArray(a)?a.map(a=>ce(a)):[ce(a)]}function cg(a){return null!=a&&"object"==typeof a&&"parts"in a&&Array.isArray(a.parts)}function ch(a){return null!=a&&"object"==typeof a&&"functionCall"in a}function ci(a){return null!=a&&"object"==typeof a&&"functionResponse"in a}function cj(a){if(null==a)throw Error("ContentUnion is required");return cg(a)?a:{role:"user",parts:cf(a)}}function ck(a,b){if(!b)return[];if(a.isVertexAI()&&Array.isArray(b))return b.flatMap(a=>{let b=cj(a);return b.parts&&b.parts.length>0&&void 0!==b.parts[0].text?[b.parts[0].text]:[]});if(a.isVertexAI()){let a=cj(b);return a.parts&&a.parts.length>0&&void 0!==a.parts[0].text?[a.parts[0].text]:[]}return Array.isArray(b)?b.map(a=>cj(a)):[cj(b)]}function cl(a){if(null==a||Array.isArray(a)&&0===a.length)throw Error("contents are required");if(!Array.isArray(a)){if(ch(a)||ci(a))throw Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[cj(a)]}let b=[],c=[],d=cg(a[0]);for(let e of a){let a=cg(e);if(a!=d)throw Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(a)b.push(e);else if(ch(e)||ci(e))throw Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");else c.push(e)}return d||b.push({role:"user",parts:cf(c)}),b}function cm(a){let b={},c=["items"],d=["anyOf"],e=["properties"];if(a.type&&a.anyOf)throw Error("type and anyOf cannot be both populated.");let f=a.anyOf;for(let[g,h]of(null!=f&&2==f.length&&("null"===f[0].type?(b.nullable=!0,a=f[1]):"null"===f[1].type&&(b.nullable=!0,a=f[0])),a.type instanceof Array&&function(a,b){a.includes("null")&&(b.nullable=!0);let c=a.filter(a=>"null"!==a);if(1===c.length)b.type=Object.values(ar).includes(c[0].toUpperCase())?c[0].toUpperCase():ar.TYPE_UNSPECIFIED;else for(let a of(b.anyOf=[],c))b.anyOf.push({type:Object.values(ar).includes(a.toUpperCase())?a.toUpperCase():ar.TYPE_UNSPECIFIED})}(a.type,b),Object.entries(a)))if(null!=h)if("type"==g){if("null"===h)throw Error("type: null can not be the only possible type for the field.");if(h instanceof Array)continue;b.type=Object.values(ar).includes(h.toUpperCase())?h.toUpperCase():ar.TYPE_UNSPECIFIED}else if(c.includes(g))b[g]=cm(h);else if(d.includes(g)){let a=[];for(let c of h){if("null"==c.type){b.nullable=!0;continue}a.push(cm(c))}b[g]=a}else if(e.includes(g)){let a={};for(let[b,c]of Object.entries(h))a[b]=cm(c);b[g]=a}else{if("additionalProperties"===g)continue;b[g]=h}return b}function cn(a){if("object"==typeof a)return a;if("string"==typeof a)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:a}}};throw Error(`Unsupported speechConfig type: ${typeof a}`)}function co(a){if("multiSpeakerVoiceConfig"in a)throw Error("multiSpeakerVoiceConfig is not supported in the live API.");return a}function cp(a){if(a.functionDeclarations)for(let b of a.functionDeclarations)b.parameters&&(Object.keys(b.parameters).includes("$schema")?b.parametersJsonSchema||(b.parametersJsonSchema=b.parameters,delete b.parameters):b.parameters=cm(b.parameters)),b.response&&(Object.keys(b.response).includes("$schema")?b.responseJsonSchema||(b.responseJsonSchema=b.response,delete b.response):b.response=cm(b.response));return a}function cq(a){if(null==a)throw Error("tools is required");if(!Array.isArray(a))throw Error("tools is required and must be an array of Tools");let b=[];for(let c of a)b.push(c);return b}function cr(a,b){if("string"!=typeof b)throw Error("name must be a string");return function(a,b,c,d=1){let e=!b.startsWith(`${c}/`)&&b.split("/").length===d;if(a.isVertexAI())if(b.startsWith("projects/"))return b;else if(b.startsWith("locations/"))return`projects/${a.getProject()}/${b}`;else if(b.startsWith(`${c}/`))return`projects/${a.getProject()}/locations/${a.getLocation()}/${b}`;else if(e)return`projects/${a.getProject()}/locations/${a.getLocation()}/${c}/${b}`;else return b;return e?`${c}/${b}`:b}(a,b,"cachedContents")}function cs(a){switch(a){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return a}}function ct(a){return null!=a&&"object"==typeof a&&"video"in a}function cu(a){return null!=a&&"object"==typeof a&&"uri"in a}function cv(a){var b;let c;if(null!=a&&"object"==typeof a&&"name"in a&&(c=a.name),!cu(a)||void 0!==(c=a.uri)){if(!ct(a)||void 0!==(c=null==(b=a.video)?void 0:b.uri)){if("string"==typeof a&&(c=a),void 0===c)throw Error("Could not extract file name from the provided input.");if(c.startsWith("https://")){let a=c.split("files/")[1].match(/[a-z0-9]+/);if(null===a)throw Error(`Could not extract file name from URI ${c}`);c=a[0]}else c.startsWith("files/")&&(c=c.split("files/")[1]);return c}}}function cw(a,b){return a.isVertexAI()?b?"publishers/google/models":"models":b?"models":"tunedModels"}function cx(a){for(let d of["models","tunedModels","publisherModels"]){var b,c;if(b=a,c=d,null!==b&&"object"==typeof b&&c in b)return a[d]}return[]}function cy(a,b){let c;if("string"==typeof b)if(a.isVertexAI())if(b.startsWith("gs://"))c={format:"jsonl",gcsUri:[b]};else if(b.startsWith("bq://"))c={format:"bigquery",bigqueryUri:b};else throw Error(`Unsupported string source for Vertex AI: ${b}`);else if(b.startsWith("files/"))c={fileName:b};else throw Error(`Unsupported string source for Gemini API: ${b}`);else if(Array.isArray(b)){if(a.isVertexAI())throw Error("InlinedRequest[] is not supported in Vertex AI.");c={inlinedRequests:b}}else c=b;let d=[c.gcsUri,c.bigqueryUri].filter(Boolean).length,e=[c.inlinedRequests,c.fileName].filter(Boolean).length;if(a.isVertexAI()){if(e>0||1!==d)throw Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(d>0||1!==e)throw Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return c}function cz(a){if("object"!=typeof a||null===a)return{};let b=a.inlinedResponses;if("object"!=typeof b||null===b)return a;let c=b.inlinedResponses;if(!Array.isArray(c)||0===c.length)return a;let d=!1;for(let a of c){if("object"!=typeof a||null===a)continue;let b=a.response;if("object"==typeof b&&null!==b&&void 0!==b.embedding){d=!0;break}}return d&&(a.inlinedEmbedContentResponses=a.inlinedResponses,delete a.inlinedResponses),a}function cA(a,b){if(!a.isVertexAI()){if(/batches\/[^/]+$/.test(b))return b.split("/").pop();throw Error(`Invalid batch job name: ${b}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(b))return b.split("/").pop();if(/^\d+$/.test(b))return b;throw Error(`Invalid batch job name: ${b}.`)}function cB(a){if("BATCH_STATE_UNSPECIFIED"===a)return"JOB_STATE_UNSPECIFIED";if("BATCH_STATE_PENDING"===a)return"JOB_STATE_PENDING";if("BATCH_STATE_RUNNING"===a)return"JOB_STATE_RUNNING";if("BATCH_STATE_SUCCEEDED"===a)return"JOB_STATE_SUCCEEDED";if("BATCH_STATE_FAILED"===a)return"JOB_STATE_FAILED";else if("BATCH_STATE_CANCELLED"===a)return"JOB_STATE_CANCELLED";else if("BATCH_STATE_EXPIRED"===a)return"JOB_STATE_EXPIRED";else return a}function cC(a){let b={},c=bG(a,["name"]);null!=c&&bF(b,["name"],c);let d=bG(a,["metadata","displayName"]);null!=d&&bF(b,["displayName"],d);let e=bG(a,["metadata","state"]);null!=e&&bF(b,["state"],cB(e));let f=bG(a,["metadata","createTime"]);null!=f&&bF(b,["createTime"],f);let g=bG(a,["metadata","endTime"]);null!=g&&bF(b,["endTime"],g);let h=bG(a,["metadata","updateTime"]);null!=h&&bF(b,["updateTime"],h);let i=bG(a,["metadata","model"]);null!=i&&bF(b,["model"],i);let j=bG(a,["metadata","output"]);return null!=j&&bF(b,["dest"],function(a){let b={},c=bG(a,["responsesFile"]);null!=c&&bF(b,["fileName"],c);let d=bG(a,["inlinedResponses","inlinedResponses"]);if(null!=d){let a=d;Array.isArray(a)&&(a=a.map(a=>{var b;let c,d,e;return c={},null!=(d=bG(b=a,["response"]))&&bF(c,["response"],function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["candidates"]);if(null!=d){let a=d;Array.isArray(a)&&(a=a.map(a=>(function(a){let b={},c=bG(a,["content"]);null!=c&&bF(b,["content"],c);let d=bG(a,["citationMetadata"]);null!=d&&bF(b,["citationMetadata"],function(a){let b={},c=bG(a,["citationSources"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["citations"],a)}return b}(d));let e=bG(a,["tokenCount"]);null!=e&&bF(b,["tokenCount"],e);let f=bG(a,["finishReason"]);null!=f&&bF(b,["finishReason"],f);let g=bG(a,["avgLogprobs"]);null!=g&&bF(b,["avgLogprobs"],g);let h=bG(a,["groundingMetadata"]);null!=h&&bF(b,["groundingMetadata"],h);let i=bG(a,["index"]);null!=i&&bF(b,["index"],i);let j=bG(a,["logprobsResult"]);null!=j&&bF(b,["logprobsResult"],j);let k=bG(a,["safetyRatings"]);if(null!=k){let a=k;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["safetyRatings"],a)}let l=bG(a,["urlContextMetadata"]);return null!=l&&bF(b,["urlContextMetadata"],l),b})(a))),bF(b,["candidates"],a)}let e=bG(a,["modelVersion"]);null!=e&&bF(b,["modelVersion"],e);let f=bG(a,["promptFeedback"]);null!=f&&bF(b,["promptFeedback"],f);let g=bG(a,["responseId"]);null!=g&&bF(b,["responseId"],g);let h=bG(a,["usageMetadata"]);return null!=h&&bF(b,["usageMetadata"],h),b}(d)),null!=(e=bG(b,["error"]))&&bF(c,["error"],e),c})),bF(b,["inlinedResponses"],a)}let e=bG(a,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=e){let a=e;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["inlinedEmbedContentResponses"],a)}return b}(cz(j))),b}function cD(a){var b,c;let d,e,f,g,h,i,j,k,l={},m=bG(a,["name"]);null!=m&&bF(l,["name"],m);let n=bG(a,["displayName"]);null!=n&&bF(l,["displayName"],n);let o=bG(a,["state"]);null!=o&&bF(l,["state"],cB(o));let p=bG(a,["error"]);null!=p&&bF(l,["error"],p);let q=bG(a,["createTime"]);null!=q&&bF(l,["createTime"],q);let r=bG(a,["startTime"]);null!=r&&bF(l,["startTime"],r);let s=bG(a,["endTime"]);null!=s&&bF(l,["endTime"],s);let t=bG(a,["updateTime"]);null!=t&&bF(l,["updateTime"],t);let u=bG(a,["model"]);null!=u&&bF(l,["model"],u);let v=bG(a,["inputConfig"]);null!=v&&bF(l,["src"],(d={},null!=(e=bG(c=v,["instancesFormat"]))&&bF(d,["format"],e),null!=(f=bG(c,["gcsSource","uris"]))&&bF(d,["gcsUri"],f),null!=(g=bG(c,["bigquerySource","inputUri"]))&&bF(d,["bigqueryUri"],g),d));let w=bG(a,["outputConfig"]);null!=w&&bF(l,["dest"],(b=cz(w),h={},null!=(i=bG(b,["predictionsFormat"]))&&bF(h,["format"],i),null!=(j=bG(b,["gcsDestination","outputUriPrefix"]))&&bF(h,["gcsUri"],j),null!=(k=bG(b,["bigqueryDestination","outputUri"]))&&bF(h,["bigqueryUri"],k),h));let x=bG(a,["completionStats"]);return null!=x&&bF(l,["completionStats"],x),l}function cE(a){let b={},c=bG(a,["parts"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>{var b;let c,d,e,f,g,h,i,j,k,l,m;return c={},null!=(d=bG(b=a,["functionCall"]))&&bF(c,["functionCall"],d),null!=(e=bG(b,["codeExecutionResult"]))&&bF(c,["codeExecutionResult"],e),null!=(f=bG(b,["executableCode"]))&&bF(c,["executableCode"],f),null!=(g=bG(b,["fileData"]))&&bF(c,["fileData"],function(a){let b={};if(void 0!==bG(a,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let c=bG(a,["fileUri"]);null!=c&&bF(b,["fileUri"],c);let d=bG(a,["mimeType"]);return null!=d&&bF(b,["mimeType"],d),b}(g)),null!=(h=bG(b,["functionResponse"]))&&bF(c,["functionResponse"],h),null!=(i=bG(b,["inlineData"]))&&bF(c,["inlineData"],function(a){let b={},c=bG(a,["data"]);if(null!=c&&bF(b,["data"],c),void 0!==bG(a,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let d=bG(a,["mimeType"]);return null!=d&&bF(b,["mimeType"],d),b}(i)),null!=(j=bG(b,["text"]))&&bF(c,["text"],j),null!=(k=bG(b,["thought"]))&&bF(c,["thought"],k),null!=(l=bG(b,["thoughtSignature"]))&&bF(c,["thoughtSignature"],l),null!=(m=bG(b,["videoMetadata"]))&&bF(c,["videoMetadata"],m),c})),bF(b,["parts"],a)}let d=bG(a,["role"]);return null!=d&&bF(b,["role"],d),b}function cF(a,b){let c={},d=bG(b,["model"]);null!=d&&bF(c,["_url","model"],b8(a,d));let e=bG(b,["src"]);null!=e&&bF(c,["batch","inputConfig"],function(a,b){let c={};if(void 0!==bG(b,["format"]))throw Error("format parameter is not supported in Gemini API.");if(void 0!==bG(b,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==bG(b,["bigqueryUri"]))throw Error("bigqueryUri parameter is not supported in Gemini API.");let d=bG(b,["fileName"]);null!=d&&bF(c,["fileName"],d);let e=bG(b,["inlinedRequests"]);if(null!=e){let b=e;Array.isArray(b)&&(b=b.map(b=>(function(a,b){let c={},d=bG(b,["model"]);null!=d&&bF(c,["request","model"],b8(a,d));let e=bG(b,["contents"]);if(null!=e){let a=cl(e);Array.isArray(a)&&(a=a.map(a=>cE(a))),bF(c,["request","contents"],a)}let f=bG(b,["metadata"]);null!=f&&bF(c,["metadata"],f);let g=bG(b,["config"]);return null!=g&&bF(c,["request","generationConfig"],function(a,b,c){let d={},e=bG(b,["systemInstruction"]);void 0!==c&&null!=e&&bF(c,["systemInstruction"],cE(cj(e)));let f=bG(b,["temperature"]);null!=f&&bF(d,["temperature"],f);let g=bG(b,["topP"]);null!=g&&bF(d,["topP"],g);let h=bG(b,["topK"]);null!=h&&bF(d,["topK"],h);let i=bG(b,["candidateCount"]);null!=i&&bF(d,["candidateCount"],i);let j=bG(b,["maxOutputTokens"]);null!=j&&bF(d,["maxOutputTokens"],j);let k=bG(b,["stopSequences"]);null!=k&&bF(d,["stopSequences"],k);let l=bG(b,["responseLogprobs"]);null!=l&&bF(d,["responseLogprobs"],l);let m=bG(b,["logprobs"]);null!=m&&bF(d,["logprobs"],m);let n=bG(b,["presencePenalty"]);null!=n&&bF(d,["presencePenalty"],n);let o=bG(b,["frequencyPenalty"]);null!=o&&bF(d,["frequencyPenalty"],o);let p=bG(b,["seed"]);null!=p&&bF(d,["seed"],p);let q=bG(b,["responseMimeType"]);null!=q&&bF(d,["responseMimeType"],q);let r=bG(b,["responseSchema"]);null!=r&&bF(d,["responseSchema"],cm(r));let s=bG(b,["responseJsonSchema"]);if(null!=s&&bF(d,["responseJsonSchema"],s),void 0!==bG(b,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==bG(b,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let t=bG(b,["safetySettings"]);if(void 0!==c&&null!=t){let a=t;Array.isArray(a)&&(a=a.map(a=>(function(a){let b={},c=bG(a,["category"]);if(null!=c&&bF(b,["category"],c),void 0!==bG(a,["method"]))throw Error("method parameter is not supported in Gemini API.");let d=bG(a,["threshold"]);return null!=d&&bF(b,["threshold"],d),b})(a))),bF(c,["safetySettings"],a)}let u=bG(b,["tools"]);if(void 0!==c&&null!=u){let a=cq(u);Array.isArray(a)&&(a=a.map(a=>(function(a){let b={},c=bG(a,["functionDeclarations"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["functionDeclarations"],a)}if(void 0!==bG(a,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let d=bG(a,["googleSearchRetrieval"]);null!=d&&bF(b,["googleSearchRetrieval"],d);let e=bG(a,["computerUse"]);null!=e&&bF(b,["computerUse"],e);let f=bG(a,["fileSearch"]);null!=f&&bF(b,["fileSearch"],f);let g=bG(a,["codeExecution"]);if(null!=g&&bF(b,["codeExecution"],g),void 0!==bG(a,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let h=bG(a,["googleMaps"]);null!=h&&bF(b,["googleMaps"],function(a){let b={};if(void 0!==bG(a,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let c=bG(a,["enableWidget"]);return null!=c&&bF(b,["enableWidget"],c),b}(h));let i=bG(a,["googleSearch"]);null!=i&&bF(b,["googleSearch"],function(a){let b={};if(void 0!==bG(a,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==bG(a,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let c=bG(a,["timeRangeFilter"]);return null!=c&&bF(b,["timeRangeFilter"],c),b}(i));let j=bG(a,["urlContext"]);return null!=j&&bF(b,["urlContext"],j),b})(cp(a)))),bF(c,["tools"],a)}let v=bG(b,["toolConfig"]);if(void 0!==c&&null!=v&&bF(c,["toolConfig"],v),void 0!==bG(b,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let w=bG(b,["cachedContent"]);void 0!==c&&null!=w&&bF(c,["cachedContent"],cr(a,w));let x=bG(b,["responseModalities"]);null!=x&&bF(d,["responseModalities"],x);let y=bG(b,["mediaResolution"]);null!=y&&bF(d,["mediaResolution"],y);let z=bG(b,["speechConfig"]);if(null!=z&&bF(d,["speechConfig"],cn(z)),void 0!==bG(b,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let A=bG(b,["thinkingConfig"]);null!=A&&bF(d,["thinkingConfig"],A);let B=bG(b,["imageConfig"]);return null!=B&&bF(d,["imageConfig"],B),d}(a,g,bG(c,["request"],{}))),c})(a,b))),bF(c,["requests","requests"],b)}return c}(a,cy(a,e)));let f=bG(b,["config"]);return null!=f&&function(a,b){let c=bG(a,["displayName"]);if(void 0!==b&&null!=c&&bF(b,["batch","displayName"],c),void 0!==bG(a,["dest"]))throw Error("dest parameter is not supported in Gemini API.")}(f,c),c}(ac=bd||(bd={})).PAGED_ITEM_BATCH_JOBS="batchJobs",ac.PAGED_ITEM_MODELS="models",ac.PAGED_ITEM_TUNING_JOBS="tuningJobs",ac.PAGED_ITEM_FILES="files",ac.PAGED_ITEM_CACHED_CONTENTS="cachedContents",ac.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",ac.PAGED_ITEM_DOCUMENTS="documents";class cG{constructor(a,b,c,d){this.pageInternal=[],this.paramsInternal={},this.requestInternal=b,this.init(a,c,d)}init(a,b,c){var d,e;this.nameInternal=a,this.pageInternal=b[this.nameInternal]||[],this.sdkHttpResponseInternal=null==b?void 0:b.sdkHttpResponse,this.idxInternal=0;let f={config:{}};(f=c&&0!==Object.keys(c).length?"object"==typeof c?Object.assign({},c):c:{config:{}}).config&&(f.config.pageToken=b.nextPageToken),this.paramsInternal=f,this.pageInternalSize=null!=(e=null==(d=f.config)?void 0:d.pageSize)?e:this.pageInternal.length}initNextPage(a){this.init(this.nameInternal,a,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(a){return this.pageInternal[a]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(!this.hasNextPage())return{value:void 0,done:!0};else await this.nextPage();let a=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:a,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error("No more pages to fetch.");let a=await this.requestInternal(this.params);return this.initNextPage(a),this.page}hasNextPage(){var a;return(null==(a=this.params.config)?void 0:a.pageToken)!==void 0}}class cH extends bD{constructor(a){super(),this.apiClient=a,this.create=async a=>(this.apiClient.isVertexAI()&&(a.config=this.formatDestination(a.src,a.config)),this.createInternal(a)),this.createEmbeddings=async a=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(a)},this.list=async(a={})=>new cG(bd.PAGED_ITEM_BATCH_JOBS,a=>this.listInternal(a),await this.listInternal(a),a)}createInlinedGenerateContentRequest(a){let b=cF(this.apiClient,a),c=bE("{model}:batchGenerateContent",b._url),d=b.batch.inputConfig.requests,e=d.requests,f=[];for(let a of e){let b=Object.assign({},a);if(b.systemInstruction){let a=b.systemInstruction;delete b.systemInstruction;let c=b.request;c.systemInstruction=a,b.request=c}f.push(b)}return d.requests=f,delete b.config,delete b._url,delete b._query,{path:c,body:b}}getGcsUri(a){return"string"==typeof a?a.startsWith("gs://")?a:void 0:!Array.isArray(a)&&a.gcsUri&&a.gcsUri.length>0?a.gcsUri[0]:void 0}getBigqueryUri(a){return"string"==typeof a?a.startsWith("bq://")?a:void 0:Array.isArray(a)?void 0:a.bigqueryUri}formatDestination(a,b){let c=b?Object.assign({},b):{},d=Date.now().toString();if(c.displayName||(c.displayName=`genaiBatchJob_${d}`),void 0===c.dest){let b=this.getGcsUri(a),e=this.getBigqueryUri(a);if(b)b.endsWith(".jsonl")?c.dest=`${b.slice(0,-6)}/dest`:c.dest=`${b}_dest_${d}`;else if(e)c.dest=`${e}_dest_${d}`;else throw Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return c}async createInternal(a){var b,c,d,e,f;let g="",h={};if(this.apiClient.isVertexAI()){let d,e,i,j,k,l,m=(f=this.apiClient,d={},null!=(e=bG(a,["model"]))&&bF(d,["model"],b8(f,e)),null!=(i=bG(a,["src"]))&&bF(d,["inputConfig"],function(a){let b={},c=bG(a,["format"]);null!=c&&bF(b,["instancesFormat"],c);let d=bG(a,["gcsUri"]);null!=d&&bF(b,["gcsSource","uris"],d);let e=bG(a,["bigqueryUri"]);if(null!=e&&bF(b,["bigquerySource","inputUri"],e),void 0!==bG(a,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==bG(a,["inlinedRequests"]))throw Error("inlinedRequests parameter is not supported in Vertex AI.");return b}(cy(f,i))),null!=(j=bG(a,["config"]))&&(k=bG(j,["displayName"]),void 0!==d&&null!=k&&bF(d,["displayName"],k),l=bG(j,["dest"]),void 0!==d&&null!=l&&bF(d,["outputConfig"],function(a){let b={},c=bG(a,["format"]);null!=c&&bF(b,["predictionsFormat"],c);let d=bG(a,["gcsUri"]);null!=d&&bF(b,["gcsDestination","outputUriPrefix"],d);let e=bG(a,["bigqueryUri"]);if(null!=e&&bF(b,["bigqueryDestination","outputUri"],e),void 0!==bG(a,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==bG(a,["inlinedResponses"]))throw Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==bG(a,["inlinedEmbedContentResponses"]))throw Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return b}(function(a){if("string"!=typeof a)return a;if(a.startsWith("gs://"))return{format:"jsonl",gcsUri:a};if(a.startsWith("bq://"))return{format:"bigquery",bigqueryUri:a};throw Error(`Unsupported destination: ${a}`)}(l)))),d);return g=bE("batchPredictionJobs",m._url),h=m._query,delete m._url,delete m._query,this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(m),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>cD(a))}{let b=cF(this.apiClient,a);return g=bE("{model}:batchGenerateContent",b._url),h=b._query,delete b._url,delete b._query,this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(b),httpMethod:"POST",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json()).then(a=>cC(a))}}async createEmbeddingsInternal(a){var b,c,d,e,f;let g="",h={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let i,j,k,l,m,n,o,p,q=(d=this.apiClient,l={},null!=(m=bG(a,["model"]))&&bF(l,["_url","model"],b8(d,m)),null!=(n=bG(a,["src"]))&&bF(l,["batch","inputConfig"],(e=d,i={},null!=(j=bG(f=n,["fileName"]))&&bF(i,["file_name"],j),null!=(k=bG(f,["inlinedRequests"]))&&bF(i,["requests"],function(a,b){let c={},d=bG(b,["contents"]);if(null!=d){let b=ck(a,d);Array.isArray(b)&&(b=b.map(a=>a)),bF(c,["requests[]","request","content"],b)}let e=bG(b,["config"]);return null!=e&&(bF(c,["_self"],function(a,b){let c=bG(a,["taskType"]);void 0!==b&&null!=c&&bF(b,["requests[]","taskType"],c);let d=bG(a,["title"]);void 0!==b&&null!=d&&bF(b,["requests[]","title"],d);let e=bG(a,["outputDimensionality"]);if(void 0!==b&&null!=e&&bF(b,["requests[]","outputDimensionality"],e),void 0!==bG(a,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==bG(a,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.");return{}}(e,c)),!function(a,b){for(let[c,d]of Object.entries(b)){let b=c.split("."),e=d.split("."),f=new Set,g=-1;for(let a=0;a<b.length;a++)if("*"===b[a]){g=a;break}if(-1!==g&&e.length>g)for(let a=g;a<e.length;a++){let b=e[a];"*"===b||b.endsWith("[]")||b.endsWith("[0]")||f.add(b)}!function a(b,c,d,e,f){if(e>=c.length||"object"!=typeof b||null===b)return;let g=c[e];if(g.endsWith("[]")){let h=g.slice(0,-2);if(h in b&&Array.isArray(b[h]))for(let g of b[h])a(g,c,d,e+1,f)}else if("*"===g){if("object"==typeof b&&null!==b&&!Array.isArray(b)){let a=Object.keys(b).filter(a=>!a.startsWith("_")&&!f.has(a)),c={};for(let d of a)c[d]=b[d];for(let[a,f]of Object.entries(c)){let c=[];for(let b of d.slice(e))"*"===b?c.push(a):c.push(b);bF(b,c,f)}for(let c of a)delete b[c]}}else g in b&&a(b[g],c,d,e+1,f)}(a,b,e,0,f)}}(c,{"requests[].*":"requests[].request.*"})),c}(e,k)),i)),null!=(o=bG(a,["config"]))&&(p=bG(o,["displayName"]),void 0!==l&&null!=p&&bF(l,["batch","displayName"],p)),l);return g=bE("{model}:asyncBatchEmbedContent",q._url),h=q._query,delete q._url,delete q._query,this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(q),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>cC(a))}}async get(a){var b,c,d,e,f,g;let h="",i={};if(this.apiClient.isVertexAI()){let d,e,g=(f=this.apiClient,d={},null!=(e=bG(a,["name"]))&&bF(d,["_url","name"],cA(f,e)),d);return h=bE("batchPredictionJobs/{name}",g._url),i=g._query,delete g._url,delete g._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(g),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>cD(a))}{let b,c,f=(g=this.apiClient,b={},null!=(c=bG(a,["name"]))&&bF(b,["_url","name"],cA(g,c)),b);return h=bE("batches/{name}",f._url),i=f._query,delete f._url,delete f._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(f),httpMethod:"GET",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json()).then(a=>cC(a))}}async cancel(a){var b,c,d,e,f,g;let h="",i={};if(this.apiClient.isVertexAI()){let d,e,g=(f=this.apiClient,d={},null!=(e=bG(a,["name"]))&&bF(d,["_url","name"],cA(f,e)),d);h=bE("batchPredictionJobs/{name}:cancel",g._url),i=g._query,delete g._url,delete g._query,await this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(g),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal})}else{let b,c,f=(g=this.apiClient,b={},null!=(c=bG(a,["name"]))&&bF(b,["_url","name"],cA(g,c)),b);h=bE("batches/{name}:cancel",f._url),i=f._query,delete f._url,delete f._query,await this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(f),httpMethod:"POST",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal})}}async listInternal(a){var b,c,d,e;let f="",g={};if(this.apiClient.isVertexAI()){let d,e,h,i,j,k=(d={},null!=(e=bG(a,["config"]))&&(h=bG(e,["pageSize"]),void 0!==d&&null!=h&&bF(d,["_query","pageSize"],h),i=bG(e,["pageToken"]),void 0!==d&&null!=i&&bF(d,["_query","pageToken"],i),j=bG(e,["filter"]),void 0!==d&&null!=j&&bF(d,["_query","filter"],j)),d);return f=bE("batchPredictionJobs",k._url),g=k._query,delete k._url,delete k._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(k),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["nextPageToken"]);null!=d&&bF(b,["nextPageToken"],d);let e=bG(a,["batchPredictionJobs"]);if(null!=e){let a=e;Array.isArray(a)&&(a=a.map(a=>cD(a))),bF(b,["batchJobs"],a)}return b}(a),c=new b4;return Object.assign(c,b),c})}{let b,c,h=(b={},null!=(c=bG(a,["config"]))&&function(a,b){let c=bG(a,["pageSize"]);void 0!==b&&null!=c&&bF(b,["_query","pageSize"],c);let d=bG(a,["pageToken"]);if(void 0!==b&&null!=d&&bF(b,["_query","pageToken"],d),void 0!==bG(a,["filter"]))throw Error("filter parameter is not supported in Gemini API.")}(c,b),b);return f=bE("batches",h._url),g=h._query,delete h._url,delete h._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["nextPageToken"]);null!=d&&bF(b,["nextPageToken"],d);let e=bG(a,["operations"]);if(null!=e){let a=e;Array.isArray(a)&&(a=a.map(a=>cC(a))),bF(b,["batchJobs"],a)}return b}(a),c=new b4;return Object.assign(c,b),c})}}async delete(a){var b,c,d,e,f,g;let h="",i={};if(this.apiClient.isVertexAI()){let d,e,g=(f=this.apiClient,d={},null!=(e=bG(a,["name"]))&&bF(d,["_url","name"],cA(f,e)),d);return h=bE("batchPredictionJobs/{name}",g._url),i=g._query,delete g._url,delete g._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b,c,d,e,f;return b={},null!=(c=bG(a,["sdkHttpResponse"]))&&bF(b,["sdkHttpResponse"],c),null!=(d=bG(a,["name"]))&&bF(b,["name"],d),null!=(e=bG(a,["done"]))&&bF(b,["done"],e),null!=(f=bG(a,["error"]))&&bF(b,["error"],f),b})}{let b,c,f=(g=this.apiClient,b={},null!=(c=bG(a,["name"]))&&bF(b,["_url","name"],cA(g,c)),b);return h=bE("batches/{name}",f._url),i=f._query,delete f._url,delete f._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b,c,d,e,f;return b={},null!=(c=bG(a,["sdkHttpResponse"]))&&bF(b,["sdkHttpResponse"],c),null!=(d=bG(a,["name"]))&&bF(b,["name"],d),null!=(e=bG(a,["done"]))&&bF(b,["done"],e),null!=(f=bG(a,["error"]))&&bF(b,["error"],f),b})}}}function cI(a){let b={},c=bG(a,["parts"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>{var b;let c,d,e,f,g,h,i,j,k,l,m;return c={},null!=(d=bG(b=a,["functionCall"]))&&bF(c,["functionCall"],d),null!=(e=bG(b,["codeExecutionResult"]))&&bF(c,["codeExecutionResult"],e),null!=(f=bG(b,["executableCode"]))&&bF(c,["executableCode"],f),null!=(g=bG(b,["fileData"]))&&bF(c,["fileData"],function(a){let b={};if(void 0!==bG(a,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let c=bG(a,["fileUri"]);null!=c&&bF(b,["fileUri"],c);let d=bG(a,["mimeType"]);return null!=d&&bF(b,["mimeType"],d),b}(g)),null!=(h=bG(b,["functionResponse"]))&&bF(c,["functionResponse"],h),null!=(i=bG(b,["inlineData"]))&&bF(c,["inlineData"],function(a){let b={},c=bG(a,["data"]);if(null!=c&&bF(b,["data"],c),void 0!==bG(a,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let d=bG(a,["mimeType"]);return null!=d&&bF(b,["mimeType"],d),b}(i)),null!=(j=bG(b,["text"]))&&bF(c,["text"],j),null!=(k=bG(b,["thought"]))&&bF(c,["thought"],k),null!=(l=bG(b,["thoughtSignature"]))&&bF(c,["thoughtSignature"],l),null!=(m=bG(b,["videoMetadata"]))&&bF(c,["videoMetadata"],m),c})),bF(b,["parts"],a)}let d=bG(a,["role"]);return null!=d&&bF(b,["role"],d),b}class cJ extends bD{constructor(a){super(),this.apiClient=a,this.list=async(a={})=>new cG(bd.PAGED_ITEM_CACHED_CONTENTS,a=>this.listInternal(a),await this.listInternal(a),a)}async create(a){var b,c,d,e,f,g;let h="",i={};if(this.apiClient.isVertexAI()){let d,e,g,j=(f=this.apiClient,d={},null!=(e=bG(a,["model"]))&&bF(d,["model"],b9(f,e)),null!=(g=bG(a,["config"]))&&function(a,b){let c=bG(a,["ttl"]);void 0!==b&&null!=c&&bF(b,["ttl"],c);let d=bG(a,["expireTime"]);void 0!==b&&null!=d&&bF(b,["expireTime"],d);let e=bG(a,["displayName"]);void 0!==b&&null!=e&&bF(b,["displayName"],e);let f=bG(a,["contents"]);if(void 0!==b&&null!=f){let a=cl(f);Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["contents"],a)}let g=bG(a,["systemInstruction"]);void 0!==b&&null!=g&&bF(b,["systemInstruction"],cj(g));let h=bG(a,["tools"]);if(void 0!==b&&null!=h){let a=h;Array.isArray(a)&&(a=a.map(a=>(function(a){let b={},c=bG(a,["functionDeclarations"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>(function(a){let b={};if(void 0!==bG(a,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let c=bG(a,["description"]);null!=c&&bF(b,["description"],c);let d=bG(a,["name"]);null!=d&&bF(b,["name"],d);let e=bG(a,["parameters"]);null!=e&&bF(b,["parameters"],e);let f=bG(a,["parametersJsonSchema"]);null!=f&&bF(b,["parametersJsonSchema"],f);let g=bG(a,["response"]);null!=g&&bF(b,["response"],g);let h=bG(a,["responseJsonSchema"]);return null!=h&&bF(b,["responseJsonSchema"],h),b})(a))),bF(b,["functionDeclarations"],a)}let d=bG(a,["retrieval"]);null!=d&&bF(b,["retrieval"],d);let e=bG(a,["googleSearchRetrieval"]);null!=e&&bF(b,["googleSearchRetrieval"],e);let f=bG(a,["computerUse"]);if(null!=f&&bF(b,["computerUse"],f),void 0!==bG(a,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let g=bG(a,["codeExecution"]);null!=g&&bF(b,["codeExecution"],g);let h=bG(a,["enterpriseWebSearch"]);null!=h&&bF(b,["enterpriseWebSearch"],h);let i=bG(a,["googleMaps"]);null!=i&&bF(b,["googleMaps"],i);let j=bG(a,["googleSearch"]);null!=j&&bF(b,["googleSearch"],j);let k=bG(a,["urlContext"]);return null!=k&&bF(b,["urlContext"],k),b})(a))),bF(b,["tools"],a)}let i=bG(a,["toolConfig"]);void 0!==b&&null!=i&&bF(b,["toolConfig"],i);let j=bG(a,["kmsKeyName"]);void 0!==b&&null!=j&&bF(b,["encryption_spec","kmsKeyName"],j)}(g,d),d);return h=bE("cachedContents",j._url),i=j._query,delete j._url,delete j._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(j),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>a)}{let b,c,f,j=(g=this.apiClient,b={},null!=(c=bG(a,["model"]))&&bF(b,["model"],b9(g,c)),null!=(f=bG(a,["config"]))&&function(a,b){let c=bG(a,["ttl"]);void 0!==b&&null!=c&&bF(b,["ttl"],c);let d=bG(a,["expireTime"]);void 0!==b&&null!=d&&bF(b,["expireTime"],d);let e=bG(a,["displayName"]);void 0!==b&&null!=e&&bF(b,["displayName"],e);let f=bG(a,["contents"]);if(void 0!==b&&null!=f){let a=cl(f);Array.isArray(a)&&(a=a.map(a=>cI(a))),bF(b,["contents"],a)}let g=bG(a,["systemInstruction"]);void 0!==b&&null!=g&&bF(b,["systemInstruction"],cI(cj(g)));let h=bG(a,["tools"]);if(void 0!==b&&null!=h){let a=h;Array.isArray(a)&&(a=a.map(a=>(function(a){let b={},c=bG(a,["functionDeclarations"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["functionDeclarations"],a)}if(void 0!==bG(a,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let d=bG(a,["googleSearchRetrieval"]);null!=d&&bF(b,["googleSearchRetrieval"],d);let e=bG(a,["computerUse"]);null!=e&&bF(b,["computerUse"],e);let f=bG(a,["fileSearch"]);null!=f&&bF(b,["fileSearch"],f);let g=bG(a,["codeExecution"]);if(null!=g&&bF(b,["codeExecution"],g),void 0!==bG(a,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let h=bG(a,["googleMaps"]);null!=h&&bF(b,["googleMaps"],function(a){let b={};if(void 0!==bG(a,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let c=bG(a,["enableWidget"]);return null!=c&&bF(b,["enableWidget"],c),b}(h));let i=bG(a,["googleSearch"]);null!=i&&bF(b,["googleSearch"],function(a){let b={};if(void 0!==bG(a,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==bG(a,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let c=bG(a,["timeRangeFilter"]);return null!=c&&bF(b,["timeRangeFilter"],c),b}(i));let j=bG(a,["urlContext"]);return null!=j&&bF(b,["urlContext"],j),b})(a))),bF(b,["tools"],a)}let i=bG(a,["toolConfig"]);if(void 0!==b&&null!=i&&bF(b,["toolConfig"],i),void 0!==bG(a,["kmsKeyName"]))throw Error("kmsKeyName parameter is not supported in Gemini API.")}(f,b),b);return h=bE("cachedContents",j._url),i=j._query,delete j._url,delete j._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(j),httpMethod:"POST",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json()).then(a=>a)}}async get(a){var b,c,d,e,f,g;let h="",i={};if(this.apiClient.isVertexAI()){let d,e,g=(f=this.apiClient,d={},null!=(e=bG(a,["name"]))&&bF(d,["_url","name"],cr(f,e)),d);return h=bE("{name}",g._url),i=g._query,delete g._url,delete g._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(g),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>a)}{let b,c,f=(g=this.apiClient,b={},null!=(c=bG(a,["name"]))&&bF(b,["_url","name"],cr(g,c)),b);return h=bE("{name}",f._url),i=f._query,delete f._url,delete f._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(f),httpMethod:"GET",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json()).then(a=>a)}}async delete(a){var b,c,d,e,f,g;let h="",i={};if(this.apiClient.isVertexAI()){let d,e,g=(f=this.apiClient,d={},null!=(e=bG(a,["name"]))&&bF(d,["_url","name"],cr(f,e)),d);return h=bE("{name}",g._url),i=g._query,delete g._url,delete g._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b,c,d=(b={},null!=(c=bG(a,["sdkHttpResponse"]))&&bF(b,["sdkHttpResponse"],c),b),e=new bX;return Object.assign(e,d),e})}{let b,c,f=(g=this.apiClient,b={},null!=(c=bG(a,["name"]))&&bF(b,["_url","name"],cr(g,c)),b);return h=bE("{name}",f._url),i=f._query,delete f._url,delete f._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b,c,d=(b={},null!=(c=bG(a,["sdkHttpResponse"]))&&bF(b,["sdkHttpResponse"],c),b),e=new bX;return Object.assign(e,d),e})}}async update(a){var b,c,d,e,f,g;let h="",i={};if(this.apiClient.isVertexAI()){let d,e,g,j,k,l=(f=this.apiClient,d={},null!=(e=bG(a,["name"]))&&bF(d,["_url","name"],cr(f,e)),null!=(g=bG(a,["config"]))&&(j=bG(g,["ttl"]),void 0!==d&&null!=j&&bF(d,["ttl"],j),k=bG(g,["expireTime"]),void 0!==d&&null!=k&&bF(d,["expireTime"],k)),d);return h=bE("{name}",l._url),i=l._query,delete l._url,delete l._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(l),httpMethod:"PATCH",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>a)}{let b,c,f,j,k,l=(g=this.apiClient,b={},null!=(c=bG(a,["name"]))&&bF(b,["_url","name"],cr(g,c)),null!=(f=bG(a,["config"]))&&(j=bG(f,["ttl"]),void 0!==b&&null!=j&&bF(b,["ttl"],j),k=bG(f,["expireTime"]),void 0!==b&&null!=k&&bF(b,["expireTime"],k)),b);return h=bE("{name}",l._url),i=l._query,delete l._url,delete l._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(l),httpMethod:"PATCH",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json()).then(a=>a)}}async listInternal(a){var b,c,d,e;let f="",g={};if(this.apiClient.isVertexAI()){let d,e,h,i,j=(d={},null!=(e=bG(a,["config"]))&&(h=bG(e,["pageSize"]),void 0!==d&&null!=h&&bF(d,["_query","pageSize"],h),i=bG(e,["pageToken"]),void 0!==d&&null!=i&&bF(d,["_query","pageToken"],i)),d);return f=bE("cachedContents",j._url),g=j._query,delete j._url,delete j._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(j),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["nextPageToken"]);null!=d&&bF(b,["nextPageToken"],d);let e=bG(a,["cachedContents"]);if(null!=e){let a=e;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["cachedContents"],a)}return b}(a),c=new bY;return Object.assign(c,b),c})}{let b,c,h,i,j=(b={},null!=(c=bG(a,["config"]))&&(h=bG(c,["pageSize"]),void 0!==b&&null!=h&&bF(b,["_query","pageSize"],h),i=bG(c,["pageToken"]),void 0!==b&&null!=i&&bF(b,["_query","pageToken"],i)),b);return f=bE("cachedContents",j._url),g=j._query,delete j._url,delete j._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(j),httpMethod:"GET",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["nextPageToken"]);null!=d&&bF(b,["nextPageToken"],d);let e=bG(a,["cachedContents"]);if(null!=e){let a=e;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["cachedContents"],a)}return b}(a),c=new bY;return Object.assign(c,b),c})}}}function cK(a){return this instanceof cK?(this.v=a,this):new cK(a)}function cL(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),g("next"),g("throw"),g("return",function(a){return function(b){return Promise.resolve(b).then(a,j)}}),d[Symbol.asyncIterator]=function(){return this},d;function g(a,b){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})},b&&(d[a]=b(d[a])))}function h(a,b){try{var c;(c=e[a](b)).value instanceof cK?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}function cM(a){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var b,c=a[Symbol.asyncIterator];return c?c.call(a):(a=function(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}(a),b={},d("next"),d("throw"),d("return"),b[Symbol.asyncIterator]=function(){return this},b);function d(c){b[c]=a[c]&&function(b){return new Promise(function(d,e){var f,g,h;f=d,g=e,h=(b=a[c](b)).done,Promise.resolve(b.value).then(function(a){f({value:a,done:h})},g)})}}}function cN(a){if(void 0===a.parts||0===a.parts.length)return!1;for(let b of a.parts)if(void 0===b||0===Object.keys(b).length)return!1;return!0}function cO(a){if(void 0===a||0===a.length)return[];let b=[],c=a.length,d=0;for(;d<c;)if("user"===a[d].role)b.push(a[d]),d++;else{let e=[],f=!0;for(;d<c&&"model"===a[d].role;)e.push(a[d]),f&&!cN(a[d])&&(f=!1),d++;f?b.push(...e):b.pop()}return b}"function"==typeof SuppressedError&&SuppressedError;class cP{constructor(a,b){this.modelsModule=a,this.apiClient=b}create(a){return new cQ(this.apiClient,this.modelsModule,a.model,a.config,structuredClone(a.history))}}class cQ{constructor(a,b,c,d={},e=[]){this.apiClient=a,this.modelsModule=b,this.model=c,this.config=d,this.history=e,this.sendPromise=Promise.resolve(),function(a){if(0!==a.length){for(let b of a)if("user"!==b.role&&"model"!==b.role)throw Error(`Role must be user or model, but got ${b.role}.`)}}(e)}async sendMessage(a){var b;await this.sendPromise;let c=cj(a.message),d=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(c),config:null!=(b=a.config)?b:this.config});return this.sendPromise=(async()=>{var a,b,e;let f=await d,g=null==(b=null==(a=f.candidates)?void 0:a[0])?void 0:b.content,h=f.automaticFunctionCallingHistory,i=this.getHistory(!0).length,j=[];null!=h&&(j=null!=(e=h.slice(i))?e:[]),this.recordHistory(c,g?[g]:[],j)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),d}async sendMessageStream(a){var b;await this.sendPromise;let c=cj(a.message),d=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(c),config:null!=(b=a.config)?b:this.config});this.sendPromise=d.then(()=>void 0).catch(()=>void 0);let e=await d;return this.processStreamResponse(e,c)}getHistory(a=!1){return structuredClone(a?cO(this.history):this.history)}processStreamResponse(a,b){var c,d;return cL(this,arguments,function*(){var e,f,g,h;let i=[];try{for(var j,k=!0,l=cM(a);!(e=(j=yield cK(l.next())).done);k=!0){if(h=j.value,k=!1,function(a){var b;if(void 0==a.candidates||0===a.candidates.length)return!1;let c=null==(b=a.candidates[0])?void 0:b.content;return void 0!==c&&cN(c)}(h)){let a=null==(d=null==(c=h.candidates)?void 0:c[0])?void 0:d.content;void 0!==a&&i.push(a)}yield yield cK(h)}}catch(a){f={error:a}}finally{try{!k&&!e&&(g=l.return)&&(yield cK(g.call(l)))}finally{if(f)throw f.error}}this.recordHistory(b,i)})}recordHistory(a,b,c){let d=[];b.length>0&&b.every(a=>void 0!==a.role)?d=b:d.push({role:"model",parts:[]}),c&&c.length>0?this.history.push(...cO(c)):this.history.push(a),this.history.push(...d)}}class cR extends Error{constructor(a){super(a.message),this.name="ApiError",this.status=a.status,Object.setPrototypeOf(this,cR.prototype)}}class cS extends bD{constructor(a){super(),this.apiClient=a,this.list=async(a={})=>new cG(bd.PAGED_ITEM_FILES,a=>this.listInternal(a),await this.listInternal(a),a)}async upload(a){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(a.file,a.config).then(a=>a)}async download(a){await this.apiClient.downloadFile(a)}async listInternal(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h,i,j=(f={},null!=(g=bG(a,["config"]))&&(h=bG(g,["pageSize"]),void 0!==f&&null!=h&&bF(f,["_query","pageSize"],h),i=bG(g,["pageToken"]),void 0!==f&&null!=i&&bF(f,["_query","pageToken"],i)),f);return d=bE("files",j._url),e=j._query,delete j._url,delete j._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(j),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["nextPageToken"]);null!=d&&bF(b,["nextPageToken"],d);let e=bG(a,["files"]);if(null!=e){let a=e;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["files"],a)}return b}(a),c=new b1;return Object.assign(c,b),c})}}async createInternal(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h=(f={},null!=(g=bG(a,["file"]))&&bF(f,["file"],g),f);return d=bE("upload/v1beta/files",h._url),e=h._query,delete h._url,delete h._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(h),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>{let b,c,d=(b={},null!=(c=bG(a,["sdkHttpResponse"]))&&bF(b,["sdkHttpResponse"],c),b),e=new b2;return Object.assign(e,d),e})}}async get(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h=(f={},null!=(g=bG(a,["name"]))&&bF(f,["_url","file"],cv(g)),f);return d=bE("files/{file}",h._url),e=h._query,delete h._url,delete h._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(h),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>a)}}async delete(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h=(f={},null!=(g=bG(a,["name"]))&&bF(f,["_url","file"],cv(g)),f);return d=bE("files/{file}",h._url),e=h._query,delete h._url,delete h._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b,c,d=(b={},null!=(c=bG(a,["sdkHttpResponse"]))&&bF(b,["sdkHttpResponse"],c),b),e=new b3;return Object.assign(e,d),e})}}}function cT(a){let b={},c=bG(a,["data"]);if(null!=c&&bF(b,["data"],c),void 0!==bG(a,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let d=bG(a,["mimeType"]);return null!=d&&bF(b,["mimeType"],d),b}function cU(a){let b={},c=bG(a,["languageCode"]);null!=c&&bF(b,["languageCode"],c);let d=bG(a,["voiceConfig"]);if(null!=d&&bF(b,["voiceConfig"],d),void 0!==bG(a,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return b}function cV(a){let b={},c=bG(a,["parts"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>{var b;let c,d,e,f,g,h,i,j,k,l,m;return c={},null!=(d=bG(b=a,["functionCall"]))&&bF(c,["functionCall"],d),null!=(e=bG(b,["codeExecutionResult"]))&&bF(c,["codeExecutionResult"],e),null!=(f=bG(b,["executableCode"]))&&bF(c,["executableCode"],f),null!=(g=bG(b,["fileData"]))&&bF(c,["fileData"],function(a){let b={};if(void 0!==bG(a,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let c=bG(a,["fileUri"]);null!=c&&bF(b,["fileUri"],c);let d=bG(a,["mimeType"]);return null!=d&&bF(b,["mimeType"],d),b}(g)),null!=(h=bG(b,["functionResponse"]))&&bF(c,["functionResponse"],h),null!=(i=bG(b,["inlineData"]))&&bF(c,["inlineData"],function(a){let b={},c=bG(a,["data"]);if(null!=c&&bF(b,["data"],c),void 0!==bG(a,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let d=bG(a,["mimeType"]);return null!=d&&bF(b,["mimeType"],d),b}(i)),null!=(j=bG(b,["text"]))&&bF(c,["text"],j),null!=(k=bG(b,["thought"]))&&bF(c,["thought"],k),null!=(l=bG(b,["thoughtSignature"]))&&bF(c,["thoughtSignature"],l),null!=(m=bG(b,["videoMetadata"]))&&bF(c,["videoMetadata"],m),c})),bF(b,["parts"],a)}let d=bG(a,["role"]);return null!=d&&bF(b,["role"],d),b}function cW(a,b){let c={},d=bG(b,["model"]);null!=d&&bF(c,["_url","model"],b8(a,d));let e=bG(b,["contents"]);if(null!=e){let a=cl(e);Array.isArray(a)&&(a=a.map(a=>cV(a))),bF(c,["contents"],a)}let f=bG(b,["config"]);return null!=f&&bF(c,["generationConfig"],function(a,b,c){let d={},e=bG(b,["systemInstruction"]);void 0!==c&&null!=e&&bF(c,["systemInstruction"],cV(cj(e)));let f=bG(b,["temperature"]);null!=f&&bF(d,["temperature"],f);let g=bG(b,["topP"]);null!=g&&bF(d,["topP"],g);let h=bG(b,["topK"]);null!=h&&bF(d,["topK"],h);let i=bG(b,["candidateCount"]);null!=i&&bF(d,["candidateCount"],i);let j=bG(b,["maxOutputTokens"]);null!=j&&bF(d,["maxOutputTokens"],j);let k=bG(b,["stopSequences"]);null!=k&&bF(d,["stopSequences"],k);let l=bG(b,["responseLogprobs"]);null!=l&&bF(d,["responseLogprobs"],l);let m=bG(b,["logprobs"]);null!=m&&bF(d,["logprobs"],m);let n=bG(b,["presencePenalty"]);null!=n&&bF(d,["presencePenalty"],n);let o=bG(b,["frequencyPenalty"]);null!=o&&bF(d,["frequencyPenalty"],o);let p=bG(b,["seed"]);null!=p&&bF(d,["seed"],p);let q=bG(b,["responseMimeType"]);null!=q&&bF(d,["responseMimeType"],q);let r=bG(b,["responseSchema"]);null!=r&&bF(d,["responseSchema"],cm(r));let s=bG(b,["responseJsonSchema"]);if(null!=s&&bF(d,["responseJsonSchema"],s),void 0!==bG(b,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==bG(b,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let t=bG(b,["safetySettings"]);if(void 0!==c&&null!=t){let a=t;Array.isArray(a)&&(a=a.map(a=>(function(a){let b={},c=bG(a,["category"]);if(null!=c&&bF(b,["category"],c),void 0!==bG(a,["method"]))throw Error("method parameter is not supported in Gemini API.");let d=bG(a,["threshold"]);return null!=d&&bF(b,["threshold"],d),b})(a))),bF(c,["safetySettings"],a)}let u=bG(b,["tools"]);if(void 0!==c&&null!=u){let a=cq(u);Array.isArray(a)&&(a=a.map(a=>(function(a){let b={},c=bG(a,["functionDeclarations"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["functionDeclarations"],a)}if(void 0!==bG(a,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let d=bG(a,["googleSearchRetrieval"]);null!=d&&bF(b,["googleSearchRetrieval"],d);let e=bG(a,["computerUse"]);null!=e&&bF(b,["computerUse"],e);let f=bG(a,["fileSearch"]);null!=f&&bF(b,["fileSearch"],f);let g=bG(a,["codeExecution"]);if(null!=g&&bF(b,["codeExecution"],g),void 0!==bG(a,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let h=bG(a,["googleMaps"]);null!=h&&bF(b,["googleMaps"],function(a){let b={};if(void 0!==bG(a,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let c=bG(a,["enableWidget"]);return null!=c&&bF(b,["enableWidget"],c),b}(h));let i=bG(a,["googleSearch"]);null!=i&&bF(b,["googleSearch"],function(a){let b={};if(void 0!==bG(a,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==bG(a,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let c=bG(a,["timeRangeFilter"]);return null!=c&&bF(b,["timeRangeFilter"],c),b}(i));let j=bG(a,["urlContext"]);return null!=j&&bF(b,["urlContext"],j),b})(cp(a)))),bF(c,["tools"],a)}let v=bG(b,["toolConfig"]);if(void 0!==c&&null!=v&&bF(c,["toolConfig"],v),void 0!==bG(b,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let w=bG(b,["cachedContent"]);void 0!==c&&null!=w&&bF(c,["cachedContent"],cr(a,w));let x=bG(b,["responseModalities"]);null!=x&&bF(d,["responseModalities"],x);let y=bG(b,["mediaResolution"]);null!=y&&bF(d,["mediaResolution"],y);let z=bG(b,["speechConfig"]);if(null!=z&&bF(d,["speechConfig"],cn(z)),void 0!==bG(b,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let A=bG(b,["thinkingConfig"]);null!=A&&bF(d,["thinkingConfig"],A);let B=bG(b,["imageConfig"]);return null!=B&&bF(d,["imageConfig"],B),d}(a,f,c)),c}function cX(a,b){let c={},d=bG(b,["model"]);null!=d&&bF(c,["_url","model"],b8(a,d));let e=bG(b,["contents"]);if(null!=e){let a=cl(e);Array.isArray(a)&&(a=a.map(a=>a)),bF(c,["contents"],a)}let f=bG(b,["config"]);return null!=f&&bF(c,["generationConfig"],function(a,b,c){let d={},e=bG(b,["systemInstruction"]);void 0!==c&&null!=e&&bF(c,["systemInstruction"],cj(e));let f=bG(b,["temperature"]);null!=f&&bF(d,["temperature"],f);let g=bG(b,["topP"]);null!=g&&bF(d,["topP"],g);let h=bG(b,["topK"]);null!=h&&bF(d,["topK"],h);let i=bG(b,["candidateCount"]);null!=i&&bF(d,["candidateCount"],i);let j=bG(b,["maxOutputTokens"]);null!=j&&bF(d,["maxOutputTokens"],j);let k=bG(b,["stopSequences"]);null!=k&&bF(d,["stopSequences"],k);let l=bG(b,["responseLogprobs"]);null!=l&&bF(d,["responseLogprobs"],l);let m=bG(b,["logprobs"]);null!=m&&bF(d,["logprobs"],m);let n=bG(b,["presencePenalty"]);null!=n&&bF(d,["presencePenalty"],n);let o=bG(b,["frequencyPenalty"]);null!=o&&bF(d,["frequencyPenalty"],o);let p=bG(b,["seed"]);null!=p&&bF(d,["seed"],p);let q=bG(b,["responseMimeType"]);null!=q&&bF(d,["responseMimeType"],q);let r=bG(b,["responseSchema"]);null!=r&&bF(d,["responseSchema"],cm(r));let s=bG(b,["responseJsonSchema"]);null!=s&&bF(d,["responseJsonSchema"],s);let t=bG(b,["routingConfig"]);null!=t&&bF(d,["routingConfig"],t);let u=bG(b,["modelSelectionConfig"]);null!=u&&bF(d,["modelConfig"],u);let v=bG(b,["safetySettings"]);if(void 0!==c&&null!=v){let a=v;Array.isArray(a)&&(a=a.map(a=>a)),bF(c,["safetySettings"],a)}let w=bG(b,["tools"]);if(void 0!==c&&null!=w){let a=cq(w);Array.isArray(a)&&(a=a.map(a=>c7(cp(a)))),bF(c,["tools"],a)}let x=bG(b,["toolConfig"]);void 0!==c&&null!=x&&bF(c,["toolConfig"],x);let y=bG(b,["labels"]);void 0!==c&&null!=y&&bF(c,["labels"],y);let z=bG(b,["cachedContent"]);void 0!==c&&null!=z&&bF(c,["cachedContent"],cr(a,z));let A=bG(b,["responseModalities"]);null!=A&&bF(d,["responseModalities"],A);let B=bG(b,["mediaResolution"]);null!=B&&bF(d,["mediaResolution"],B);let C=bG(b,["speechConfig"]);null!=C&&bF(d,["speechConfig"],c6(cn(C)));let D=bG(b,["audioTimestamp"]);null!=D&&bF(d,["audioTimestamp"],D);let E=bG(b,["thinkingConfig"]);null!=E&&bF(d,["thinkingConfig"],E);let F=bG(b,["imageConfig"]);return null!=F&&bF(d,["imageConfig"],F),d}(a,f,c)),c}function cY(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["candidates"]);if(null!=d){let a=d;Array.isArray(a)&&(a=a.map(a=>(function(a){let b={},c=bG(a,["content"]);null!=c&&bF(b,["content"],c);let d=bG(a,["citationMetadata"]);null!=d&&bF(b,["citationMetadata"],function(a){let b={},c=bG(a,["citationSources"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["citations"],a)}return b}(d));let e=bG(a,["tokenCount"]);null!=e&&bF(b,["tokenCount"],e);let f=bG(a,["finishReason"]);null!=f&&bF(b,["finishReason"],f);let g=bG(a,["avgLogprobs"]);null!=g&&bF(b,["avgLogprobs"],g);let h=bG(a,["groundingMetadata"]);null!=h&&bF(b,["groundingMetadata"],h);let i=bG(a,["index"]);null!=i&&bF(b,["index"],i);let j=bG(a,["logprobsResult"]);null!=j&&bF(b,["logprobsResult"],j);let k=bG(a,["safetyRatings"]);if(null!=k){let a=k;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["safetyRatings"],a)}let l=bG(a,["urlContextMetadata"]);return null!=l&&bF(b,["urlContextMetadata"],l),b})(a))),bF(b,["candidates"],a)}let e=bG(a,["modelVersion"]);null!=e&&bF(b,["modelVersion"],e);let f=bG(a,["promptFeedback"]);null!=f&&bF(b,["promptFeedback"],f);let g=bG(a,["responseId"]);null!=g&&bF(b,["responseId"],g);let h=bG(a,["usageMetadata"]);return null!=h&&bF(b,["usageMetadata"],h),b}function cZ(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["candidates"]);if(null!=d){let a=d;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["candidates"],a)}let e=bG(a,["createTime"]);null!=e&&bF(b,["createTime"],e);let f=bG(a,["modelVersion"]);null!=f&&bF(b,["modelVersion"],f);let g=bG(a,["promptFeedback"]);null!=g&&bF(b,["promptFeedback"],g);let h=bG(a,["responseId"]);null!=h&&bF(b,["responseId"],h);let i=bG(a,["usageMetadata"]);return null!=i&&bF(b,["usageMetadata"],i),b}function c$(a){let b={},c=bG(a,["_self"]);null!=c&&bF(b,["image"],c_(c));let d=bG(a,["raiFilteredReason"]);null!=d&&bF(b,["raiFilteredReason"],d);let e=bG(a,["_self"]);null!=e&&bF(b,["safetyAttributes"],c5(e));let f=bG(a,["prompt"]);return null!=f&&bF(b,["enhancedPrompt"],f),b}function c_(a){let b={},c=bG(a,["gcsUri"]);null!=c&&bF(b,["gcsUri"],c);let d=bG(a,["bytesBase64Encoded"]);null!=d&&bF(b,["imageBytes"],bH(d));let e=bG(a,["mimeType"]);return null!=e&&bF(b,["mimeType"],e),b}function c0(a){let b={};if(void 0!==bG(a,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let c=bG(a,["imageBytes"]);null!=c&&bF(b,["bytesBase64Encoded"],bH(c));let d=bG(a,["mimeType"]);return null!=d&&bF(b,["mimeType"],d),b}function c1(a){let b={},c=bG(a,["gcsUri"]);null!=c&&bF(b,["gcsUri"],c);let d=bG(a,["imageBytes"]);null!=d&&bF(b,["bytesBase64Encoded"],bH(d));let e=bG(a,["mimeType"]);return null!=e&&bF(b,["mimeType"],e),b}function c2(a){var b;let c,d,e,f,g={},h=bG(a,["name"]);null!=h&&bF(g,["name"],h);let i=bG(a,["displayName"]);null!=i&&bF(g,["displayName"],i);let j=bG(a,["description"]);null!=j&&bF(g,["description"],j);let k=bG(a,["version"]);null!=k&&bF(g,["version"],k);let l=bG(a,["_self"]);null!=l&&bF(g,["tunedModelInfo"],(c={},null!=(d=bG(b=l,["baseModel"]))&&bF(c,["baseModel"],d),null!=(e=bG(b,["createTime"]))&&bF(c,["createTime"],e),null!=(f=bG(b,["updateTime"]))&&bF(c,["updateTime"],f),c));let m=bG(a,["inputTokenLimit"]);null!=m&&bF(g,["inputTokenLimit"],m);let n=bG(a,["outputTokenLimit"]);null!=n&&bF(g,["outputTokenLimit"],n);let o=bG(a,["supportedGenerationMethods"]);null!=o&&bF(g,["supportedActions"],o);let p=bG(a,["temperature"]);null!=p&&bF(g,["temperature"],p);let q=bG(a,["maxTemperature"]);null!=q&&bF(g,["maxTemperature"],q);let r=bG(a,["topP"]);null!=r&&bF(g,["topP"],r);let s=bG(a,["topK"]);null!=s&&bF(g,["topK"],s);let t=bG(a,["thinking"]);return null!=t&&bF(g,["thinking"],t),g}function c3(a){var b;let c,d,e,f,g={},h=bG(a,["name"]);null!=h&&bF(g,["name"],h);let i=bG(a,["displayName"]);null!=i&&bF(g,["displayName"],i);let j=bG(a,["description"]);null!=j&&bF(g,["description"],j);let k=bG(a,["versionId"]);null!=k&&bF(g,["version"],k);let l=bG(a,["deployedModels"]);if(null!=l){let a=l;Array.isArray(a)&&(a=a.map(a=>{let b,c,d;return b={},null!=(c=bG(a,["endpoint"]))&&bF(b,["name"],c),null!=(d=bG(a,["deployedModelId"]))&&bF(b,["deployedModelId"],d),b})),bF(g,["endpoints"],a)}let m=bG(a,["labels"]);null!=m&&bF(g,["labels"],m);let n=bG(a,["_self"]);null!=n&&bF(g,["tunedModelInfo"],(c={},null!=(d=bG(b=n,["labels","google-vertex-llm-tuning-base-model-id"]))&&bF(c,["baseModel"],d),null!=(e=bG(b,["createTime"]))&&bF(c,["createTime"],e),null!=(f=bG(b,["updateTime"]))&&bF(c,["updateTime"],f),c));let o=bG(a,["defaultCheckpointId"]);null!=o&&bF(g,["defaultCheckpointId"],o);let p=bG(a,["checkpoints"]);if(null!=p){let a=p;Array.isArray(a)&&(a=a.map(a=>a)),bF(g,["checkpoints"],a)}return g}function c4(a){let b={},c=bG(a,["safetyAttributes","categories"]);null!=c&&bF(b,["categories"],c);let d=bG(a,["safetyAttributes","scores"]);null!=d&&bF(b,["scores"],d);let e=bG(a,["contentType"]);return null!=e&&bF(b,["contentType"],e),b}function c5(a){let b={},c=bG(a,["safetyAttributes","categories"]);null!=c&&bF(b,["categories"],c);let d=bG(a,["safetyAttributes","scores"]);null!=d&&bF(b,["scores"],d);let e=bG(a,["contentType"]);return null!=e&&bF(b,["contentType"],e),b}function c6(a){let b={},c=bG(a,["languageCode"]);null!=c&&bF(b,["languageCode"],c);let d=bG(a,["voiceConfig"]);if(null!=d&&bF(b,["voiceConfig"],d),void 0!==bG(a,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return b}function c7(a){let b={},c=bG(a,["functionDeclarations"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>(function(a){let b={};if(void 0!==bG(a,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let c=bG(a,["description"]);null!=c&&bF(b,["description"],c);let d=bG(a,["name"]);null!=d&&bF(b,["name"],d);let e=bG(a,["parameters"]);null!=e&&bF(b,["parameters"],e);let f=bG(a,["parametersJsonSchema"]);null!=f&&bF(b,["parametersJsonSchema"],f);let g=bG(a,["response"]);null!=g&&bF(b,["response"],g);let h=bG(a,["responseJsonSchema"]);return null!=h&&bF(b,["responseJsonSchema"],h),b})(a))),bF(b,["functionDeclarations"],a)}let d=bG(a,["retrieval"]);null!=d&&bF(b,["retrieval"],d);let e=bG(a,["googleSearchRetrieval"]);null!=e&&bF(b,["googleSearchRetrieval"],e);let f=bG(a,["computerUse"]);if(null!=f&&bF(b,["computerUse"],f),void 0!==bG(a,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let g=bG(a,["codeExecution"]);null!=g&&bF(b,["codeExecution"],g);let h=bG(a,["enterpriseWebSearch"]);null!=h&&bF(b,["enterpriseWebSearch"],h);let i=bG(a,["googleMaps"]);null!=i&&bF(b,["googleMaps"],i);let j=bG(a,["googleSearch"]);null!=j&&bF(b,["googleSearch"],j);let k=bG(a,["urlContext"]);return null!=k&&bF(b,["urlContext"],k),b}function c8(a){let b={},c=bG(a,["uri"]);null!=c&&bF(b,["uri"],c);let d=bG(a,["videoBytes"]);null!=d&&bF(b,["encodedVideo"],bH(d));let e=bG(a,["mimeType"]);return null!=e&&bF(b,["encoding"],e),b}function c9(a){let b={},c=bG(a,["uri"]);null!=c&&bF(b,["gcsUri"],c);let d=bG(a,["videoBytes"]);null!=d&&bF(b,["bytesBase64Encoded"],bH(d));let e=bG(a,["mimeType"]);return null!=e&&bF(b,["mimeType"],e),b}let da="x-goog-api-client",db=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class dc{constructor(a){var b,c;this.clientOptions=Object.assign(Object.assign({},a),{project:a.project,location:a.location,apiKey:a.apiKey,vertexai:a.vertexai});const d={};this.clientOptions.vertexai?(d.apiVersion=null!=(b=this.clientOptions.apiVersion)?b:"v1beta1",d.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(d.apiVersion=null!=(c=this.clientOptions.apiVersion)?c:"v1beta",d.baseUrl="https://generativelanguage.googleapis.com/"),d.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=d,a.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(d,a.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&"global"!==this.clientOptions.location?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var a;return null!=(a=this.clientOptions.vertexai)&&a}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw Error("Headers are not set.")}getRequestUrlInternal(a){if(!a||void 0===a.baseUrl||void 0===a.apiVersion)throw Error("HTTP options are not correctly set.");let b=[a.baseUrl.endsWith("/")?a.baseUrl.slice(0,-1):a.baseUrl];return a.apiVersion&&""!==a.apiVersion&&b.push(a.apiVersion),b.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let a=new URL(this.getBaseUrl());return a.protocol="http:"==a.protocol?"ws":"wss",a.toString()}setBaseUrl(a){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=a;else throw Error("HTTP options are not correctly set.")}constructUrl(a,b,c){let d=[this.getRequestUrlInternal(b)];return c&&d.push(this.getBaseResourcePath()),""!==a&&d.push(a),new URL(`${d.join("/")}`)}shouldPrependVertexProjectPath(a){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||a.path.startsWith("projects/")||"GET"===a.httpMethod&&a.path.startsWith("publishers/google/models"))}async request(a){let b=this.clientOptions.httpOptions;a.httpOptions&&(b=this.patchHttpOptions(this.clientOptions.httpOptions,a.httpOptions));let c=this.shouldPrependVertexProjectPath(a),d=this.constructUrl(a.path,b,c);if(a.queryParams)for(let[b,c]of Object.entries(a.queryParams))d.searchParams.append(b,String(c));let e={};if("GET"===a.httpMethod){if(a.body&&"{}"!==a.body)throw Error("Request body should be empty for GET request, but got non empty request body")}else e.body=a.body;return e=await this.includeExtraHttpOptionsToRequestInit(e,b,d.toString(),a.abortSignal),this.unaryApiCall(d,e,a.httpMethod)}patchHttpOptions(a,b){let c=JSON.parse(JSON.stringify(a));for(let[a,d]of Object.entries(b))"object"==typeof d?c[a]=Object.assign(Object.assign({},c[a]),d):void 0!==d&&(c[a]=d);return c}async requestStream(a){let b=this.clientOptions.httpOptions;a.httpOptions&&(b=this.patchHttpOptions(this.clientOptions.httpOptions,a.httpOptions));let c=this.shouldPrependVertexProjectPath(a),d=this.constructUrl(a.path,b,c);d.searchParams.has("alt")&&"sse"===d.searchParams.get("alt")||d.searchParams.set("alt","sse");let e={};return e.body=a.body,e=await this.includeExtraHttpOptionsToRequestInit(e,b,d.toString(),a.abortSignal),this.streamApiCall(d,e,a.httpMethod)}async includeExtraHttpOptionsToRequestInit(a,b,c,d){if(b&&b.timeout||d){let c=new AbortController,e=c.signal;if(b.timeout&&(null==b?void 0:b.timeout)>0){let a=setTimeout(()=>c.abort(),b.timeout);a&&"function"==typeof a.unref&&a.unref()}d&&d.addEventListener("abort",()=>{c.abort()}),a.signal=e}return b&&null!==b.extraBody&&function(a,b){if(!b||0===Object.keys(b).length)return;if(a.body instanceof Blob)return console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");let c={};if("string"==typeof a.body&&a.body.length>0)try{let b=JSON.parse(a.body);if("object"!=typeof b||null===b||Array.isArray(b))return void console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");c=b}catch(a){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}a.body=JSON.stringify(function a(b,c){let d=Object.assign({},b);for(let b in c)if(Object.prototype.hasOwnProperty.call(c,b)){let e=c[b],f=d[b];e&&"object"==typeof e&&!Array.isArray(e)&&f&&"object"==typeof f&&!Array.isArray(f)?d[b]=a(f,e):(f&&e&&typeof f!=typeof e&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${b}". Original type: ${typeof f}, New type: ${typeof e}. Overwriting.`),d[b]=e)}return d}(c,b))}(a,b.extraBody),a.headers=await this.getHeadersInternal(b,c),a}async unaryApiCall(a,b,c){return this.apiCall(a.toString(),Object.assign(Object.assign({},b),{method:c})).then(async a=>(await dd(a),new bJ(a))).catch(a=>{if(a instanceof Error)throw a;throw Error(JSON.stringify(a))})}async streamApiCall(a,b,c){return this.apiCall(a.toString(),Object.assign(Object.assign({},b),{method:c})).then(async a=>(await dd(a),this.processStreamResponse(a))).catch(a=>{if(a instanceof Error)throw a;throw Error(JSON.stringify(a))})}processStreamResponse(a){var b;return cL(this,arguments,function*(){let c=null==(b=null==a?void 0:a.body)?void 0:b.getReader(),d=new TextDecoder("utf-8");if(!c)throw Error("Response body is empty");try{let b="";for(;;){let{done:e,value:f}=yield cK(c.read());if(e){if(b.trim().length>0)throw Error("Incomplete JSON segment at the end");break}let g=d.decode(f,{stream:!0});try{let a=JSON.parse(g);if("error"in a){let b=JSON.parse(JSON.stringify(a.error)),c=b.status,d=b.code,e=`got status: ${c}. ${JSON.stringify(a)}`;if(d>=400&&d<600)throw new cR({message:e,status:d})}}catch(a){if("ApiError"===a.name)throw a}let h=(b+=g).match(db);for(;h;){let c=h[1];try{let d=new Response(c,{headers:null==a?void 0:a.headers,status:null==a?void 0:a.status,statusText:null==a?void 0:a.statusText});yield yield cK(new bJ(d)),h=(b=b.slice(h[0].length)).match(db)}catch(a){throw Error(`exception parsing stream chunk ${c}. ${a}`)}}}}finally{c.releaseLock()}})}async apiCall(a,b){return fetch(a,b).catch(a=>{throw Error(`exception ${a} sending request`)})}getDefaultHeaders(){let a={},b="google-genai-sdk/1.29.1 "+this.clientOptions.userAgentExtra;return a["User-Agent"]=b,a[da]=b,a["Content-Type"]="application/json",a}async getHeadersInternal(a,b){let c=new Headers;if(a&&a.headers){for(let[b,d]of Object.entries(a.headers))c.append(b,d);a.timeout&&a.timeout>0&&c.append("X-Server-Timeout",String(Math.ceil(a.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(c,b),c}getFileName(a){var b;let c="";return"string"==typeof a&&(c=null!=(b=(c=a.replace(/[/\\]+$/,"")).split(/[/\\]/).pop())?b:""),c}async uploadFile(a,b){var c;let d={};null!=b&&(d.mimeType=b.mimeType,d.name=b.name,d.displayName=b.displayName),d.name&&!d.name.startsWith("files/")&&(d.name=`files/${d.name}`);let e=this.clientOptions.uploader,f=await e.stat(a);d.sizeBytes=String(f.size);let g=null!=(c=null==b?void 0:b.mimeType)?c:f.type;if(void 0===g||""===g)throw Error("Can not determine mimeType. Please provide mimeType in the config.");d.mimeType=g;let h={file:d},i=this.getFileName(a),j=bE("upload/v1beta/files",h._url),k=await this.fetchUploadUrl(j,d.sizeBytes,d.mimeType,i,h,null==b?void 0:b.httpOptions);return e.upload(a,k,this)}async uploadFileToFileSearchStore(a,b,c){var d;let e=this.clientOptions.uploader,f=await e.stat(b),g=String(f.size),h=null!=(d=null==c?void 0:c.mimeType)?d:f.type;if(void 0===h||""===h)throw Error("Can not determine mimeType. Please provide mimeType in the config.");let i=`upload/v1beta/${a}:uploadToFileSearchStore`,j=this.getFileName(b),k={};(null==c?void 0:c.customMetadata)&&(k.customMetadata=c.customMetadata),(null==c?void 0:c.chunkingConfig)&&(k.chunkingConfig=c.chunkingConfig);let l=await this.fetchUploadUrl(i,g,h,j,k,null==c?void 0:c.httpOptions);return e.uploadToFileSearchStore(b,l,this)}async downloadFile(a){let b=this.clientOptions.downloader;await b.download(a,this)}async fetchUploadUrl(a,b,c,d,e,f){var g;let h={};h=f||{apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${b}`,"X-Goog-Upload-Header-Content-Type":`${c}`},d?{"X-Goog-Upload-File-Name":d}:{})};let i=await this.request({path:a,body:JSON.stringify(e),httpMethod:"POST",httpOptions:h});if(!i||!(null==i?void 0:i.headers))throw Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let j=null==(g=null==i?void 0:i.headers)?void 0:g["x-goog-upload-url"];if(void 0===j)throw Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return j}}async function dd(a){var b;if(void 0===a)throw Error("response is undefined");if(!a.ok){let c=a.status,d=JSON.stringify((null==(b=a.headers.get("content-type"))?void 0:b.includes("application/json"))?await a.json():{error:{message:await a.text(),code:a.status,status:a.statusText}});if(c>=400&&c<600)throw new cR({message:d,status:c});throw Error(d)}}function de(a){for(let c of a){var b;if(null!==(b=c)&&"object"==typeof b&&b instanceof dg||"object"==typeof c&&"inputSchema"in c)return!0}return!1}function df(a){var b;let c=null!=(b=a[da])?b:"";a[da]=(c+" mcp_used/unknown").trimStart()}class dg{constructor(a=[],b){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=a,this.config=b}static create(a,b){return new dg(a,b)}async initialize(){var a,b,c,d;if(this.mcpTools.length>0)return;let e={},f=[];for(let j of this.mcpClients)try{for(var g,h=!0,i=(b=void 0,cM(function(a,b=100){return cL(this,arguments,function*(){let c,d=0;for(;d<b;){let b=yield cK(a.listTools({cursor:c}));for(let a of b.tools)yield yield cK(a),d++;if(!b.nextCursor)break;c=b.nextCursor}})}(j)));!(a=(g=await i.next()).done);h=!0){d=g.value,h=!1,f.push(d);let a=d.name;if(e[a])throw Error(`Duplicate function name ${a} found in MCP tools. Please ensure function names are unique.`);e[a]=j}}catch(a){b={error:a}}finally{try{!h&&!a&&(c=i.return)&&await c.call(i)}finally{if(b)throw b.error}}this.mcpTools=f,this.functionNameToMcpClient=e}async tool(){return await this.initialize(),function(a,b={}){let c=[],d=new Set;for(let e of a){let a=e.name;if(d.has(a))throw Error(`Duplicate function name ${a} found in MCP tools. Please ensure function names are unique.`);d.add(a);let f=function(a,b={}){let c={name:a.name,description:a.description,parametersJsonSchema:a.inputSchema};return a.outputSchema&&(c.responseJsonSchema=a.outputSchema),b.behavior&&(c.behavior=b.behavior),{functionDeclarations:[c]}}(e,b);f.functionDeclarations&&c.push(...f.functionDeclarations)}return{functionDeclarations:c}}(this.mcpTools,this.config)}async callTool(a){await this.initialize();let b=[];for(let c of a)if(c.name in this.functionNameToMcpClient){let a,d=this.functionNameToMcpClient[c.name];this.config.timeout&&(a={timeout:this.config.timeout});let e=await d.callTool({name:c.name,arguments:c.args},void 0,a);b.push({functionResponse:{name:c.name,response:e.isError?{error:e}:e}})}return b}}async function dh(a,b,c){let d=new b6;Object.assign(d,c.data instanceof Blob?JSON.parse(await c.data.text()):JSON.parse(c.data)),b(d)}class di{constructor(a,b,c){this.apiClient=a,this.auth=b,this.webSocketFactory=c}async connect(a){var b,c;let d;if(this.apiClient.isVertexAI())throw Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let e=this.apiClient.getWebsocketBaseUrl(),f=this.apiClient.getApiVersion(),g=function(a){let b=new Headers;for(let[c,d]of Object.entries(a))b.append(c,d);return b}(this.apiClient.getDefaultHeaders()),h=this.apiClient.getApiKey(),i=`${e}/ws/google.ai.generativelanguage.${f}.GenerativeService.BidiGenerateMusic?key=${h}`,j=()=>{},k=new Promise(a=>{j=a}),l=a.callbacks,m=this.apiClient,n={onopen:function(){j({})},onmessage:a=>{dh(m,l.onmessage,a)},onerror:null!=(b=null==l?void 0:l.onerror)?b:function(a){},onclose:null!=(c=null==l?void 0:l.onclose)?c:function(a){}},o=this.webSocketFactory.create(i,(d={},g.forEach((a,b)=>{d[b]=a}),d),n);o.connect(),await k;let p=b8(this.apiClient,a.model);return o.send(JSON.stringify({setup:{model:p}})),new dj(o,this.apiClient)}}class dj{constructor(a,b){this.conn=a,this.apiClient=b}async setWeightedPrompts(a){if(!a.weightedPrompts||0===Object.keys(a.weightedPrompts).length)throw Error("Weighted prompts must be set and contain at least one entry.");let b=function(a){let b={},c=bG(a,["weightedPrompts"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["weightedPrompts"],a)}return b}(a);this.conn.send(JSON.stringify({clientContent:b}))}async setMusicGenerationConfig(a){let b,c;a.musicGenerationConfig||(a.musicGenerationConfig={});let d=(b={},null!=(c=bG(a,["musicGenerationConfig"]))&&bF(b,["musicGenerationConfig"],c),b);this.conn.send(JSON.stringify(d))}sendPlaybackControl(a){this.conn.send(JSON.stringify({playbackControl:a}))}play(){this.sendPlaybackControl(bc.PLAY)}pause(){this.sendPlaybackControl(bc.PAUSE)}stop(){this.sendPlaybackControl(bc.STOP)}resetContext(){this.sendPlaybackControl(bc.RESET_CONTEXT)}close(){this.conn.close()}}async function dk(a,b,c){let d=new b5,e=JSON.parse(c.data instanceof Blob?await c.data.text():c.data instanceof ArrayBuffer?new TextDecoder().decode(c.data):c.data);if(a.isVertexAI()){let a,b,c,f,g,h,i,j;Object.assign(d,(a={},null!=(b=bG(e,["setupComplete"]))&&bF(a,["setupComplete"],b),null!=(c=bG(e,["serverContent"]))&&bF(a,["serverContent"],c),null!=(f=bG(e,["toolCall"]))&&bF(a,["toolCall"],f),null!=(g=bG(e,["toolCallCancellation"]))&&bF(a,["toolCallCancellation"],g),null!=(h=bG(e,["usageMetadata"]))&&bF(a,["usageMetadata"],function(a){let b={},c=bG(a,["promptTokenCount"]);null!=c&&bF(b,["promptTokenCount"],c);let d=bG(a,["cachedContentTokenCount"]);null!=d&&bF(b,["cachedContentTokenCount"],d);let e=bG(a,["candidatesTokenCount"]);null!=e&&bF(b,["responseTokenCount"],e);let f=bG(a,["toolUsePromptTokenCount"]);null!=f&&bF(b,["toolUsePromptTokenCount"],f);let g=bG(a,["thoughtsTokenCount"]);null!=g&&bF(b,["thoughtsTokenCount"],g);let h=bG(a,["totalTokenCount"]);null!=h&&bF(b,["totalTokenCount"],h);let i=bG(a,["promptTokensDetails"]);if(null!=i){let a=i;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["promptTokensDetails"],a)}let j=bG(a,["cacheTokensDetails"]);if(null!=j){let a=j;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["cacheTokensDetails"],a)}let k=bG(a,["candidatesTokensDetails"]);if(null!=k){let a=k;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["responseTokensDetails"],a)}let l=bG(a,["toolUsePromptTokensDetails"]);if(null!=l){let a=l;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["toolUsePromptTokensDetails"],a)}let m=bG(a,["trafficType"]);return null!=m&&bF(b,["trafficType"],m),b}(h)),null!=(i=bG(e,["goAway"]))&&bF(a,["goAway"],i),null!=(j=bG(e,["sessionResumptionUpdate"]))&&bF(a,["sessionResumptionUpdate"],j),a))}else Object.assign(d,e);b(d)}class dl{constructor(a,b,c){this.apiClient=a,this.auth=b,this.webSocketFactory=c,this.music=new di(this.apiClient,this.auth,this.webSocketFactory)}async connect(a){var b,c,d,e,f,g,h,i;let j,k;if(a.config&&a.config.httpOptions)throw Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),m=this.apiClient.getApiVersion(),n=this.apiClient.getHeaders();a.config&&a.config.tools&&de(a.config.tools)&&df(n);let o=function(a){let b=new Headers;for(let[c,d]of Object.entries(a))b.append(c,d);return b}(n);if(this.apiClient.isVertexAI())j=`${l}/ws/google.cloud.aiplatform.${m}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(o,j);else{let a=this.apiClient.getApiKey(),b="BidiGenerateContent",c="key";(null==a?void 0:a.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==m&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),b="BidiGenerateContentConstrained",c="access_token"),j=`${l}/ws/google.ai.generativelanguage.${m}.GenerativeService.${b}?${c}=${a}`}let p=()=>{},q=new Promise(a=>{p=a}),r=a.callbacks,s=this.apiClient,t={onopen:function(){var a;null==(a=null==r?void 0:r.onopen)||a.call(r),p({})},onmessage:a=>{dk(s,r.onmessage,a)},onerror:null!=(b=null==r?void 0:r.onerror)?b:function(a){},onclose:null!=(c=null==r?void 0:r.onclose)?c:function(a){}},u=this.webSocketFactory.create(j,(k={},o.forEach((a,b)=>{k[b]=a}),k),t);u.connect(),await q;let v=b8(this.apiClient,a.model);if(this.apiClient.isVertexAI()&&v.startsWith("publishers/")){let a=this.apiClient.getProject(),b=this.apiClient.getLocation();v=`projects/${a}/locations/${b}/`+v}let w={};this.apiClient.isVertexAI()&&(null==(d=a.config)?void 0:d.responseModalities)===void 0&&(void 0===a.config?a.config={responseModalities:[aG.AUDIO]}:a.config.responseModalities=[aG.AUDIO]),(null==(e=a.config)?void 0:e.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let x=null!=(g=null==(f=a.config)?void 0:f.tools)?g:[],y=[];for(let a of x)this.isCallableTool(a)?y.push(await a.tool()):y.push(a);y.length>0&&(a.config.tools=y);let z={model:v,config:a.config,callbacks:a.callbacks};if(this.apiClient.isVertexAI()){let a,b,c;h=this.apiClient,a={},null!=(b=bG(z,["model"]))&&bF(a,["setup","model"],b8(h,b)),null!=(c=bG(z,["config"]))&&bF(a,["config"],function(a,b){let c=bG(a,["generationConfig"]);void 0!==b&&null!=c&&bF(b,["setup","generationConfig"],function(a){let b={},c=bG(a,["modelSelectionConfig"]);null!=c&&bF(b,["modelConfig"],c);let d=bG(a,["responseJsonSchema"]);null!=d&&bF(b,["responseJsonSchema"],d);let e=bG(a,["audioTimestamp"]);null!=e&&bF(b,["audioTimestamp"],e);let f=bG(a,["candidateCount"]);null!=f&&bF(b,["candidateCount"],f);let g=bG(a,["enableAffectiveDialog"]);null!=g&&bF(b,["enableAffectiveDialog"],g);let h=bG(a,["frequencyPenalty"]);null!=h&&bF(b,["frequencyPenalty"],h);let i=bG(a,["logprobs"]);null!=i&&bF(b,["logprobs"],i);let j=bG(a,["maxOutputTokens"]);null!=j&&bF(b,["maxOutputTokens"],j);let k=bG(a,["mediaResolution"]);null!=k&&bF(b,["mediaResolution"],k);let l=bG(a,["presencePenalty"]);null!=l&&bF(b,["presencePenalty"],l);let m=bG(a,["responseLogprobs"]);null!=m&&bF(b,["responseLogprobs"],m);let n=bG(a,["responseMimeType"]);null!=n&&bF(b,["responseMimeType"],n);let o=bG(a,["responseModalities"]);null!=o&&bF(b,["responseModalities"],o);let p=bG(a,["responseSchema"]);null!=p&&bF(b,["responseSchema"],p);let q=bG(a,["routingConfig"]);null!=q&&bF(b,["routingConfig"],q);let r=bG(a,["seed"]);null!=r&&bF(b,["seed"],r);let s=bG(a,["speechConfig"]);null!=s&&bF(b,["speechConfig"],cU(s));let t=bG(a,["stopSequences"]);null!=t&&bF(b,["stopSequences"],t);let u=bG(a,["temperature"]);null!=u&&bF(b,["temperature"],u);let v=bG(a,["thinkingConfig"]);null!=v&&bF(b,["thinkingConfig"],v);let w=bG(a,["topK"]);null!=w&&bF(b,["topK"],w);let x=bG(a,["topP"]);if(null!=x&&bF(b,["topP"],x),void 0!==bG(a,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return b}(c));let d=bG(a,["responseModalities"]);void 0!==b&&null!=d&&bF(b,["setup","generationConfig","responseModalities"],d);let e=bG(a,["temperature"]);void 0!==b&&null!=e&&bF(b,["setup","generationConfig","temperature"],e);let f=bG(a,["topP"]);void 0!==b&&null!=f&&bF(b,["setup","generationConfig","topP"],f);let g=bG(a,["topK"]);void 0!==b&&null!=g&&bF(b,["setup","generationConfig","topK"],g);let h=bG(a,["maxOutputTokens"]);void 0!==b&&null!=h&&bF(b,["setup","generationConfig","maxOutputTokens"],h);let i=bG(a,["mediaResolution"]);void 0!==b&&null!=i&&bF(b,["setup","generationConfig","mediaResolution"],i);let j=bG(a,["seed"]);void 0!==b&&null!=j&&bF(b,["setup","generationConfig","seed"],j);let k=bG(a,["speechConfig"]);void 0!==b&&null!=k&&bF(b,["setup","generationConfig","speechConfig"],cU(co(k)));let l=bG(a,["thinkingConfig"]);void 0!==b&&null!=l&&bF(b,["setup","generationConfig","thinkingConfig"],l);let m=bG(a,["enableAffectiveDialog"]);void 0!==b&&null!=m&&bF(b,["setup","generationConfig","enableAffectiveDialog"],m);let n=bG(a,["systemInstruction"]);void 0!==b&&null!=n&&bF(b,["setup","systemInstruction"],cj(n));let o=bG(a,["tools"]);if(void 0!==b&&null!=o){let a=cq(o);Array.isArray(a)&&(a=a.map(a=>(function(a){let b={},c=bG(a,["functionDeclarations"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>(function(a){let b={};if(void 0!==bG(a,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let c=bG(a,["description"]);null!=c&&bF(b,["description"],c);let d=bG(a,["name"]);null!=d&&bF(b,["name"],d);let e=bG(a,["parameters"]);null!=e&&bF(b,["parameters"],e);let f=bG(a,["parametersJsonSchema"]);null!=f&&bF(b,["parametersJsonSchema"],f);let g=bG(a,["response"]);null!=g&&bF(b,["response"],g);let h=bG(a,["responseJsonSchema"]);return null!=h&&bF(b,["responseJsonSchema"],h),b})(a))),bF(b,["functionDeclarations"],a)}let d=bG(a,["retrieval"]);null!=d&&bF(b,["retrieval"],d);let e=bG(a,["googleSearchRetrieval"]);null!=e&&bF(b,["googleSearchRetrieval"],e);let f=bG(a,["computerUse"]);if(null!=f&&bF(b,["computerUse"],f),void 0!==bG(a,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let g=bG(a,["codeExecution"]);null!=g&&bF(b,["codeExecution"],g);let h=bG(a,["enterpriseWebSearch"]);null!=h&&bF(b,["enterpriseWebSearch"],h);let i=bG(a,["googleMaps"]);null!=i&&bF(b,["googleMaps"],i);let j=bG(a,["googleSearch"]);null!=j&&bF(b,["googleSearch"],j);let k=bG(a,["urlContext"]);return null!=k&&bF(b,["urlContext"],k),b})(cp(a)))),bF(b,["setup","tools"],a)}let p=bG(a,["sessionResumption"]);void 0!==b&&null!=p&&bF(b,["setup","sessionResumption"],p);let q=bG(a,["inputAudioTranscription"]);void 0!==b&&null!=q&&bF(b,["setup","inputAudioTranscription"],q);let r=bG(a,["outputAudioTranscription"]);void 0!==b&&null!=r&&bF(b,["setup","outputAudioTranscription"],r);let s=bG(a,["realtimeInputConfig"]);void 0!==b&&null!=s&&bF(b,["setup","realtimeInputConfig"],s);let t=bG(a,["contextWindowCompression"]);void 0!==b&&null!=t&&bF(b,["setup","contextWindowCompression"],t);let u=bG(a,["proactivity"]);return void 0!==b&&null!=u&&bF(b,["setup","proactivity"],u),{}}(c,a)),w=a}else{let a,b,c;i=this.apiClient,a={},null!=(b=bG(z,["model"]))&&bF(a,["setup","model"],b8(i,b)),null!=(c=bG(z,["config"]))&&bF(a,["config"],function(a,b){let c=bG(a,["generationConfig"]);void 0!==b&&null!=c&&bF(b,["setup","generationConfig"],c);let d=bG(a,["responseModalities"]);void 0!==b&&null!=d&&bF(b,["setup","generationConfig","responseModalities"],d);let e=bG(a,["temperature"]);void 0!==b&&null!=e&&bF(b,["setup","generationConfig","temperature"],e);let f=bG(a,["topP"]);void 0!==b&&null!=f&&bF(b,["setup","generationConfig","topP"],f);let g=bG(a,["topK"]);void 0!==b&&null!=g&&bF(b,["setup","generationConfig","topK"],g);let h=bG(a,["maxOutputTokens"]);void 0!==b&&null!=h&&bF(b,["setup","generationConfig","maxOutputTokens"],h);let i=bG(a,["mediaResolution"]);void 0!==b&&null!=i&&bF(b,["setup","generationConfig","mediaResolution"],i);let j=bG(a,["seed"]);void 0!==b&&null!=j&&bF(b,["setup","generationConfig","seed"],j);let k=bG(a,["speechConfig"]);void 0!==b&&null!=k&&bF(b,["setup","generationConfig","speechConfig"],co(k));let l=bG(a,["thinkingConfig"]);void 0!==b&&null!=l&&bF(b,["setup","generationConfig","thinkingConfig"],l);let m=bG(a,["enableAffectiveDialog"]);void 0!==b&&null!=m&&bF(b,["setup","generationConfig","enableAffectiveDialog"],m);let n=bG(a,["systemInstruction"]);void 0!==b&&null!=n&&bF(b,["setup","systemInstruction"],function(a){let b={},c=bG(a,["parts"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>{var b;let c,d,e,f,g,h,i,j,k,l,m;return c={},null!=(d=bG(b=a,["functionCall"]))&&bF(c,["functionCall"],d),null!=(e=bG(b,["codeExecutionResult"]))&&bF(c,["codeExecutionResult"],e),null!=(f=bG(b,["executableCode"]))&&bF(c,["executableCode"],f),null!=(g=bG(b,["fileData"]))&&bF(c,["fileData"],function(a){let b={};if(void 0!==bG(a,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let c=bG(a,["fileUri"]);null!=c&&bF(b,["fileUri"],c);let d=bG(a,["mimeType"]);return null!=d&&bF(b,["mimeType"],d),b}(g)),null!=(h=bG(b,["functionResponse"]))&&bF(c,["functionResponse"],h),null!=(i=bG(b,["inlineData"]))&&bF(c,["inlineData"],cT(i)),null!=(j=bG(b,["text"]))&&bF(c,["text"],j),null!=(k=bG(b,["thought"]))&&bF(c,["thought"],k),null!=(l=bG(b,["thoughtSignature"]))&&bF(c,["thoughtSignature"],l),null!=(m=bG(b,["videoMetadata"]))&&bF(c,["videoMetadata"],m),c})),bF(b,["parts"],a)}let d=bG(a,["role"]);return null!=d&&bF(b,["role"],d),b}(cj(n)));let o=bG(a,["tools"]);if(void 0!==b&&null!=o){let a=cq(o);Array.isArray(a)&&(a=a.map(a=>(function(a){let b={},c=bG(a,["functionDeclarations"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["functionDeclarations"],a)}if(void 0!==bG(a,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let d=bG(a,["googleSearchRetrieval"]);null!=d&&bF(b,["googleSearchRetrieval"],d);let e=bG(a,["computerUse"]);null!=e&&bF(b,["computerUse"],e);let f=bG(a,["fileSearch"]);null!=f&&bF(b,["fileSearch"],f);let g=bG(a,["codeExecution"]);if(null!=g&&bF(b,["codeExecution"],g),void 0!==bG(a,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let h=bG(a,["googleMaps"]);null!=h&&bF(b,["googleMaps"],function(a){let b={};if(void 0!==bG(a,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let c=bG(a,["enableWidget"]);return null!=c&&bF(b,["enableWidget"],c),b}(h));let i=bG(a,["googleSearch"]);null!=i&&bF(b,["googleSearch"],function(a){let b={};if(void 0!==bG(a,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==bG(a,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let c=bG(a,["timeRangeFilter"]);return null!=c&&bF(b,["timeRangeFilter"],c),b}(i));let j=bG(a,["urlContext"]);return null!=j&&bF(b,["urlContext"],j),b})(cp(a)))),bF(b,["setup","tools"],a)}let p=bG(a,["sessionResumption"]);void 0!==b&&null!=p&&bF(b,["setup","sessionResumption"],function(a){let b={},c=bG(a,["handle"]);if(null!=c&&bF(b,["handle"],c),void 0!==bG(a,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return b}(p));let q=bG(a,["inputAudioTranscription"]);void 0!==b&&null!=q&&bF(b,["setup","inputAudioTranscription"],q);let r=bG(a,["outputAudioTranscription"]);void 0!==b&&null!=r&&bF(b,["setup","outputAudioTranscription"],r);let s=bG(a,["realtimeInputConfig"]);void 0!==b&&null!=s&&bF(b,["setup","realtimeInputConfig"],s);let t=bG(a,["contextWindowCompression"]);void 0!==b&&null!=t&&bF(b,["setup","contextWindowCompression"],t);let u=bG(a,["proactivity"]);return void 0!==b&&null!=u&&bF(b,["setup","proactivity"],u),{}}(c,a)),w=a}return delete w.config,u.send(JSON.stringify(w)),new dn(u,this.apiClient)}isCallableTool(a){return"callTool"in a&&"function"==typeof a.callTool}}let dm={turnComplete:!0};class dn{constructor(a,b){this.conn=a,this.apiClient=b}tLiveClientContent(a,b){if(null!==b.turns&&void 0!==b.turns){let c=[];try{c=cl(b.turns),a.isVertexAI()||(c=c.map(a=>cV(a)))}catch(a){throw Error(`Failed to parse client content "turns", type: '${typeof b.turns}'`)}return{clientContent:{turns:c,turnComplete:b.turnComplete}}}return{clientContent:{turnComplete:b.turnComplete}}}tLiveClienttToolResponse(a,b){let c=[];if(null==b.functionResponses||0===(c=Array.isArray(b.functionResponses)?b.functionResponses:[b.functionResponses]).length)throw Error("functionResponses is required.");for(let b of c){if("object"!=typeof b||null===b||!("name"in b)||!("response"in b))throw Error(`Could not parse function response, type '${typeof b}'.`);if(!a.isVertexAI()&&!("id"in b))throw Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:c}}}sendClientContent(a){a=Object.assign(Object.assign({},dm),a);let b=this.tLiveClientContent(this.apiClient,a);this.conn.send(JSON.stringify(b))}sendRealtimeInput(a){let b={};b=this.apiClient.isVertexAI()?{realtimeInput:function(a){let b={},c=bG(a,["media"]);if(null!=c){let a=ca(c);Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["mediaChunks"],a)}let d=bG(a,["audio"]);null!=d&&bF(b,["audio"],cd(d));let e=bG(a,["audioStreamEnd"]);null!=e&&bF(b,["audioStreamEnd"],e);let f=bG(a,["video"]);null!=f&&bF(b,["video"],cc(f));let g=bG(a,["text"]);null!=g&&bF(b,["text"],g);let h=bG(a,["activityStart"]);null!=h&&bF(b,["activityStart"],h);let i=bG(a,["activityEnd"]);return null!=i&&bF(b,["activityEnd"],i),b}(a)}:{realtimeInput:function(a){let b={},c=bG(a,["media"]);if(null!=c){let a=ca(c);Array.isArray(a)&&(a=a.map(a=>cT(a))),bF(b,["mediaChunks"],a)}let d=bG(a,["audio"]);null!=d&&bF(b,["audio"],cT(cd(d)));let e=bG(a,["audioStreamEnd"]);null!=e&&bF(b,["audioStreamEnd"],e);let f=bG(a,["video"]);null!=f&&bF(b,["video"],cT(cc(f)));let g=bG(a,["text"]);null!=g&&bF(b,["text"],g);let h=bG(a,["activityStart"]);null!=h&&bF(b,["activityStart"],h);let i=bG(a,["activityEnd"]);return null!=i&&bF(b,["activityEnd"],i),b}(a)},this.conn.send(JSON.stringify(b))}sendToolResponse(a){if(null==a.functionResponses)throw Error("Tool response parameters are required.");let b=this.tLiveClienttToolResponse(this.apiClient,a);this.conn.send(JSON.stringify(b))}close(){this.conn.close()}}function dp(a){var b,c,d;if(null==(b=null==a?void 0:a.automaticFunctionCalling)?void 0:b.disable)return!0;let e=!1;for(let b of null!=(c=null==a?void 0:a.tools)?c:[])if(dq(b)){e=!0;break}if(!e)return!0;let f=null==(d=null==a?void 0:a.automaticFunctionCalling)?void 0:d.maximumRemoteCalls;return(!(!f||!(f<0)&&Number.isInteger(f))||0==f)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",f),!0)}function dq(a){return"callTool"in a&&"function"==typeof a.callTool}function dr(a){var b;let c=[];return(null==(b=null==a?void 0:a.config)?void 0:b.tools)&&a.config.tools.forEach((a,b)=>{dq(a)||a.functionDeclarations&&a.functionDeclarations.length>0&&c.push(b)}),c}function ds(a){var b;return!(null==(b=null==a?void 0:a.automaticFunctionCalling)?void 0:b.ignoreCallHistory)}class dt extends bD{constructor(a){super(),this.apiClient=a,this.generateContent=async a=>{var b,c,d,e,f,g,h,i;let j,k,l=await this.processParamsMaybeAddMcpUsage(a);if(this.maybeMoveToResponseJsonSchem(a),!(null!=(i=null==(h=null==(g=a.config)?void 0:g.tools)?void 0:h.some(a=>dq(a)))&&i)||dp(a.config))return await this.generateContentInternal(l);let m=dr(a);if(m.length>0){let a=m.map(a=>`tools[${a}]`).join(", ");throw Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${a}.`)}let n=cl(l.contents),o=null!=(d=null==(c=null==(b=l.config)?void 0:b.automaticFunctionCalling)?void 0:c.maximumRemoteCalls)?d:10,p=0;for(;p<o&&(j=await this.generateContentInternal(l)).functionCalls&&0!==j.functionCalls.length;){let b=j.candidates[0].content,c=[];for(let b of null!=(f=null==(e=a.config)?void 0:e.tools)?f:[])if(dq(b)){let a=await b.callTool(j.functionCalls);c.push(...a)}p++,k={role:"user",parts:c},l.contents=cl(l.contents),l.contents.push(b),l.contents.push(k),ds(l.config)&&(n.push(b),n.push(k))}return ds(l.config)&&(j.automaticFunctionCallingHistory=n),j},this.generateContentStream=async a=>{if(this.maybeMoveToResponseJsonSchem(a),dp(a.config)){let b=await this.processParamsMaybeAddMcpUsage(a);return await this.generateContentStreamInternal(b)}let b=dr(a);if(b.length>0){let a=b.map(a=>`tools[${a}]`).join(", ");throw Error(`Incompatible tools found at ${a}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}return await this.processAfcStream(a)},this.generateImages=async a=>await this.generateImagesInternal(a).then(a=>{var b;let c,d=[];if(null==a?void 0:a.generatedImages)for(let e of a.generatedImages)e&&(null==e?void 0:e.safetyAttributes)&&(null==(b=null==e?void 0:e.safetyAttributes)?void 0:b.contentType)==="Positive Prompt"?c=null==e?void 0:e.safetyAttributes:d.push(e);return c?{generatedImages:d,positivePromptSafetyAttributes:c,sdkHttpResponse:a.sdkHttpResponse}:{generatedImages:d,sdkHttpResponse:a.sdkHttpResponse}}),this.list=async a=>{var b;let c={config:Object.assign(Object.assign({},{queryBase:!0}),null==a?void 0:a.config)};if(this.apiClient.isVertexAI()&&!c.config.queryBase)if(null==(b=c.config)?void 0:b.filter)throw Error("Filtering tuned models list for Vertex AI is not currently supported");else c.config.filter="labels.tune-type:*";return new cG(bd.PAGED_ITEM_MODELS,a=>this.listInternal(a),await this.listInternal(c),c)},this.editImage=async a=>{let b={model:a.model,prompt:a.prompt,referenceImages:[],config:a.config};return a.referenceImages&&a.referenceImages&&(b.referenceImages=a.referenceImages.map(a=>a.toReferenceImageAPI())),await this.editImageInternal(b)},this.upscaleImage=async a=>{let b={numberOfImages:1,mode:"upscale"};a.config&&(b=Object.assign(Object.assign({},b),a.config));let c={model:a.model,image:a.image,upscaleFactor:a.upscaleFactor,config:b};return await this.upscaleImageInternal(c)},this.generateVideos=async a=>{var b,c,d,e,f,g;if((a.prompt||a.image||a.video)&&a.source)throw Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return!this.apiClient.isVertexAI()&&((null==(b=a.video)?void 0:b.uri)&&(null==(c=a.video)?void 0:c.videoBytes)?a.video={uri:a.video.uri,mimeType:a.video.mimeType}:(null==(e=null==(d=a.source)?void 0:d.video)?void 0:e.uri)&&(null==(g=null==(f=a.source)?void 0:f.video)?void 0:g.videoBytes)&&(a.source.video={uri:a.source.video.uri,mimeType:a.source.video.mimeType})),await this.generateVideosInternal(a)}}maybeMoveToResponseJsonSchem(a){a.config&&a.config.responseSchema&&!a.config.responseJsonSchema&&Object.keys(a.config.responseSchema).includes("$schema")&&(a.config.responseJsonSchema=a.config.responseSchema,delete a.config.responseSchema)}async processParamsMaybeAddMcpUsage(a){var b,c,d;let e=null==(b=a.config)?void 0:b.tools;if(!e)return a;let f=await Promise.all(e.map(async a=>dq(a)?await a.tool():a)),g={model:a.model,contents:a.contents,config:Object.assign(Object.assign({},a.config),{tools:f})};if(g.config.tools=f,a.config&&a.config.tools&&de(a.config.tools)){let b=Object.assign({},null!=(d=null==(c=a.config.httpOptions)?void 0:c.headers)?d:{});0===Object.keys(b).length&&(b=this.apiClient.getDefaultHeaders()),df(b),g.config.httpOptions=Object.assign(Object.assign({},a.config.httpOptions),{headers:b})}return g}async initAfcToolsMap(a){var b,c,d;let e=new Map;for(let f of null!=(c=null==(b=a.config)?void 0:b.tools)?c:[])if(dq(f))for(let a of null!=(d=(await f.tool()).functionDeclarations)?d:[]){if(!a.name)throw Error("Function declaration name is required.");if(e.has(a.name))throw Error(`Duplicate tool declaration name: ${a.name}`);e.set(a.name,f)}return e}async processAfcStream(a){var b,c,d;let e=null!=(d=null==(c=null==(b=a.config)?void 0:b.automaticFunctionCalling)?void 0:c.maximumRemoteCalls)?d:10,f=!1,g=0;return function(a,b,c){var d,h;return cL(this,arguments,function*(){for(var i,j,k,l;g<e;){f&&(g++,f=!1);let p=yield cK(a.processParamsMaybeAddMcpUsage(c)),q=yield cK(a.generateContentStreamInternal(p)),r=[],s=[];try{for(var m,n=!0,o=(j=void 0,cM(q));!(i=(m=yield cK(o.next())).done);n=!0)if(l=m.value,n=!1,yield yield cK(l),l.candidates&&(null==(d=l.candidates[0])?void 0:d.content)){for(let a of(s.push(l.candidates[0].content),null!=(h=l.candidates[0].content.parts)?h:[]))if(g<e&&a.functionCall){if(!a.functionCall.name)throw Error("Function call name was not returned by the model.");if(b.has(a.functionCall.name)){let c=yield cK(b.get(a.functionCall.name).callTool([a.functionCall]));r.push(...c)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${b.keys()}, mising tool: ${a.functionCall.name}`)}}}catch(a){j={error:a}}finally{try{!n&&!i&&(k=o.return)&&(yield cK(k.call(o)))}finally{if(j)throw j.error}}if(r.length>0){f=!0;let a=new bK;a.candidates=[{content:{role:"user",parts:r}}],yield yield cK(a);let b=[];b.push(...s),b.push({role:"user",parts:r});let d=cl(c.contents).concat(b);c.contents=d}else break}})}(this,await this.initAfcToolsMap(a),a)}async generateContentInternal(a){var b,c,d,e;let f="",g={};if(this.apiClient.isVertexAI()){let d=cX(this.apiClient,a);return f=bE("{model}:generateContent",d._url),g=d._query,delete d._url,delete d._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(d),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=cZ(a),c=new bK;return Object.assign(c,b),c})}{let b=cW(this.apiClient,a);return f=bE("{model}:generateContent",b._url),g=b._query,delete b._url,delete b._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(b),httpMethod:"POST",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=cY(a),c=new bK;return Object.assign(c,b),c})}}async generateContentStreamInternal(a){var b,c,d,e;let f="",g={};if(this.apiClient.isVertexAI()){let d=cX(this.apiClient,a);return f=bE("{model}:streamGenerateContent?alt=sse",d._url),g=d._query,delete d._url,delete d._query,this.apiClient.requestStream({path:f,queryParams:g,body:JSON.stringify(d),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(function(a){return cL(this,arguments,function*(){var b,c,d,e;try{for(var f,g=!0,h=cM(a);!(b=(f=yield cK(h.next())).done);g=!0){e=f.value,g=!1;let a=cZ((yield cK(e.json())));a.sdkHttpResponse={headers:e.headers};let b=new bK;Object.assign(b,a),yield yield cK(b)}}catch(a){c={error:a}}finally{try{!g&&!b&&(d=h.return)&&(yield cK(d.call(h)))}finally{if(c)throw c.error}}})})}{let b=cW(this.apiClient,a);return f=bE("{model}:streamGenerateContent?alt=sse",b._url),g=b._query,delete b._url,delete b._query,this.apiClient.requestStream({path:f,queryParams:g,body:JSON.stringify(b),httpMethod:"POST",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(function(a){return cL(this,arguments,function*(){var b,c,d,e;try{for(var f,g=!0,h=cM(a);!(b=(f=yield cK(h.next())).done);g=!0){e=f.value,g=!1;let a=cY((yield cK(e.json())));a.sdkHttpResponse={headers:e.headers};let b=new bK;Object.assign(b,a),yield yield cK(b)}}catch(a){c={error:a}}finally{try{!g&&!b&&(d=h.return)&&(yield cK(d.call(h)))}finally{if(c)throw c.error}}})})}}async embedContent(a){var b,c,d,e;let f="",g={};if(this.apiClient.isVertexAI()){let d=function(a,b){let c,d,e,f,g,h={},i=bG(b,["model"]);null!=i&&bF(h,["_url","model"],b8(a,i));let j=bG(b,["contents"]);if(null!=j){let b=ck(a,j);Array.isArray(b)&&(b=b.map(a=>a)),bF(h,["instances[]","content"],b)}let k=bG(b,["config"]);return null!=k&&(c=bG(k,["taskType"]),void 0!==h&&null!=c&&bF(h,["instances[]","task_type"],c),d=bG(k,["title"]),void 0!==h&&null!=d&&bF(h,["instances[]","title"],d),e=bG(k,["outputDimensionality"]),void 0!==h&&null!=e&&bF(h,["parameters","outputDimensionality"],e),f=bG(k,["mimeType"]),void 0!==h&&null!=f&&bF(h,["instances[]","mimeType"],f),g=bG(k,["autoTruncate"]),void 0!==h&&null!=g&&bF(h,["parameters","autoTruncate"],g)),h}(this.apiClient,a);return f=bE("{model}:predict",d._url),g=d._query,delete d._url,delete d._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(d),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["predictions[]","embeddings"]);if(null!=d){let a=d;Array.isArray(a)&&(a=a.map(a=>{var b;let c,d,e,f,g,h;return c={},null!=(d=bG(a,["values"]))&&bF(c,["values"],d),null!=(e=bG(a,["statistics"]))&&bF(c,["statistics"],(f={},null!=(g=bG(b=e,["truncated"]))&&bF(f,["truncated"],g),null!=(h=bG(b,["token_count"]))&&bF(f,["tokenCount"],h),f)),c})),bF(b,["embeddings"],a)}let e=bG(a,["metadata"]);return null!=e&&bF(b,["metadata"],e),b}(a),c=new bL;return Object.assign(c,b),c})}{let b=function(a,b){let c={},d=bG(b,["model"]);null!=d&&bF(c,["_url","model"],b8(a,d));let e=bG(b,["contents"]);if(null!=e){let b=ck(a,e);Array.isArray(b)&&(b=b.map(a=>a)),bF(c,["requests[]","content"],b)}let f=bG(b,["config"]);null!=f&&function(a,b){let c=bG(a,["taskType"]);void 0!==b&&null!=c&&bF(b,["requests[]","taskType"],c);let d=bG(a,["title"]);void 0!==b&&null!=d&&bF(b,["requests[]","title"],d);let e=bG(a,["outputDimensionality"]);if(void 0!==b&&null!=e&&bF(b,["requests[]","outputDimensionality"],e),void 0!==bG(a,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==bG(a,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.")}(f,c);let g=bG(b,["model"]);return void 0!==g&&bF(c,["requests[]","model"],b8(a,g)),c}(this.apiClient,a);return f=bE("{model}:batchEmbedContents",b._url),g=b._query,delete b._url,delete b._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(b),httpMethod:"POST",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["embeddings"]);if(null!=d){let a=d;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["embeddings"],a)}let e=bG(a,["metadata"]);return null!=e&&bF(b,["metadata"],e),b}(a),c=new bL;return Object.assign(c,b),c})}}async generateImagesInternal(a){var b,c,d,e,f,g;let h="",i={};if(this.apiClient.isVertexAI()){let d,e,g,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=(f=this.apiClient,d={},null!=(e=bG(a,["model"]))&&bF(d,["_url","model"],b8(f,e)),null!=(g=bG(a,["prompt"]))&&bF(d,["instances[0]","prompt"],g),null!=(j=bG(a,["config"]))&&(k=bG(j,["outputGcsUri"]),void 0!==d&&null!=k&&bF(d,["parameters","storageUri"],k),l=bG(j,["negativePrompt"]),void 0!==d&&null!=l&&bF(d,["parameters","negativePrompt"],l),m=bG(j,["numberOfImages"]),void 0!==d&&null!=m&&bF(d,["parameters","sampleCount"],m),n=bG(j,["aspectRatio"]),void 0!==d&&null!=n&&bF(d,["parameters","aspectRatio"],n),o=bG(j,["guidanceScale"]),void 0!==d&&null!=o&&bF(d,["parameters","guidanceScale"],o),p=bG(j,["seed"]),void 0!==d&&null!=p&&bF(d,["parameters","seed"],p),q=bG(j,["safetyFilterLevel"]),void 0!==d&&null!=q&&bF(d,["parameters","safetySetting"],q),r=bG(j,["personGeneration"]),void 0!==d&&null!=r&&bF(d,["parameters","personGeneration"],r),s=bG(j,["includeSafetyAttributes"]),void 0!==d&&null!=s&&bF(d,["parameters","includeSafetyAttributes"],s),t=bG(j,["includeRaiReason"]),void 0!==d&&null!=t&&bF(d,["parameters","includeRaiReason"],t),u=bG(j,["language"]),void 0!==d&&null!=u&&bF(d,["parameters","language"],u),v=bG(j,["outputMimeType"]),void 0!==d&&null!=v&&bF(d,["parameters","outputOptions","mimeType"],v),w=bG(j,["outputCompressionQuality"]),void 0!==d&&null!=w&&bF(d,["parameters","outputOptions","compressionQuality"],w),x=bG(j,["addWatermark"]),void 0!==d&&null!=x&&bF(d,["parameters","addWatermark"],x),y=bG(j,["labels"]),void 0!==d&&null!=y&&bF(d,["labels"],y),z=bG(j,["imageSize"]),void 0!==d&&null!=z&&bF(d,["parameters","sampleImageSize"],z),A=bG(j,["enhancePrompt"]),void 0!==d&&null!=A&&bF(d,["parameters","enhancePrompt"],A)),d);return h=bE("{model}:predict",B._url),i=B._query,delete B._url,delete B._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(B),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["predictions"]);if(null!=d){let a=d;Array.isArray(a)&&(a=a.map(a=>c$(a))),bF(b,["generatedImages"],a)}let e=bG(a,["positivePromptSafetyAttributes"]);return null!=e&&bF(b,["positivePromptSafetyAttributes"],c5(e)),b}(a),c=new bM;return Object.assign(c,b),c})}{let b,c,f,j,k=(g=this.apiClient,b={},null!=(c=bG(a,["model"]))&&bF(b,["_url","model"],b8(g,c)),null!=(f=bG(a,["prompt"]))&&bF(b,["instances[0]","prompt"],f),null!=(j=bG(a,["config"]))&&function(a,b){if(void 0!==bG(a,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==bG(a,["negativePrompt"]))throw Error("negativePrompt parameter is not supported in Gemini API.");let c=bG(a,["numberOfImages"]);void 0!==b&&null!=c&&bF(b,["parameters","sampleCount"],c);let d=bG(a,["aspectRatio"]);void 0!==b&&null!=d&&bF(b,["parameters","aspectRatio"],d);let e=bG(a,["guidanceScale"]);if(void 0!==b&&null!=e&&bF(b,["parameters","guidanceScale"],e),void 0!==bG(a,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let f=bG(a,["safetyFilterLevel"]);void 0!==b&&null!=f&&bF(b,["parameters","safetySetting"],f);let g=bG(a,["personGeneration"]);void 0!==b&&null!=g&&bF(b,["parameters","personGeneration"],g);let h=bG(a,["includeSafetyAttributes"]);void 0!==b&&null!=h&&bF(b,["parameters","includeSafetyAttributes"],h);let i=bG(a,["includeRaiReason"]);void 0!==b&&null!=i&&bF(b,["parameters","includeRaiReason"],i);let j=bG(a,["language"]);void 0!==b&&null!=j&&bF(b,["parameters","language"],j);let k=bG(a,["outputMimeType"]);void 0!==b&&null!=k&&bF(b,["parameters","outputOptions","mimeType"],k);let l=bG(a,["outputCompressionQuality"]);if(void 0!==b&&null!=l&&bF(b,["parameters","outputOptions","compressionQuality"],l),void 0!==bG(a,["addWatermark"]))throw Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==bG(a,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let m=bG(a,["imageSize"]);if(void 0!==b&&null!=m&&bF(b,["parameters","sampleImageSize"],m),void 0!==bG(a,["enhancePrompt"]))throw Error("enhancePrompt parameter is not supported in Gemini API.")}(j,b),b);return h=bE("{model}:predict",k._url),i=k._query,delete k._url,delete k._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(k),httpMethod:"POST",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["predictions"]);if(null!=d){let a=d;Array.isArray(a)&&(a=a.map(a=>{var b,c;let d,e,f,g,h,i,j;return d={},null!=(e=bG(b=a,["_self"]))&&bF(d,["image"],(f={},null!=(g=bG(c=e,["bytesBase64Encoded"]))&&bF(f,["imageBytes"],bH(g)),null!=(h=bG(c,["mimeType"]))&&bF(f,["mimeType"],h),f)),null!=(i=bG(b,["raiFilteredReason"]))&&bF(d,["raiFilteredReason"],i),null!=(j=bG(b,["_self"]))&&bF(d,["safetyAttributes"],c4(j)),d})),bF(b,["generatedImages"],a)}let e=bG(a,["positivePromptSafetyAttributes"]);return null!=e&&bF(b,["positivePromptSafetyAttributes"],c4(e)),b}(a),c=new bM;return Object.assign(c,b),c})}}async editImageInternal(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI()){let f=function(a,b){let c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t={},u=bG(b,["model"]);null!=u&&bF(t,["_url","model"],b8(a,u));let v=bG(b,["prompt"]);null!=v&&bF(t,["instances[0]","prompt"],v);let w=bG(b,["referenceImages"]);if(null!=w){let a=w;Array.isArray(a)&&(a=a.map(a=>(function(a){let b,c,d,e,f,g,h,i={},j=bG(a,["referenceImage"]);null!=j&&bF(i,["referenceImage"],c1(j));let k=bG(a,["referenceId"]);null!=k&&bF(i,["referenceId"],k);let l=bG(a,["referenceType"]);null!=l&&bF(i,["referenceType"],l);let m=bG(a,["maskImageConfig"]);null!=m&&bF(i,["maskImageConfig"],(b={},null!=(c=bG(m,["maskMode"]))&&bF(b,["maskMode"],c),null!=(d=bG(m,["segmentationClasses"]))&&bF(b,["maskClasses"],d),null!=(e=bG(m,["maskDilation"]))&&bF(b,["dilation"],e),b));let n=bG(a,["controlImageConfig"]);null!=n&&bF(i,["controlImageConfig"],(f={},null!=(g=bG(n,["controlType"]))&&bF(f,["controlType"],g),null!=(h=bG(n,["enableControlImageComputation"]))&&bF(f,["computeControl"],h),f));let o=bG(a,["styleImageConfig"]);null!=o&&bF(i,["styleImageConfig"],o);let p=bG(a,["subjectImageConfig"]);return null!=p&&bF(i,["subjectImageConfig"],p),i})(a))),bF(t,["instances[0]","referenceImages"],a)}let x=bG(b,["config"]);return null!=x&&(c=bG(x,["outputGcsUri"]),void 0!==t&&null!=c&&bF(t,["parameters","storageUri"],c),d=bG(x,["negativePrompt"]),void 0!==t&&null!=d&&bF(t,["parameters","negativePrompt"],d),e=bG(x,["numberOfImages"]),void 0!==t&&null!=e&&bF(t,["parameters","sampleCount"],e),f=bG(x,["aspectRatio"]),void 0!==t&&null!=f&&bF(t,["parameters","aspectRatio"],f),g=bG(x,["guidanceScale"]),void 0!==t&&null!=g&&bF(t,["parameters","guidanceScale"],g),h=bG(x,["seed"]),void 0!==t&&null!=h&&bF(t,["parameters","seed"],h),i=bG(x,["safetyFilterLevel"]),void 0!==t&&null!=i&&bF(t,["parameters","safetySetting"],i),j=bG(x,["personGeneration"]),void 0!==t&&null!=j&&bF(t,["parameters","personGeneration"],j),k=bG(x,["includeSafetyAttributes"]),void 0!==t&&null!=k&&bF(t,["parameters","includeSafetyAttributes"],k),l=bG(x,["includeRaiReason"]),void 0!==t&&null!=l&&bF(t,["parameters","includeRaiReason"],l),m=bG(x,["language"]),void 0!==t&&null!=m&&bF(t,["parameters","language"],m),n=bG(x,["outputMimeType"]),void 0!==t&&null!=n&&bF(t,["parameters","outputOptions","mimeType"],n),o=bG(x,["outputCompressionQuality"]),void 0!==t&&null!=o&&bF(t,["parameters","outputOptions","compressionQuality"],o),p=bG(x,["addWatermark"]),void 0!==t&&null!=p&&bF(t,["parameters","addWatermark"],p),q=bG(x,["labels"]),void 0!==t&&null!=q&&bF(t,["labels"],q),r=bG(x,["editMode"]),void 0!==t&&null!=r&&bF(t,["parameters","editMode"],r),s=bG(x,["baseSteps"]),void 0!==t&&null!=s&&bF(t,["parameters","editConfig","baseSteps"],s)),t}(this.apiClient,a);return d=bE("{model}:predict",f._url),e=f._query,delete f._url,delete f._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(f),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["predictions"]);if(null!=d){let a=d;Array.isArray(a)&&(a=a.map(a=>c$(a))),bF(b,["generatedImages"],a)}return b}(a),c=new bN;return Object.assign(c,b),c})}throw Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(a){var b,c,d;let e="",f={};if(this.apiClient.isVertexAI()){let g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=(d=this.apiClient,g={},null!=(h=bG(a,["model"]))&&bF(g,["_url","model"],b8(d,h)),null!=(i=bG(a,["image"]))&&bF(g,["instances[0]","image"],c1(i)),null!=(j=bG(a,["upscaleFactor"]))&&bF(g,["parameters","upscaleConfig","upscaleFactor"],j),null!=(k=bG(a,["config"]))&&(l=bG(k,["outputGcsUri"]),void 0!==g&&null!=l&&bF(g,["parameters","storageUri"],l),m=bG(k,["safetyFilterLevel"]),void 0!==g&&null!=m&&bF(g,["parameters","safetySetting"],m),n=bG(k,["personGeneration"]),void 0!==g&&null!=n&&bF(g,["parameters","personGeneration"],n),o=bG(k,["includeRaiReason"]),void 0!==g&&null!=o&&bF(g,["parameters","includeRaiReason"],o),p=bG(k,["outputMimeType"]),void 0!==g&&null!=p&&bF(g,["parameters","outputOptions","mimeType"],p),q=bG(k,["outputCompressionQuality"]),void 0!==g&&null!=q&&bF(g,["parameters","outputOptions","compressionQuality"],q),r=bG(k,["enhanceInputImage"]),void 0!==g&&null!=r&&bF(g,["parameters","upscaleConfig","enhanceInputImage"],r),s=bG(k,["imagePreservationFactor"]),void 0!==g&&null!=s&&bF(g,["parameters","upscaleConfig","imagePreservationFactor"],s),t=bG(k,["labels"]),void 0!==g&&null!=t&&bF(g,["labels"],t),u=bG(k,["numberOfImages"]),void 0!==g&&null!=u&&bF(g,["parameters","sampleCount"],u),v=bG(k,["mode"]),void 0!==g&&null!=v&&bF(g,["parameters","mode"],v)),g);return e=bE("{model}:predict",w._url),f=w._query,delete w._url,delete w._query,this.apiClient.request({path:e,queryParams:f,body:JSON.stringify(w),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["predictions"]);if(null!=d){let a=d;Array.isArray(a)&&(a=a.map(a=>c$(a))),bF(b,["generatedImages"],a)}return b}(a),c=new bO;return Object.assign(c,b),c})}throw Error("This method is only supported by the Vertex AI.")}async recontextImage(a){var b,c,d;let e="",f={};if(this.apiClient.isVertexAI()){let g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=(d=this.apiClient,g={},null!=(h=bG(a,["model"]))&&bF(g,["_url","model"],b8(d,h)),null!=(i=bG(a,["source"]))&&function(a,b){let c=bG(a,["prompt"]);void 0!==b&&null!=c&&bF(b,["instances[0]","prompt"],c);let d=bG(a,["personImage"]);void 0!==b&&null!=d&&bF(b,["instances[0]","personImage","image"],c1(d));let e=bG(a,["productImages"]);if(void 0!==b&&null!=e){let a=e;Array.isArray(a)&&(a=a.map(a=>{let b,c;return b={},null!=(c=bG(a,["productImage"]))&&bF(b,["image"],c1(c)),b})),bF(b,["instances[0]","productImages"],a)}}(i,g),null!=(j=bG(a,["config"]))&&(k=bG(j,["numberOfImages"]),void 0!==g&&null!=k&&bF(g,["parameters","sampleCount"],k),l=bG(j,["baseSteps"]),void 0!==g&&null!=l&&bF(g,["parameters","baseSteps"],l),m=bG(j,["outputGcsUri"]),void 0!==g&&null!=m&&bF(g,["parameters","storageUri"],m),n=bG(j,["seed"]),void 0!==g&&null!=n&&bF(g,["parameters","seed"],n),o=bG(j,["safetyFilterLevel"]),void 0!==g&&null!=o&&bF(g,["parameters","safetySetting"],o),p=bG(j,["personGeneration"]),void 0!==g&&null!=p&&bF(g,["parameters","personGeneration"],p),q=bG(j,["addWatermark"]),void 0!==g&&null!=q&&bF(g,["parameters","addWatermark"],q),r=bG(j,["outputMimeType"]),void 0!==g&&null!=r&&bF(g,["parameters","outputOptions","mimeType"],r),s=bG(j,["outputCompressionQuality"]),void 0!==g&&null!=s&&bF(g,["parameters","outputOptions","compressionQuality"],s),t=bG(j,["enhancePrompt"]),void 0!==g&&null!=t&&bF(g,["parameters","enhancePrompt"],t),u=bG(j,["labels"]),void 0!==g&&null!=u&&bF(g,["labels"],u)),g);return e=bE("{model}:predict",v._url),f=v._query,delete v._url,delete v._query,this.apiClient.request({path:e,queryParams:f,body:JSON.stringify(v),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>{let b=function(a){let b={},c=bG(a,["predictions"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>c$(a))),bF(b,["generatedImages"],a)}return b}(a),c=new bP;return Object.assign(c,b),c})}throw Error("This method is only supported by the Vertex AI.")}async segmentImage(a){var b,c,d,e,f;let g="",h={};if(this.apiClient.isVertexAI()){let i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=(d=this.apiClient,n={},null!=(o=bG(a,["model"]))&&bF(n,["_url","model"],b8(d,o)),null!=(p=bG(a,["source"]))&&(e=p,f=n,k=bG(e,["prompt"]),void 0!==f&&null!=k&&bF(f,["instances[0]","prompt"],k),l=bG(e,["image"]),void 0!==f&&null!=l&&bF(f,["instances[0]","image"],c1(l)),m=bG(e,["scribbleImage"]),void 0!==f&&null!=m&&bF(f,["instances[0]","scribble"],(i={},null!=(j=bG(m,["image"]))&&bF(i,["image"],c1(j)),i))),null!=(q=bG(a,["config"]))&&(r=bG(q,["mode"]),void 0!==n&&null!=r&&bF(n,["parameters","mode"],r),s=bG(q,["maxPredictions"]),void 0!==n&&null!=s&&bF(n,["parameters","maxPredictions"],s),t=bG(q,["confidenceThreshold"]),void 0!==n&&null!=t&&bF(n,["parameters","confidenceThreshold"],t),u=bG(q,["maskDilation"]),void 0!==n&&null!=u&&bF(n,["parameters","maskDilation"],u),v=bG(q,["binaryColorThreshold"]),void 0!==n&&null!=v&&bF(n,["parameters","binaryColorThreshold"],v),w=bG(q,["labels"]),void 0!==n&&null!=w&&bF(n,["labels"],w)),n);return g=bE("{model}:predict",x._url),h=x._query,delete x._url,delete x._query,this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(x),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>{let b=function(a){let b={},c=bG(a,["predictions"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>(function(a){let b={},c=bG(a,["_self"]);null!=c&&bF(b,["mask"],c_(c));let d=bG(a,["labels"]);if(null!=d){let a=d;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["labels"],a)}return b})(a))),bF(b,["generatedMasks"],a)}return b}(a),c=new bQ;return Object.assign(c,b),c})}throw Error("This method is only supported by the Vertex AI.")}async get(a){var b,c,d,e,f,g;let h="",i={};if(this.apiClient.isVertexAI()){let d,e,g=(f=this.apiClient,d={},null!=(e=bG(a,["model"]))&&bF(d,["_url","name"],b8(f,e)),d);return h=bE("{name}",g._url),i=g._query,delete g._url,delete g._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(g),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>c3(a))}{let b,c,f=(g=this.apiClient,b={},null!=(c=bG(a,["model"]))&&bF(b,["_url","name"],b8(g,c)),b);return h=bE("{name}",f._url),i=f._query,delete f._url,delete f._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(f),httpMethod:"GET",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json()).then(a=>c2(a))}}async listInternal(a){var b,c,d,e,f,g;let h="",i={};if(this.apiClient.isVertexAI()){let d,e,g,j,k,l,m=(f=this.apiClient,d={},null!=(e=bG(a,["config"]))&&(g=bG(e,["pageSize"]),void 0!==d&&null!=g&&bF(d,["_query","pageSize"],g),j=bG(e,["pageToken"]),void 0!==d&&null!=j&&bF(d,["_query","pageToken"],j),k=bG(e,["filter"]),void 0!==d&&null!=k&&bF(d,["_query","filter"],k),l=bG(e,["queryBase"]),void 0!==d&&null!=l&&bF(d,["_url","models_url"],cw(f,l))),d);return h=bE("{models_url}",m._url),i=m._query,delete m._url,delete m._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(m),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["nextPageToken"]);null!=d&&bF(b,["nextPageToken"],d);let e=bG(a,["_self"]);if(null!=e){let a=cx(e);Array.isArray(a)&&(a=a.map(a=>c3(a))),bF(b,["models"],a)}return b}(a),c=new bR;return Object.assign(c,b),c})}{let b,c,f,j,k,l,m=(g=this.apiClient,b={},null!=(c=bG(a,["config"]))&&(f=bG(c,["pageSize"]),void 0!==b&&null!=f&&bF(b,["_query","pageSize"],f),j=bG(c,["pageToken"]),void 0!==b&&null!=j&&bF(b,["_query","pageToken"],j),k=bG(c,["filter"]),void 0!==b&&null!=k&&bF(b,["_query","filter"],k),l=bG(c,["queryBase"]),void 0!==b&&null!=l&&bF(b,["_url","models_url"],cw(g,l))),b);return h=bE("{models_url}",m._url),i=m._query,delete m._url,delete m._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(m),httpMethod:"GET",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["nextPageToken"]);null!=d&&bF(b,["nextPageToken"],d);let e=bG(a,["_self"]);if(null!=e){let a=cx(e);Array.isArray(a)&&(a=a.map(a=>c2(a))),bF(b,["models"],a)}return b}(a),c=new bR;return Object.assign(c,b),c})}}async update(a){var b,c,d,e,f,g;let h="",i={};if(this.apiClient.isVertexAI()){let d,e,g,j,k,l,m=(f=this.apiClient,d={},null!=(e=bG(a,["model"]))&&bF(d,["_url","model"],b8(f,e)),null!=(g=bG(a,["config"]))&&(j=bG(g,["displayName"]),void 0!==d&&null!=j&&bF(d,["displayName"],j),k=bG(g,["description"]),void 0!==d&&null!=k&&bF(d,["description"],k),l=bG(g,["defaultCheckpointId"]),void 0!==d&&null!=l&&bF(d,["defaultCheckpointId"],l)),d);return h=bE("{model}",m._url),i=m._query,delete m._url,delete m._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(m),httpMethod:"PATCH",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>c3(a))}{let b,c,f,j,k,l,m=(g=this.apiClient,b={},null!=(c=bG(a,["model"]))&&bF(b,["_url","name"],b8(g,c)),null!=(f=bG(a,["config"]))&&(j=bG(f,["displayName"]),void 0!==b&&null!=j&&bF(b,["displayName"],j),k=bG(f,["description"]),void 0!==b&&null!=k&&bF(b,["description"],k),l=bG(f,["defaultCheckpointId"]),void 0!==b&&null!=l&&bF(b,["defaultCheckpointId"],l)),b);return h=bE("{name}",m._url),i=m._query,delete m._url,delete m._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(m),httpMethod:"PATCH",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json()).then(a=>c2(a))}}async delete(a){var b,c,d,e,f,g;let h="",i={};if(this.apiClient.isVertexAI()){let d,e,g=(f=this.apiClient,d={},null!=(e=bG(a,["model"]))&&bF(d,["_url","name"],b8(f,e)),d);return h=bE("{name}",g._url),i=g._query,delete g._url,delete g._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(g),httpMethod:"DELETE",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b,c,d=(b={},null!=(c=bG(a,["sdkHttpResponse"]))&&bF(b,["sdkHttpResponse"],c),b),e=new bS;return Object.assign(e,d),e})}{let b,c,f=(g=this.apiClient,b={},null!=(c=bG(a,["model"]))&&bF(b,["_url","name"],b8(g,c)),b);return h=bE("{name}",f._url),i=f._query,delete f._url,delete f._query,this.apiClient.request({path:h,queryParams:i,body:JSON.stringify(f),httpMethod:"DELETE",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b,c,d=(b={},null!=(c=bG(a,["sdkHttpResponse"]))&&bF(b,["sdkHttpResponse"],c),b),e=new bS;return Object.assign(e,d),e})}}async countTokens(a){var b,c,d,e;let f="",g={};if(this.apiClient.isVertexAI()){let d=function(a,b){let c={},d=bG(b,["model"]);null!=d&&bF(c,["_url","model"],b8(a,d));let e=bG(b,["contents"]);if(null!=e){let a=cl(e);Array.isArray(a)&&(a=a.map(a=>a)),bF(c,["contents"],a)}let f=bG(b,["config"]);return null!=f&&function(a,b){let c=bG(a,["systemInstruction"]);void 0!==b&&null!=c&&bF(b,["systemInstruction"],cj(c));let d=bG(a,["tools"]);if(void 0!==b&&null!=d){let a=d;Array.isArray(a)&&(a=a.map(a=>c7(a))),bF(b,["tools"],a)}let e=bG(a,["generationConfig"]);void 0!==b&&null!=e&&bF(b,["generationConfig"],function(a){let b={},c=bG(a,["modelSelectionConfig"]);null!=c&&bF(b,["modelConfig"],c);let d=bG(a,["responseJsonSchema"]);null!=d&&bF(b,["responseJsonSchema"],d);let e=bG(a,["audioTimestamp"]);null!=e&&bF(b,["audioTimestamp"],e);let f=bG(a,["candidateCount"]);null!=f&&bF(b,["candidateCount"],f);let g=bG(a,["enableAffectiveDialog"]);null!=g&&bF(b,["enableAffectiveDialog"],g);let h=bG(a,["frequencyPenalty"]);null!=h&&bF(b,["frequencyPenalty"],h);let i=bG(a,["logprobs"]);null!=i&&bF(b,["logprobs"],i);let j=bG(a,["maxOutputTokens"]);null!=j&&bF(b,["maxOutputTokens"],j);let k=bG(a,["mediaResolution"]);null!=k&&bF(b,["mediaResolution"],k);let l=bG(a,["presencePenalty"]);null!=l&&bF(b,["presencePenalty"],l);let m=bG(a,["responseLogprobs"]);null!=m&&bF(b,["responseLogprobs"],m);let n=bG(a,["responseMimeType"]);null!=n&&bF(b,["responseMimeType"],n);let o=bG(a,["responseModalities"]);null!=o&&bF(b,["responseModalities"],o);let p=bG(a,["responseSchema"]);null!=p&&bF(b,["responseSchema"],p);let q=bG(a,["routingConfig"]);null!=q&&bF(b,["routingConfig"],q);let r=bG(a,["seed"]);null!=r&&bF(b,["seed"],r);let s=bG(a,["speechConfig"]);null!=s&&bF(b,["speechConfig"],c6(s));let t=bG(a,["stopSequences"]);null!=t&&bF(b,["stopSequences"],t);let u=bG(a,["temperature"]);null!=u&&bF(b,["temperature"],u);let v=bG(a,["thinkingConfig"]);null!=v&&bF(b,["thinkingConfig"],v);let w=bG(a,["topK"]);null!=w&&bF(b,["topK"],w);let x=bG(a,["topP"]);if(null!=x&&bF(b,["topP"],x),void 0!==bG(a,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return b}(e))}(f,c),c}(this.apiClient,a);return f=bE("{model}:countTokens",d._url),g=d._query,delete d._url,delete d._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(d),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b,c,d,e=(b={},null!=(c=bG(a,["sdkHttpResponse"]))&&bF(b,["sdkHttpResponse"],c),null!=(d=bG(a,["totalTokens"]))&&bF(b,["totalTokens"],d),b),f=new bT;return Object.assign(f,e),f})}{let b=function(a,b){let c={},d=bG(b,["model"]);null!=d&&bF(c,["_url","model"],b8(a,d));let e=bG(b,["contents"]);if(null!=e){let a=cl(e);Array.isArray(a)&&(a=a.map(a=>cV(a))),bF(c,["contents"],a)}let f=bG(b,["config"]);return null!=f&&function(a){if(void 0!==bG(a,["systemInstruction"]))throw Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==bG(a,["tools"]))throw Error("tools parameter is not supported in Gemini API.");if(void 0!==bG(a,["generationConfig"]))throw Error("generationConfig parameter is not supported in Gemini API.")}(f),c}(this.apiClient,a);return f=bE("{model}:countTokens",b._url),g=b._query,delete b._url,delete b._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(b),httpMethod:"POST",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b,c,d,e,f=(b={},null!=(c=bG(a,["sdkHttpResponse"]))&&bF(b,["sdkHttpResponse"],c),null!=(d=bG(a,["totalTokens"]))&&bF(b,["totalTokens"],d),null!=(e=bG(a,["cachedContentTokenCount"]))&&bF(b,["cachedContentTokenCount"],e),b),g=new bT;return Object.assign(g,f),g})}}async computeTokens(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI()){let f=function(a,b){let c={},d=bG(b,["model"]);null!=d&&bF(c,["_url","model"],b8(a,d));let e=bG(b,["contents"]);if(null!=e){let a=cl(e);Array.isArray(a)&&(a=a.map(a=>a)),bF(c,["contents"],a)}return c}(this.apiClient,a);return d=bE("{model}:computeTokens",f._url),e=f._query,delete f._url,delete f._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(f),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["tokensInfo"]);if(null!=d){let a=d;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["tokensInfo"],a)}return b}(a),c=new bU;return Object.assign(c,b),c})}throw Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(a){var b,c,d,e,f,g,h,i,j,k;let l="",m={};if(this.apiClient.isVertexAI()){let d,e,g,j,k,n,o,p,q,r,s=(f=this.apiClient,j={},null!=(k=bG(a,["model"]))&&bF(j,["_url","model"],b8(f,k)),null!=(n=bG(a,["prompt"]))&&bF(j,["instances[0]","prompt"],n),null!=(o=bG(a,["image"]))&&bF(j,["instances[0]","image"],c1(o)),null!=(p=bG(a,["video"]))&&bF(j,["instances[0]","video"],c9(p)),null!=(q=bG(a,["source"]))&&(h=q,i=j,d=bG(h,["prompt"]),void 0!==i&&null!=d&&bF(i,["instances[0]","prompt"],d),e=bG(h,["image"]),void 0!==i&&null!=e&&bF(i,["instances[0]","image"],c1(e)),g=bG(h,["video"]),void 0!==i&&null!=g&&bF(i,["instances[0]","video"],c9(g))),null!=(r=bG(a,["config"]))&&function(a,b){var c;let d,e,f,g=bG(a,["numberOfVideos"]);void 0!==b&&null!=g&&bF(b,["parameters","sampleCount"],g);let h=bG(a,["outputGcsUri"]);void 0!==b&&null!=h&&bF(b,["parameters","storageUri"],h);let i=bG(a,["fps"]);void 0!==b&&null!=i&&bF(b,["parameters","fps"],i);let j=bG(a,["durationSeconds"]);void 0!==b&&null!=j&&bF(b,["parameters","durationSeconds"],j);let k=bG(a,["seed"]);void 0!==b&&null!=k&&bF(b,["parameters","seed"],k);let l=bG(a,["aspectRatio"]);void 0!==b&&null!=l&&bF(b,["parameters","aspectRatio"],l);let m=bG(a,["resolution"]);void 0!==b&&null!=m&&bF(b,["parameters","resolution"],m);let n=bG(a,["personGeneration"]);void 0!==b&&null!=n&&bF(b,["parameters","personGeneration"],n);let o=bG(a,["pubsubTopic"]);void 0!==b&&null!=o&&bF(b,["parameters","pubsubTopic"],o);let p=bG(a,["negativePrompt"]);void 0!==b&&null!=p&&bF(b,["parameters","negativePrompt"],p);let q=bG(a,["enhancePrompt"]);void 0!==b&&null!=q&&bF(b,["parameters","enhancePrompt"],q);let r=bG(a,["generateAudio"]);void 0!==b&&null!=r&&bF(b,["parameters","generateAudio"],r);let s=bG(a,["lastFrame"]);void 0!==b&&null!=s&&bF(b,["instances[0]","lastFrame"],c1(s));let t=bG(a,["referenceImages"]);if(void 0!==b&&null!=t){let a=t;Array.isArray(a)&&(a=a.map(a=>{var b;let c,d,e;return c={},null!=(d=bG(b=a,["image"]))&&bF(c,["image"],c1(d)),null!=(e=bG(b,["referenceType"]))&&bF(c,["referenceType"],e),c})),bF(b,["instances[0]","referenceImages"],a)}let u=bG(a,["mask"]);void 0!==b&&null!=u&&bF(b,["instances[0]","mask"],(d={},null!=(e=bG(c=u,["image"]))&&bF(d,["_self"],c1(e)),null!=(f=bG(c,["maskMode"]))&&bF(d,["maskMode"],f),d));let v=bG(a,["compressionQuality"]);void 0!==b&&null!=v&&bF(b,["parameters","compressionQuality"],v)}(r,j),j);return l=bE("{model}:predictLongRunning",s._url),m=s._query,delete s._url,delete s._query,this.apiClient.request({path:l,queryParams:m,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>{let b,c,d,e,f,g,h=(b={},null!=(c=bG(a,["name"]))&&bF(b,["name"],c),null!=(d=bG(a,["metadata"]))&&bF(b,["metadata"],d),null!=(e=bG(a,["done"]))&&bF(b,["done"],e),null!=(f=bG(a,["error"]))&&bF(b,["error"],f),null!=(g=bG(a,["response"]))&&bF(b,["response"],function(a){let b={},c=bG(a,["videos"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>{var b;let c,d,e,f,g,h;return c={},null!=(d=bG(a,["_self"]))&&bF(c,["video"],(e={},null!=(f=bG(b=d,["gcsUri"]))&&bF(e,["uri"],f),null!=(g=bG(b,["bytesBase64Encoded"]))&&bF(e,["videoBytes"],bH(g)),null!=(h=bG(b,["mimeType"]))&&bF(e,["mimeType"],h),e)),c})),bF(b,["generatedVideos"],a)}let d=bG(a,["raiMediaFilteredCount"]);null!=d&&bF(b,["raiMediaFilteredCount"],d);let e=bG(a,["raiMediaFilteredReasons"]);return null!=e&&bF(b,["raiMediaFilteredReasons"],e),b}(g)),b),i=new bV;return Object.assign(i,h),i})}{let b,c,f,h,i,n,o,p,q,r,s=(g=this.apiClient,h={},null!=(i=bG(a,["model"]))&&bF(h,["_url","model"],b8(g,i)),null!=(n=bG(a,["prompt"]))&&bF(h,["instances[0]","prompt"],n),null!=(o=bG(a,["image"]))&&bF(h,["instances[0]","image"],c0(o)),null!=(p=bG(a,["video"]))&&bF(h,["instances[0]","video"],c8(p)),null!=(q=bG(a,["source"]))&&(j=q,k=h,b=bG(j,["prompt"]),void 0!==k&&null!=b&&bF(k,["instances[0]","prompt"],b),c=bG(j,["image"]),void 0!==k&&null!=c&&bF(k,["instances[0]","image"],c0(c)),f=bG(j,["video"]),void 0!==k&&null!=f&&bF(k,["instances[0]","video"],c8(f))),null!=(r=bG(a,["config"]))&&function(a,b){let c=bG(a,["numberOfVideos"]);if(void 0!==b&&null!=c&&bF(b,["parameters","sampleCount"],c),void 0!==bG(a,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==bG(a,["fps"]))throw Error("fps parameter is not supported in Gemini API.");let d=bG(a,["durationSeconds"]);if(void 0!==b&&null!=d&&bF(b,["parameters","durationSeconds"],d),void 0!==bG(a,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let e=bG(a,["aspectRatio"]);void 0!==b&&null!=e&&bF(b,["parameters","aspectRatio"],e);let f=bG(a,["resolution"]);void 0!==b&&null!=f&&bF(b,["parameters","resolution"],f);let g=bG(a,["personGeneration"]);if(void 0!==b&&null!=g&&bF(b,["parameters","personGeneration"],g),void 0!==bG(a,["pubsubTopic"]))throw Error("pubsubTopic parameter is not supported in Gemini API.");let h=bG(a,["negativePrompt"]);void 0!==b&&null!=h&&bF(b,["parameters","negativePrompt"],h);let i=bG(a,["enhancePrompt"]);if(void 0!==b&&null!=i&&bF(b,["parameters","enhancePrompt"],i),void 0!==bG(a,["generateAudio"]))throw Error("generateAudio parameter is not supported in Gemini API.");let j=bG(a,["lastFrame"]);void 0!==b&&null!=j&&bF(b,["instances[0]","lastFrame"],c0(j));let k=bG(a,["referenceImages"]);if(void 0!==b&&null!=k){let a=k;Array.isArray(a)&&(a=a.map(a=>{var b;let c,d,e;return c={},null!=(d=bG(b=a,["image"]))&&bF(c,["image"],c0(d)),null!=(e=bG(b,["referenceType"]))&&bF(c,["referenceType"],e),c})),bF(b,["instances[0]","referenceImages"],a)}if(void 0!==bG(a,["mask"]))throw Error("mask parameter is not supported in Gemini API.");if(void 0!==bG(a,["compressionQuality"]))throw Error("compressionQuality parameter is not supported in Gemini API.")}(r,h),h);return l=bE("{model}:predictLongRunning",s._url),m=s._query,delete s._url,delete s._query,this.apiClient.request({path:l,queryParams:m,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json()).then(a=>{let b,c,d,e,f,g,h=(b={},null!=(c=bG(a,["name"]))&&bF(b,["name"],c),null!=(d=bG(a,["metadata"]))&&bF(b,["metadata"],d),null!=(e=bG(a,["done"]))&&bF(b,["done"],e),null!=(f=bG(a,["error"]))&&bF(b,["error"],f),null!=(g=bG(a,["response","generateVideoResponse"]))&&bF(b,["response"],function(a){let b={},c=bG(a,["generatedSamples"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>{var b;let c,d,e,f,g,h;return c={},null!=(d=bG(a,["video"]))&&bF(c,["video"],(e={},null!=(f=bG(b=d,["uri"]))&&bF(e,["uri"],f),null!=(g=bG(b,["encodedVideo"]))&&bF(e,["videoBytes"],bH(g)),null!=(h=bG(b,["encoding"]))&&bF(e,["mimeType"],h),e)),c})),bF(b,["generatedVideos"],a)}let d=bG(a,["raiMediaFilteredCount"]);null!=d&&bF(b,["raiMediaFilteredCount"],d);let e=bG(a,["raiMediaFilteredReasons"]);return null!=e&&bF(b,["raiMediaFilteredReasons"],e),b}(g)),b),i=new bV;return Object.assign(i,h),i})}}}class du extends bD{constructor(a){super(),this.apiClient=a}async getVideosOperation(a){let b=a.operation,c=a.config;if(void 0===b.name||""===b.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let a,d=b.name.split("/operations/")[0];c&&"httpOptions"in c&&(a=c.httpOptions);let e=await this.fetchPredictVideosOperationInternal({operationName:b.name,resourceName:d,config:{httpOptions:a}});return b._fromAPIResponse({apiResponse:e,_isVertexAI:!0})}{let a=await this.getVideosOperationInternal({operationName:b.name,config:c});return b._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async get(a){let b=a.operation,c=a.config;if(void 0===b.name||""===b.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let a,d=b.name.split("/operations/")[0];c&&"httpOptions"in c&&(a=c.httpOptions);let e=await this.fetchPredictVideosOperationInternal({operationName:b.name,resourceName:d,config:{httpOptions:a}});return b._fromAPIResponse({apiResponse:e,_isVertexAI:!0})}{let a=await this.getVideosOperationInternal({operationName:b.name,config:c});return b._fromAPIResponse({apiResponse:a,_isVertexAI:!1})}}async getVideosOperationInternal(a){var b,c,d,e;let f="",g={};if(this.apiClient.isVertexAI()){let d,e,h=(d={},null!=(e=bG(a,["operationName"]))&&bF(d,["_url","operationName"],e),d);return f=bE("{operationName}",h._url),g=h._query,delete h._url,delete h._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json())}{let b,c,h=(b={},null!=(c=bG(a,["operationName"]))&&bF(b,["_url","operationName"],c),b);return f=bE("{operationName}",h._url),g=h._query,delete h._url,delete h._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json())}}async fetchPredictVideosOperationInternal(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI()){let f,g,h,i=(f={},null!=(g=bG(a,["operationName"]))&&bF(f,["operationName"],g),null!=(h=bG(a,["resourceName"]))&&bF(f,["_url","resourceName"],h),f);return d=bE("{resourceName}:fetchPredictOperation",i._url),e=i._query,delete i._url,delete i._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json())}throw Error("This method is only supported by the Vertex AI.")}}class dv extends bD{constructor(a){super(),this.apiClient=a}async create(a){var b,c,d,e,f;let g="",h={};if(this.apiClient.isVertexAI())throw Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let i,j,k,l,m,n,o,p,q,r,s=(d=this.apiClient,l={},null!=(m=bG(a,["config"]))&&bF(l,["config"],(n=bG(m,["expireTime"]),void 0!==l&&null!=n&&bF(l,["expireTime"],n),o=bG(m,["newSessionExpireTime"]),void 0!==l&&null!=o&&bF(l,["newSessionExpireTime"],o),p=bG(m,["uses"]),void 0!==l&&null!=p&&bF(l,["uses"],p),q=bG(m,["liveConnectConstraints"]),void 0!==l&&null!=q&&bF(l,["bidiGenerateContentSetup"],(e=d,i={},null!=(j=bG(f=q,["model"]))&&bF(i,["setup","model"],b8(e,j)),null!=(k=bG(f,["config"]))&&bF(i,["config"],function(a,b){let c=bG(a,["generationConfig"]);void 0!==b&&null!=c&&bF(b,["setup","generationConfig"],c);let d=bG(a,["responseModalities"]);void 0!==b&&null!=d&&bF(b,["setup","generationConfig","responseModalities"],d);let e=bG(a,["temperature"]);void 0!==b&&null!=e&&bF(b,["setup","generationConfig","temperature"],e);let f=bG(a,["topP"]);void 0!==b&&null!=f&&bF(b,["setup","generationConfig","topP"],f);let g=bG(a,["topK"]);void 0!==b&&null!=g&&bF(b,["setup","generationConfig","topK"],g);let h=bG(a,["maxOutputTokens"]);void 0!==b&&null!=h&&bF(b,["setup","generationConfig","maxOutputTokens"],h);let i=bG(a,["mediaResolution"]);void 0!==b&&null!=i&&bF(b,["setup","generationConfig","mediaResolution"],i);let j=bG(a,["seed"]);void 0!==b&&null!=j&&bF(b,["setup","generationConfig","seed"],j);let k=bG(a,["speechConfig"]);void 0!==b&&null!=k&&bF(b,["setup","generationConfig","speechConfig"],co(k));let l=bG(a,["thinkingConfig"]);void 0!==b&&null!=l&&bF(b,["setup","generationConfig","thinkingConfig"],l);let m=bG(a,["enableAffectiveDialog"]);void 0!==b&&null!=m&&bF(b,["setup","generationConfig","enableAffectiveDialog"],m);let n=bG(a,["systemInstruction"]);void 0!==b&&null!=n&&bF(b,["setup","systemInstruction"],function(a){let b={},c=bG(a,["parts"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>{var b;let c,d,e,f,g,h,i,j,k,l,m;return c={},null!=(d=bG(b=a,["functionCall"]))&&bF(c,["functionCall"],d),null!=(e=bG(b,["codeExecutionResult"]))&&bF(c,["codeExecutionResult"],e),null!=(f=bG(b,["executableCode"]))&&bF(c,["executableCode"],f),null!=(g=bG(b,["fileData"]))&&bF(c,["fileData"],function(a){let b={};if(void 0!==bG(a,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let c=bG(a,["fileUri"]);null!=c&&bF(b,["fileUri"],c);let d=bG(a,["mimeType"]);return null!=d&&bF(b,["mimeType"],d),b}(g)),null!=(h=bG(b,["functionResponse"]))&&bF(c,["functionResponse"],h),null!=(i=bG(b,["inlineData"]))&&bF(c,["inlineData"],function(a){let b={},c=bG(a,["data"]);if(null!=c&&bF(b,["data"],c),void 0!==bG(a,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let d=bG(a,["mimeType"]);return null!=d&&bF(b,["mimeType"],d),b}(i)),null!=(j=bG(b,["text"]))&&bF(c,["text"],j),null!=(k=bG(b,["thought"]))&&bF(c,["thought"],k),null!=(l=bG(b,["thoughtSignature"]))&&bF(c,["thoughtSignature"],l),null!=(m=bG(b,["videoMetadata"]))&&bF(c,["videoMetadata"],m),c})),bF(b,["parts"],a)}let d=bG(a,["role"]);return null!=d&&bF(b,["role"],d),b}(cj(n)));let o=bG(a,["tools"]);if(void 0!==b&&null!=o){let a=cq(o);Array.isArray(a)&&(a=a.map(a=>(function(a){let b={},c=bG(a,["functionDeclarations"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["functionDeclarations"],a)}if(void 0!==bG(a,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let d=bG(a,["googleSearchRetrieval"]);null!=d&&bF(b,["googleSearchRetrieval"],d);let e=bG(a,["computerUse"]);null!=e&&bF(b,["computerUse"],e);let f=bG(a,["fileSearch"]);null!=f&&bF(b,["fileSearch"],f);let g=bG(a,["codeExecution"]);if(null!=g&&bF(b,["codeExecution"],g),void 0!==bG(a,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let h=bG(a,["googleMaps"]);null!=h&&bF(b,["googleMaps"],function(a){let b={};if(void 0!==bG(a,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let c=bG(a,["enableWidget"]);return null!=c&&bF(b,["enableWidget"],c),b}(h));let i=bG(a,["googleSearch"]);null!=i&&bF(b,["googleSearch"],function(a){let b={};if(void 0!==bG(a,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==bG(a,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let c=bG(a,["timeRangeFilter"]);return null!=c&&bF(b,["timeRangeFilter"],c),b}(i));let j=bG(a,["urlContext"]);return null!=j&&bF(b,["urlContext"],j),b})(cp(a)))),bF(b,["setup","tools"],a)}let p=bG(a,["sessionResumption"]);void 0!==b&&null!=p&&bF(b,["setup","sessionResumption"],function(a){let b={},c=bG(a,["handle"]);if(null!=c&&bF(b,["handle"],c),void 0!==bG(a,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return b}(p));let q=bG(a,["inputAudioTranscription"]);void 0!==b&&null!=q&&bF(b,["setup","inputAudioTranscription"],q);let r=bG(a,["outputAudioTranscription"]);void 0!==b&&null!=r&&bF(b,["setup","outputAudioTranscription"],r);let s=bG(a,["realtimeInputConfig"]);void 0!==b&&null!=s&&bF(b,["setup","realtimeInputConfig"],s);let t=bG(a,["contextWindowCompression"]);void 0!==b&&null!=t&&bF(b,["setup","contextWindowCompression"],t);let u=bG(a,["proactivity"]);return void 0!==b&&null!=u&&bF(b,["setup","proactivity"],u),{}}(k,i)),i)),r=bG(m,["lockAdditionalFields"]),void 0!==l&&null!=r&&bF(l,["fieldMask"],r),{})),l);g=bE("auth_tokens",s._url),h=s._query,delete s.config,delete s._url,delete s._query;let t=function(a,b){let c=null,d=a.bidiGenerateContentSetup;if("object"==typeof d&&null!==d&&"setup"in d){let b=d.setup;"object"==typeof b&&null!==b?(a.bidiGenerateContentSetup=b,c=b):delete a.bidiGenerateContentSetup}else void 0!==d&&delete a.bidiGenerateContentSetup;let e=a.fieldMask;if(c){let d=function(a){let b=[];for(let c in a)if(Object.prototype.hasOwnProperty.call(a,c)){let d=a[c];if("object"==typeof d&&null!=d&&Object.keys(d).length>0){let a=Object.keys(d).map(a=>`${c}.${a}`);b.push(...a)}else b.push(c)}return b.join(",")}(c);if(Array.isArray(null==b?void 0:b.lockAdditionalFields)&&(null==b?void 0:b.lockAdditionalFields.length)===0)d?a.fieldMask=d:delete a.fieldMask;else if((null==b?void 0:b.lockAdditionalFields)&&b.lockAdditionalFields.length>0&&null!==e&&Array.isArray(e)&&e.length>0){let b=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],c=[];e.length>0&&(c=e.map(a=>b.includes(a)?`generationConfig.${a}`:a));let f=[];d&&f.push(d),c.length>0&&f.push(...c),f.length>0?a.fieldMask=f.join(","):delete a.fieldMask}else delete a.fieldMask}else null!==e&&Array.isArray(e)&&e.length>0?a.fieldMask=e.join(","):delete a.fieldMask;return a}(s,a.config);return this.apiClient.request({path:g,queryParams:h,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>a)}}}class dw extends bD{constructor(a){super(),this.apiClient=a,this.list=async a=>new cG(bd.PAGED_ITEM_DOCUMENTS,b=>this.listInternal({parent:a.parent,config:b.config}),await this.listInternal(a),a)}async get(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h=(f={},null!=(g=bG(a,["name"]))&&bF(f,["_url","name"],g),f);return d=bE("{name}",h._url),e=h._query,delete h._url,delete h._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(h),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>a)}}async delete(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h,i,j=(f={},null!=(g=bG(a,["name"]))&&bF(f,["_url","name"],g),null!=(h=bG(a,["config"]))&&(i=bG(h,["force"]),void 0!==f&&null!=i&&bF(f,["_query","force"],i)),f);d=bE("{name}",j._url),e=j._query,delete j._url,delete j._query,await this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(j),httpMethod:"DELETE",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal})}}async listInternal(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h,i,j,k=(f={},null!=(g=bG(a,["parent"]))&&bF(f,["_url","parent"],g),null!=(h=bG(a,["config"]))&&(i=bG(h,["pageSize"]),void 0!==f&&null!=i&&bF(f,["_query","pageSize"],i),j=bG(h,["pageToken"]),void 0!==f&&null!=j&&bF(f,["_query","pageToken"],j)),f);return d=bE("{parent}/documents",k._url),e=k._query,delete k._url,delete k._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(k),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["nextPageToken"]);null!=d&&bF(b,["nextPageToken"],d);let e=bG(a,["documents"]);if(null!=e){let a=e;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["documents"],a)}return b}(a),c=new bZ;return Object.assign(c,b),c})}}}class dx extends bD{constructor(a,b=new dw(a)){super(),this.apiClient=a,this.documents=b,this.list=async(a={})=>new cG(bd.PAGED_ITEM_FILE_SEARCH_STORES,a=>this.listInternal(a),await this.listInternal(a),a)}async uploadToFileSearchStore(a){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(a.fileSearchStoreName,a.file,a.config)}async create(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h,i=(f={},null!=(g=bG(a,["config"]))&&(h=bG(g,["displayName"]),void 0!==f&&null!=h&&bF(f,["displayName"],h)),f);return d=bE("fileSearchStores",i._url),e=i._query,delete i._url,delete i._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>a)}}async get(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h=(f={},null!=(g=bG(a,["name"]))&&bF(f,["_url","name"],g),f);return d=bE("{name}",h._url),e=h._query,delete h._url,delete h._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(h),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>a)}}async delete(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h,i,j=(f={},null!=(g=bG(a,["name"]))&&bF(f,["_url","name"],g),null!=(h=bG(a,["config"]))&&(i=bG(h,["force"]),void 0!==f&&null!=i&&bF(f,["_query","force"],i)),f);d=bE("{name}",j._url),e=j._query,delete j._url,delete j._query,await this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(j),httpMethod:"DELETE",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal})}}async listInternal(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h,i,j=(f={},null!=(g=bG(a,["config"]))&&(h=bG(g,["pageSize"]),void 0!==f&&null!=h&&bF(f,["_query","pageSize"],h),i=bG(g,["pageToken"]),void 0!==f&&null!=i&&bF(f,["_query","pageToken"],i)),f);return d=bE("fileSearchStores",j._url),e=j._query,delete j._url,delete j._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(j),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>{let b=function(a){let b={},c=bG(a,["sdkHttpResponse"]);null!=c&&bF(b,["sdkHttpResponse"],c);let d=bG(a,["nextPageToken"]);null!=d&&bF(b,["nextPageToken"],d);let e=bG(a,["fileSearchStores"]);if(null!=e){let a=e;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["fileSearchStores"],a)}return b}(a),c=new b$;return Object.assign(c,b),c})}}async uploadToFileSearchStoreInternal(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h,i=(f={},null!=(g=bG(a,["fileSearchStoreName"]))&&bF(f,["_url","file_search_store_name"],g),null!=(h=bG(a,["config"]))&&function(a,b){let c=bG(a,["mimeType"]);void 0!==b&&null!=c&&bF(b,["mimeType"],c);let d=bG(a,["displayName"]);void 0!==b&&null!=d&&bF(b,["displayName"],d);let e=bG(a,["customMetadata"]);if(void 0!==b&&null!=e){let a=e;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["customMetadata"],a)}let f=bG(a,["chunkingConfig"]);void 0!==b&&null!=f&&bF(b,["chunkingConfig"],f)}(h,f),f);return d=bE("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",i._url),e=i._query,delete i._url,delete i._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(i),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>{let b,c,d=(b={},null!=(c=bG(a,["sdkHttpResponse"]))&&bF(b,["sdkHttpResponse"],c),b),e=new b_;return Object.assign(e,d),e})}}async importFile(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h,i,j=(f={},null!=(g=bG(a,["fileSearchStoreName"]))&&bF(f,["_url","file_search_store_name"],g),null!=(h=bG(a,["fileName"]))&&bF(f,["fileName"],h),null!=(i=bG(a,["config"]))&&function(a,b){let c=bG(a,["customMetadata"]);if(void 0!==b&&null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>a)),bF(b,["customMetadata"],a)}let d=bG(a,["chunkingConfig"]);void 0!==b&&null!=d&&bF(b,["chunkingConfig"],d)}(i,f),f);return d=bE("{file_search_store_name}:importFile",j._url),e=j._query,delete j._url,delete j._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(j),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json()).then(a=>{var b;let c,d,e,f,g,h,i,j,k,l,m=(g={},null!=(h=bG(a,["name"]))&&bF(g,["name"],h),null!=(i=bG(a,["metadata"]))&&bF(g,["metadata"],i),null!=(j=bG(a,["done"]))&&bF(g,["done"],j),null!=(k=bG(a,["error"]))&&bF(g,["error"],k),null!=(l=bG(a,["response"]))&&bF(g,["response"],(c={},null!=(d=bG(b=l,["sdkHttpResponse"]))&&bF(c,["sdkHttpResponse"],d),null!=(e=bG(b,["parent"]))&&bF(c,["parent"],e),null!=(f=bG(b,["documentName"]))&&bF(c,["documentName"],f),c)),g),n=new b0;return Object.assign(n,m),n})}}}let dy="x-goog-api-key",dz="https://www.googleapis.com/auth/cloud-platform";class dA{constructor(a){if(void 0!==a.apiKey){this.apiKey=a.apiKey;return}const b=function(a){let b;if(!a)return{scopes:[dz]};if((b=a).scopes){if("string"==typeof b.scopes&&b.scopes!==dz||Array.isArray(b.scopes)&&0>b.scopes.indexOf(dz))throw Error(`Invalid auth scopes. Scopes must include: ${dz}`)}else b.scopes=[dz];return b}(a.googleAuthOptions);this.googleAuth=new bw.GoogleAuth(b)}async addAuthHeaders(a,b){if(void 0!==this.apiKey){if(this.apiKey.startsWith("auth_tokens/"))throw Error("Ephemeral tokens are only supported by the live API.");this.addKeyHeader(a);return}return this.addGoogleAuthHeaders(a,b)}addKeyHeader(a){if(null===a.get(dy)){if(void 0===this.apiKey)throw Error("Trying to set API key header but apiKey is not set");a.append(dy,this.apiKey)}}async addGoogleAuthHeaders(a,b){if(void 0===this.googleAuth)throw Error("Trying to set google-auth headers but googleAuth is unset");for(let[c,d]of(await this.googleAuth.getRequestHeaders(b)))null===a.get(c)&&a.append(c,d)}}class dB{async download(a,b){if(a.downloadPath){let c=await dC(a,b);if(c instanceof bJ){let b=(0,bx.createWriteStream)(a.downloadPath);bz.Readable.fromWeb(c.responseInternal.body).pipe(b),await (0,bA.finished)(b)}else try{await (0,by.writeFile)(a.downloadPath,c,{encoding:"base64"})}catch(b){throw Error(`Failed to write file to ${a.downloadPath}: ${b}`)}}}}async function dC(a,b){var c,d,e;let f=cv(a.file);if(void 0!==f)return await b.request({path:`files/${f}:download`,httpMethod:"GET",queryParams:{alt:"media"},httpOptions:null==(c=a.config)?void 0:c.httpOptions,abortSignal:null==(d=a.config)?void 0:d.abortSignal});if(ct(a.file)){let b=null==(e=a.file.video)?void 0:e.videoBytes;if("string"==typeof b)return b;throw Error("Failed to download generated video, Uri or videoBytes not found.")}if(cu(a.file)){let b=a.file.videoBytes;if("string"==typeof b)return b;throw Error("Failed to download video, Uri or videoBytes not found.")}throw Error("Unsupported file type")}class dD{create(a,b,c){return new dE(a,b,c)}}class dE{constructor(a,b,c){this.url=a,this.headers=b,this.callbacks=c}connect(){this.ws=new bB.default(this.url,{headers:this.headers}),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(a){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.send(a)}close(){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.close()}}function dF(a,b){let c,d,e,f={},g=bG(a,["sdkHttpResponse"]);null!=g&&bF(f,["sdkHttpResponse"],g);let h=bG(a,["name"]);null!=h&&bF(f,["name"],h);let i=bG(a,["state"]);null!=i&&bF(f,["state"],cs(i));let j=bG(a,["createTime"]);null!=j&&bF(f,["createTime"],j);let k=bG(a,["tuningTask","startTime"]);null!=k&&bF(f,["startTime"],k);let l=bG(a,["tuningTask","completeTime"]);null!=l&&bF(f,["endTime"],l);let m=bG(a,["updateTime"]);null!=m&&bF(f,["updateTime"],m);let n=bG(a,["description"]);null!=n&&bF(f,["description"],n);let o=bG(a,["baseModel"]);null!=o&&bF(f,["baseModel"],o);let p=bG(a,["_self"]);return null!=p&&bF(f,["tunedModel"],(c={},null!=(d=bG(p,["name"]))&&bF(c,["model"],d),null!=(e=bG(p,["name"]))&&bF(c,["endpoint"],e),c)),f}function dG(a,b){let c={},d=bG(a,["sdkHttpResponse"]);null!=d&&bF(c,["sdkHttpResponse"],d);let e=bG(a,["name"]);null!=e&&bF(c,["name"],e);let f=bG(a,["state"]);null!=f&&bF(c,["state"],cs(f));let g=bG(a,["createTime"]);null!=g&&bF(c,["createTime"],g);let h=bG(a,["startTime"]);null!=h&&bF(c,["startTime"],h);let i=bG(a,["endTime"]);null!=i&&bF(c,["endTime"],i);let j=bG(a,["updateTime"]);null!=j&&bF(c,["updateTime"],j);let k=bG(a,["error"]);null!=k&&bF(c,["error"],k);let l=bG(a,["description"]);null!=l&&bF(c,["description"],l);let m=bG(a,["baseModel"]);null!=m&&bF(c,["baseModel"],m);let n=bG(a,["tunedModel"]);null!=n&&bF(c,["tunedModel"],n);let o=bG(a,["preTunedModel"]);null!=o&&bF(c,["preTunedModel"],o);let p=bG(a,["supervisedTuningSpec"]);null!=p&&bF(c,["supervisedTuningSpec"],p);let q=bG(a,["preferenceOptimizationSpec"]);null!=q&&bF(c,["preferenceOptimizationSpec"],q);let r=bG(a,["tuningDataStats"]);null!=r&&bF(c,["tuningDataStats"],r);let s=bG(a,["encryptionSpec"]);null!=s&&bF(c,["encryptionSpec"],s);let t=bG(a,["partnerModelTuningSpec"]);null!=t&&bF(c,["partnerModelTuningSpec"],t);let u=bG(a,["customBaseModel"]);null!=u&&bF(c,["customBaseModel"],u);let v=bG(a,["experiment"]);null!=v&&bF(c,["experiment"],v);let w=bG(a,["labels"]);null!=w&&bF(c,["labels"],w);let x=bG(a,["outputUri"]);null!=x&&bF(c,["outputUri"],x);let y=bG(a,["pipelineJob"]);null!=y&&bF(c,["pipelineJob"],y);let z=bG(a,["serviceAccount"]);null!=z&&bF(c,["serviceAccount"],z);let A=bG(a,["tunedModelDisplayName"]);null!=A&&bF(c,["tunedModelDisplayName"],A);let B=bG(a,["veoTuningSpec"]);return null!=B&&bF(c,["veoTuningSpec"],B),c}function dH(a,b){let c={},d=bG(a,["gcsUri"]);null!=d&&bF(c,["validationDatasetUri"],d);let e=bG(a,["vertexDatasetResource"]);return null!=e&&bF(c,["validationDatasetUri"],e),c}class dI extends bD{constructor(a){super(),this.apiClient=a,this.get=async a=>await this.getInternal(a),this.list=async(a={})=>new cG(bd.PAGED_ITEM_TUNING_JOBS,a=>this.listInternal(a),await this.listInternal(a),a),this.tune=async a=>{var b;if(this.apiClient.isVertexAI())if(a.baseModel.startsWith("projects/")){let c={tunedModelName:a.baseModel};(null==(b=a.config)?void 0:b.preTunedModelCheckpointId)&&(c.checkpointId=a.config.preTunedModelCheckpointId);let d=Object.assign(Object.assign({},a),{preTunedModel:c});return d.baseModel=void 0,await this.tuneInternal(d)}else{let b=Object.assign({},a);return await this.tuneInternal(b)}{let b=Object.assign({},a),c=await this.tuneMldevInternal(b),d="";return void 0!==c.metadata&&void 0!==c.metadata.tunedModel?d=c.metadata.tunedModel:void 0!==c.name&&c.name.includes("/operations/")&&(d=c.name.split("/operations/")[0]),{name:d,state:aK.JOB_STATE_QUEUED}}}}async getInternal(a){var b,c,d,e;let f="",g={};if(this.apiClient.isVertexAI()){let d,e,h=(d={},null!=(e=bG(a,["name"]))&&bF(d,["_url","name"],e),d);return f=bE("{name}",h._url),g=h._query,delete h._url,delete h._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>dG(a))}{let b,c,h=(b={},null!=(c=bG(a,["name"]))&&bF(b,["_url","name"],c),b);return f=bE("{name}",h._url),g=h._query,delete h._url,delete h._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(h),httpMethod:"GET",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>dF(a))}}async listInternal(a){var b,c,d,e;let f="",g={};if(this.apiClient.isVertexAI()){let d,e,h,i,j,k=(d={},null!=(e=bG(a,["config"]))&&(h=bG(e,["pageSize"]),void 0!==d&&null!=h&&bF(d,["_query","pageSize"],h),i=bG(e,["pageToken"]),void 0!==d&&null!=i&&bF(d,["_query","pageToken"],i),j=bG(e,["filter"]),void 0!==d&&null!=j&&bF(d,["_query","filter"],j)),d);return f=bE("tuningJobs",k._url),g=k._query,delete k._url,delete k._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(k),httpMethod:"GET",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a,b){let c={},d=bG(a,["sdkHttpResponse"]);null!=d&&bF(c,["sdkHttpResponse"],d);let e=bG(a,["nextPageToken"]);null!=e&&bF(c,["nextPageToken"],e);let f=bG(a,["tuningJobs"]);if(null!=f){let a=f;Array.isArray(a)&&(a=a.map(a=>dG(a))),bF(c,["tuningJobs"],a)}return c}(a),c=new bW;return Object.assign(c,b),c})}{let b,c,h,i,j,k=(b={},null!=(c=bG(a,["config"]))&&(h=bG(c,["pageSize"]),void 0!==b&&null!=h&&bF(b,["_query","pageSize"],h),i=bG(c,["pageToken"]),void 0!==b&&null!=i&&bF(b,["_query","pageToken"],i),j=bG(c,["filter"]),void 0!==b&&null!=j&&bF(b,["_query","filter"],j)),b);return f=bE("tunedModels",k._url),g=k._query,delete k._url,delete k._query,this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(k),httpMethod:"GET",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b=function(a,b){let c={},d=bG(a,["sdkHttpResponse"]);null!=d&&bF(c,["sdkHttpResponse"],d);let e=bG(a,["nextPageToken"]);null!=e&&bF(c,["nextPageToken"],e);let f=bG(a,["tunedModels"]);if(null!=f){let a=f;Array.isArray(a)&&(a=a.map(a=>dF(a))),bF(c,["tuningJobs"],a)}return c}(a),c=new bW;return Object.assign(c,b),c})}}async cancel(a){var b,c,d,e;let f="",g={};if(this.apiClient.isVertexAI()){let d,e,h=(d={},null!=(e=bG(a,["name"]))&&bF(d,["_url","name"],e),d);f=bE("{name}:cancel",h._url),g=h._query,delete h._url,delete h._query,await this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal})}else{let b,c,h=(b={},null!=(c=bG(a,["name"]))&&bF(b,["_url","name"],c),b);f=bE("{name}:cancel",h._url),g=h._query,delete h._url,delete h._query,await this.apiClient.request({path:f,queryParams:g,body:JSON.stringify(h),httpMethod:"POST",httpOptions:null==(d=a.config)?void 0:d.httpOptions,abortSignal:null==(e=a.config)?void 0:e.abortSignal})}}async tuneInternal(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI()){let f,g,h,i,j,k=(f={},null!=(g=bG(a,["baseModel"]))&&bF(f,["baseModel"],g),null!=(h=bG(a,["preTunedModel"]))&&bF(f,["preTunedModel"],h),null!=(i=bG(a,["trainingDataset"]))&&function(a,b,c){let d=bG(c,["config","method"]);if(void 0===d&&(d="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===d){let c=bG(a,["gcsUri"]);void 0!==b&&null!=c&&bF(b,["supervisedTuningSpec","trainingDatasetUri"],c)}else if("PREFERENCE_TUNING"===d){let c=bG(a,["gcsUri"]);void 0!==b&&null!=c&&bF(b,["preferenceOptimizationSpec","trainingDatasetUri"],c)}let e=bG(c,["config","method"]);if(void 0===e&&(e="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===e){let c=bG(a,["vertexDatasetResource"]);void 0!==b&&null!=c&&bF(b,["supervisedTuningSpec","trainingDatasetUri"],c)}else if("PREFERENCE_TUNING"===e){let c=bG(a,["vertexDatasetResource"]);void 0!==b&&null!=c&&bF(b,["preferenceOptimizationSpec","trainingDatasetUri"],c)}if(void 0!==bG(a,["examples"]))throw Error("examples parameter is not supported in Vertex AI.")}(i,f,a),null!=(j=bG(a,["config"]))&&function(a,b,c){let d=bG(c,["config","method"]);if(void 0===d&&(d="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===d){let c=bG(a,["validationDataset"]);void 0!==b&&null!=c&&bF(b,["supervisedTuningSpec"],dH(c))}else if("PREFERENCE_TUNING"===d){let c=bG(a,["validationDataset"]);void 0!==b&&null!=c&&bF(b,["preferenceOptimizationSpec"],dH(c))}let e=bG(a,["tunedModelDisplayName"]);void 0!==b&&null!=e&&bF(b,["tunedModelDisplayName"],e);let f=bG(a,["description"]);void 0!==b&&null!=f&&bF(b,["description"],f);let g=bG(c,["config","method"]);if(void 0===g&&(g="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===g){let c=bG(a,["epochCount"]);void 0!==b&&null!=c&&bF(b,["supervisedTuningSpec","hyperParameters","epochCount"],c)}else if("PREFERENCE_TUNING"===g){let c=bG(a,["epochCount"]);void 0!==b&&null!=c&&bF(b,["preferenceOptimizationSpec","hyperParameters","epochCount"],c)}let h=bG(c,["config","method"]);if(void 0===h&&(h="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===h){let c=bG(a,["learningRateMultiplier"]);void 0!==b&&null!=c&&bF(b,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],c)}else if("PREFERENCE_TUNING"===h){let c=bG(a,["learningRateMultiplier"]);void 0!==b&&null!=c&&bF(b,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],c)}let i=bG(c,["config","method"]);if(void 0===i&&(i="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===i){let c=bG(a,["exportLastCheckpointOnly"]);void 0!==b&&null!=c&&bF(b,["supervisedTuningSpec","exportLastCheckpointOnly"],c)}else if("PREFERENCE_TUNING"===i){let c=bG(a,["exportLastCheckpointOnly"]);void 0!==b&&null!=c&&bF(b,["preferenceOptimizationSpec","exportLastCheckpointOnly"],c)}let j=bG(c,["config","method"]);if(void 0===j&&(j="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===j){let c=bG(a,["adapterSize"]);void 0!==b&&null!=c&&bF(b,["supervisedTuningSpec","hyperParameters","adapterSize"],c)}else if("PREFERENCE_TUNING"===j){let c=bG(a,["adapterSize"]);void 0!==b&&null!=c&&bF(b,["preferenceOptimizationSpec","hyperParameters","adapterSize"],c)}if(void 0!==bG(a,["batchSize"]))throw Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==bG(a,["learningRate"]))throw Error("learningRate parameter is not supported in Vertex AI.");let k=bG(a,["labels"]);void 0!==b&&null!=k&&bF(b,["labels"],k);let l=bG(a,["beta"]);void 0!==b&&null!=l&&bF(b,["preferenceOptimizationSpec","hyperParameters","beta"],l)}(j,f,a),f);return d=bE("tuningJobs",k._url),e=k._query,delete k._url,delete k._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(k),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>dG(a))}throw Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(a){var b,c;let d="",e={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let f,g,h,i,j,k=(f={},null!=(g=bG(a,["baseModel"]))&&bF(f,["baseModel"],g),null!=(h=bG(a,["preTunedModel"]))&&bF(f,["preTunedModel"],h),null!=(i=bG(a,["trainingDataset"]))&&function(a,b){if(void 0!==bG(a,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==bG(a,["vertexDatasetResource"]))throw Error("vertexDatasetResource parameter is not supported in Gemini API.");let c=bG(a,["examples"]);if(null!=c){let a=c;Array.isArray(a)&&(a=a.map(a=>a)),bF({},["examples","examples"],a)}}(i),null!=(j=bG(a,["config"]))&&function(a,b,c){if(void 0!==bG(a,["validationDataset"]))throw Error("validationDataset parameter is not supported in Gemini API.");let d=bG(a,["tunedModelDisplayName"]);if(void 0!==b&&null!=d&&bF(b,["displayName"],d),void 0!==bG(a,["description"]))throw Error("description parameter is not supported in Gemini API.");let e=bG(a,["epochCount"]);void 0!==b&&null!=e&&bF(b,["tuningTask","hyperparameters","epochCount"],e);let f=bG(a,["learningRateMultiplier"]);if(null!=f&&bF({},["tuningTask","hyperparameters","learningRateMultiplier"],f),void 0!==bG(a,["exportLastCheckpointOnly"]))throw Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==bG(a,["preTunedModelCheckpointId"]))throw Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==bG(a,["adapterSize"]))throw Error("adapterSize parameter is not supported in Gemini API.");let g=bG(a,["batchSize"]);void 0!==b&&null!=g&&bF(b,["tuningTask","hyperparameters","batchSize"],g);let h=bG(a,["learningRate"]);if(void 0!==b&&null!=h&&bF(b,["tuningTask","hyperparameters","learningRate"],h),void 0!==bG(a,["labels"]))throw Error("labels parameter is not supported in Gemini API.");if(void 0!==bG(a,["beta"]))throw Error("beta parameter is not supported in Gemini API.")}(j,f),f);return d=bE("tunedModels",k._url),e=k._query,delete k._url,delete k._query,this.apiClient.request({path:d,queryParams:e,body:JSON.stringify(k),httpMethod:"POST",httpOptions:null==(b=a.config)?void 0:b.httpOptions,abortSignal:null==(c=a.config)?void 0:c.abortSignal}).then(a=>a.json().then(b=>(b.sdkHttpResponse={headers:a.headers},b))).then(a=>{let b,c,d,e,f,g;return b={},null!=(c=bG(a,["sdkHttpResponse"]))&&bF(b,["sdkHttpResponse"],c),null!=(d=bG(a,["name"]))&&bF(b,["name"],d),null!=(e=bG(a,["metadata"]))&&bF(b,["metadata"],e),null!=(f=bG(a,["done"]))&&bF(b,["done"],f),null!=(g=bG(a,["error"]))&&bF(b,["error"],g),b})}}}let dJ="x-goog-upload-status";async function dK(a,b,c){var d;let e=await dM(a,b,c),f=await (null==e?void 0:e.json());if((null==(d=null==e?void 0:e.headers)?void 0:d[dJ])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return f.file}async function dL(a,b,c){var d;let e=await dM(a,b,c),f=await (null==e?void 0:e.json());if((null==(d=null==e?void 0:e.headers)?void 0:d[dJ])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");let g=bI(f),h=new b7;return Object.assign(h,g),h}async function dM(a,b,c){var d,e;let f=0,g=0,h=new bJ(new Response),i="upload";for(f=a.size;g<f;){let j=Math.min(8388608,f-g),k=a.slice(g,g+j);g+j>=f&&(i+=", finalize");let l=0,m=1e3;for(;l<3&&(null==(d=null==(h=await c.request({path:"",body:k,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:b,headers:{"X-Goog-Upload-Command":i,"X-Goog-Upload-Offset":String(g),"Content-Length":String(j)}}}))?void 0:h.headers)||!d[dJ]);)l++,await dO(m),m*=2;if(g+=j,(null==(e=null==h?void 0:h.headers)?void 0:e[dJ])!=="active")break;if(f<=g)throw Error("All content has been uploaded, but the upload status is not finalized.")}return h}async function dN(a){return{size:a.size,type:a.type}}function dO(a){return new Promise(b=>setTimeout(b,a))}class dP{async stat(a){let b={size:0,type:void 0};return"string"==typeof a?(b.size=(await by.stat(a)).size,b.type=this.inferMimeType(a),b):await dN(a)}async upload(a,b,c){return"string"==typeof a?await this.uploadFileFromPath(a,b,c):dK(a,b,c)}async uploadToFileSearchStore(a,b,c){return"string"==typeof a?await this.uploadFileToFileSearchStoreFromPath(a,b,c):dL(a,b,c)}inferMimeType(a){return({aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz+xml",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"})[a.slice(a.lastIndexOf(".")+1).toLowerCase()]}async uploadFileFromPath(a,b,c){var d;let e=await this.uploadFileFromPathInternal(a,b,c),f=await (null==e?void 0:e.json());if((null==(d=null==e?void 0:e.headers)?void 0:d[dJ])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return f.file}async uploadFileToFileSearchStoreFromPath(a,b,c){var d;let e=await this.uploadFileFromPathInternal(a,b,c),f=await (null==e?void 0:e.json());if((null==(d=null==e?void 0:e.headers)?void 0:d[dJ])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");let g=bI(f),h=new b7;return Object.assign(h,g),h}async uploadFileFromPathInternal(a,b,c){var d,e;let f,g=0,h=0,i=new bJ(new Response),j="upload",k=bC.basename(a);try{if(!(f=await by.open(a,"r")))throw Error("Failed to open file");for(g=(await f.stat()).size;h<g;){let a=Math.min(8388608,g-h);h+a>=g&&(j+=", finalize");let l=new Uint8Array(a),{bytesRead:m}=await f.read(l,0,a,h);if(m!==a)throw Error(`Failed to read ${a} bytes from file at offset ${h}. bytes actually read: ${m}`);let n=new Blob([l]),o=0,p=1e3;for(;o<3&&(null==(d=null==(i=await c.request({path:"",body:n,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:b,headers:{"X-Goog-Upload-Command":j,"X-Goog-Upload-Offset":String(h),"Content-Length":String(m),"X-Goog-Upload-File-Name":k}}}))?void 0:i.headers)||!d[dJ]);)o++,await dO(p),p*=2;if(h+=m,(null==(e=null==i?void 0:i.headers)?void 0:e[dJ])!=="active")break;if(g<=h)throw Error("All content has been uploaded, but the upload status is not finalized.")}return i}finally{f&&await f.close()}}}class dQ{constructor(a){var d,e,f,g,h,i;if((a.project||a.location)&&a.apiKey)throw Error("Project/location and API key are mutually exclusive in the client initializer.");this.vertexai=null!=(e=null!=(d=a.vertexai)?d:function(a){var b;return void 0!==(b=dR(a))&&"true"===b.toLowerCase()}("GOOGLE_GENAI_USE_VERTEXAI"))&&e;const j=function(){let a=dR("GOOGLE_API_KEY"),b=dR("GEMINI_API_KEY");return a&&b&&console.warn("Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY."),a||b||void 0}(),k=dR("GOOGLE_CLOUD_PROJECT"),l=dR("GOOGLE_CLOUD_LOCATION");this.apiKey=null!=(f=a.apiKey)?f:j,this.project=null!=(g=a.project)?g:k,this.location=null!=(h=a.location)?h:l,a.vertexai&&((null==(i=a.googleAuthOptions)?void 0:i.credentials)&&(console.debug("The user provided Google Cloud credentials will take precedence over the API key from the environment variable."),this.apiKey=void 0),(k||l)&&a.apiKey?(console.debug("The user provided Vertex AI API key will take precedence over the project/location from the environment variables."),this.project=void 0,this.location=void 0):(a.project||a.location)&&j?(console.debug("The user provided project/location will take precedence over the API key from the environment variables."),this.apiKey=void 0):(k||l)&&j&&(console.debug("The project/location from the environment variables will take precedence over the API key from the environment variables."),this.apiKey=void 0),this.location||this.apiKey||(this.location="global"));const m=function(a,d,e,f){return(null==a?void 0:a.baseUrl)?a.baseUrl:d?null!=c?c:e:null!=b?b:f}(a.httpOptions,a.vertexai,dR("GOOGLE_VERTEX_BASE_URL"),dR("GOOGLE_GEMINI_BASE_URL"));m&&(a.httpOptions?a.httpOptions.baseUrl=m:a.httpOptions={baseUrl:m}),this.apiVersion=a.apiVersion;const n=new dA({apiKey:this.apiKey,googleAuthOptions:a.googleAuthOptions});this.apiClient=new dc({auth:n,project:this.project,location:this.location,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:a.httpOptions,userAgentExtra:"gl-node/"+process.version,uploader:new dP,downloader:new dB}),this.models=new dt(this.apiClient),this.live=new dl(this.apiClient,n,new dD),this.batches=new cH(this.apiClient),this.chats=new cP(this.models,this.apiClient),this.caches=new cJ(this.apiClient),this.files=new cS(this.apiClient),this.operations=new du(this.apiClient),this.authTokens=new dv(this.apiClient),this.tunings=new dI(this.apiClient),this.fileSearchStores=new dx(this.apiClient)}}function dR(a){var b,c,d;return null!=(d=null==(c=null==(b=null==process?void 0:process.env)?void 0:b[a])?void 0:c.trim())?d:void 0}let dS=null;function dT(){if(!dS){let a=process.env.NEXT_PUBLIC_GEMINI_API_KEY;if(!a)throw Error("NEXT_PUBLIC_GEMINI_API_KEY nÃ£o estÃ¡ configurada no arquivo .env.local");dS=new dQ({apiKey:a})}return dS}let dU="gemini-2.5-pro",dV="gemini-2.5-flash",dW=`Voc\xea \xe9 o "G\xeanesis", um assistente de IA especialista em tributa\xe7\xe3o brasileira. Sua principal fonte de conhecimento s\xe3o os documentos fornecidos no contexto. Responda \xe0s perguntas de forma clara, informativa e profissional, priorizando sempre as informa\xe7\xf5es contidas nesses documentos. Quando o contexto n\xe3o for suficiente, use seu conhecimento geral e a busca na web para complementar a resposta. Sempre cite as fontes da web que utilizar.`,dX=`Voc\xea \xe9 um programador especialista s\xeanior, fluente em Python e Delphi, com profundo conhecimento em regras tribut\xe1rias e fiscais. Sua tarefa \xe9 gerar fun\xe7\xf5es e trechos de c\xf3digo claros, eficientes e bem documentados para resolver problemas tribut\xe1rios. Sempre que poss\xedvel, adicione coment\xe1rios explicando a l\xf3gica e o c\xe1lculo fiscal implementado. Use blocos de c\xf3digo markdown para formatar sua resposta.`,dY=`Voc\xea \xe9 um especialista em otimiza\xe7\xe3o de buscas e prompts. Sua tarefa \xe9 analisar a pergunta do usu\xe1rio e, em vez de respond\xea-la diretamente, sugerir 3 maneiras alternativas e mais eficazes de formular a mesma pergunta para obter melhores resultados de um assistente de IA fiscal. Apresente as sugest\xf5es em uma lista numerada, cada uma com uma breve explica\xe7\xe3o do porqu\xea a nova formula\xe7\xe3o \xe9 melhor. Use markdown para formatar a lista.`;async function dZ(a){return console.warn("Using mock embeddings. Replace with a real embedding model API call."),a.map(()=>Array(768).fill(0).map(()=>2*Math.random()-1))}async function d$(a){try{let b=`Gere um t\xedtulo curto e descritivo (3-5 palavras) para uma conversa que come\xe7a com a seguinte pergunta do usu\xe1rio. Responda apenas com o t\xedtulo. Pergunta: "${a}"`,c=((await dT().models.generateContent({model:dV,contents:b})).text??"").trim().replace(/["']/g,"");if(!c)return console.warn("Gemini title generation returned empty response."),a.substring(0,30)+"...";return c}catch(b){return console.error("Error generating title:",b),a.substring(0,30)+"..."}}async function d_(a,b,c=!1){let d={};c&&(d.tools=[{googleSearch:{}}]);let e=await dT().models.generateContent({model:a,contents:b,config:d}),f=e.text||"",g=[];if(c){let a=e.candidates?.[0]?.groundingMetadata;if(a?.groundingChunks)for(let b of a.groundingChunks)b.web?.uri&&g.push({uri:b.web.uri,title:b.web.title||b.web.uri})}return{text:f,sources:Array.from(new Map(g.map(a=>[a.uri,a])).values())}}async function d0(a){return new Promise((b,c)=>{let d=new FileReader;d.onload=a=>{b(a.target?.result)},d.onerror=a=>{c(a)},d.readAsText(a)})}async function d1(a){if("undefined"==typeof pdfjsLib||"function"!=typeof pdfjsLib.getDocument)throw Error("A biblioteca PDF (pdf.js) nÃ£o foi carregada corretamente. Verifique a conexÃ£o com a internet ou recarregue a pÃ¡gina.");return new Promise((b,c)=>{let d=new FileReader;d.onload=async a=>{if(!a.target?.result)return c(Error("Falha ao ler o arquivo PDF."));try{let c=new Uint8Array(a.target.result),d=await pdfjsLib.getDocument({data:c}).promise,e="";for(let a=1;a<=d.numPages;a++){let b=await d.getPage(a),c=(await b.getTextContent()).items.map(a=>a.str).join(" ");e+=c+"\n\n"}b(e.trim())}catch(a){console.error("Erro ao analisar o PDF:",a),c(Error("O arquivo PDF estÃ¡ corrompido ou nÃ£o pÃ´de ser lido."))}},d.onerror=a=>{c(a)},d.readAsArrayBuffer(a)})}async function d2(a,b,c){let d=function(a){let b=[];if(!a)return b;let c=0;for(;c<a.length;){let d=a.substring(c,c+1e3);b.push(d),c+=800}return b}(a);if(0===d.length)return{id:`${b}-${Date.now()}`,name:b,chunks:[],isDeletable:c,content:a};let e=await dZ(d),f=d.map((a,b)=>({text:a,embedding:e[b]}));return{id:`${b}-${Date.now()}`,name:b,chunks:f,isDeletable:c,content:a}}async function d3(a){let b="",c=a.type,d=a.name.toLowerCase();if("application/pdf"===c||d.endsWith(".pdf"))b=await d1(a);else if("text/plain"===c||"text/markdown"===c||d.endsWith(".txt")||d.endsWith(".md"))b=await d0(a);else throw Error("Tipo de arquivo nÃ£o suportado. Por favor, envie .txt, .md ou .pdf.");return d2(b,a.name,!0)}let d4=(a,b)=>{if(a.length!==b.length)return 0;let c=0,d=0,e=0;for(let f=0;f<a.length;f++)c+=a[f]*b[f],d+=a[f]*a[f],e+=b[f]*b[f];let f=Math.sqrt(d)*Math.sqrt(e);return 0===f?0:c/f},d5=`
Um "agente que tem conhecimento sobre tributa\xe7\xe3o fiscal do Brasil" \xe9 um profissional ou uma empresa especializada em entender, interpretar e aplicar as complexas regras do sistema tribut\xe1rio brasileiro.

No Brasil, a tributa\xe7\xe3o \xe9 notoriamente uma das mais complexas do mundo, envolvendo tr\xeas esferas de governo (Federal, Estadual e Municipal), cada uma com seus pr\xf3prios impostos, regras e prazos. Um agente com este conhecimento \xe9, portanto, uma pe\xe7a-chave para qualquer empresa ou at\xe9 mesmo para pessoas f\xedsicas com patrim\xf4nio mais significativo.

Vamos detalhar o que este agente **\xe9**, o que ele **faz** e o que ele **precisa saber**.

---

### 1. Quem \xe9 este Agente? (Os Perfis)

Este agente pode ser um profissional com diferentes forma\xe7\xf5es, mas com uma especializa\xe7\xe3o em tributos. Os mais comuns s\xe3o:

*   **Contador / Empresa de Contabilidade:** \xc9 o profissional mais pr\xf3ximo do dia a dia das empresas. Respons\xe1vel pela escritura\xe7\xe3o cont\xe1bil, apura\xe7\xe3o dos impostos e entrega das obriga\xe7\xf5es acess\xf3rias.
*   **Advogado Tributarista:** Focado na interpreta\xe7\xe3o da lei, na defesa do cliente em processos administrativos e judiciais (contencioso tribut\xe1rio) e na emiss\xe3o de pareceres legais para opera\xe7\xf5es complexas.
*   **Consultor Tribut\xe1rio:** Pode ser um contador, advogado ou economista com especializa\xe7\xe3o. Geralmente atua de forma estrat\xe9gica, focado em **planejamento tribut\xe1rio** para otimizar e reduzir a carga de impostos de forma legal.
*   **Auditor Fiscal (do lado do Fisco):** \xc9 o agente do governo que fiscaliza o cumprimento das obriga\xe7\xf5es tribut\xe1rias. Conhecer seu trabalho \xe9 fundamental para se preparar para uma fiscaliza\xe7\xe3o.
*   **Gestor Financeiro / Empres\xe1rio:** Embora n\xe3o seja um especialista, um bom gestor precisa ter um conhecimento s\xf3lido dos basics de tributa\xe7\xe3o para tomar decis\xf5es de neg\xf3cio conscientes.

---

### 2. O que ele Faz? (As Principais Atividades)

As fun\xe7\xf5es deste agente v\xe3o muito al\xe9m de apenas "calcular e pagar impostos". Elas se dividem em \xe1reas estrat\xe9gicas e operacionais:

#### a) Planejamento Tribut\xe1rio
*   **O que \xe9:** A atividade mais estrat\xe9gica e valiosa. Consiste em estudar a legisla\xe7\xe3o para encontrar a forma legal mais eficiente de uma empresa operar, pagando menos impostos sem sonegar.
*   **Exemplos:** Escolher o melhor regime tribut\xe1rio (Simples Nacional, Lucro Presumido ou Lucro Real), estruturar opera\xe7\xf5es de fus\xe3o e aquisi\xe7\xe3o, decidir sobre a localiza\xe7\xe3o de uma nova f\xe1brica (levando em conta os benef\xedcios fiscais estaduais).

#### b) Compliance Tribut\xe1rio (Conformidade)
*   **O que \xe9:** \xc9 a \xe1rea operacional que garante que a empresa esteja em dia com todas as suas obriga\xe7\xf5es.
*   **Atividades:**
    *   Apurar e calcular os impostos (PIS, COFINS, IRPJ, ICMS, ISS, etc.).
    *   Preencher e entregar as declara\xe7\xf5es e obriga\xe7\xf5es acess\xf3rias (SPEDs, DCTF, GFIP, GIA, etc.).
    *   Emitir guias de pagamento (DARF, GARE, etc.) e garantir o pagamento dentro do prazo.
    *   Manter a documenta\xe7\xe3o fiscal em ordem.

#### c) Contencioso Tribut\xe1rio
*   **O que \xe9:** A \xe1rea de defesa da empresa. Quando h\xe1 uma autua\xe7\xe3o ou cobran\xe7a indevida por parte do Fisco, este agente atua para reverter a situa\xe7\xe3o.
*   **Atividades:**
    *   Apresentar defesas administrativas.
    *   Negotiar parcelamentos de d\xedvidas.
    *   Entrar com a\xe7\xf5es judiciais para discutir a cobran\xe7a de tributos.

#### d) Consultoria e Assessoria
*   **O que \xe9:** Dar suporte ao dia a dia e a decis\xf5es espec\xedficas.
*   **Exemplos:** "Posso deduzir esta despesa?", "Qual o impacto tribut\xe1rio de vender este produto para outro estado?", "Como tratar este imposto na contabilidade?".

---

### 3. O que ele Precisa Saber? (O Conhecimento Essencial)

O conhecimento deste agente \xe9 vasto e precisa ser constantemente atualizado. Os pilares s\xe3o:

*   **Sistema Tribut\xe1rio Nacional:** Entender a divis\xe3o de compet\xeancias entre Uni\xe3o, Estados e Munic\xedpios.
*   **Regimes Tribut\xe1rios:** Dominar as regras do **Simples Nacional**, **Lucro Presumido** e **Lucro Real**, sabendo qual a vantagem de cada um para um tipo espec\xedfico de empresa.
*   **Principais Tributos:**
    *   **Federais:** IRPJ (Imposto de Renda da Pessoa Jur\xeddrica), CSLL (Contribui\xe7\xe3o Social sobre o Lucro L\xedquido), PIS, COFINS, IPI (Imposto sobre Produtos Industrializados).
    *   **Estaduais:** ICMS (Imposto sobre Circula\xe7\xe3o de Mercadorias e Servi\xe7os).
    *   **Municipais:** ISS (Imposto Sobre Servi\xe7os).
*   **Obriga\xe7\xf5es Acess\xf3rias:** Conhecer a fundo o SPED (Sistema P\xfablico de Escritura\xe7\xe3o Digital) e suas vertentes (EFD-Contribui\xe7\xf5es, EFD-ICMS/IPI, ECF, etc.).
*   **Legisla\xe7\xe3o e Jurisprud\xeancia:** A lei tribut\xe1ria muda constantemente. Al\xe9m das leis, \xe9 preciso acompanhar as decis\xf5es dos tribunais (jurisprud\xeancia), que definem como a lei \xe9 interpretada na pr\xe1tica.
*   **\xc1reas Correlatas:** Ter no\xe7\xf5es de Contabilidade, Direito Empresarial e Finan\xe7as, pois a tributa\xe7\xe3o impacta todas essas \xe1reas.

---

### Conclus\xe3o: Por que este Agente \xe9 Fundamental?

No Brasil, ter um agente com conhecimento profundo em tributa\xe7\xe3o n\xe3o \xe9 um luxo, mas uma **necessidade estrat\xe9gica**. Ele \xe9 fundamental para:

1.  **Evitar Multas e Juros:** O erro no cumprimento de uma obriga\xe7\xe3o pode gerar penalidades alt\xedssimas.
2.  **Otimizar Custos:** Um bom planejamento pode reduzir a carga tribut\xe1ria, aumentando a competitividade e o lucro da empresa.
3.  **Garantir a Sustentabilidade:** A gest\xe3o tribut\xe1ria inadequada \xe9 uma das principais causas de fal\xeancia de empresas no Brasil.
4.  **Proporcionar Seguran\xe7a Jur\xeddica:** Dar tranquilidade ao empres\xe1rio para que ele possa focar no seu neg\xf3cio, sabendo que a parte fiscal est\xe1 sob controle.

Em resumo, este agente \xe9 o **navegador** que ajuda as empresas e indiv\xedduos a atravessar o "mar revolto" da tributa\xe7\xe3o brasileira de forma segura, eficiente e estrat\xe9gica. \xc9 um investimento, n\xe3o um custo.
`,d6=`
A nova reforma tribut\xe1ria brasileira, aprovada entre 2023 e 2025, configura-se como a maior mudan\xe7a fiscal das \xfaltimas d\xe9cadas e tem impacto significativo em praticamente todos os setores econ\xf4micos. Ela substitui os antigos tributos sobre consumo por novos impostos, simplificando a estrutura e promovendo maior transpar\xeancia, por\xe9m trazendo desafios espec\xedficos para servi\xe7os, agroneg\xf3cio, ind\xfastria e varejo[1][2][3].

### Principais Mudan\xe7as

- Os impostos federais PIS, Cofins e IPI, o estadual ICMS e o municipal ISS ser\xe3o substitu\xeddos por dois novos tributos:
  - CBS (Contribui\xe7\xe3o sobre Bens e Servi\xe7os), federal.
  - IBS (Imposto sobre Bens e Servi\xe7os), com gest\xe3o compartilhada entre estados e munic\xedpios.
- Implementa\xe7\xe3o do Imposto Seletivo (IS), incidente sobre bens e servi\xe7os nocivos \xe0 sa\xfade ou ao meio ambiente (bebidas alco\xf3licas, cigarros, combust\xedveis f\xf3sseis).
- Fim da cumulatividade e amplia\xe7\xe3o do cr\xe9dito financeiro para os tributos.
- Nova sistem\xe1tica de cobran\xe7a no destino para opera\xe7\xf5es entre estados, eliminando benef\xedcios regionais e simplificando obriga\xe7\xf5es acess\xf3rias[1][3][4][5].

### Impacto nos Setores Econ\xf4micos

- **Servi\xe7os**: Tende a ser o mais impactado negativamente, pois atualmente usufrui de regimes simplificados e al\xedquotas menores. A nova al\xedquota geral, pr\xf3xima de 25%, pode elevar significativamente o custo para empresas com pouca possibilidade de apropria\xe7\xe3o de cr\xe9ditos tribut\xe1rios (como advocacia, educa\xe7\xe3o, sa\xfade, tecnologia)[2][6][7].
- **Agroneg\xf3cio**: Apesar de isen\xe7\xf5es para itens da cesta b\xe1sica, outros insumos essenciais passar\xe3o a ser tributados, demandando readequa\xe7\xe3o fiscal e controle de cr\xe9ditos.
- **Varejo**: Ter\xe1 que investir em sistemas e compliance para lidar com os novos tributos e garantir o correto aproveitamento dos cr\xe9ditos fiscais. A transi\xe7\xe3o oferece oportunidade competitiva para quem se adaptar r\xe1pido[2][4].
- **Transporte**: Mudan\xe7as na incid\xeancia territorial (de origem para destino) e elimina\xe7\xe3o de benef\xedcios podem elevar custos do setor, exigindo reajuste de pre\xe7os e modelos operacionais[2][8].

### Cronograma de Implanta\xe7\xe3o

- **2023-2025**: Aprova\xe7\xe3o constitucional e regulamenta\xe7\xe3o infraconstitucional.
- **2026**: In\xedcio da fase experimental, CBS e IBS com al\xedquotas simb\xf3licas para testes nos sistemas das empresas.
- **2027**: In\xedcio do Imposto Seletivo (IS)[9][5][4].
- **At\xe9 2033**: Transi\xe7\xe3o gradual at\xe9 extin\xe7\xe3o completa dos antigos tributos e consolida\xe7\xe3o do novo modelo, exigindo adapta\xe7\xe3o simult\xe2nea aos sistemas antigos e novos nos pr\xf3ximos anos[9][4].

### Novidades para Empresas

- Obrigatoriedade de atualizar sistemas fiscais, adaptar classifica\xe7\xf5es de produto e processos internos.
- Maior fiscaliza\xe7\xe3o e risco de autua\xe7\xf5es para quem n\xe3o respeitar as novas regras.
- Introdu\xe7\xe3o do cashback, com devolu\xe7\xe3o tribut\xe1ria para fam\xedlias de baixa renda, especialmente via IBS e CBS[10][5].

### Situa\xe7\xe3o Atual e Pr\xf3ximos Passos

Em setembro de 2025, o Senado aprovou a segunda etapa da regulamenta\xe7\xe3o, detalhando a opera\xe7\xe3o e a distribui\xe7\xe3o dos impostos e criando o Comit\xea Gestor do IBS. O texto agora segue para aprova\xe7\xe3o final na C\xe2mara e posterior san\xe7\xe3o presidencial. As empresas precisam acompanhar a regulamenta\xe7\xe3o complementar e j\xe1 preparar migra\xe7\xe3o de sistemas e processos[9][11][12].

***
A reforma tribut\xe1ria brasileira, portanto, mudar\xe1 profundamente a l\xf3gica da tributa\xe7\xe3o sobre consumo no pa\xeds. A simplifica\xe7\xe3o e amplia\xe7\xe3o de controles e cr\xe9ditos fiscais exigir\xe3o atualiza\xe7\xe3o tecnol\xf3gica e estrat\xe9gica por parte de todos os agentes econ\xf4micos â com impactos distintos conforme o perfil de cada atividade[1][3][2][9][5].

Cita\xe7\xf5es:
[1] Reforma tribut\xe1ria 2025: o que pequenos neg\xf3cios ... https://sebrae.com.br/sites/PortalSebrae/ufs/pe/artigos/reforma-tributaria-2025-o-que-pequenos-negocios-precisam-saber,6d772d5ec7b37910VgnVCM1000001b00320aRCRD
[2] Reforma Tribut\xe1ria: o impacto nos setores https://drfiscal.com.br/planejamento-e-gestao/reforma-tributaria-o-impacto-nos-setores/
[3] Reforma Tribut\xe1ria: quais as \xfaltimas atualiza\xe7\xf5es em 2025 https://www.contabeis.com.br/noticias/71673/reforma-tributaria-quais-as-ultimas-atualizacoes-em-2025/
[4] Reforma Tribut\xe1ria 2025 - KPMG Brasil https://kpmg.com/br/pt/home/insights/2025/05/reforma-tributaria-2025-5-passos-essenciais-empresa-preparar.html
[5] Reforma tribut\xe1ria: veja o que muda com aprova\xe7\xe3o no ... https://fin.org.br/reforma-tributaria-veja-o-que-muda-com-aprovacao-no-senado/
[6] Quais setores ser\xe3o mais afetados com a reforma tribut\xe1ria? https://portaldacontabilidade.clmcontroller.com.br/quais-setores-serao-mais-afetados-com-a-reforma-tributaria/
[7] Reforma tribut\xe1ria pode elevar custos e alterar ... https://fenacon.org.br/reforma-tributaria/reforma-tributaria-pode-elevar-custos-e-alterar-competitividade-do-setor-de-servicos/
[8] Reforma Tribut\xe1ria em pr\xe1tica: impactos e pr\xf3ximos passos https://lefosse.com/noticias/reforma-tributaria-em-pratica-impactos-e-proximos-passos/
[9] Cronograma reforma tribut\xe1ria: quando entra em vigor? https://blog.tecnospeed.com.br/cronograma-reforma-tributaria-quando-entra-em-vigor/
[10] Modificada, regulamenta\xe7\xe3o da reforma tribut\xe1ria volta \xe0 ... https://www12.senado.leg.br/noticias/materias/2025/09/30/modificada-regulamentacao-da-reforma-tributaria-volta-a-camara
[11] Reforma Tribut\xe1ria Regulamenta\xe7\xe3o â Minist\xe9rio da Fazenda https://www.gov.br/fazenda/pt-br/acesso-a-informacao/acoes-e-programas/reforma-tributaria
[12] Reforma Tribut\xe1ria: \xfaltimas atualiza\xe7\xf5es de 2025 https://qive.com.br/blog/atualizacoes-reforma-tributaria/
[13] Reforma Tribut\xe1ria - Portal Gov.br https://www.gov.br/fazenda/pt-br/acesso-a-informacao/acoes-e-programas/reforma-tributaria/apresentacoes/apresentacao-reforma-tributaria-para-o-brasil-crescer-ela-precisa-acontecer-02-8-2023
[14] Reforma Tribut\xe1ria: o que \xe9 e quais as mudan\xe7as para 2025 https://nsdocs.com.br/blog/reforma-tributaria
[15] Reforma Tribut\xe1ria - TOTVS - Espa\xe7o Legisla\xe7\xe3o https://espacolegislacao.totvs.com/reforma-tributaria/
[16] Reforma Tribut\xe1ria 2025: Desafios e Impactos Econ\xf4micos ... https://www.ibmec.br/blog/conteudo-gratuito/reforma-tributaria-nos-moldes-dos-desafios-economicos-e-sociais-globais
[17] Reforma Tribut\xe1ria 2025: Impactos e Mudan\xe7as nas ... https://www.mantoanadvogados.com.br/blog/reforma-tributaria-2025-quais-mudancas-afetam-sua-empresa-/374
[18] Veja principais mudan\xe7as na reforma tribut\xe1ria aprovada ... https://www.cnnbrasil.com.br/economia/financas/veja-principais-mudancas-na-reforma-tributaria-aprovada-pelo-senado/
[19] Reforma Tribut\xe1ria â Perguntas e Respostas - Portal Gov.br https://www.gov.br/fazenda/pt-br/acesso-a-informacao/acoes-e-programas/reforma-tributaria/arquivos/perguntas-e-respostas-reforma-tributaria_.pdf
[20] Reforma Tribut\xe1ria 2025: principais pontos e o que falta ... https://www.taxgroup.com.br/intelligence/reforma-tributaria-2025-principais-pontos-e-o-que-falta-para-entrar-em-vigor/
`;var d7=a.i(52100);class d8 extends Error{constructor(a,b="FunctionsError",c){super(a),this.name=b,this.context=c}}class d9 extends d8{constructor(a){super("Failed to send a request to the Edge Function","FunctionsFetchError",a)}}class ea extends d8{constructor(a){super("Relay Error invoking the Edge Function","FunctionsRelayError",a)}}class eb extends d8{constructor(a){super("Edge Function returned a non-2xx status code","FunctionsHttpError",a)}}(ad=be||(be={})).Any="any",ad.ApNortheast1="ap-northeast-1",ad.ApNortheast2="ap-northeast-2",ad.ApSouth1="ap-south-1",ad.ApSoutheast1="ap-southeast-1",ad.ApSoutheast2="ap-southeast-2",ad.CaCentral1="ca-central-1",ad.EuCentral1="eu-central-1",ad.EuWest1="eu-west-1",ad.EuWest2="eu-west-2",ad.EuWest3="eu-west-3",ad.SaEast1="sa-east-1",ad.UsEast1="us-east-1",ad.UsWest1="us-west-1",ad.UsWest2="us-west-2";class ec{constructor(a,{headers:b={},customFetch:c,region:d=be.Any}={}){this.url=a,this.headers=b,this.region=d,this.fetch=(a=>a?(...b)=>a(...b):(...a)=>fetch(...a))(c)}setAuth(a){this.headers.Authorization=`Bearer ${a}`}invoke(a){return(0,d7.__awaiter)(this,arguments,void 0,function*(a,b={}){var c;let d,e;try{let f,{headers:g,method:h,body:i,signal:j,timeout:k}=b,l={},{region:m}=b;m||(m=this.region);let n=new URL(`${this.url}/${a}`);m&&"any"!==m&&(l["x-region"]=m,n.searchParams.set("forceFunctionRegion",m)),i&&(g&&!Object.prototype.hasOwnProperty.call(g,"Content-Type")||!g)?"undefined"!=typeof Blob&&i instanceof Blob||i instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",f=i):"string"==typeof i?(l["Content-Type"]="text/plain",f=i):"undefined"!=typeof FormData&&i instanceof FormData?f=i:(l["Content-Type"]="application/json",f=JSON.stringify(i)):f=i;let o=j;k&&(e=new AbortController,d=setTimeout(()=>e.abort(),k),j?(o=e.signal,j.addEventListener("abort",()=>e.abort())):o=e.signal);let p=yield this.fetch(n.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),g),body:f,signal:o}).catch(a=>{throw new d9(a)}),q=p.headers.get("x-relay-error");if(q&&"true"===q)throw new ea(p);if(!p.ok)throw new eb(p);let r=(null!=(c=p.headers.get("Content-Type"))?c:"text/plain").split(";")[0].trim();return{data:"application/json"===r?yield p.json():"application/octet-stream"===r||"application/pdf"===r?yield p.blob():"text/event-stream"===r?p:"multipart/form-data"===r?yield p.formData():yield p.text(),error:null,response:p}}catch(a){return{data:null,error:a,response:a instanceof eb||a instanceof ea?a.context:void 0}}finally{d&&clearTimeout(d)}})}}var ed=a.i(79614);let{PostgrestClient:ee,PostgrestQueryBuilder:ef,PostgrestFilterBuilder:eg,PostgrestTransformBuilder:eh,PostgrestBuilder:ei,PostgrestError:ej}=ed.default||ed,ek=class{static detectEnvironment(){var b;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if(void 0!==a.g.WebSocket)return{type:"native",constructor:a.g.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null==(b=navigator.userAgent)?void 0:b.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){let a=process.versions;if(a&&a.node){let b=parseInt(a.node.replace(/^v/,"").split(".")[0]);return b>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${b} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${b} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let a=this.detectEnvironment();if(a.constructor)return a.constructor;let b=a.error||"WebSocket not supported in this environment.";throw a.workaround&&(b+=`

Suggested solution: ${a.workaround}`),Error(b)}static createWebSocket(a,b){return new(this.getWebSocketConstructor())(a,b)}static isWebSocketSupported(){try{let a=this.detectEnvironment();return"native"===a.type||"ws"===a.type}catch(a){return!1}}},el="1.0.0";(ae=bf||(bf={}))[ae.connecting=0]="connecting",ae[ae.open=1]="open",ae[ae.closing=2]="closing",ae[ae.closed=3]="closed",(af=bg||(bg={})).closed="closed",af.errored="errored",af.joined="joined",af.joining="joining",af.leaving="leaving",(ag=bh||(bh={})).close="phx_close",ag.error="phx_error",ag.join="phx_join",ag.reply="phx_reply",ag.leave="phx_leave",ag.access_token="access_token",(bi||(bi={})).websocket="websocket",(ah=bj||(bj={})).Connecting="connecting",ah.Open="open",ah.Closing="closing",ah.Closed="closed";class em{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={push:0,reply:1,broadcast:2,userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST="broadcast"}encode(a,b){return this._isArrayBuffer(a.payload)?b(this._binaryEncodePush(a)):a.event!==this.BROADCAST||a.payload instanceof ArrayBuffer||"string"!=typeof a.payload.event?b(JSON.stringify([a.join_ref,a.ref,a.topic,a.event,a.payload])):b(this._binaryEncodeUserBroadcastPush(a))}_binaryEncodePush(a){let{join_ref:b,ref:c,event:d,topic:e,payload:f}=a,g=this.META_LENGTH+b.length+c.length+e.length+d.length,h=new ArrayBuffer(this.HEADER_LENGTH+g),i=new DataView(h),j=0;i.setUint8(j++,this.KINDS.push),i.setUint8(j++,b.length),i.setUint8(j++,c.length),i.setUint8(j++,e.length),i.setUint8(j++,d.length),Array.from(b,a=>i.setUint8(j++,a.charCodeAt(0))),Array.from(c,a=>i.setUint8(j++,a.charCodeAt(0))),Array.from(e,a=>i.setUint8(j++,a.charCodeAt(0))),Array.from(d,a=>i.setUint8(j++,a.charCodeAt(0)));var k=new Uint8Array(h.byteLength+f.byteLength);return k.set(new Uint8Array(h),0),k.set(new Uint8Array(f),h.byteLength),k.buffer}_binaryEncodeUserBroadcastPush(a){var b;return this._isArrayBuffer(null==(b=a.payload)?void 0:b.payload)?this._encodeBinaryUserBroadcastPush(a):this._encodeJsonUserBroadcastPush(a)}_encodeBinaryUserBroadcastPush(a){let{join_ref:b,ref:c,topic:d}=a,e=a.payload.event,f=null!=(l=null==(k=a.payload)?void 0:k.payload)?l:new ArrayBuffer(0),g=this.USER_BROADCAST_PUSH_META_LENGTH+b.length+c.length+d.length+e.length,h=new ArrayBuffer(this.HEADER_LENGTH+g),i=new DataView(h),j=0;i.setUint8(j++,this.KINDS.userBroadcastPush),i.setUint8(j++,b.length),i.setUint8(j++,c.length),i.setUint8(j++,d.length),i.setUint8(j++,e.length),i.setUint8(j++,this.BINARY_ENCODING),Array.from(b,a=>i.setUint8(j++,a.charCodeAt(0))),Array.from(c,a=>i.setUint8(j++,a.charCodeAt(0))),Array.from(d,a=>i.setUint8(j++,a.charCodeAt(0))),Array.from(e,a=>i.setUint8(j++,a.charCodeAt(0)));var k,l,m=new Uint8Array(h.byteLength+f.byteLength);return m.set(new Uint8Array(h),0),m.set(new Uint8Array(f),h.byteLength),m.buffer}_encodeJsonUserBroadcastPush(a){let{join_ref:b,ref:c,topic:d}=a,e=a.payload.event,f=null!=(m=null==(l=a.payload)?void 0:l.payload)?m:{},g=new TextEncoder().encode(JSON.stringify(f)).buffer,h=this.USER_BROADCAST_PUSH_META_LENGTH+b.length+c.length+d.length+e.length,i=new ArrayBuffer(this.HEADER_LENGTH+h),j=new DataView(i),k=0;j.setUint8(k++,this.KINDS.userBroadcastPush),j.setUint8(k++,b.length),j.setUint8(k++,c.length),j.setUint8(k++,d.length),j.setUint8(k++,e.length),j.setUint8(k++,this.JSON_ENCODING),Array.from(b,a=>j.setUint8(k++,a.charCodeAt(0))),Array.from(c,a=>j.setUint8(k++,a.charCodeAt(0))),Array.from(d,a=>j.setUint8(k++,a.charCodeAt(0))),Array.from(e,a=>j.setUint8(k++,a.charCodeAt(0)));var l,m,n=new Uint8Array(i.byteLength+g.byteLength);return n.set(new Uint8Array(i),0),n.set(new Uint8Array(g),i.byteLength),n.buffer}decode(a,b){if(this._isArrayBuffer(a))return b(this._binaryDecode(a));if("string"==typeof a){let[c,d,e,f,g]=JSON.parse(a);return b({join_ref:c,ref:d,topic:e,event:f,payload:g})}return b({})}_binaryDecode(a){let b=new DataView(a),c=b.getUint8(0),d=new TextDecoder;switch(c){case this.KINDS.push:return this._decodePush(a,b,d);case this.KINDS.reply:return this._decodeReply(a,b,d);case this.KINDS.broadcast:return this._decodeBroadcast(a,b,d);case this.KINDS.userBroadcast:return this._decodeUserBroadcast(a,b,d)}}_decodePush(a,b,c){let d=b.getUint8(1),e=b.getUint8(2),f=b.getUint8(3),g=this.HEADER_LENGTH+this.META_LENGTH-1,h=c.decode(a.slice(g,g+d));g+=d;let i=c.decode(a.slice(g,g+e));g+=e;let j=c.decode(a.slice(g,g+f));return g+=f,{join_ref:h,ref:null,topic:i,event:j,payload:JSON.parse(c.decode(a.slice(g,a.byteLength)))}}_decodeReply(a,b,c){let d=b.getUint8(1),e=b.getUint8(2),f=b.getUint8(3),g=b.getUint8(4),h=this.HEADER_LENGTH+this.META_LENGTH,i=c.decode(a.slice(h,h+d));h+=d;let j=c.decode(a.slice(h,h+e));h+=e;let k=c.decode(a.slice(h,h+f));h+=f;let l=c.decode(a.slice(h,h+g));h+=g;let m=JSON.parse(c.decode(a.slice(h,a.byteLength)));return{join_ref:i,ref:j,topic:k,event:bh.reply,payload:{status:l,response:m}}}_decodeBroadcast(a,b,c){let d=b.getUint8(1),e=b.getUint8(2),f=this.HEADER_LENGTH+2,g=c.decode(a.slice(f,f+d));f+=d;let h=c.decode(a.slice(f,f+e));return f+=e,{join_ref:null,ref:null,topic:g,event:h,payload:JSON.parse(c.decode(a.slice(f,a.byteLength)))}}_decodeUserBroadcast(a,b,c){let d=b.getUint8(1),e=b.getUint8(2),f=b.getUint8(3),g=b.getUint8(4),h=this.HEADER_LENGTH+4,i=c.decode(a.slice(h,h+d));h+=d;let j=c.decode(a.slice(h,h+e));h+=e;let k=c.decode(a.slice(h,h+f));h+=f;let l=a.slice(h,a.byteLength),m=g===this.JSON_ENCODING?JSON.parse(c.decode(l)):l,n={type:this.BROADCAST,event:j,payload:m};return f>0&&(n.meta=JSON.parse(k)),{join_ref:null,ref:null,topic:i,event:this.BROADCAST,payload:n}}_isArrayBuffer(a){var b;return a instanceof ArrayBuffer||(null==(b=null==a?void 0:a.constructor)?void 0:b.name)==="ArrayBuffer"}}class en{constructor(a,b){this.callback=a,this.timerCalc=b,this.timer=void 0,this.tries=0,this.callback=a,this.timerCalc=b}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(ai=bk||(bk={})).abstime="abstime",ai.bool="bool",ai.date="date",ai.daterange="daterange",ai.float4="float4",ai.float8="float8",ai.int2="int2",ai.int4="int4",ai.int4range="int4range",ai.int8="int8",ai.int8range="int8range",ai.json="json",ai.jsonb="jsonb",ai.money="money",ai.numeric="numeric",ai.oid="oid",ai.reltime="reltime",ai.text="text",ai.time="time",ai.timestamp="timestamp",ai.timestamptz="timestamptz",ai.timetz="timetz",ai.tsrange="tsrange",ai.tstzrange="tstzrange";let eo=(a,b,c={})=>{var d;let e=null!=(d=c.skipTypes)?d:[];return b?Object.keys(b).reduce((c,d)=>(c[d]=ep(d,a,b,e),c),{}):{}},ep=(a,b,c,d)=>{let e=b.find(b=>b.name===a),f=null==e?void 0:e.type,g=c[a];return f&&!d.includes(f)?eq(f,g):er(g)},eq=(a,b)=>{if("_"===a.charAt(0))return ev(b,a.slice(1,a.length));switch(a){case bk.bool:return es(b);case bk.float4:case bk.float8:case bk.int2:case bk.int4:case bk.int8:case bk.numeric:case bk.oid:return et(b);case bk.json:case bk.jsonb:return eu(b);case bk.timestamp:return ew(b);case bk.abstime:case bk.date:case bk.daterange:case bk.int4range:case bk.int8range:case bk.money:case bk.reltime:case bk.text:case bk.time:case bk.timestamptz:case bk.timetz:case bk.tsrange:case bk.tstzrange:default:return er(b)}},er=a=>a,es=a=>{switch(a){case"t":return!0;case"f":return!1;default:return a}},et=a=>{if("string"==typeof a){let b=parseFloat(a);if(!Number.isNaN(b))return b}return a},eu=a=>{if("string"==typeof a)try{return JSON.parse(a)}catch(a){console.log(`JSON parse error: ${a}`)}return a},ev=(a,b)=>{if("string"!=typeof a)return a;let c=a.length-1,d=a[c];if("{"===a[0]&&"}"===d){let d,e=a.slice(1,c);try{d=JSON.parse("["+e+"]")}catch(a){d=e?e.split(","):[]}return d.map(a=>eq(b,a))}return a},ew=a=>"string"==typeof a?a.replace(" ","T"):a,ex=a=>{let b=new URL(a);return b.protocol=b.protocol.replace(/^ws/i,"http"),b.pathname=b.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===b.pathname||"/"===b.pathname?b.pathname="/api/broadcast":b.pathname=b.pathname+"/api/broadcast",b.href};class ey{constructor(a,b,c={},d=1e4){this.channel=a,this.event=b,this.payload=c,this.timeout=d,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(a){this.timeout=a,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(a){this.payload=Object.assign(Object.assign({},this.payload),a)}receive(a,b){var c;return this._hasReceived(a)&&b(null==(c=this.receivedResp)?void 0:c.response),this.recHooks.push({status:a,callback:b}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let a=a=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=a,this._matchReceive(a)};this.channel._on(this.refEvent,{},a),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(a,b){this.refEvent&&this.channel._trigger(this.refEvent,{status:a,response:b})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:a,response:b}){this.recHooks.filter(b=>b.status===a).forEach(a=>a.callback(b))}_hasReceived(a){return this.receivedResp&&this.receivedResp.status===a}}(aj=bl||(bl={})).SYNC="sync",aj.JOIN="join",aj.LEAVE="leave";class ez{constructor(a,b){this.channel=a,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const c=(null==b?void 0:b.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(c.state,{},a=>{let{onJoin:b,onLeave:c,onSync:d}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ez.syncState(this.state,a,b,c),this.pendingDiffs.forEach(a=>{this.state=ez.syncDiff(this.state,a,b,c)}),this.pendingDiffs=[],d()}),this.channel._on(c.diff,{},a=>{let{onJoin:b,onLeave:c,onSync:d}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=ez.syncDiff(this.state,a,b,c),d())}),this.onJoin((a,b,c)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:b,newPresences:c})}),this.onLeave((a,b,c)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:b,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(a,b,c,d){let e=this.cloneDeep(a),f=this.transformState(b),g={},h={};return this.map(e,(a,b)=>{f[a]||(h[a]=b)}),this.map(f,(a,b)=>{let c=e[a];if(c){let d=b.map(a=>a.presence_ref),e=c.map(a=>a.presence_ref),f=b.filter(a=>0>e.indexOf(a.presence_ref)),i=c.filter(a=>0>d.indexOf(a.presence_ref));f.length>0&&(g[a]=f),i.length>0&&(h[a]=i)}else g[a]=b}),this.syncDiff(e,{joins:g,leaves:h},c,d)}static syncDiff(a,b,c,d){let{joins:e,leaves:f}={joins:this.transformState(b.joins),leaves:this.transformState(b.leaves)};return c||(c=()=>{}),d||(d=()=>{}),this.map(e,(b,d)=>{var e;let f=null!=(e=a[b])?e:[];if(a[b]=this.cloneDeep(d),f.length>0){let c=a[b].map(a=>a.presence_ref),d=f.filter(a=>0>c.indexOf(a.presence_ref));a[b].unshift(...d)}c(b,f,d)}),this.map(f,(b,c)=>{let e=a[b];if(!e)return;let f=c.map(a=>a.presence_ref);e=e.filter(a=>0>f.indexOf(a.presence_ref)),a[b]=e,d(b,e,c),0===e.length&&delete a[b]}),a}static map(a,b){return Object.getOwnPropertyNames(a).map(c=>b(c,a[c]))}static transformState(a){return Object.getOwnPropertyNames(a=this.cloneDeep(a)).reduce((b,c)=>{let d=a[c];return"metas"in d?b[c]=d.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):b[c]=d,b},{})}static cloneDeep(a){return JSON.parse(JSON.stringify(a))}onJoin(a){this.caller.onJoin=a}onLeave(a){this.caller.onLeave=a}onSync(a){this.caller.onSync=a}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(ak=bm||(bm={})).ALL="*",ak.INSERT="INSERT",ak.UPDATE="UPDATE",ak.DELETE="DELETE",(al=bn||(bn={})).BROADCAST="broadcast",al.PRESENCE="presence",al.POSTGRES_CHANGES="postgres_changes",al.SYSTEM="system",(am=bo||(bo={})).SUBSCRIBED="SUBSCRIBED",am.TIMED_OUT="TIMED_OUT",am.CLOSED="CLOSED",am.CHANNEL_ERROR="CHANNEL_ERROR";class eA{constructor(a,b={config:{}},c){var d,e;if(this.topic=a,this.params=b,this.socket=c,this.bindings={},this.state=bg.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=a.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},b.config),this.timeout=this.socket.timeout,this.joinPush=new ey(this,bh.join,this.params,this.timeout),this.rejoinTimer=new en(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=bg.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=bg.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=bg.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=bg.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=bg.errored,this.rejoinTimer.scheduleTimeout())}),this._on(bh.reply,{},(a,b)=>{this._trigger(this._replyEventName(b),a)}),this.presence=new ez(this),this.broadcastEndpointURL=ex(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null==(e=null==(d=this.params.config)?void 0:d.broadcast)?void 0:e.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(a,b=this.timeout){var c,d,e;if(this.socket.isConnected()||this.socket.connect(),this.state==bg.closed){let{config:{broadcast:f,presence:g,private:h}}=this.params,i=null!=(d=null==(c=this.bindings.postgres_changes)?void 0:c.map(a=>a.filter))?d:[],j=!!this.bindings[bn.PRESENCE]&&this.bindings[bn.PRESENCE].length>0||(null==(e=this.params.config.presence)?void 0:e.enabled)===!0,k={},l={broadcast:f,presence:Object.assign(Object.assign({},g),{enabled:j}),postgres_changes:i,private:h};this.socket.accessTokenValue&&(k.access_token=this.socket.accessTokenValue),this._onError(b=>null==a?void 0:a(bo.CHANNEL_ERROR,b)),this._onClose(()=>null==a?void 0:a(bo.CLOSED)),this.updateJoinPayload(Object.assign({config:l},k)),this.joinedOnce=!0,this._rejoin(b),this.joinPush.receive("ok",async({postgres_changes:b})=>{var c;if(this.socket.setAuth(),void 0===b){null==a||a(bo.SUBSCRIBED);return}{let d=this.bindings.postgres_changes,e=null!=(c=null==d?void 0:d.length)?c:0,f=[];for(let c=0;c<e;c++){let e=d[c],{filter:{event:g,schema:h,table:i,filter:j}}=e,k=b&&b[c];if(k&&k.event===g&&k.schema===h&&k.table===i&&k.filter===j)f.push(Object.assign(Object.assign({},e),{id:k.id}));else{this.unsubscribe(),this.state=bg.errored,null==a||a(bo.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,a&&a(bo.SUBSCRIBED);return}}).receive("error",b=>{this.state=bg.errored,null==a||a(bo.CHANNEL_ERROR,Error(JSON.stringify(Object.values(b).join(", ")||"error")))}).receive("timeout",()=>{null==a||a(bo.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(a,b={}){return await this.send({type:"presence",event:"track",payload:a},b.timeout||this.timeout)}async untrack(a={}){return await this.send({type:"presence",event:"untrack"},a)}on(a,b,c){return this.state===bg.joined&&a===bn.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(a,b,c)}async httpSend(a,b,c={}){var d;let e=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(null==b)return Promise.reject("Payload is required for httpSend()");let f={method:"POST",headers:{Authorization:e,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:b,private:this.private}]})},g=await this._fetchWithTimeout(this.broadcastEndpointURL,f,null!=(d=c.timeout)?d:this.timeout);if(202===g.status)return{success:!0};let h=g.statusText;try{let a=await g.json();h=a.error||a.message||h}catch(a){}return Promise.reject(Error(h))}async send(a,b={}){var c,d;if(this._canPush()||"broadcast"!==a.type)return new Promise(c=>{var d,e,f;let g=this._push(a.type,a,b.timeout||this.timeout);"broadcast"!==a.type||(null==(f=null==(e=null==(d=this.params)?void 0:d.config)?void 0:e.broadcast)?void 0:f.ack)||c("ok"),g.receive("ok",()=>c("ok")),g.receive("error",()=>c("error")),g.receive("timeout",()=>c("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:e,payload:f}=a,g={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:f,private:this.private}]})};try{let a=await this._fetchWithTimeout(this.broadcastEndpointURL,g,null!=(c=b.timeout)?c:this.timeout);return await (null==(d=a.body)?void 0:d.cancel()),a.ok?"ok":"error"}catch(a){if("AbortError"===a.name)return"timed out";return"error"}}}updateJoinPayload(a){this.joinPush.updatePayload(a)}unsubscribe(a=this.timeout){this.state=bg.leaving;let b=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(bh.close,"leave",this._joinRef())};this.joinPush.destroy();let c=null;return new Promise(d=>{(c=new ey(this,bh.leave,{},a)).receive("ok",()=>{b(),d("ok")}).receive("timeout",()=>{b(),d("timed out")}).receive("error",()=>{d("error")}),c.send(),this._canPush()||c.trigger("ok",{})}).finally(()=>{null==c||c.destroy()})}teardown(){this.pushBuffer.forEach(a=>a.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=bg.closed,this.bindings={}}async _fetchWithTimeout(a,b,c){let d=new AbortController,e=setTimeout(()=>d.abort(),c),f=await this.socket.fetch(a,Object.assign(Object.assign({},b),{signal:d.signal}));return clearTimeout(e),f}_push(a,b,c=this.timeout){if(!this.joinedOnce)throw`tried to push '${a}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let d=new ey(this,a,b,c);return this._canPush()?d.send():this._addToPushBuffer(d),d}_addToPushBuffer(a){if(a.startTimeout(),this.pushBuffer.push(a),this.pushBuffer.length>100){let a=this.pushBuffer.shift();a&&(a.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${a.event}`,a.payload))}}_onMessage(a,b,c){return b}_isMember(a){return this.topic===a}_joinRef(){return this.joinPush.ref}_trigger(a,b,c){var d,e;let f=a.toLocaleLowerCase(),{close:g,error:h,leave:i,join:j}=bh;if(c&&[g,h,i,j].indexOf(f)>=0&&c!==this._joinRef())return;let k=this._onMessage(f,b,c);if(b&&!k)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(f)?null==(d=this.bindings.postgres_changes)||d.filter(a=>{var b,c,d;return(null==(b=a.filter)?void 0:b.event)==="*"||(null==(d=null==(c=a.filter)?void 0:c.event)?void 0:d.toLocaleLowerCase())===f}).map(a=>a.callback(k,c)):null==(e=this.bindings[f])||e.filter(a=>{var c,d,e,g,h,i;if(!["broadcast","presence","postgres_changes"].includes(f))return a.type.toLocaleLowerCase()===f;if("id"in a){let f=a.id,g=null==(c=a.filter)?void 0:c.event;return f&&(null==(d=b.ids)?void 0:d.includes(f))&&("*"===g||(null==g?void 0:g.toLocaleLowerCase())===(null==(e=b.data)?void 0:e.type.toLocaleLowerCase()))}{let c=null==(h=null==(g=null==a?void 0:a.filter)?void 0:g.event)?void 0:h.toLocaleLowerCase();return"*"===c||c===(null==(i=null==b?void 0:b.event)?void 0:i.toLocaleLowerCase())}}).map(a=>{if("object"==typeof k&&"ids"in k){let a=k.data,{schema:b,table:c,commit_timestamp:d,type:e,errors:f}=a;k=Object.assign(Object.assign({},{schema:b,table:c,commit_timestamp:d,eventType:e,new:{},old:{},errors:f}),this._getPayloadRecords(a))}a.callback(k,c)})}_isClosed(){return this.state===bg.closed}_isJoined(){return this.state===bg.joined}_isJoining(){return this.state===bg.joining}_isLeaving(){return this.state===bg.leaving}_replyEventName(a){return`chan_reply_${a}`}_on(a,b,c){let d=a.toLocaleLowerCase(),e={type:d,filter:b,callback:c};return this.bindings[d]?this.bindings[d].push(e):this.bindings[d]=[e],this}_off(a,b){let c=a.toLocaleLowerCase();return this.bindings[c]&&(this.bindings[c]=this.bindings[c].filter(a=>{var d;return!((null==(d=a.type)?void 0:d.toLocaleLowerCase())===c&&eA.isEqual(a.filter,b))})),this}static isEqual(a,b){if(Object.keys(a).length!==Object.keys(b).length)return!1;for(let c in a)if(a[c]!==b[c])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(a){this._on(bh.close,{},a)}_onError(a){this._on(bh.error,{},b=>a(b))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(a=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=bg.joining,this.joinPush.resend(a))}_getPayloadRecords(a){let b={new:{},old:{}};return("INSERT"===a.type||"UPDATE"===a.type)&&(b.new=eo(a.columns,a.record)),("UPDATE"===a.type||"DELETE"===a.type)&&(b.old=eo(a.columns,a.old_record)),b}}let eB=()=>{},eC=[1e3,2e3,5e3,1e4],eD=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class eE{constructor(a,b){var c;if(this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=eB,this.ref=0,this.reconnectTimer=null,this.vsn=el,this.logger=eB,this.conn=null,this.sendBuffer=[],this.serializer=new em,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=a=>a?(...b)=>a(...b):(...a)=>fetch(...a),!(null==(c=null==b?void 0:b.params)?void 0:c.apikey))throw Error("API key is required to connect to Realtime");this.apiKey=b.params.apikey,this.endPoint=`${a}/${bi.websocket}`,this.httpEndpoint=ex(a),this._initializeOptions(b),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==b?void 0:b.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=ek.createWebSocket(this.endpointURL())}catch(b){this._setConnectionState("disconnected");let a=b.message;if(a.includes("Node.js"))throw Error(`${a}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`);throw Error(`WebSocket not available: ${a}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(a,b){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let c=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(c),this._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(a?this.conn.close(a,null!=b?b:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(a){let b=await a.unsubscribe();return 0===this.channels.length&&this.disconnect(),b}async removeAllChannels(){let a=await Promise.all(this.channels.map(a=>a.unsubscribe()));return this.channels=[],this.disconnect(),a}log(a,b,c){this.logger(a,b,c)}connectionState(){switch(this.conn&&this.conn.readyState){case bf.connecting:return bj.Connecting;case bf.open:return bj.Open;case bf.closing:return bj.Closing;default:return bj.Closed}}isConnected(){return this.connectionState()===bj.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(a,b={config:{}}){let c=`realtime:${a}`,d=this.getChannels().find(a=>a.topic===c);if(d)return d;{let c=new eA(`realtime:${a}`,b,this);return this.channels.push(c),c}}push(a){let{topic:b,event:c,payload:d,ref:e}=a,f=()=>{this.encode(a,a=>{var b;null==(b=this.conn)||b.send(a)})};this.log("push",`${b} ${c} (${e})`,d),this.isConnected()?f():this.sendBuffer.push(f)}async setAuth(a=null){this._authPromise=this._performAuth(a);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var a;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(a){this.log("error","error in heartbeat callback",a)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(a){this.log("error","error in heartbeat callback",a)}this._wasManualDisconnect=!1,null==(a=this.conn)||a.close(1e3,"heartbeat timeout"),setTimeout(()=>{var a;this.isConnected()||null==(a=this.reconnectTimer)||a.scheduleTimeout()},100);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(a){this.log("error","error in heartbeat callback",a)}this._setAuthSafely("heartbeat")}onHeartbeat(a){this.heartbeatCallback=a}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(a=>a()),this.sendBuffer=[])}_makeRef(){let a=this.ref+1;return a===this.ref?this.ref=0:this.ref=a,this.ref.toString()}_leaveOpenTopic(a){let b=this.channels.find(b=>b.topic===a&&(b._isJoined()||b._isJoining()));b&&(this.log("transport",`leaving duplicate topic "${a}"`),b.unsubscribe())}_remove(a){this.channels=this.channels.filter(b=>b.topic!==a.topic)}_onConnMessage(a){this.decode(a.data,a=>{if("phoenix"===a.topic&&"phx_reply"===a.event)try{this.heartbeatCallback("ok"===a.payload.status?"ok":"error")}catch(a){this.log("error","error in heartbeat callback",a)}a.ref&&a.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);let{topic:b,event:c,payload:d,ref:e}=a,f=e?`(${e})`:"",g=d.status||"";this.log("receive",`${g} ${b} ${c} ${f}`.trim(),d),this.channels.filter(a=>a._isMember(b)).forEach(a=>a._trigger(c,d,e)),this._triggerStateCallbacks("message",a)})}_clearTimer(a){var b;"heartbeat"===a&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===a&&(null==(b=this.reconnectTimer)||b.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=a=>this._onConnError(a),this.conn.onmessage=a=>this._onConnMessage(a),this.conn.onclose=a=>this._onConnClose(a))}_teardownConnection(){if(this.conn){if(this.conn.readyState===bf.open||this.conn.readyState===bf.connecting)try{this.conn.close()}catch(a){this.log("error","Error closing connection",a)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(a=>a.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(a=>{this.log("error","error waiting for auth on connect",a),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let a=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(a),this.workerRef.onerror=a=>{this.log("worker","worker error",a.message),this.workerRef.terminate()},this.workerRef.onmessage=a=>{"keepAlive"===a.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(a){var b;this._setConnectionState("disconnected"),this.log("transport","close",a),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null==(b=this.reconnectTimer)||b.scheduleTimeout(),this._triggerStateCallbacks("close",a)}_onConnError(a){this._setConnectionState("disconnected"),this.log("transport",`${a}`),this._triggerChanError(),this._triggerStateCallbacks("error",a)}_triggerChanError(){this.channels.forEach(a=>a._trigger(bh.error))}_appendParams(a,b){if(0===Object.keys(b).length)return a;let c=a.match(/\?/)?"&":"?",d=new URLSearchParams(b);return`${a}${c}${d}`}_workerObjectUrl(a){let b;if(a)b=a;else{let a=new Blob([eD],{type:"application/javascript"});b=URL.createObjectURL(a)}return b}_setConnectionState(a,b=!1){this._connectionState=a,"connecting"===a?this._wasManualDisconnect=!1:"disconnecting"===a&&(this._wasManualDisconnect=b)}async _performAuth(a=null){let b;b=a||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=b&&(this.accessTokenValue=b,this.channels.forEach(a=>{b&&a.updateJoinPayload({access_token:b,version:"realtime-js/2.81.1"}),a.joinedOnce&&a._isJoined()&&a._push(bh.access_token,{access_token:b})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(a="general"){this.setAuth().catch(b=>{this.log("error",`error setting auth in ${a}`,b)})}_triggerStateCallbacks(a,b){try{this.stateChangeCallbacks[a].forEach(c=>{try{c(b)}catch(b){this.log("error",`error in ${a} callback`,b)}})}catch(b){this.log("error",`error triggering ${a} callbacks`,b)}}_setupReconnectionTimer(){this.reconnectTimer=new en(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},10)},this.reconnectAfterMs)}_initializeOptions(a){var b,c,d,e,f,g,h,i,j,k,l,m;switch(this.transport=null!=(b=null==a?void 0:a.transport)?b:null,this.timeout=null!=(c=null==a?void 0:a.timeout)?c:1e4,this.heartbeatIntervalMs=null!=(d=null==a?void 0:a.heartbeatIntervalMs)?d:25e3,this.worker=null!=(e=null==a?void 0:a.worker)&&e,this.accessToken=null!=(f=null==a?void 0:a.accessToken)?f:null,this.heartbeatCallback=null!=(g=null==a?void 0:a.heartbeatCallback)?g:eB,this.vsn=null!=(h=null==a?void 0:a.vsn)?h:el,(null==a?void 0:a.params)&&(this.params=a.params),(null==a?void 0:a.logger)&&(this.logger=a.logger),((null==a?void 0:a.logLevel)||(null==a?void 0:a.log_level))&&(this.logLevel=a.logLevel||a.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!=(i=null==a?void 0:a.reconnectAfterMs)?i:a=>eC[a-1]||1e4,this.vsn){case el:this.encode=null!=(j=null==a?void 0:a.encode)?j:(a,b)=>b(JSON.stringify(a)),this.decode=null!=(k=null==a?void 0:a.decode)?k:(a,b)=>b(JSON.parse(a));break;case"2.0.0":this.encode=null!=(l=null==a?void 0:a.encode)?l:this.serializer.encode.bind(this.serializer),this.decode=null!=(m=null==a?void 0:a.decode)?m:this.serializer.decode.bind(this.serializer);break;default:throw Error(`Unsupported serializer version: ${this.vsn}`)}this.worker&&(this.workerUrl=null==a?void 0:a.workerUrl)}}class eF extends Error{constructor(a){super(a),this.__isStorageError=!0,this.name="StorageError"}}function eG(a){return"object"==typeof a&&null!==a&&"__isStorageError"in a}class eH extends eF{constructor(a,b,c){super(a),this.name="StorageApiError",this.status=b,this.statusCode=c}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class eI extends eF{constructor(a,b){super(a),this.name="StorageUnknownError",this.originalError=b}}let eJ=a=>a?(...b)=>a(...b):(...a)=>fetch(...a),eK=a=>{if(Array.isArray(a))return a.map(a=>eK(a));if("function"==typeof a||a!==Object(a))return a;let b={};return Object.entries(a).forEach(([a,c])=>{b[a.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""))]=eK(c)}),b},eL=a=>{var b;return a.msg||a.message||a.error_description||("string"==typeof a.error?a.error:null==(b=a.error)?void 0:b.message)||JSON.stringify(a)};function eM(a,b,c,d,e,f){return(0,d7.__awaiter)(this,void 0,void 0,function*(){return new Promise((g,h)=>{let i;a(c,(i={method:b,headers:(null==d?void 0:d.headers)||{}},"GET"===b||!f?i:((a=>{if("object"!=typeof a||null===a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)})(f)?(i.headers=Object.assign({"Content-Type":"application/json"},null==d?void 0:d.headers),i.body=JSON.stringify(f)):i.body=f,(null==d?void 0:d.duplex)&&(i.duplex=d.duplex),Object.assign(Object.assign({},i),e)))).then(a=>{if(!a.ok)throw a;return(null==d?void 0:d.noResolveJson)?a:a.json()}).then(a=>g(a)).catch(a=>(0,d7.__awaiter)(void 0,void 0,void 0,function*(){a instanceof(yield Response)&&!(null==d?void 0:d.noResolveJson)?a.json().then(b=>{let c=a.status||500,d=(null==b?void 0:b.statusCode)||c+"";h(new eH(eL(b),c,d))}).catch(a=>{h(new eI(eL(a),a))}):h(new eI(eL(a),a))}))})})}function eN(a,b,c,d){return(0,d7.__awaiter)(this,void 0,void 0,function*(){return eM(a,"GET",b,c,d)})}function eO(a,b,c,d,e){return(0,d7.__awaiter)(this,void 0,void 0,function*(){return eM(a,"POST",b,d,e,c)})}function eP(a,b,c,d,e){return(0,d7.__awaiter)(this,void 0,void 0,function*(){return eM(a,"PUT",b,d,e,c)})}function eQ(a,b,c,d,e){return(0,d7.__awaiter)(this,void 0,void 0,function*(){return eM(a,"DELETE",b,d,e,c)})}class eR{constructor(a,b){this.downloadFn=a,this.shouldThrowOnError=b}then(a,b){return this.execute().then(a,b)}execute(){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}}bp=Symbol.toStringTag;let eS=class{constructor(a,b){this.downloadFn=a,this.shouldThrowOnError=b,this[bp]="BlobDownloadBuilder",this.promise=null}asStream(){return new eR(this.downloadFn,this.shouldThrowOnError)}then(a,b){return this.getPromise().then(a,b)}catch(a){return this.getPromise().catch(a)}finally(a){return this.getPromise().finally(a)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{let a=yield this.downloadFn();return{data:yield a.blob(),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}},eT={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},eU={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class eV{constructor(a,b={},c,d){this.shouldThrowOnError=!1,this.url=a,this.headers=b,this.bucketId=c,this.fetch=eJ(d)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(a,b,c,d){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{let e,f=Object.assign(Object.assign({},eU),d),g=Object.assign(Object.assign({},this.headers),"POST"===a&&{"x-upsert":String(f.upsert)}),h=f.metadata;"undefined"!=typeof Blob&&c instanceof Blob?((e=new FormData).append("cacheControl",f.cacheControl),h&&e.append("metadata",this.encodeMetadata(h)),e.append("",c)):"undefined"!=typeof FormData&&c instanceof FormData?((e=c).has("cacheControl")||e.append("cacheControl",f.cacheControl),h&&!e.has("metadata")&&e.append("metadata",this.encodeMetadata(h))):(e=c,g["cache-control"]=`max-age=${f.cacheControl}`,g["content-type"]=f.contentType,h&&(g["x-metadata"]=this.toBase64(this.encodeMetadata(h))),("undefined"!=typeof ReadableStream&&e instanceof ReadableStream||e&&"object"==typeof e&&"pipe"in e&&"function"==typeof e.pipe)&&!f.duplex&&(f.duplex="half")),(null==d?void 0:d.headers)&&(g=Object.assign(Object.assign({},g),d.headers));let i=this._removeEmptyFolders(b),j=this._getFinalPath(i),k=yield("PUT"==a?eP:eO)(this.fetch,`${this.url}/object/${j}`,e,Object.assign({headers:g},(null==f?void 0:f.duplex)?{duplex:f.duplex}:{}));return{data:{path:i,id:k.Id,fullPath:k.Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}upload(a,b,c){return(0,d7.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",a,b,c)})}uploadToSignedUrl(a,b,c,d){return(0,d7.__awaiter)(this,void 0,void 0,function*(){let e=this._removeEmptyFolders(a),f=this._getFinalPath(e),g=new URL(this.url+`/object/upload/sign/${f}`);g.searchParams.set("token",b);try{let a,b=Object.assign({upsert:eU.upsert},d),f=Object.assign(Object.assign({},this.headers),{"x-upsert":String(b.upsert)});"undefined"!=typeof Blob&&c instanceof Blob?((a=new FormData).append("cacheControl",b.cacheControl),a.append("",c)):"undefined"!=typeof FormData&&c instanceof FormData?(a=c).append("cacheControl",b.cacheControl):(a=c,f["cache-control"]=`max-age=${b.cacheControl}`,f["content-type"]=b.contentType);let h=yield eP(this.fetch,g.toString(),a,{headers:f});return{data:{path:e,fullPath:h.Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(a,b){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{let c=this._getFinalPath(a),d=Object.assign({},this.headers);(null==b?void 0:b.upsert)&&(d["x-upsert"]="true");let e=yield eO(this.fetch,`${this.url}/object/upload/sign/${c}`,{},{headers:d}),f=new URL(this.url+e.url),g=f.searchParams.get("token");if(!g)throw new eF("No token returned by API");return{data:{signedUrl:f.toString(),path:a,token:g},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}update(a,b,c){return(0,d7.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",a,b,c)})}move(a,b,c){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eO(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:a,destinationKey:b,destinationBucket:null==c?void 0:c.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}copy(a,b,c){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:{path:(yield eO(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:a,destinationKey:b,destinationBucket:null==c?void 0:c.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}createSignedUrl(a,b,c){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{let d=this._getFinalPath(a),e=yield eO(this.fetch,`${this.url}/object/sign/${d}`,Object.assign({expiresIn:b},(null==c?void 0:c.transform)?{transform:c.transform}:{}),{headers:this.headers}),f=(null==c?void 0:c.download)?`&download=${!0===c.download?"":c.download}`:"";return{data:e={signedUrl:encodeURI(`${this.url}${e.signedURL}${f}`)},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}createSignedUrls(a,b,c){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{let d=yield eO(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:b,paths:a},{headers:this.headers}),e=(null==c?void 0:c.download)?`&download=${!0===c.download?"":c.download}`:"";return{data:d.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${e}`):null})),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}download(a,b){let c=void 0!==(null==b?void 0:b.transform)?"render/image/authenticated":"object",d=this.transformOptsToQueryString((null==b?void 0:b.transform)||{}),e=d?`?${d}`:"",f=this._getFinalPath(a);return new eS(()=>eN(this.fetch,`${this.url}/${c}/${f}${e}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){let b=this._getFinalPath(a);try{let a=yield eN(this.fetch,`${this.url}/object/info/${b}`,{headers:this.headers});return{data:eK(a),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}exists(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){let b=this._getFinalPath(a);try{return yield function(a,b,c,d){return(0,d7.__awaiter)(this,void 0,void 0,function*(){return eM(a,"HEAD",b,Object.assign(Object.assign({},c),{noResolveJson:!0}),void 0)})}(this.fetch,`${this.url}/object/${b}`,{headers:this.headers}),{data:!0,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a)&&a instanceof eI){let b=a.originalError;if([400,404].includes(null==b?void 0:b.status))return{data:!1,error:a}}throw a}})}getPublicUrl(a,b){let c=this._getFinalPath(a),d=[],e=(null==b?void 0:b.download)?`download=${!0===b.download?"":b.download}`:"";""!==e&&d.push(e);let f=void 0!==(null==b?void 0:b.transform),g=this.transformOptsToQueryString((null==b?void 0:b.transform)||{});""!==g&&d.push(g);let h=d.join("&");return""!==h&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${f?"render/image":"object"}/public/${c}${h}`)}}}remove(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eQ(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:a},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}list(a,b,c){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{let d=Object.assign(Object.assign(Object.assign({},eT),b),{prefix:a||""});return{data:yield eO(this.fetch,`${this.url}/object/list/${this.bucketId}`,d,{headers:this.headers},c),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}listV2(a,b){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{let c=Object.assign({},a);return{data:yield eO(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,c,{headers:this.headers},b),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}encodeMetadata(a){return JSON.stringify(a)}toBase64(a){return"undefined"!=typeof Buffer?Buffer.from(a).toString("base64"):btoa(a)}_getFinalPath(a){return`${this.bucketId}/${a.replace(/^\/+/,"")}`}_removeEmptyFolders(a){return a.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(a){let b=[];return a.width&&b.push(`width=${a.width}`),a.height&&b.push(`height=${a.height}`),a.resize&&b.push(`resize=${a.resize}`),a.format&&b.push(`format=${a.format}`),a.quality&&b.push(`quality=${a.quality}`),b.join("&")}}let eW="2.81.1",eX={"X-Client-Info":`storage-js/${eW}`};class eY{constructor(a,b={},c,d){this.shouldThrowOnError=!1;const e=new URL(a);(null==d?void 0:d.useNewHostname)&&/supabase\.(co|in|red)$/.test(e.hostname)&&!e.hostname.includes("storage.supabase.")&&(e.hostname=e.hostname.replace("supabase.","storage.supabase.")),this.url=e.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eX),b),this.fetch=eJ(c)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{let b=this.listBucketOptionsToQueryString(a);return{data:yield eN(this.fetch,`${this.url}/bucket${b}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}getBucket(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eN(this.fetch,`${this.url}/bucket/${a}`,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}createBucket(a){return(0,d7.__awaiter)(this,arguments,void 0,function*(a,b={public:!1}){try{return{data:yield eO(this.fetch,`${this.url}/bucket`,{id:a,name:a,type:b.type,public:b.public,file_size_limit:b.fileSizeLimit,allowed_mime_types:b.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}updateBucket(a,b){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eP(this.fetch,`${this.url}/bucket/${a}`,{id:a,name:a,public:b.public,file_size_limit:b.fileSizeLimit,allowed_mime_types:b.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}emptyBucket(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eO(this.fetch,`${this.url}/bucket/${a}/empty`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}deleteBucket(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eQ(this.fetch,`${this.url}/bucket/${a}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}listBucketOptionsToQueryString(a){let b={};return a&&("limit"in a&&(b.limit=String(a.limit)),"offset"in a&&(b.offset=String(a.offset)),a.search&&(b.search=a.search),a.sortColumn&&(b.sortColumn=a.sortColumn),a.sortOrder&&(b.sortOrder=a.sortOrder)),Object.keys(b).length>0?"?"+new URLSearchParams(b).toString():""}}class eZ{constructor(a,b={},c){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eX),b),this.fetch=eJ(c)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eO(this.fetch,`${this.url}/bucket`,{name:a},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}listBuckets(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{let b=new URLSearchParams;(null==a?void 0:a.limit)!==void 0&&b.set("limit",a.limit.toString()),(null==a?void 0:a.offset)!==void 0&&b.set("offset",a.offset.toString()),(null==a?void 0:a.sortColumn)&&b.set("sortColumn",a.sortColumn),(null==a?void 0:a.sortOrder)&&b.set("sortOrder",a.sortOrder),(null==a?void 0:a.search)&&b.set("search",a.search);let c=b.toString(),d=c?`${this.url}/bucket?${c}`:`${this.url}/bucket`;return{data:yield eN(this.fetch,d,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}deleteBucket(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eQ(this.fetch,`${this.url}/bucket/${a}`,{},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(eG(a))return{data:null,error:a};throw a}})}}let e$={"X-Client-Info":`storage-js/${eW}`,"Content-Type":"application/json"};class e_ extends Error{constructor(a){super(a),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function e0(a){return"object"==typeof a&&null!==a&&"__isStorageVectorsError"in a}class e1 extends e_{constructor(a,b,c){super(a),this.name="StorageVectorsApiError",this.status=b,this.statusCode=c}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class e2 extends e_{constructor(a,b){super(a),this.name="StorageVectorsUnknownError",this.originalError=b}}(an=bq||(bq={})).InternalError="InternalError",an.S3VectorConflictException="S3VectorConflictException",an.S3VectorNotFoundException="S3VectorNotFoundException",an.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",an.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",an.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded";let e3=a=>a?(...b)=>a(...b):(...a)=>fetch(...a),e4=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a);function e5(a,b,c,d,e){return(0,d7.__awaiter)(this,void 0,void 0,function*(){return function(a,b,c,d,e,f){return(0,d7.__awaiter)(this,void 0,void 0,function*(){return new Promise((g,h)=>{let i;a(c,(i={method:b,headers:(null==d?void 0:d.headers)||{}},"GET"===b||!f?i:((a=>{if("object"!=typeof a||null===a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)})(f)?(i.headers=Object.assign({"Content-Type":"application/json"},null==d?void 0:d.headers),i.body=JSON.stringify(f)):i.body=f,Object.assign(Object.assign({},i),e)))).then(a=>{if(!a.ok)throw a;if(null==d?void 0:d.noResolveJson)return a;let b=a.headers.get("content-type");return b&&b.includes("application/json")?a.json():{}}).then(a=>g(a)).catch(a=>(0,d7.__awaiter)(void 0,void 0,void 0,function*(){if(!(a&&"object"==typeof a&&"status"in a&&"ok"in a&&"number"==typeof a.status)||(null==d?void 0:d.noResolveJson))h(new e2(e4(a),a));else{let b=a.status||500;"function"==typeof a.json?a.json().then(a=>{let c=(null==a?void 0:a.statusCode)||(null==a?void 0:a.code)||b+"";h(new e1(e4(a),b,c))}).catch(()=>{h(new e1(a.statusText||`HTTP ${b} error`,b,b+""))}):h(new e1(a.statusText||`HTTP ${b} error`,b,b+""))}}))})})}(a,"POST",b,d,e,c)})}class e6{constructor(a,b={},c){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},e$),b),this.fetch=e3(c)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield e5(this.fetch,`${this.url}/CreateIndex`,a,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(e0(a))return{data:null,error:a};throw a}})}getIndex(a,b){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:a,indexName:b},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(e0(a))return{data:null,error:a};throw a}})}listIndexes(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/ListIndexes`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(e0(a))return{data:null,error:a};throw a}})}deleteIndex(a,b){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield e5(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:a,indexName:b},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(e0(a))return{data:null,error:a};throw a}})}}class e7{constructor(a,b={},c){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},e$),b),this.fetch=e3(c)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{if(a.vectors.length<1||a.vectors.length>500)throw Error("Vector batch size must be between 1 and 500 items");return{data:(yield e5(this.fetch,`${this.url}/PutVectors`,a,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(e0(a))return{data:null,error:a};throw a}})}getVectors(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/GetVectors`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(e0(a))return{data:null,error:a};throw a}})}listVectors(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{if(void 0!==a.segmentCount){if(a.segmentCount<1||a.segmentCount>16)throw Error("segmentCount must be between 1 and 16");if(void 0!==a.segmentIndex&&(a.segmentIndex<0||a.segmentIndex>=a.segmentCount))throw Error(`segmentIndex must be between 0 and ${a.segmentCount-1}`)}return{data:yield e5(this.fetch,`${this.url}/ListVectors`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(e0(a))return{data:null,error:a};throw a}})}queryVectors(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/QueryVectors`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(e0(a))return{data:null,error:a};throw a}})}deleteVectors(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{if(a.keys.length<1||a.keys.length>500)throw Error("Keys batch size must be between 1 and 500 items");return{data:(yield e5(this.fetch,`${this.url}/DeleteVectors`,a,{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(e0(a))return{data:null,error:a};throw a}})}}class e8{constructor(a,b={},c){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},e$),b),this.fetch=e3(c)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield e5(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:a},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(e0(a))return{data:null,error:a};throw a}})}getBucket(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:a},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(e0(a))return{data:null,error:a};throw a}})}listBuckets(){return(0,d7.__awaiter)(this,arguments,void 0,function*(a={}){try{return{data:yield e5(this.fetch,`${this.url}/ListVectorBuckets`,a,{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(e0(a))return{data:null,error:a};throw a}})}deleteBucket(a){return(0,d7.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield e5(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:a},{headers:this.headers}))||{},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(e0(a))return{data:null,error:a};throw a}})}}class e9 extends e8{constructor(a,b={}){super(a,b.headers||{},b.fetch)}from(a){return new fa(this.url,this.headers,a,this.fetch)}}class fa extends e6{constructor(a,b,c,d){super(a,b,d),this.vectorBucketName=c}createIndex(a){let b=Object.create(null,{createIndex:{get:()=>super.createIndex}});return(0,d7.__awaiter)(this,void 0,void 0,function*(){return b.createIndex.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){let a=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return(0,d7.__awaiter)(this,arguments,void 0,function*(b={}){return a.listIndexes.call(this,Object.assign(Object.assign({},b),{vectorBucketName:this.vectorBucketName}))})}getIndex(a){let b=Object.create(null,{getIndex:{get:()=>super.getIndex}});return(0,d7.__awaiter)(this,void 0,void 0,function*(){return b.getIndex.call(this,this.vectorBucketName,a)})}deleteIndex(a){let b=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return(0,d7.__awaiter)(this,void 0,void 0,function*(){return b.deleteIndex.call(this,this.vectorBucketName,a)})}index(a){return new fb(this.url,this.headers,this.vectorBucketName,a,this.fetch)}}class fb extends e7{constructor(a,b,c,d,e){super(a,b,e),this.vectorBucketName=c,this.indexName=d}putVectors(a){let b=Object.create(null,{putVectors:{get:()=>super.putVectors}});return(0,d7.__awaiter)(this,void 0,void 0,function*(){return b.putVectors.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(a){let b=Object.create(null,{getVectors:{get:()=>super.getVectors}});return(0,d7.__awaiter)(this,void 0,void 0,function*(){return b.getVectors.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){let a=Object.create(null,{listVectors:{get:()=>super.listVectors}});return(0,d7.__awaiter)(this,arguments,void 0,function*(b={}){return a.listVectors.call(this,Object.assign(Object.assign({},b),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(a){let b=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return(0,d7.__awaiter)(this,void 0,void 0,function*(){return b.queryVectors.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(a){let b=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return(0,d7.__awaiter)(this,void 0,void 0,function*(){return b.deleteVectors.call(this,Object.assign(Object.assign({},a),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class fc extends eY{constructor(a,b={},c,d){super(a,b,c,d)}from(a){return new eV(this.url,this.headers,a,this.fetch)}get vectors(){return new e9(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new eZ(this.url+"/iceberg",this.headers,this.fetch)}}let fd="";fd="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";let fe={headers:{"X-Client-Info":`supabase-js-${fd}/2.81.1`}},ff={schema:"public"},fg={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},fh={},fi="2.81.1",fj={"X-Client-Info":`gotrue-js/${fi}`},fk="X-Supabase-Api-Version",fl={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},fm=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class fn extends Error{constructor(a,b,c){super(a),this.__isAuthError=!0,this.name="AuthError",this.status=b,this.code=c}}function fo(a){return"object"==typeof a&&null!==a&&"__isAuthError"in a}class fp extends fn{constructor(a,b,c){super(a,b,c),this.name="AuthApiError",this.status=b,this.code=c}}class fq extends fn{constructor(a,b){super(a),this.name="AuthUnknownError",this.originalError=b}}class fr extends fn{constructor(a,b,c,d){super(a,c,d),this.name=b,this.status=c}}class fs extends fr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class ft extends fr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class fu extends fr{constructor(a){super(a,"AuthInvalidCredentialsError",400,void 0)}}class fv extends fr{constructor(a,b=null){super(a,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=b}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class fw extends fr{constructor(a,b){super(a,"AuthRetryableFetchError",b,void 0)}}function fx(a){return fo(a)&&"AuthRetryableFetchError"===a.name}class fy extends fr{constructor(a,b,c){super(a,"AuthWeakPasswordError",b,"weak_password"),this.reasons=c}}class fz extends fr{constructor(a){super(a,"AuthInvalidJwtError",400,"invalid_jwt")}}let fA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),fB=" 	\n\r=".split(""),fC=(()=>{let a=Array(128);for(let b=0;b<a.length;b+=1)a[b]=-1;for(let b=0;b<fB.length;b+=1)a[fB[b].charCodeAt(0)]=-2;for(let b=0;b<fA.length;b+=1)a[fA[b].charCodeAt(0)]=b;return a})();function fD(a,b,c){if(null!==a)for(b.queue=b.queue<<8|a,b.queuedBits+=8;b.queuedBits>=6;)c(fA[b.queue>>b.queuedBits-6&63]),b.queuedBits-=6;else if(b.queuedBits>0)for(b.queue=b.queue<<6-b.queuedBits,b.queuedBits=6;b.queuedBits>=6;)c(fA[b.queue>>b.queuedBits-6&63]),b.queuedBits-=6}function fE(a,b,c){let d=fC[a];if(d>-1)for(b.queue=b.queue<<6|d,b.queuedBits+=6;b.queuedBits>=8;)c(b.queue>>b.queuedBits-8&255),b.queuedBits-=8;else if(-2===d)return;else throw Error(`Invalid Base64-URL character "${String.fromCharCode(a)}"`)}function fF(a){let b=[],c=a=>{b.push(String.fromCodePoint(a))},d={utf8seq:0,codepoint:0},e={queue:0,queuedBits:0},f=a=>{!function(a,b,c){if(0===b.utf8seq){if(a<=127)return c(a);for(let c=1;c<6;c+=1)if((a>>7-c&1)==0){b.utf8seq=c;break}if(2===b.utf8seq)b.codepoint=31&a;else if(3===b.utf8seq)b.codepoint=15&a;else if(4===b.utf8seq)b.codepoint=7&a;else throw Error("Invalid UTF-8 sequence");b.utf8seq-=1}else if(b.utf8seq>0){if(a<=127)throw Error("Invalid UTF-8 sequence");b.codepoint=b.codepoint<<6|63&a,b.utf8seq-=1,0===b.utf8seq&&c(b.codepoint)}}(a,d,c)};for(let b=0;b<a.length;b+=1)fE(a.charCodeAt(b),e,f);return b.join("")}function fG(a){let b=[],c={queue:0,queuedBits:0},d=a=>{b.push(a)};for(let b=0;b<a.length;b+=1)fE(a.charCodeAt(b),c,d);return new Uint8Array(b)}function fH(a){let b=[],c={queue:0,queuedBits:0},d=a=>{b.push(a)};return a.forEach(a=>fD(a,c,d)),fD(null,c,d),b.join("")}let fI=a=>a?(...b)=>a(...b):(...a)=>fetch(...a),fJ=async(a,b,c)=>{await a.setItem(b,JSON.stringify(c))},fK=async(a,b)=>{let c=await a.getItem(b);if(!c)return null;try{return JSON.parse(c)}catch(a){return c}},fL=async(a,b)=>{await a.removeItem(b)};class fM{constructor(){this.promise=new fM.promiseConstructor((a,b)=>{this.resolve=a,this.reject=b})}}function fN(a){let b=a.split(".");if(3!==b.length)throw new fz("Invalid JWT structure");for(let a=0;a<b.length;a++)if(!fm.test(b[a]))throw new fz("JWT not in base64url format");return{header:JSON.parse(fF(b[0])),payload:JSON.parse(fF(b[1])),signature:fG(b[2]),raw:{header:b[0],payload:b[1]}}}async function fO(a){return await new Promise(b=>{setTimeout(()=>b(null),a)})}function fP(a){return("0"+a.toString(16)).substr(-2)}async function fQ(a){let b=new TextEncoder().encode(a);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",b))).map(a=>String.fromCharCode(a)).join("")}async function fR(a){return"undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder?(console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),a):btoa(await fQ(a)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function fS(a,b,c=!1){let d=function(){let a=new Uint32Array(56);if("undefined"==typeof crypto){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",b=a.length,c="";for(let d=0;d<56;d++)c+=a.charAt(Math.floor(Math.random()*b));return c}return crypto.getRandomValues(a),Array.from(a,fP).join("")}(),e=d;c&&(e+="/PASSWORD_RECOVERY"),await fJ(a,`${b}-code-verifier`,e);let f=await fR(d),g=d===f?"plain":"s256";return[f,g]}fM.promiseConstructor=Promise;let fT=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,fU=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function fV(a){if(!fU.test(a))throw Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function fW(){return new Proxy({},{get:(a,b)=>{if("__isUserNotAvailableProxy"===b)return!0;if("symbol"==typeof b){let a=b.toString();if("Symbol(Symbol.toPrimitive)"===a||"Symbol(Symbol.toStringTag)"===a||"Symbol(util.inspect.custom)"===a)return}throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${b}" property of the session object is not supported. Please use getUser() instead.`)},set:(a,b)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${b}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(a,b)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${b}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function fX(a){return JSON.parse(JSON.stringify(a))}let fY=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),fZ=[502,503,504];async function f$(a){var b;let c,d;if(!("object"==typeof a&&null!==a&&"status"in a&&"ok"in a&&"json"in a&&"function"==typeof a.json))throw new fw(fY(a),0);if(fZ.includes(a.status))throw new fw(fY(a),a.status);try{c=await a.json()}catch(a){throw new fq(fY(a),a)}let e=function(a){let b=a.headers.get(fk);if(!b||!b.match(fT))return null;try{return new Date(`${b}T00:00:00.0Z`)}catch(a){return null}}(a);if(e&&e.getTime()>=fl["2024-01-01"].timestamp&&"object"==typeof c&&c&&"string"==typeof c.code?d=c.code:"object"==typeof c&&c&&"string"==typeof c.error_code&&(d=c.error_code),d){if("weak_password"===d)throw new fy(fY(c),a.status,(null==(b=c.weak_password)?void 0:b.reasons)||[]);else if("session_not_found"===d)throw new fs}else if("object"==typeof c&&c&&"object"==typeof c.weak_password&&c.weak_password&&Array.isArray(c.weak_password.reasons)&&c.weak_password.reasons.length&&c.weak_password.reasons.reduce((a,b)=>a&&"string"==typeof b,!0))throw new fy(fY(c),a.status,c.weak_password.reasons);throw new fp(fY(c),a.status||500,d)}async function f_(a,b,c,d){var e;let f=Object.assign({},null==d?void 0:d.headers);f[fk]||(f[fk]=fl["2024-01-01"].name),(null==d?void 0:d.jwt)&&(f.Authorization=`Bearer ${d.jwt}`);let g=null!=(e=null==d?void 0:d.query)?e:{};(null==d?void 0:d.redirectTo)&&(g.redirect_to=d.redirectTo);let h=Object.keys(g).length?"?"+new URLSearchParams(g).toString():"",i=await f0(a,b,c+h,{headers:f,noResolveJson:null==d?void 0:d.noResolveJson},{},null==d?void 0:d.body);return(null==d?void 0:d.xform)?null==d?void 0:d.xform(i):{data:Object.assign({},i),error:null}}async function f0(a,b,c,d,e,f){let g,h,i=(h={method:b,headers:(null==d?void 0:d.headers)||{}},"GET"===b?h:(h.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==d?void 0:d.headers),h.body=JSON.stringify(f),Object.assign(Object.assign({},h),e)));try{g=await a(c,Object.assign({},i))}catch(a){throw console.error(a),new fw(fY(a),0)}if(g.ok||await f$(g),null==d?void 0:d.noResolveJson)return g;try{return await g.json()}catch(a){await f$(a)}}function f1(a){var b,c,d;let e=null;(d=a).access_token&&d.refresh_token&&d.expires_in&&(e=Object.assign({},a),a.expires_at||(e.expires_at=(c=a.expires_in,Math.round(Date.now()/1e3)+c)));return{data:{session:e,user:null!=(b=a.user)?b:a},error:null}}function f2(a){let b=f1(a);return!b.error&&a.weak_password&&"object"==typeof a.weak_password&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.message&&"string"==typeof a.weak_password.message&&a.weak_password.reasons.reduce((a,b)=>a&&"string"==typeof b,!0)&&(b.data.weak_password=a.weak_password),b}function f3(a){var b;return{data:{user:null!=(b=a.user)?b:a},error:null}}function f4(a){return{data:a,error:null}}function f5(a){let{action_link:b,email_otp:c,hashed_token:d,redirect_to:e,verification_type:f}=a;return{data:{properties:{action_link:b,email_otp:c,hashed_token:d,redirect_to:e,verification_type:f},user:Object.assign({},(0,d7.__rest)(a,["action_link","email_otp","hashed_token","redirect_to","verification_type"]))},error:null}}function f6(a){return a}let f7=["global","local","others"];class f8{constructor({url:a="",headers:b={},fetch:c}){this.url=a,this.headers=b,this.fetch=fI(c),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(a,b=f7[0]){if(0>f7.indexOf(b))throw Error(`@supabase/auth-js: Parameter scope must be one of ${f7.join(", ")}`);try{return await f_(this.fetch,"POST",`${this.url}/logout?scope=${b}`,{headers:this.headers,jwt:a,noResolveJson:!0}),{data:null,error:null}}catch(a){if(fo(a))return{data:null,error:a};throw a}}async inviteUserByEmail(a,b={}){try{return await f_(this.fetch,"POST",`${this.url}/invite`,{body:{email:a,data:b.data},headers:this.headers,redirectTo:b.redirectTo,xform:f3})}catch(a){if(fo(a))return{data:{user:null},error:a};throw a}}async generateLink(a){try{let{options:b}=a,c=(0,d7.__rest)(a,["options"]),d=Object.assign(Object.assign({},c),b);return"newEmail"in c&&(d.new_email=null==c?void 0:c.newEmail,delete d.newEmail),await f_(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:d,headers:this.headers,xform:f5,redirectTo:null==b?void 0:b.redirectTo})}catch(a){if(fo(a))return{data:{properties:null,user:null},error:a};throw a}}async createUser(a){try{return await f_(this.fetch,"POST",`${this.url}/admin/users`,{body:a,headers:this.headers,xform:f3})}catch(a){if(fo(a))return{data:{user:null},error:a};throw a}}async listUsers(a){var b,c,d,e,f,g,h;try{let i={nextPage:null,lastPage:0,total:0},j=await f_(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!=(c=null==(b=null==a?void 0:a.page)?void 0:b.toString())?c:"",per_page:null!=(e=null==(d=null==a?void 0:a.perPage)?void 0:d.toString())?e:""},xform:f6});if(j.error)throw j.error;let k=await j.json(),l=null!=(f=j.headers.get("x-total-count"))?f:0,m=null!=(h=null==(g=j.headers.get("link"))?void 0:g.split(","))?h:[];return m.length>0&&(m.forEach(a=>{let b=parseInt(a.split(";")[0].split("=")[1].substring(0,1)),c=JSON.parse(a.split(";")[1].split("=")[1]);i[`${c}Page`]=b}),i.total=parseInt(l)),{data:Object.assign(Object.assign({},k),i),error:null}}catch(a){if(fo(a))return{data:{users:[]},error:a};throw a}}async getUserById(a){fV(a);try{return await f_(this.fetch,"GET",`${this.url}/admin/users/${a}`,{headers:this.headers,xform:f3})}catch(a){if(fo(a))return{data:{user:null},error:a};throw a}}async updateUserById(a,b){fV(a);try{return await f_(this.fetch,"PUT",`${this.url}/admin/users/${a}`,{body:b,headers:this.headers,xform:f3})}catch(a){if(fo(a))return{data:{user:null},error:a};throw a}}async deleteUser(a,b=!1){fV(a);try{return await f_(this.fetch,"DELETE",`${this.url}/admin/users/${a}`,{headers:this.headers,body:{should_soft_delete:b},xform:f3})}catch(a){if(fo(a))return{data:{user:null},error:a};throw a}}async _listFactors(a){fV(a.userId);try{let{data:b,error:c}=await f_(this.fetch,"GET",`${this.url}/admin/users/${a.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:b,error:c}}catch(a){if(fo(a))return{data:null,error:a};throw a}}async _deleteFactor(a){fV(a.userId),fV(a.id);try{return{data:await f_(this.fetch,"DELETE",`${this.url}/admin/users/${a.userId}/factors/${a.id}`,{headers:this.headers}),error:null}}catch(a){if(fo(a))return{data:null,error:a};throw a}}async _listOAuthClients(a){var b,c,d,e,f,g,h;try{let i={nextPage:null,lastPage:0,total:0},j=await f_(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!=(c=null==(b=null==a?void 0:a.page)?void 0:b.toString())?c:"",per_page:null!=(e=null==(d=null==a?void 0:a.perPage)?void 0:d.toString())?e:""},xform:f6});if(j.error)throw j.error;let k=await j.json(),l=null!=(f=j.headers.get("x-total-count"))?f:0,m=null!=(h=null==(g=j.headers.get("link"))?void 0:g.split(","))?h:[];return m.length>0&&(m.forEach(a=>{let b=parseInt(a.split(";")[0].split("=")[1].substring(0,1)),c=JSON.parse(a.split(";")[1].split("=")[1]);i[`${c}Page`]=b}),i.total=parseInt(l)),{data:Object.assign(Object.assign({},k),i),error:null}}catch(a){if(fo(a))return{data:{clients:[]},error:a};throw a}}async _createOAuthClient(a){try{return await f_(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:a,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(fo(a))return{data:null,error:a};throw a}}async _getOAuthClient(a){try{return await f_(this.fetch,"GET",`${this.url}/admin/oauth/clients/${a}`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(fo(a))return{data:null,error:a};throw a}}async _updateOAuthClient(a,b){try{return await f_(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${a}`,{body:b,headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(fo(a))return{data:null,error:a};throw a}}async _deleteOAuthClient(a){try{return await f_(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${a}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(a){if(fo(a))return{data:null,error:a};throw a}}async _regenerateOAuthClientSecret(a){try{return await f_(this.fetch,"POST",`${this.url}/admin/oauth/clients/${a}/regenerate_secret`,{headers:this.headers,xform:a=>({data:a,error:null})})}catch(a){if(fo(a))return{data:null,error:a};throw a}}}function f9(a={}){return{getItem:b=>a[b]||null,setItem:(b,c)=>{a[b]=c},removeItem:b=>{delete a[b]}}}globalThis;class ga extends Error{constructor(a){super(a),this.isAcquireTimeout=!0}}function gb(a){if(!/^0x[a-fA-F0-9]{40}$/.test(a))throw Error(`@supabase/auth-js: Address "${a}" is invalid.`);return a.toLowerCase()}class gc extends Error{constructor({message:a,code:b,cause:c,name:d}){var e;super(a,{cause:c}),this.__isWebAuthnError=!0,this.name=null!=(e=null!=d?d:c instanceof Error?c.name:void 0)?e:"Unknown Error",this.code=b}}class gd extends gc{constructor(a,b){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:b,message:a}),this.name="WebAuthnUnknownError",this.originalError=b}}let ge=new class{createNewAbortSignal(){if(this.controller){let a=Error("Cancelling existing WebAuthn API call for new one");a.name="AbortError",this.controller.abort(a)}let a=new AbortController;return this.controller=a,a.signal}cancelCeremony(){if(this.controller){let a=Error("Manually cancelling existing WebAuthn API call");a.name="AbortError",this.controller.abort(a),this.controller=void 0}}};function gf(a){return"localhost"===a||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(a)}async function gg(a){try{let b=await navigator.credentials.create(a);if(!b)return{data:null,error:new gd("Empty credential response",b)};if(!(b instanceof PublicKeyCredential))return{data:null,error:new gd("Browser returned unexpected credential type",b)};return{data:b,error:null}}catch(b){return{data:null,error:function({error:a,options:b}){var c,d,e;let{publicKey:f}=b;if(!f)throw Error("options was missing required publicKey property");if("AbortError"===a.name){if(b.signal instanceof AbortSignal)return new gc({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else if("ConstraintError"===a.name){if((null==(c=f.authenticatorSelection)?void 0:c.requireResidentKey)===!0)return new gc({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:a});else if("conditional"===b.mediation&&(null==(d=f.authenticatorSelection)?void 0:d.userVerification)==="required")return new gc({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:a});else if((null==(e=f.authenticatorSelection)?void 0:e.userVerification)==="required")return new gc({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:a})}else if("InvalidStateError"===a.name)return new gc({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:a});else if("NotAllowedError"===a.name)return new gc({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});else if("NotSupportedError"===a.name)return new gc(0===f.pubKeyCredParams.filter(a=>"public-key"===a.type).length?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:a}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:a});else if("SecurityError"===a.name){let b=window.location.hostname;if(!gf(b))return new gc({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a});if(f.rp.id!==b)return new gc({message:`The RP ID "${f.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else if("TypeError"===a.name){if(f.user.id.byteLength<1||f.user.id.byteLength>64)return new gc({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:a})}else if("UnknownError"===a.name)return new gc({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a});return new gc({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a})}({error:b,options:a})}}}async function gh(a){try{let b=await navigator.credentials.get(a);if(!b)return{data:null,error:new gd("Empty credential response",b)};if(!(b instanceof PublicKeyCredential))return{data:null,error:new gd("Browser returned unexpected credential type",b)};return{data:b,error:null}}catch(b){return{data:null,error:function({error:a,options:b}){let{publicKey:c}=b;if(!c)throw Error("options was missing required publicKey property");if("AbortError"===a.name){if(b.signal instanceof AbortSignal)return new gc({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else if("NotAllowedError"===a.name)return new gc({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});else if("SecurityError"===a.name){let b=window.location.hostname;if(!gf(b))return new gc({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a});if(c.rpId!==b)return new gc({message:`The RP ID "${c.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else if("UnknownError"===a.name)return new gc({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a});return new gc({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a})}({error:b,options:a})}}}let gi={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},gj={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function gk(...a){let b=a=>null!==a&&"object"==typeof a&&!Array.isArray(a),c=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),d={};for(let e of a)if(e)for(let a in e){let f=e[a];if(void 0!==f)if(Array.isArray(f))d[a]=f;else if(c(f))d[a]=f;else if(b(f)){let c=d[a];b(c)?d[a]=gk(c,f):d[a]=gk(f)}else d[a]=f}return d}class gl{constructor(a){this.client=a,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(a){return this.client.mfa.enroll(Object.assign(Object.assign({},a),{factorType:"webauthn"}))}async _challenge({factorId:a,webauthn:b,friendlyName:c,signal:d},e){try{var f,g,h,i;let{data:j,error:k}=await this.client.mfa.challenge({factorId:a,webauthn:b});if(!j)return{data:null,error:k};let l=null!=d?d:ge.createNewAbortSignal();if("create"===j.webauthn.type){let{user:a}=j.webauthn.credential_options.publicKey;a.name||(a.name=`${a.id}:${c}`),a.displayName||(a.displayName=a.name)}switch(j.webauthn.type){case"create":{let b=(f=j.webauthn.credential_options.publicKey,g=null==e?void 0:e.create,gk(gi,f,g||{})),{data:c,error:d}=await gg({publicKey:b,signal:l});if(c)return{data:{factorId:a,challengeId:j.id,webauthn:{type:j.webauthn.type,credential_response:c}},error:null};return{data:null,error:d}}case"request":{let b=(h=j.webauthn.credential_options.publicKey,i=null==e?void 0:e.request,gk(gj,h,i||{})),{data:c,error:d}=await gh(Object.assign(Object.assign({},j.webauthn.credential_options),{publicKey:b,signal:l}));if(c)return{data:{factorId:a,challengeId:j.id,webauthn:{type:j.webauthn.type,credential_response:c}},error:null};return{data:null,error:d}}}}catch(a){if(fo(a))return{data:null,error:a};return{data:null,error:new fq("Unexpected error in challenge",a)}}}async _verify({challengeId:a,factorId:b,webauthn:c}){return this.client.mfa.verify({factorId:b,challengeId:a,webauthn:c})}async _authenticate({factorId:a,webauthn:{rpId:b,rpOrigins:c,signal:d}={}},e){if(!b)return{data:null,error:new fn("rpId is required for WebAuthn authentication")};try{1;return{data:null,error:new fq("Browser does not support WebAuthn",null)}}catch(a){if(fo(a))return{data:null,error:a};return{data:null,error:new fq("Unexpected error in authenticate",a)}}}async _register({friendlyName:a,webauthn:{rpId:b,rpOrigins:c,signal:d}={}},e){if(!b)return{data:null,error:new fn("rpId is required for WebAuthn registration")};try{1;return{data:null,error:new fq("Browser does not support WebAuthn",null)}}catch(a){if(fo(a))return{data:null,error:a};return{data:null,error:new fq("Unexpected error in register",a)}}}}if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(a){"undefined"!=typeof self&&(self.globalThis=self)}let gm={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:fj,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function gn(a,b,c){return await c()}let go={};class gp{get jwks(){var a,b;return null!=(b=null==(a=go[this.storageKey])?void 0:a.jwks)?b:{keys:[]}}set jwks(a){go[this.storageKey]=Object.assign(Object.assign({},go[this.storageKey]),{jwks:a})}get jwks_cached_at(){var a,b;return null!=(b=null==(a=go[this.storageKey])?void 0:a.cachedAt)?b:Number.MIN_SAFE_INTEGER}set jwks_cached_at(a){go[this.storageKey]=Object.assign(Object.assign({},go[this.storageKey]),{cachedAt:a})}constructor(a){var b;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const c=Object.assign(Object.assign({},gm),a);this.storageKey=c.storageKey,this.instanceID=null!=(b=gp.nextInstanceID[this.storageKey])?b:0,gp.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!c.debug,"function"==typeof c.debug&&(this.logger=c.debug),this.instanceID,this.persistSession=c.persistSession,this.autoRefreshToken=c.autoRefreshToken,this.admin=new f8({url:c.url,headers:c.headers,fetch:c.fetch}),this.url=c.url,this.headers=c.headers,this.fetch=fI(c.fetch),this.lock=c.lock||gn,this.detectSessionInUrl=c.detectSessionInUrl,this.flowType=c.flowType,this.hasCustomAuthorizationHeader=c.hasCustomAuthorizationHeader,this.throwOnError=c.throwOnError,c.lock?this.lock=c.lock:this.lock=gn,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new gl(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(c.storage?this.storage=c.storage:(this.memoryStorage={},this.storage=f9(this.memoryStorage)),c.userStorage&&(this.userStorage=c.userStorage)):(this.memoryStorage={},this.storage=f9(this.memoryStorage)),this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(a){if(this.throwOnError&&a&&a.error)throw a.error;return a}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${fi}) ${new Date().toISOString()}`}_debug(...a){return this.logDebugMessages&&this.logger(this._logPrefix(),...a),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){try{return await this._recoverAndRefresh(),{error:null}}catch(a){if(fo(a))return this._returnResult({error:a});return this._returnResult({error:new fq("Unexpected error during initialization",a)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(a){var b,c,d;try{let{data:e,error:f}=await f_(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!=(c=null==(b=null==a?void 0:a.options)?void 0:b.data)?c:{},gotrue_meta_security:{captcha_token:null==(d=null==a?void 0:a.options)?void 0:d.captchaToken}},xform:f1});if(f||!e)return this._returnResult({data:{user:null,session:null},error:f});let g=e.session,h=e.user;return e.session&&(await this._saveSession(e.session),await this._notifyAllSubscribers("SIGNED_IN",g)),this._returnResult({data:{user:h,session:g},error:null})}catch(a){if(fo(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signUp(a){var b,c,d;try{let e;if("email"in a){let{email:c,password:d,options:f}=a,g=null,h=null;"pkce"===this.flowType&&([g,h]=await fS(this.storage,this.storageKey)),e=await f_(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==f?void 0:f.emailRedirectTo,body:{email:c,password:d,data:null!=(b=null==f?void 0:f.data)?b:{},gotrue_meta_security:{captcha_token:null==f?void 0:f.captchaToken},code_challenge:g,code_challenge_method:h},xform:f1})}else if("phone"in a){let{phone:b,password:f,options:g}=a;e=await f_(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:b,password:f,data:null!=(c=null==g?void 0:g.data)?c:{},channel:null!=(d=null==g?void 0:g.channel)?d:"sms",gotrue_meta_security:{captcha_token:null==g?void 0:g.captchaToken}},xform:f1})}else throw new fu("You must provide either an email or phone number and a password");let{data:f,error:g}=e;if(g||!f)return this._returnResult({data:{user:null,session:null},error:g});let h=f.session,i=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:i,session:h},error:null})}catch(a){if(fo(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithPassword(a){try{let b;if("email"in a){let{email:c,password:d,options:e}=a;b=await f_(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:c,password:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:f2})}else if("phone"in a){let{phone:c,password:d,options:e}=a;b=await f_(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:c,password:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:f2})}else throw new fu("You must provide either an email or phone number and a password");let{data:c,error:d}=b;if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!c||!c.session||!c.user){let a=new ft;return this._returnResult({data:{user:null,session:null},error:a})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:Object.assign({user:c.user,session:c.session},c.weak_password?{weakPassword:c.weak_password}:null),error:d})}catch(a){if(fo(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithOAuth(a){var b,c,d,e;return await this._handleProviderSignIn(a.provider,{redirectTo:null==(b=a.options)?void 0:b.redirectTo,scopes:null==(c=a.options)?void 0:c.scopes,queryParams:null==(d=a.options)?void 0:d.queryParams,skipBrowserRedirect:null==(e=a.options)?void 0:e.skipBrowserRedirect})}async exchangeCodeForSession(a){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(a))}async signInWithWeb3(a){let{chain:b}=a;switch(b){case"ethereum":return await this.signInWithEthereum(a);case"solana":return await this.signInWithSolana(a);default:throw Error(`@supabase/auth-js: Unsupported chain "${b}"`)}}async signInWithEthereum(a){var b,c,d,e,f,g,h,i,j,k,l,m;let n,o;if("message"in a)n=a.message,o=a.signature;else{let{chain:k,wallet:l,statement:p,options:q}=a;if("object"!=typeof l||!(null==q?void 0:q.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");let r=new URL(null!=(b=null==q?void 0:q.url)?b:window.location.href),s=await l.request({method:"eth_requestAccounts"}).then(a=>a).catch(()=>{throw Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!s||0===s.length)throw Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let t=gb(s[0]),u=null==(c=null==q?void 0:q.signInWithEthereum)?void 0:c.chainId;u||(u=parseInt(await l.request({method:"eth_chainId"}),16)),n=function(a){var b;let{chainId:c,domain:d,expirationTime:e,issuedAt:f=new Date,nonce:g,notBefore:h,requestId:i,resources:j,scheme:k,uri:l,version:m}=a;if(!Number.isInteger(c))throw Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${c}`);if(!d)throw Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(g&&g.length<8)throw Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${g}`);if(!l)throw Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==m)throw Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${m}`);if(null==(b=a.statement)?void 0:b.includes("\n"))throw Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${a.statement}`);let n=gb(a.address),o=k?`${k}://${d}`:d,p=a.statement?`${a.statement}
`:"",q=`${o} wants you to sign in with your Ethereum account:
${n}

${p}`,r=`URI: ${l}
Version: ${m}
Chain ID: ${c}${g?`
Nonce: ${g}`:""}
Issued At: ${f.toISOString()}`;if(e&&(r+=`
Expiration Time: ${e.toISOString()}`),h&&(r+=`
Not Before: ${h.toISOString()}`),i&&(r+=`
Request ID: ${i}`),j){let a="\nResources:";for(let b of j){if(!b||"string"!=typeof b)throw Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${b}`);a+=`
- ${b}`}r+=a}return`${q}
${r}`}({domain:r.host,address:t,statement:p,uri:r.href,version:"1",chainId:u,nonce:null==(d=null==q?void 0:q.signInWithEthereum)?void 0:d.nonce,issuedAt:null!=(f=null==(e=null==q?void 0:q.signInWithEthereum)?void 0:e.issuedAt)?f:new Date,expirationTime:null==(g=null==q?void 0:q.signInWithEthereum)?void 0:g.expirationTime,notBefore:null==(h=null==q?void 0:q.signInWithEthereum)?void 0:h.notBefore,requestId:null==(i=null==q?void 0:q.signInWithEthereum)?void 0:i.requestId,resources:null==(j=null==q?void 0:q.signInWithEthereum)?void 0:j.resources}),o=await l.request({method:"personal_sign",params:[(m=n,"0x"+Array.from(new TextEncoder().encode(m),a=>a.toString(16).padStart(2,"0")).join("")),t]})}try{let{data:b,error:c}=await f_(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:n,signature:o},(null==(k=a.options)?void 0:k.captchaToken)?{gotrue_meta_security:{captcha_token:null==(l=a.options)?void 0:l.captchaToken}}:null),xform:f1});if(c)throw c;if(!b||!b.session||!b.user){let a=new ft;return this._returnResult({data:{user:null,session:null},error:a})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:c})}catch(a){if(fo(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSolana(a){var b,c,d,e,f,g,h,i,j,k,l,m;let n,o;if("message"in a)n=a.message,o=a.signature;else{let{chain:l,wallet:m,statement:p,options:q}=a;if("object"!=typeof m||!(null==q?void 0:q.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");let r=new URL(null!=(b=null==q?void 0:q.url)?b:window.location.href);if("signIn"in m&&m.signIn){let a,b=await m.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},null==q?void 0:q.signInWithSolana),{version:"1",domain:r.host,uri:r.href}),p?{statement:p}:null));if(Array.isArray(b)&&b[0]&&"object"==typeof b[0])a=b[0];else if(b&&"object"==typeof b&&"signedMessage"in b&&"signature"in b)a=b;else throw Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in a&&"signature"in a&&("string"==typeof a.signedMessage||a.signedMessage instanceof Uint8Array)&&a.signature instanceof Uint8Array)n="string"==typeof a.signedMessage?a.signedMessage:new TextDecoder().decode(a.signedMessage),o=a.signature;else throw Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in m)||"function"!=typeof m.signMessage||!("publicKey"in m)||"object"!=typeof m||!m.publicKey||!("toBase58"in m.publicKey)||"function"!=typeof m.publicKey.toBase58)throw Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");n=[`${r.host} wants you to sign in with your Solana account:`,m.publicKey.toBase58(),...p?["",p,""]:[""],"Version: 1",`URI: ${r.href}`,`Issued At: ${null!=(d=null==(c=null==q?void 0:q.signInWithSolana)?void 0:c.issuedAt)?d:new Date().toISOString()}`,...(null==(e=null==q?void 0:q.signInWithSolana)?void 0:e.notBefore)?[`Not Before: ${q.signInWithSolana.notBefore}`]:[],...(null==(f=null==q?void 0:q.signInWithSolana)?void 0:f.expirationTime)?[`Expiration Time: ${q.signInWithSolana.expirationTime}`]:[],...(null==(g=null==q?void 0:q.signInWithSolana)?void 0:g.chainId)?[`Chain ID: ${q.signInWithSolana.chainId}`]:[],...(null==(h=null==q?void 0:q.signInWithSolana)?void 0:h.nonce)?[`Nonce: ${q.signInWithSolana.nonce}`]:[],...(null==(i=null==q?void 0:q.signInWithSolana)?void 0:i.requestId)?[`Request ID: ${q.signInWithSolana.requestId}`]:[],...(null==(k=null==(j=null==q?void 0:q.signInWithSolana)?void 0:j.resources)?void 0:k.length)?["Resources",...q.signInWithSolana.resources.map(a=>`- ${a}`)]:[]].join("\n");let a=await m.signMessage(new TextEncoder().encode(n),"utf8");if(!a||!(a instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");o=a}}try{let{data:b,error:c}=await f_(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:n,signature:fH(o)},(null==(l=a.options)?void 0:l.captchaToken)?{gotrue_meta_security:{captcha_token:null==(m=a.options)?void 0:m.captchaToken}}:null),xform:f1});if(c)throw c;if(!b||!b.session||!b.user){let a=new ft;return this._returnResult({data:{user:null,session:null},error:a})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:c})}catch(a){if(fo(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async _exchangeCodeForSession(a){let b=await fK(this.storage,`${this.storageKey}-code-verifier`),[c,d]=(null!=b?b:"").split("/");try{let{data:b,error:e}=await f_(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:a,code_verifier:c},xform:f1});if(await fL(this.storage,`${this.storageKey}-code-verifier`),e)throw e;if(!b||!b.session||!b.user){let a=new ft;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign(Object.assign({},b),{redirectType:null!=d?d:null}),error:e})}catch(a){if(fo(a))return this._returnResult({data:{user:null,session:null,redirectType:null},error:a});throw a}}async signInWithIdToken(a){try{let{options:b,provider:c,token:d,access_token:e,nonce:f}=a,{data:g,error:h}=await f_(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:c,id_token:d,access_token:e,nonce:f,gotrue_meta_security:{captcha_token:null==b?void 0:b.captchaToken}},xform:f1});if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!g||!g.session||!g.user){let a=new ft;return this._returnResult({data:{user:null,session:null},error:a})}return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),this._returnResult({data:g,error:h})}catch(a){if(fo(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithOtp(a){var b,c,d,e,f;try{if("email"in a){let{email:d,options:e}=a,f=null,g=null;"pkce"===this.flowType&&([f,g]=await fS(this.storage,this.storageKey));let{error:h}=await f_(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:d,data:null!=(b=null==e?void 0:e.data)?b:{},create_user:null==(c=null==e?void 0:e.shouldCreateUser)||c,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken},code_challenge:f,code_challenge_method:g},redirectTo:null==e?void 0:e.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:h})}if("phone"in a){let{phone:b,options:c}=a,{data:g,error:h}=await f_(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:b,data:null!=(d=null==c?void 0:c.data)?d:{},create_user:null==(e=null==c?void 0:c.shouldCreateUser)||e,gotrue_meta_security:{captcha_token:null==c?void 0:c.captchaToken},channel:null!=(f=null==c?void 0:c.channel)?f:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null==g?void 0:g.message_id},error:h})}throw new fu("You must provide either an email or phone number.")}catch(a){if(fo(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(a){var b,c;try{let d,e;"options"in a&&(d=null==(b=a.options)?void 0:b.redirectTo,e=null==(c=a.options)?void 0:c.captchaToken);let{data:f,error:g}=await f_(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},a),{gotrue_meta_security:{captcha_token:e}}),redirectTo:d,xform:f1});if(g)throw g;if(!f)throw Error("An error occurred on token verification.");let h=f.session,i=f.user;return(null==h?void 0:h.access_token)&&(await this._saveSession(h),await this._notifyAllSubscribers("recovery"==a.type?"PASSWORD_RECOVERY":"SIGNED_IN",h)),this._returnResult({data:{user:i,session:h},error:null})}catch(a){if(fo(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSSO(a){var b,c,d,e;try{let f=null,g=null;"pkce"===this.flowType&&([f,g]=await fS(this.storage,this.storageKey));let h=await f_(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in a?{provider_id:a.providerId}:null),"domain"in a?{domain:a.domain}:null),{redirect_to:null!=(c=null==(b=a.options)?void 0:b.redirectTo)?c:void 0}),(null==(d=null==a?void 0:a.options)?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:a.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:f,code_challenge_method:g}),headers:this.headers,xform:f4});return null==(e=h.data)||e.url,this._returnResult(h)}catch(a){if(fo(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async a=>{let{data:{session:b},error:c}=a;if(c)throw c;if(!b)throw new fs;let{error:d}=await f_(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:b.access_token});return this._returnResult({data:{user:null,session:null},error:d})})}catch(a){if(fo(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async resend(a){try{let b=`${this.url}/resend`;if("email"in a){let{email:c,type:d,options:e}=a,{error:f}=await f_(this.fetch,"POST",b,{headers:this.headers,body:{email:c,type:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},redirectTo:null==e?void 0:e.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:f})}if("phone"in a){let{phone:c,type:d,options:e}=a,{data:f,error:g}=await f_(this.fetch,"POST",b,{headers:this.headers,body:{phone:c,type:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null==f?void 0:f.message_id},error:g})}throw new fu("You must provide either an email or phone number and a type")}catch(a){if(fo(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async a=>a))}async _acquireLock(a,b){this._debug("#_acquireLock","begin",a);try{if(this.lockAcquired){let a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),c=(async()=>(await a,await b()))();return this.pendingInLock.push((async()=>{try{await c}catch(a){}})()),c}return await this.lock(`lock:${this.storageKey}`,a,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let a=b();for(this.pendingInLock.push((async()=>{try{await a}catch(a){}})()),await a;this.pendingInLock.length;){let a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(a){this._debug("#_useSession","begin");try{let b=await this.__loadSession();return await a(b)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let b=null,c=await fK(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",c),null!==c&&(this._isValidSession(c)?b=c:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!b)return{data:{session:null},error:null};let d=!!b.expires_at&&1e3*b.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${d?"":" not"} expired`,"expires_at",b.expires_at),!d){if(this.userStorage){let a=await fK(this.userStorage,this.storageKey+"-user");(null==a?void 0:a.user)?b.user=a.user:b.user=fW()}if(this.storage.isServer&&b.user&&!b.user.__isUserNotAvailableProxy){var a;let c={value:this.suppressGetSessionWarning};b.user=(a=b.user,new Proxy(a,{get:(a,b,d)=>{if("__isInsecureUserWarningProxy"===b)return!0;if("symbol"==typeof b){let c=b.toString();if("Symbol(Symbol.toPrimitive)"===c||"Symbol(Symbol.toStringTag)"===c||"Symbol(util.inspect.custom)"===c||"Symbol(nodejs.util.inspect.custom)"===c)return Reflect.get(a,b,d)}return c.value||"string"!=typeof b||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),c.value=!0),Reflect.get(a,b,d)}})),c.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:b},error:null}}let{data:e,error:f}=await this._callRefreshToken(b.refresh_token);if(f)return this._returnResult({data:{session:null},error:f});return this._returnResult({data:{session:e},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(a){return a?await this._getUser(a):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(a){try{if(a)return await f_(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:a,xform:f3});return await this._useSession(async a=>{var b,c,d;let{data:e,error:f}=a;if(f)throw f;return(null==(b=e.session)?void 0:b.access_token)||this.hasCustomAuthorizationHeader?await f_(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!=(d=null==(c=e.session)?void 0:c.access_token)?d:void 0,xform:f3}):{data:{user:null},error:new fs}})}catch(a){if(fo(a))return fo(a)&&"AuthSessionMissingError"===a.name&&(await this._removeSession(),await fL(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:a});throw a}}async updateUser(a,b={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(a,b))}async _updateUser(a,b={}){try{return await this._useSession(async c=>{let{data:d,error:e}=c;if(e)throw e;if(!d.session)throw new fs;let f=d.session,g=null,h=null;"pkce"===this.flowType&&null!=a.email&&([g,h]=await fS(this.storage,this.storageKey));let{data:i,error:j}=await f_(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==b?void 0:b.emailRedirectTo,body:Object.assign(Object.assign({},a),{code_challenge:g,code_challenge_method:h}),jwt:f.access_token,xform:f3});if(j)throw j;return f.user=i.user,await this._saveSession(f),await this._notifyAllSubscribers("USER_UPDATED",f),this._returnResult({data:{user:f.user},error:null})})}catch(a){if(fo(a))return this._returnResult({data:{user:null},error:a});throw a}}async setSession(a){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(a))}async _setSession(a){try{if(!a.access_token||!a.refresh_token)throw new fs;let b=Date.now()/1e3,c=b,d=!0,e=null,{payload:f}=fN(a.access_token);if(f.exp&&(d=(c=f.exp)<=b),d){let{data:b,error:c}=await this._callRefreshToken(a.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!b)return{data:{user:null,session:null},error:null};e=b}else{let{data:d,error:f}=await this._getUser(a.access_token);if(f)throw f;e={access_token:a.access_token,refresh_token:a.refresh_token,user:d.user,token_type:"bearer",expires_in:c-b,expires_at:c},await this._saveSession(e),await this._notifyAllSubscribers("SIGNED_IN",e)}return this._returnResult({data:{user:e.user,session:e},error:null})}catch(a){if(fo(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}}async refreshSession(a){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(a))}async _refreshSession(a){try{return await this._useSession(async b=>{var c;if(!a){let{data:d,error:e}=b;if(e)throw e;a=null!=(c=d.session)?c:void 0}if(!(null==a?void 0:a.refresh_token))throw new fs;let{data:d,error:e}=await this._callRefreshToken(a.refresh_token);return e?this._returnResult({data:{user:null,session:null},error:e}):d?this._returnResult({data:{user:d.user,session:d},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(a){if(fo(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async _getSessionFromURL(a,b){try{throw new fv("No browser detected.")}catch(a){if(fo(a))return this._returnResult({data:{session:null,redirectType:null},error:a});throw a}}_isImplicitGrantCallback(a){return!!(a.access_token||a.error_description)}async _isPKCECallback(a){let b=await fK(this.storage,`${this.storageKey}-code-verifier`);return!!(a.code&&b)}async signOut(a={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(a))}async _signOut({scope:a}={scope:"global"}){return await this._useSession(async b=>{var c;let{data:d,error:e}=b;if(e)return this._returnResult({error:e});let f=null==(c=d.session)?void 0:c.access_token;if(f){let{error:b}=await this.admin.signOut(f,a);if(b&&!(fo(b)&&"AuthApiError"===b.name&&(404===b.status||401===b.status||403===b.status)))return this._returnResult({error:b})}return"others"!==a&&(await this._removeSession(),await fL(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(a){let b=Symbol("auth-callback"),c={id:b,callback:a,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",b),this.stateChangeEmitters.delete(b)}};return this._debug("#onAuthStateChange()","registered callback with id",b),this.stateChangeEmitters.set(b,c),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(b)})})(),{data:{subscription:c}}}async _emitInitialSession(a){return await this._useSession(async b=>{var c,d;try{let{data:{session:d},error:e}=b;if(e)throw e;await (null==(c=this.stateChangeEmitters.get(a))?void 0:c.callback("INITIAL_SESSION",d)),this._debug("INITIAL_SESSION","callback id",a,"session",d)}catch(b){await (null==(d=this.stateChangeEmitters.get(a))?void 0:d.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",a,"error",b),console.error(b)}})}async resetPasswordForEmail(a,b={}){let c=null,d=null;"pkce"===this.flowType&&([c,d]=await fS(this.storage,this.storageKey,!0));try{return await f_(this.fetch,"POST",`${this.url}/recover`,{body:{email:a,code_challenge:c,code_challenge_method:d,gotrue_meta_security:{captcha_token:b.captchaToken}},headers:this.headers,redirectTo:b.redirectTo})}catch(a){if(fo(a))return this._returnResult({data:null,error:a});throw a}}async getUserIdentities(){var a;try{let{data:b,error:c}=await this.getUser();if(c)throw c;return this._returnResult({data:{identities:null!=(a=b.user.identities)?a:[]},error:null})}catch(a){if(fo(a))return this._returnResult({data:null,error:a});throw a}}async linkIdentity(a){return"token"in a?this.linkIdentityIdToken(a):this.linkIdentityOAuth(a)}async linkIdentityOAuth(a){try{let{data:b,error:c}=await this._useSession(async b=>{var c,d,e,f,g;let{data:h,error:i}=b;if(i)throw i;let j=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,a.provider,{redirectTo:null==(c=a.options)?void 0:c.redirectTo,scopes:null==(d=a.options)?void 0:d.scopes,queryParams:null==(e=a.options)?void 0:e.queryParams,skipBrowserRedirect:!0});return await f_(this.fetch,"GET",j,{headers:this.headers,jwt:null!=(g=null==(f=h.session)?void 0:f.access_token)?g:void 0})});if(c)throw c;return this._returnResult({data:{provider:a.provider,url:null==b?void 0:b.url},error:null})}catch(b){if(fo(b))return this._returnResult({data:{provider:a.provider,url:null},error:b});throw b}}async linkIdentityIdToken(a){return await this._useSession(async b=>{var c;try{let{error:d,data:{session:e}}=b;if(d)throw d;let{options:f,provider:g,token:h,access_token:i,nonce:j}=a,{data:k,error:l}=await f_(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!=(c=null==e?void 0:e.access_token)?c:void 0,body:{provider:g,id_token:h,access_token:i,nonce:j,link_identity:!0,gotrue_meta_security:{captcha_token:null==f?void 0:f.captchaToken}},xform:f1});if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!k||!k.session||!k.user)return this._returnResult({data:{user:null,session:null},error:new ft});return k.session&&(await this._saveSession(k.session),await this._notifyAllSubscribers("USER_UPDATED",k.session)),this._returnResult({data:k,error:l})}catch(a){if(fo(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}async unlinkIdentity(a){try{return await this._useSession(async b=>{var c,d;let{data:e,error:f}=b;if(f)throw f;return await f_(this.fetch,"DELETE",`${this.url}/user/identities/${a.identity_id}`,{headers:this.headers,jwt:null!=(d=null==(c=e.session)?void 0:c.access_token)?d:void 0})})}catch(a){if(fo(a))return this._returnResult({data:null,error:a});throw a}}async _refreshAccessToken(a){let b=`#_refreshAccessToken(${a.substring(0,5)}...)`;this._debug(b,"begin");try{var c,d;let e=Date.now();return await (c=async c=>(c>0&&await fO(200*Math.pow(2,c-1)),this._debug(b,"refreshing attempt",c),await f_(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:a},headers:this.headers,xform:f1})),d=(a,b)=>{let c=200*Math.pow(2,a);return b&&fx(b)&&Date.now()+c-e<3e4},new Promise((a,b)=>{(async()=>{for(let e=0;e<1/0;e++)try{let b=await c(e);if(!d(e,null,b))return void a(b)}catch(a){if(!d(e,a))return void b(a)}})()}))}catch(a){if(this._debug(b,"error",a),fo(a))return this._returnResult({data:{session:null,user:null},error:a});throw a}finally{this._debug(b,"end")}}_isValidSession(a){return"object"==typeof a&&null!==a&&"access_token"in a&&"refresh_token"in a&&"expires_at"in a}async _handleProviderSignIn(a,b){let c=await this._getUrlForProvider(`${this.url}/authorize`,a,{redirectTo:b.redirectTo,scopes:b.scopes,queryParams:b.queryParams});return this._debug("#_handleProviderSignIn()","provider",a,"options",b,"url",c),{data:{provider:a,url:c},error:null}}async _recoverAndRefresh(){var a,b;let c="#_recoverAndRefresh()";this._debug(c,"begin");try{let d=await fK(this.storage,this.storageKey);if(d&&this.userStorage){let b=await fK(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!b&&(b={user:d.user},await fJ(this.userStorage,this.storageKey+"-user",b)),d.user=null!=(a=null==b?void 0:b.user)?a:fW()}else if(d&&!d.user&&!d.user){let a=await fK(this.storage,this.storageKey+"-user");a&&(null==a?void 0:a.user)?(d.user=a.user,await fL(this.storage,this.storageKey+"-user"),await fJ(this.storage,this.storageKey,d)):d.user=fW()}if(this._debug(c,"session from storage",d),!this._isValidSession(d)){this._debug(c,"session is not valid"),null!==d&&await this._removeSession();return}let e=(null!=(b=d.expires_at)?b:1/0)*1e3-Date.now()<9e4;if(this._debug(c,`session has${e?"":" not"} expired with margin of 90000s`),e){if(this.autoRefreshToken&&d.refresh_token){let{error:a}=await this._callRefreshToken(d.refresh_token);a&&(console.error(a),fx(a)||(this._debug(c,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(d.user&&!0===d.user.__isUserNotAvailableProxy)try{let{data:a,error:b}=await this._getUser(d.access_token);!b&&(null==a?void 0:a.user)?(d.user=a.user,await this._saveSession(d),await this._notifyAllSubscribers("SIGNED_IN",d)):this._debug(c,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(c,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",d)}catch(a){this._debug(c,"error",a),console.error(a);return}finally{this._debug(c,"end")}}async _callRefreshToken(a){var b,c;if(!a)throw new fs;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let d=`#_callRefreshToken(${a.substring(0,5)}...)`;this._debug(d,"begin");try{this.refreshingDeferred=new fM;let{data:b,error:c}=await this._refreshAccessToken(a);if(c)throw c;if(!b.session)throw new fs;await this._saveSession(b.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",b.session);let d={data:b.session,error:null};return this.refreshingDeferred.resolve(d),d}catch(a){if(this._debug(d,"error",a),fo(a)){let c={data:null,error:a};return fx(a)||await this._removeSession(),null==(b=this.refreshingDeferred)||b.resolve(c),c}throw null==(c=this.refreshingDeferred)||c.reject(a),a}finally{this.refreshingDeferred=null,this._debug(d,"end")}}async _notifyAllSubscribers(a,b,c=!0){let d=`#_notifyAllSubscribers(${a})`;this._debug(d,"begin",b,`broadcast = ${c}`);try{this.broadcastChannel&&c&&this.broadcastChannel.postMessage({event:a,session:b});let d=[],e=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(a,b)}catch(a){d.push(a)}});if(await Promise.all(e),d.length>0){for(let a=0;a<d.length;a+=1)console.error(d[a]);throw d[0]}}finally{this._debug(d,"end")}}async _saveSession(a){this._debug("#_saveSession()",a),this.suppressGetSessionWarning=!0;let b=Object.assign({},a),c=b.user&&!0===b.user.__isUserNotAvailableProxy;if(this.userStorage){!c&&b.user&&await fJ(this.userStorage,this.storageKey+"-user",{user:b.user});let a=Object.assign({},b);delete a.user;let d=fX(a);await fJ(this.storage,this.storageKey,d)}else{let a=fX(b);await fJ(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),await fL(this.storage,this.storageKey),await fL(this.storage,this.storageKey+"-code-verifier"),await fL(this.storage,this.storageKey+"-user"),this.userStorage&&await fL(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()"),this.visibilityChangedCallback,this.visibilityChangedCallback=null}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let a=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=a,a&&"object"==typeof a&&"function"==typeof a.unref?a.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(a),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let a=this.autoRefreshTicker;this.autoRefreshTicker=null,a&&clearInterval(a)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let a=Date.now();try{return await this._useSession(async b=>{let{data:{session:c}}=b;if(!c||!c.refresh_token||!c.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");let d=Math.floor((1e3*c.expires_at-a)/3e4);this._debug("#_autoRefreshTokenTick()",`access token expires in ${d} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),d<=3&&await this._callRefreshToken(c.refresh_token)})}catch(a){console.error("Auto refresh tick failed with error. This is likely a transient error.",a)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(a){if(a.isAcquireTimeout||a instanceof ga)this._debug("auto refresh token tick lock not available");else throw a}}async _handleVisibilityChange(){return this._debug("#_handleVisibilityChange()"),this.autoRefreshToken&&this.startAutoRefresh(),!1}async _onVisibilityChanged(a){let b=`#_onVisibilityChanged(${a})`;this._debug(b,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),a||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"!==document.visibilityState?this._debug(b,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting"):await this._recoverAndRefresh()}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(a,b,c){let d=[`provider=${encodeURIComponent(b)}`];if((null==c?void 0:c.redirectTo)&&d.push(`redirect_to=${encodeURIComponent(c.redirectTo)}`),(null==c?void 0:c.scopes)&&d.push(`scopes=${encodeURIComponent(c.scopes)}`),"pkce"===this.flowType){let[a,b]=await fS(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(b)}`});d.push(c.toString())}if(null==c?void 0:c.queryParams){let a=new URLSearchParams(c.queryParams);d.push(a.toString())}return(null==c?void 0:c.skipBrowserRedirect)&&d.push(`skip_http_redirect=${c.skipBrowserRedirect}`),`${a}?${d.join("&")}`}async _unenroll(a){try{return await this._useSession(async b=>{var c;let{data:d,error:e}=b;return e?this._returnResult({data:null,error:e}):await f_(this.fetch,"DELETE",`${this.url}/factors/${a.factorId}`,{headers:this.headers,jwt:null==(c=null==d?void 0:d.session)?void 0:c.access_token})})}catch(a){if(fo(a))return this._returnResult({data:null,error:a});throw a}}async _enroll(a){try{return await this._useSession(async b=>{var c,d;let{data:e,error:f}=b;if(f)return this._returnResult({data:null,error:f});let g=Object.assign({friendly_name:a.friendlyName,factor_type:a.factorType},"phone"===a.factorType?{phone:a.phone}:"totp"===a.factorType?{issuer:a.issuer}:{}),{data:h,error:i}=await f_(this.fetch,"POST",`${this.url}/factors`,{body:g,headers:this.headers,jwt:null==(c=null==e?void 0:e.session)?void 0:c.access_token});return i?this._returnResult({data:null,error:i}):("totp"===a.factorType&&"totp"===h.type&&(null==(d=null==h?void 0:h.totp)?void 0:d.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),this._returnResult({data:h,error:null}))})}catch(a){if(fo(a))return this._returnResult({data:null,error:a});throw a}}async _verify(a){return this._acquireLock(-1,async()=>{try{return await this._useSession(async b=>{var c,d,e;let{data:f,error:g}=b;if(g)return this._returnResult({data:null,error:g});let h=Object.assign({challenge_id:a.challengeId},"webauthn"in a?{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_response:"create"===a.webauthn.type?(d=a.webauthn.credential_response,"toJSON"in d&&"function"==typeof d.toJSON?d.toJSON():{id:d.id,rawId:d.id,response:{attestationObject:fH(new Uint8Array(d.response.attestationObject)),clientDataJSON:fH(new Uint8Array(d.response.clientDataJSON))},type:"public-key",clientExtensionResults:d.getClientExtensionResults(),authenticatorAttachment:null!=(e=d.authenticatorAttachment)?e:void 0}):function(a){var b;if("toJSON"in a&&"function"==typeof a.toJSON)return a.toJSON();let c=a.getClientExtensionResults(),d=a.response;return{id:a.id,rawId:a.id,response:{authenticatorData:fH(new Uint8Array(d.authenticatorData)),clientDataJSON:fH(new Uint8Array(d.clientDataJSON)),signature:fH(new Uint8Array(d.signature)),userHandle:d.userHandle?fH(new Uint8Array(d.userHandle)):void 0},type:"public-key",clientExtensionResults:c,authenticatorAttachment:null!=(b=a.authenticatorAttachment)?b:void 0}}(a.webauthn.credential_response)})}:{code:a.code}),{data:i,error:j}=await f_(this.fetch,"POST",`${this.url}/factors/${a.factorId}/verify`,{body:h,headers:this.headers,jwt:null==(c=null==f?void 0:f.session)?void 0:c.access_token});return j?this._returnResult({data:null,error:j}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),this._returnResult({data:i,error:j}))})}catch(a){if(fo(a))return this._returnResult({data:null,error:a});throw a}})}async _challenge(a){return this._acquireLock(-1,async()=>{try{return await this._useSession(async b=>{var c;let{data:d,error:e}=b;if(e)return this._returnResult({data:null,error:e});let f=await f_(this.fetch,"POST",`${this.url}/factors/${a.factorId}/challenge`,{body:a,headers:this.headers,jwt:null==(c=null==d?void 0:d.session)?void 0:c.access_token});if(f.error)return f;let{data:g}=f;if("webauthn"!==g.type)return{data:g,error:null};switch(g.webauthn.type){case"create":return{data:Object.assign(Object.assign({},g),{webauthn:Object.assign(Object.assign({},g.webauthn),{credential_options:Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:function(a){if(!a)throw Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(a);let{challenge:b,user:c,excludeCredentials:d}=a,e=(0,d7.__rest)(a,["challenge","user","excludeCredentials"]),f=fG(b).buffer,g=Object.assign(Object.assign({},c),{id:fG(c.id).buffer}),h=Object.assign(Object.assign({},e),{challenge:f,user:g});if(d&&d.length>0){h.excludeCredentials=Array(d.length);for(let a=0;a<d.length;a++){let b=d[a];h.excludeCredentials[a]=Object.assign(Object.assign({},b),{id:fG(b.id).buffer,type:b.type||"public-key",transports:b.transports})}}return h}(g.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},g),{webauthn:Object.assign(Object.assign({},g.webauthn),{credential_options:Object.assign(Object.assign({},g.webauthn.credential_options),{publicKey:function(a){if(!a)throw Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(a);let{challenge:b,allowCredentials:c}=a,d=(0,d7.__rest)(a,["challenge","allowCredentials"]),e=fG(b).buffer,f=Object.assign(Object.assign({},d),{challenge:e});if(c&&c.length>0){f.allowCredentials=Array(c.length);for(let a=0;a<c.length;a++){let b=c[a];f.allowCredentials[a]=Object.assign(Object.assign({},b),{id:fG(b.id).buffer,type:b.type||"public-key",transports:b.transports})}}return f}(g.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(a){if(fo(a))return this._returnResult({data:null,error:a});throw a}})}async _challengeAndVerify(a){let{data:b,error:c}=await this._challenge({factorId:a.factorId});return c?this._returnResult({data:null,error:c}):await this._verify({factorId:a.factorId,challengeId:b.id,code:a.code})}async _listFactors(){var a;let{data:{user:b},error:c}=await this.getUser();if(c)return{data:null,error:c};let d={all:[],phone:[],totp:[],webauthn:[]};for(let c of null!=(a=null==b?void 0:b.factors)?a:[])d.all.push(c),"verified"===c.status&&d[c.factor_type].push(c);return{data:d,error:null}}async _getAuthenticatorAssuranceLevel(){var a,b;let{data:{session:c},error:d}=await this.getSession();if(d)return this._returnResult({data:null,error:d});if(!c)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:e}=fN(c.access_token),f=null;e.aal&&(f=e.aal);let g=f;return(null!=(b=null==(a=c.user.factors)?void 0:a.filter(a=>"verified"===a.status))?b:[]).length>0&&(g="aal2"),{data:{currentLevel:f,nextLevel:g,currentAuthenticationMethods:e.amr||[]},error:null}}async _getAuthorizationDetails(a){try{return await this._useSession(async b=>{let{data:{session:c},error:d}=b;return d?this._returnResult({data:null,error:d}):c?await f_(this.fetch,"GET",`${this.url}/oauth/authorizations/${a}`,{headers:this.headers,jwt:c.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new fs})})}catch(a){if(fo(a))return this._returnResult({data:null,error:a});throw a}}async _approveAuthorization(a,b){try{return await this._useSession(async b=>{let{data:{session:c},error:d}=b;if(d)return this._returnResult({data:null,error:d});if(!c)return this._returnResult({data:null,error:new fs});let e=await f_(this.fetch,"POST",`${this.url}/oauth/authorizations/${a}/consent`,{headers:this.headers,jwt:c.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return e.data&&e.data.redirect_url,e})}catch(a){if(fo(a))return this._returnResult({data:null,error:a});throw a}}async _denyAuthorization(a,b){try{return await this._useSession(async b=>{let{data:{session:c},error:d}=b;if(d)return this._returnResult({data:null,error:d});if(!c)return this._returnResult({data:null,error:new fs});let e=await f_(this.fetch,"POST",`${this.url}/oauth/authorizations/${a}/consent`,{headers:this.headers,jwt:c.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return e.data&&e.data.redirect_url,e})}catch(a){if(fo(a))return this._returnResult({data:null,error:a});throw a}}async fetchJwk(a,b={keys:[]}){let c=b.keys.find(b=>b.kid===a);if(c)return c;let d=Date.now();if((c=this.jwks.keys.find(b=>b.kid===a))&&this.jwks_cached_at+6e5>d)return c;let{data:e,error:f}=await f_(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(f)throw f;return e.keys&&0!==e.keys.length&&(this.jwks=e,this.jwks_cached_at=d,c=e.keys.find(b=>b.kid===a))?c:null}async getClaims(a,b={}){try{var c;let d,e=a;if(!e){let{data:a,error:b}=await this.getSession();if(b||!a.session)return this._returnResult({data:null,error:b});e=a.session.access_token}let{header:f,payload:g,signature:h,raw:{header:i,payload:j}}=fN(e);(null==b?void 0:b.allowExpired)||function(a){if(!a)throw Error("Missing exp claim");if(a<=Math.floor(Date.now()/1e3))throw Error("JWT has expired")}(g.exp);let k=!f.alg||f.alg.startsWith("HS")||!f.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(f.kid,(null==b?void 0:b.keys)?{keys:b.keys}:null==b?void 0:b.jwks);if(!k){let{error:a}=await this.getUser(e);if(a)throw a;return{data:{claims:g,header:f,signature:h},error:null}}let l=function(a){switch(a){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(f.alg),m=await crypto.subtle.importKey("jwk",k,l,!0,["verify"]);if(!await crypto.subtle.verify(l,m,h,(c=`${i}.${j}`,d=[],!function(a,b){for(let c=0;c<a.length;c+=1){let d=a.charCodeAt(c);if(d>55295&&d<=56319){let b=(d-55296)*1024&65535;d=(a.charCodeAt(c+1)-56320&65535|b)+65536,c+=1}!function(a,b){if(a<=127)return b(a);if(a<=2047){b(192|a>>6),b(128|63&a);return}if(a<=65535){b(224|a>>12),b(128|a>>6&63),b(128|63&a);return}if(a<=1114111){b(240|a>>18),b(128|a>>12&63),b(128|a>>6&63),b(128|63&a);return}throw Error(`Unrecognized Unicode codepoint: ${a.toString(16)}`)}(d,b)}}(c,a=>d.push(a)),new Uint8Array(d))))throw new fz("Invalid JWT signature");return{data:{claims:g,header:f,signature:h},error:null}}catch(a){if(fo(a))return this._returnResult({data:null,error:a});throw a}}}gp.nextInstanceID={};let gq=gp;class gr extends gq{constructor(a){super(a)}}(function(){if("undefined"==typeof process)return!1;let a=process.version;if(null==a)return!1;let b=a.match(/^v(\d+)\./);return!!b&&18>=parseInt(b[1],10)})()&&console.warn(`â ï¸  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217`);let gs=new class a{constructor(a,b,c){var d,e,f;this.supabaseUrl=a,this.supabaseKey=b;const g=function(a){let b=null==a?void 0:a.trim();if(!b)throw Error("supabaseUrl is required.");if(!b.match(/^https?:\/\//i))throw Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(b.endsWith("/")?b:b+"/")}catch(a){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}(a);if(!b)throw Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",g),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",g),this.storageUrl=new URL("storage/v1",g),this.functionsUrl=new URL("functions/v1",g);const h=`sb-${g.hostname.split(".")[0]}-auth-token`,i=function(a,b){var c,d;let{db:e,auth:f,realtime:g,global:h}=a,{db:i,auth:j,realtime:k,global:l}=b,m={db:Object.assign(Object.assign({},i),e),auth:Object.assign(Object.assign({},j),f),realtime:Object.assign(Object.assign({},k),g),storage:{},global:Object.assign(Object.assign(Object.assign({},l),h),{headers:Object.assign(Object.assign({},null!=(c=null==l?void 0:l.headers)?c:{}),null!=(d=null==h?void 0:h.headers)?d:{})}),accessToken:async()=>""};return a.accessToken?m.accessToken=a.accessToken:delete m.accessToken,m}(null!=c?c:{},{db:ff,realtime:fh,auth:Object.assign(Object.assign({},fg),{storageKey:h}),global:fe});this.storageKey=null!=(d=i.auth.storageKey)?d:"",this.headers=null!=(e=i.global.headers)?e:{},i.accessToken?(this.accessToken=i.accessToken,this.auth=new Proxy({},{get:(a,b)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(b)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!=(f=i.auth)?f:{},this.headers,i.global.fetch),this.fetch=((a,b,c)=>{let d=c?(...a)=>c(...a):(...a)=>fetch(...a),e=Headers;return async(c,f)=>{var g;let h=null!=(g=await b())?g:a,i=new e(null==f?void 0:f.headers);return i.has("apikey")||i.set("apikey",a),i.has("Authorization")||i.set("Authorization",`Bearer ${h}`),d(c,Object.assign(Object.assign({},f),{headers:i}))}})(b,this._getAccessToken.bind(this),i.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},i.realtime)),this.accessToken&&this.accessToken().then(a=>this.realtime.setAuth(a)).catch(a=>console.warn("Failed to set initial Realtime auth token:",a)),this.rest=new ee(new URL("rest/v1",g).href,{headers:this.headers,schema:i.db.schema,fetch:this.fetch}),this.storage=new fc(this.storageUrl.href,this.headers,this.fetch,null==c?void 0:c.storage),i.accessToken||this._listenForAuthEvents()}get functions(){return new ec(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(a){return this.rest.from(a)}schema(a){return this.rest.schema(a)}rpc(a,b={},c={head:!1,get:!1,count:void 0}){return this.rest.rpc(a,b,c)}channel(a,b={config:{}}){return this.realtime.channel(a,b)}getChannels(){return this.realtime.getChannels()}removeChannel(a){return this.realtime.removeChannel(a)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var a,b;if(this.accessToken)return await this.accessToken();let{data:c}=await this.auth.getSession();return null!=(b=null==(a=c.session)?void 0:a.access_token)?b:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:a,persistSession:b,detectSessionInUrl:c,storage:d,userStorage:e,storageKey:f,flowType:g,lock:h,debug:i,throwOnError:j},k,l){let m={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new gr({url:this.authUrl.href,headers:Object.assign(Object.assign({},m),k),storageKey:f,autoRefreshToken:a,persistSession:b,detectSessionInUrl:c,storage:d,userStorage:e,flowType:g,lock:h,debug:i,throwOnError:j,fetch:l,hasCustomAuthorizationHeader:Object.keys(this.headers).some(a=>"authorization"===a.toLowerCase())})}_initRealtimeClient(a){return new eE(this.realtimeUrl.href,Object.assign(Object.assign({},a),{params:Object.assign({apikey:this.supabaseKey},null==a?void 0:a.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((a,b)=>{this._handleTokenChanged(a,"CLIENT",null==b?void 0:b.access_token)})}_handleTokenChanged(a,b,c){("TOKEN_REFRESHED"===a||"SIGNED_IN"===a)&&this.changedAccessToken!==c?(this.changedAccessToken=c,this.realtime.setAuth(c)):"SIGNED_OUT"===a&&(this.realtime.setAuth(),"STORAGE"==b&&this.auth.signOut(),this.changedAccessToken=void 0)}}("https://pmhztbcyyhcbvxlusxgp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBtaHp0YmN5eWhjYnZ4bHVzeGdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5NzgxOTksImV4cCI6MjA3NzU1NDE5OX0.KN0DhyAd129DWztqRglG-mZD5hK0rBWPxIm2RpBM4HA",void 0),gt={web:"document",codigo:"code",sugestao:"suggestion"},gu=d5.replace(/'/g,"''"),gv=d6.replace(/'/g,"''"),gw=`-- Habilita a extens\xe3o uuid-ossp se ainda n\xe3o estiver habilitada
CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA extensions;

-- Tabela de perfis de usu\xe1rio
CREATE TABLE IF NOT EXISTS public.user_profiles (
  user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  full_name TEXT,
  user_type TEXT,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
ALTER TABLE public.user_profiles ENABLE ROW LEVEL SECURITY;
DROP POLICY IF EXISTS "Os usu\xe1rios podem gerenciar seu pr\xf3prio perfil." ON public.user_profiles;
CREATE POLICY "Os usu\xe1rios podem gerenciar seu pr\xf3prio perfil."
ON public.user_profiles FOR ALL
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);


-- Tabela de documentos
CREATE TABLE IF NOT EXISTS public.documents (
  id UUID PRIMARY KEY DEFAULT extensions.uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE, -- user_id \xe9 nulo para documentos p\xfablicos
  name TEXT NOT NULL,
  content TEXT NOT NULL,
  is_deletable BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
-- Adiciona um \xedndice \xfanico para nomes de documentos p\xfablicos para o ON CONFLICT funcionar de forma confi\xe1vel.
CREATE UNIQUE INDEX IF NOT EXISTS documents_public_name_key ON public.documents (name) WHERE (user_id IS NULL);
ALTER TABLE public.documents ENABLE ROW LEVEL SECURITY;
-- Pol\xedtica SELECT: permite ver documentos pr\xf3prios ou p\xfablicos (user_id IS NULL)
DROP POLICY IF EXISTS "Usu\xe1rios podem visualizar documentos p\xfablicos e os seus pr\xf3prios." ON public.documents;
CREATE POLICY "Usu\xe1rios podem visualizar documentos p\xfablicos e os seus pr\xf3prios."
ON public.documents FOR SELECT
USING (user_id IS NULL OR user_id = auth.uid());
-- Pol\xedtica INSERT: s\xf3 pode criar documentos para si mesmo
DROP POLICY IF EXISTS "Usu\xe1rios podem criar seus pr\xf3prios documentos." ON public.documents;
CREATE POLICY "Usu\xe1rios podem criar seus pr\xf3prios documentos."
ON public.documents FOR INSERT
WITH CHECK (user_id = auth.uid());
-- Pol\xedtica UPDATE: s\xf3 pode modificar seus pr\xf3prios documentos
DROP POLICY IF EXISTS "Usu\xe1rios podem modificar seus pr\xf3prios documentos." ON public.documents;
CREATE POLICY "Usu\xe1rios podem modificar seus pr\xf3prios documentos."
ON public.documents FOR UPDATE
USING (user_id = auth.uid() AND is_deletable = TRUE)
WITH CHECK (user_id = auth.uid());
-- Pol\xedtica DELETE: s\xf3 pode excluir seus pr\xf3prios documentos
DROP POLICY IF EXISTS "Usu\xe1rios podem excluir seus pr\xf3prios documentos." ON public.documents;
CREATE POLICY "Usu\xe1rios podem excluir seus pr\xf3prios documentos."
ON public.documents FOR DELETE
USING (user_id = auth.uid() AND is_deletable = TRUE);


-- Tabela de conversas
CREATE TABLE IF NOT EXISTS public.conversations (
  id UUID PRIMARY KEY DEFAULT extensions.uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  title TEXT NOT NULL,
  agent_type TEXT NOT NULL CHECK (agent_type IN ('document', 'code', 'suggestion')),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
ALTER TABLE public.conversations ADD COLUMN IF NOT EXISTS updated_at TIMESTAMPTZ DEFAULT NOW();
ALTER TABLE public.conversations DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.conversations ENABLE ROW LEVEL SECURITY;

-- Pol\xedticas de seguran\xe7a para conversas
DROP POLICY IF EXISTS "Usu\xe1rios podem visualizar suas pr\xf3prias conversas ou \xf3rf\xe3s." ON public.conversations;
CREATE POLICY "Usu\xe1rios podem visualizar suas pr\xf3prias conversas ou \xf3rf\xe3s."
ON public.conversations FOR SELECT
USING (user_id = auth.uid() OR user_id IS NULL);

DROP POLICY IF EXISTS "Usu\xe1rios podem criar conversas para si mesmos." ON public.conversations;
CREATE POLICY "Usu\xe1rios podem criar conversas para si mesmos."
ON public.conversations FOR INSERT
WITH CHECK (user_id = auth.uid());

DROP POLICY IF EXISTS "Usu\xe1rios podem atualizar suas pr\xf3prias conversas ou reivindicar \xf3rf\xe3s." ON public.conversations;
CREATE POLICY "Usu\xe1rios podem atualizar suas pr\xf3prias conversas ou reivindicar \xf3rf\xe3s."
ON public.conversations FOR UPDATE
USING (user_id = auth.uid() OR user_id IS NULL)
WITH CHECK (user_id = auth.uid());

DROP POLICY IF EXISTS "Usu\xe1rios podem excluir suas pr\xf3prias conversas ou \xf3rf\xe3s." ON public.conversations;
CREATE POLICY "Usu\xe1rios podem excluir suas pr\xf3prias conversas ou \xf3rf\xe3s."
ON public.conversations FOR DELETE
USING (user_id = auth.uid() OR user_id IS NULL);


-- Tabela de mensagens
CREATE TABLE IF NOT EXISTS public.messages (
  id UUID PRIMARY KEY DEFAULT extensions.uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  conversation_id UUID NOT NULL REFERENCES public.conversations(id) ON DELETE CASCADE,
  sender TEXT NOT NULL CHECK (sender IN ('user', 'bot')),
  text TEXT NOT NULL,
  sources JSONB,
  feedback TEXT CHECK (feedback IN ('good', 'bad')),
  created_at TIMESTAMPTZ DEFAULT NOW()
);
ALTER TABLE public.messages ENABLE ROW LEVEL SECURITY;

/*
 * **REVIS\xc3O PROFUNDA E CORRE\xc7\xc3O DEFINITIVA DA POL\xcdTICA DE MENSAGENS**
 * A causa raiz do problema de exclus\xe3o \xe9 que a pol\xedtica de mensagens verificava a posse
 * da *mensagem* individual. Isso falhava durante uma exclus\xe3o em cascata se alguma
 * mensagem legada tivesse um 'user_id' inconsistente.
 * A nova pol\xedtica resolve isso vinculando a permiss\xe3o para modificar uma mensagem
 * \xe0 posse da *conversa* pai. Se um usu\xe1rio pode excluir a conversa, ele
 * implicitamente pode excluir todas as mensagens contidas nela. Isso garante
 * que a exclus\xe3o em cascata funcione corretamente em todos os casos.
 */
DROP POLICY IF EXISTS "Usu\xe1rios podem gerenciar suas mensagens pr\xf3prias ou \xf3rf\xe3s." ON public.messages;
DROP POLICY IF EXISTS "Usu\xe1rios gerenciam mensagens baseadas na posse da conversa." ON public.messages;
CREATE POLICY "Usu\xe1rios gerenciam mensagens baseadas na posse da conversa."
ON public.messages FOR ALL
USING (
  EXISTS (
    SELECT 1 FROM public.conversations
    WHERE id = messages.conversation_id AND (user_id = auth.uid() OR user_id IS NULL)
  )
)
WITH CHECK (
  -- A verifica\xe7\xe3o (WITH CHECK) para novas inser\xe7\xf5es/atualiza\xe7\xf5es garante que o usu\xe1rio
  -- que est\xe1 agindo seja o dono da mensagem E da conversa, mantendo a integridade.
  user_id = auth.uid() AND
  EXISTS (
    SELECT 1 FROM public.conversations
    WHERE id = messages.conversation_id AND user_id = auth.uid()
  )
);


-- \xcdndices para otimizar buscas
CREATE INDEX IF NOT EXISTS idx_messages_conversation_id ON public.messages(conversation_id);
CREATE INDEX IF NOT EXISTS idx_messages_user_id ON public.messages(user_id);
CREATE INDEX IF NOT EXISTS idx_conversations_updated_at ON public.conversations(updated_at DESC);


-- SEED DE DADOS: Insere os documentos da base de conhecimento inicial.
-- \xc9 seguro rodar isso v\xe1rias vezes por causa do "ON CONFLICT".
-- A execu\xe7\xe3o deste script no painel do Supabase ignora a RLS, permitindo a inser\xe7\xe3o de documentos p\xfablicos (user_id = NULL).
INSERT INTO public.documents (name, content, is_deletable, user_id) VALUES
('Conhecimento - Agente.txt', '${gu}', false, NULL),
('Conhecimento - Reforma.txt', '${gv}', false, NULL)
ON CONFLICT (name) WHERE (user_id IS NULL) DO NOTHING;


-- Coment\xe1rios para clareza
COMMENT ON COLUMN public.documents.user_id IS 'Chave estrangeira para o usu\xe1rio que enviou o documento. NULO para documentos da base de conhecimento global.';
COMMENT ON COLUMN public.conversations.user_id IS 'Chave estrangeira para o usu\xe1rio dono da conversa.';
COMMENT ON COLUMN public.messages.user_id IS 'Chave estrangeira para o usu\xe1rio que criou a mensagem.';
COMMENT ON POLICY "Usu\xe1rios gerenciam mensagens baseadas na posse da conversa." ON public.messages IS 'Permite opera\xe7\xf5es em mensagens se o usu\xe1rio possuir a conversa pai.';
`,gx=a=>`ERRO DE CONFIGURA\xc7\xc3O DO BANCO DE DADOS

Foi detectado um problema com a estrutura do seu banco de dados: **${a}**.

Isso geralmente significa que as tabelas ou pol\xedticas de seguran\xe7a (Row Level Security) necess\xe1rias para separar os dados por usu\xe1rio est\xe3o ausentes ou incorretas.

SOLU\xc7\xc3O:
1. V\xe1 para o seu projeto em supabase.com.
2. No menu \xe0 esquerda, clique no \xedcone de "SQL Editor".
3. Clique em "+ New query".
4. Cole o script SQL abaixo e clique em "RUN". Este script \xe9 seguro para ser executado v\xe1rias vezes e ir\xe1 criar ou corrigir as tabelas, pol\xedticas de seguran\xe7a e dados iniciais.

--- SCRIPT SQL PARA COPIAR ---
${gw}
---------------------------------`;function gy(a){if(a instanceof Error)return a.message;if("object"==typeof a&&null!==a){let b=a.message||"Ocorreu um erro desconhecido.";return a.details&&(b+=`
Detalhes: ${a.details}`),a.hint&&(b+=`
HINT: ${a.hint}`),a.code&&(b+=` (C\xf3digo: ${a.code})`),b}try{let b=JSON.stringify(a);return"{}"===b?String(a):b}catch{return String(a)}}let gz=bv((a,b)=>({documents:[],isLoading:!1,error:null,loadInitialDocuments:async()=>{if(!b().isLoading){a({isLoading:!0,error:null});try{let{data:b,error:c}=await gs.from("documents").select("*");if(c)throw c;let d=[];for(let a of b){let b=await d2(a.content,a.name,a.is_deletable);b.id=a.id,b.content=a.content,d.push(b)}a({documents:d})}catch(d){let b=gy(d),c=`Erro detalhado ao carregar documentos:
${b}`;"string"==typeof b&&(b.includes("relation")||b.includes("does not exist")||b.includes("violates row-level security policy"))&&(c=gx("A polÃ­tica de seguranÃ§a (RLS) para `documents` pode estar ausente ou incorreta.")),a({error:c}),console.error("Erro detalhado ao carregar documentos:",d)}finally{a({isLoading:!1})}}},addDocument:async b=>{a({isLoading:!0,error:null});try{let{data:{user:c}}=await gs.auth.getUser();if(!c)throw Error("UsuÃ¡rio nÃ£o autenticado para adicionar documento.");let d=await d3(b);if(0===d.chunks.length)throw Error("O documento estÃ¡ vazio ou nÃ£o pÃ´de ser processado.");let e=d.content||d.chunks.map(a=>a.text).join(""),{data:f,error:g}=await gs.from("documents").insert({name:d.name,content:e,is_deletable:!0,user_id:c.id}).select().single();if(g)throw g;d.id=f.id,a(a=>({documents:[...a.documents,d]}))}catch(c){let b=gy(c);a({error:`Erro ao adicionar documento: ${b}`}),console.error("Error adding document:",c)}finally{a({isLoading:!1})}},deleteDocument:async b=>{let{error:c}=await gs.from("documents").delete().match({id:b});if(c){let b=gy(c);console.error("Error deleting document:",b),a({error:b});return}a(a=>({documents:a.documents.filter(a=>a.id!==b)}))},renameDocument:async(b,c)=>{let{error:d}=await gs.from("documents").update({name:c}).match({id:b});if(d){let b=gy(d);console.error("Error renaming document:",b),a({error:b});return}a(a=>({documents:a.documents.map(a=>a.id===b?{...a,name:c}:a)}))}})),gA=bv((a,b)=>({documentConversations:{},codeConversations:{},suggestionConversations:{},activeDocumentConversationId:null,activeCodeConversationId:null,activeSuggestionConversationId:null,isLoading:!1,activeAgent:"document",activeModel:dV,proTokenCount:0,proTokenLimit:32768,session:null,user:null,authLoading:!0,authError:null,authMessage:null,initAuth:()=>{gs.auth.getSession().then(({data:{session:b}})=>{a({session:b,user:b?.user??null,authLoading:!1})});let{data:{subscription:b}}=gs.auth.onAuthStateChange((b,c)=>{a({session:c,user:c?.user??null,authLoading:!1})});return()=>{b.unsubscribe()}},signUp:async(b,c,d)=>{a({authLoading:!0,authError:null,authMessage:null}),gz.setState({error:null});let{data:e,error:f}=await gs.auth.signUp({email:b,password:c,options:{data:d}});if(f){let b=gy(f);b.toLowerCase().includes("database error saving new user")||b.includes('violates row-level security policy for table "user_profiles"')?a({authLoading:!1,authError:{name:"DatabaseSetupError",message:gx("A criaÃ§Ã£o de perfil de usuÃ¡rio falhou, indicando uma configuraÃ§Ã£o de banco de dados incorreta ou polÃ­ticas de RLS ausentes.")}}):f.message.includes("User already registered")?a({authLoading:!1,authError:{name:"UserAlreadyRegisteredError",message:'Este e-mail jÃ¡ estÃ¡ cadastrado.\n\n1. Se vocÃª ainda nÃ£o ativou sua conta, por favor, verifique sua caixa de entrada e a pasta de spam para encontrar o e-mail de confirmaÃ§Ã£o.\n\n2. Se vocÃª jÃ¡ confirmou mas esqueceu a senha, utilize a opÃ§Ã£o "Esqueci minha senha" na tela de login.'}}):a({authLoading:!1,authError:f});return}e.user&&e.user.identities&&0===e.user.identities.length&&console.log("Cadastro enviado com sucesso. O usuÃ¡rio estÃ¡ aguardando confirmaÃ§Ã£o por e-mail e ainda nÃ£o aparecerÃ¡ na tabela auth.users. Verifique o e-mail ou desative a confirmaÃ§Ã£o de e-mail nas configuraÃ§Ãµes de autenticaÃ§Ã£o do Supabase."),a({authLoading:!1,authError:null,authMessage:"Cadastro realizado! Verifique seu e-mail para confirmar a conta e poder fazer o login."})},signIn:async(b,c)=>{a({authLoading:!0,authError:null,authMessage:null});let{error:d}=await gs.auth.signInWithPassword({email:b,password:c});a({authLoading:!1,authError:d||null})},signOut:async()=>{a({authLoading:!0,authError:null}),await gs.auth.signOut(),a({session:null,user:null,authLoading:!1,authError:null})},sendPasswordResetEmail:async b=>{a({authLoading:!0,authError:null,authMessage:null});let{error:c}=await gs.auth.resetPasswordForEmail(b,{});c?a({authLoading:!1,authError:c}):a({authLoading:!1,authMessage:"Se o e-mail estiver correto, vocÃª receberÃ¡ um link para redefinir sua senha em breve."})},clearAuthFeedback:()=>{a({authError:null,authMessage:null})},loadInitialData:async()=>{if(a({isLoading:!0}),gz.setState({error:null}),await gz.getState().loadInitialDocuments(),gz.getState().error)return void a({isLoading:!1});let c=b().user;if(c)try{let{data:a,error:b}=await gs.from("user_profiles").select("user_id, full_name").eq("user_id",c.id).single(),d=c.user_metadata;if(b&&"PGRST116"===b.code&&d?.full_name){console.log("Perfil de usuÃ¡rio nÃ£o encontrado. Criando agora...");let{error:a}=await gs.from("user_profiles").insert({user_id:c.id,full_name:d.full_name,user_type:d.user_type});if(a)throw a}else if(b&&"PGRST116"!==b.code)throw b}catch(c){let b=gy(c);if(b.includes('relation "public.user_profiles" does not exist')||b.includes("column")&&b.includes("does not exist")||b.includes("violates row-level security policy")){let c="tabela ausente";b.includes("column")&&(c="estrutura de coluna incorreta"),b.includes("security policy")&&(c="polÃ­ticas de seguranÃ§a ausentes ou incorretas"),gz.setState({error:gx(`user_profiles (${c})`)}),a({isLoading:!1});return}console.error("Erro durante a verificaÃ§Ã£o/criaÃ§Ã£o do perfil:",b)}try{let{data:c,error:d}=await gs.from("conversations").select("*");if(d)throw d;let{data:e,error:f}=await gs.from("messages").select("*").order("created_at",{ascending:!0});if(f)throw f;let g={},h={},i={};for(let a of c){let b=e.filter(b=>b.conversation_id===a.id).map(a=>({id:a.id,sender:a.sender,text:a.text,feedback:a.feedback,sources:a.sources,createdAt:new Date(a.created_at).getTime()})),c={id:a.id,title:a.title,createdAt:new Date(a.created_at).getTime(),updatedAt:a.updated_at?new Date(a.updated_at).getTime():new Date(a.created_at).getTime(),messages:b};"document"===a.agent_type?g[a.id]=c:"code"===a.agent_type?h[a.id]=c:"suggestion"===a.agent_type&&(i[a.id]=c)}let j=(a,b)=>(b.updatedAt||b.createdAt)-(a.updatedAt||a.createdAt),k=Object.values(g).sort(j).map(a=>a.id),l=Object.values(h).sort(j).map(a=>a.id),m=Object.values(i).sort(j).map(a=>a.id);a({documentConversations:g,codeConversations:h,suggestionConversations:i,activeDocumentConversationId:k[0]||null,activeCodeConversationId:l[0]||null,activeSuggestionConversationId:m[0]||null}),"document"!==b().activeAgent||b().activeDocumentConversationId||await b().startNewConversation("document")}catch(c){let a=gy(c),b=`Erro ao carregar o hist\xf3rico de conversas: ${a}`;"string"==typeof a&&(a.includes("relation")||a.includes("does not exist")||a.includes("violates row-level security policy"))&&(b=gx("A polÃ­tica de seguranÃ§a (RLS) para `conversations` ou `messages` pode estar ausente ou incorreta.")),gz.setState({error:b}),console.error("Erro detalhado ao carregar conversas:",c)}finally{a({isLoading:!1})}},setActiveAgent:c=>{a({activeAgent:c});let d=b(),e=!1;switch(c){case"document":e=!d.activeDocumentConversationId||!d.documentConversations[d.activeDocumentConversationId];break;case"code":e=!d.activeCodeConversationId||!d.codeConversations[d.activeCodeConversationId];break;case"suggestion":e=!d.activeSuggestionConversationId||!d.suggestionConversations[d.activeSuggestionConversationId]}e&&b().startNewConversation(c)},startNewConversation:async b=>{let{data:{user:c}}=await gs.auth.getUser();if(!c){let a="UsuÃ¡rio nÃ£o autenticado. NÃ£o Ã© possÃ­vel criar uma nova conversa.";console.error(a),gz.setState({error:a});return}let d=((a="Nova Conversa")=>({id:crypto.randomUUID(),title:a,messages:[],createdAt:Date.now(),updatedAt:Date.now()}))(),{error:e}=await gs.from("conversations").insert({id:d.id,user_id:c.id,title:d.title,agent_type:b,created_at:new Date(d.createdAt).toISOString(),updated_at:new Date(d.updatedAt).toISOString()});if(e){let a=gy(e);if(console.error("Failed to create conversation:",a),"string"==typeof a&&(a.includes("violates row-level security policy")||a.includes("column")&&a.includes("does not exist")||a.includes("PGRST204"))){let a=gx("Falha ao criar conversa. A estrutura da tabela `conversations` parece estar desatualizada ou incorreta.");gz.setState({error:a})}else gz.setState({error:`Falha ao criar a conversa: ${a}`});return}switch(b){case"document":a(a=>({documentConversations:{...a.documentConversations,[d.id]:d},activeDocumentConversationId:d.id}));break;case"code":a(a=>({codeConversations:{...a.codeConversations,[d.id]:d},activeCodeConversationId:d.id}));break;case"suggestion":a(a=>({suggestionConversations:{...a.suggestionConversations,[d.id]:d},activeSuggestionConversationId:d.id}))}},deleteConversation:async(c,d)=>{let e=null,f=null;if("document"===c?(e="documentConversations",f="activeDocumentConversationId"):"code"===c?(e="codeConversations",f="activeCodeConversationId"):"suggestion"===c&&(e="suggestionConversations",f="activeSuggestionConversationId"),!e||!f)return;let g=b()[e],h=b()[f],i={...g};delete i[d];let j=h;j===d&&(j=Object.values(i).sort((a,b)=>(b.updatedAt||b.createdAt)-(a.updatedAt||a.createdAt)).map(a=>a.id)[0]||null),a({[e]:i,[f]:j});let{error:k}=await gs.from("conversations").delete().match({id:d});if(k){let b=gy(k);console.error("Failed to delete conversation:",b),gz.setState({error:`Falha ao excluir a conversa: ${b}`}),a({[e]:g,[f]:h})}0===Object.keys(b()[e]).length&&b().startNewConversation(c)},setActiveConversation:(b,c)=>{switch(b){case"document":a({activeDocumentConversationId:c});break;case"code":a({activeCodeConversationId:c});break;case"suggestion":a({activeSuggestionConversationId:c})}},setMessageFeedback:async(c,d,e,f)=>{let g=null;if("document"===c?g="documentConversations":"code"===c?g="codeConversations":"suggestion"===c&&(g="suggestionConversations"),!g)return;let h=b()[g][d];if(!h)return;let i=h.messages.find(a=>a.id===e);if(!i)return;let j=i.feedback===f?null:f,k=h.messages.map(a=>a.id===e?{...a,feedback:j}:a);a(a=>({[g]:{...a[g],[d]:{...h,messages:k}}}));let{error:l}=await gs.from("messages").update({feedback:j}).match({id:e});if(l){let b=gy(l);console.error("Failed to set feedback:",b),gz.setState({error:`Falha ao salvar o feedback: ${b}`}),a(a=>({[g]:{...a[g],[d]:{...h,messages:h.messages}}}))}},sendMessage:async(c,d)=>{let e,f,g=c.trim();if(!g)return;let h=gz.getState().error;h&&!h.includes("ERRO DE CONFIGURAÃÃO DO BANCO DE DADOS")&&gz.setState({error:null});let i=b().user;if(!i){let b="UsuÃ¡rio nÃ£o autenticado. A mensagem nÃ£o pode ser enviada. Por favor, faÃ§a o login novamente.";console.error(b),gz.setState({error:b}),a({isLoading:!1});return}let j=b().activeAgent,k=g,l=g.match(/^@(\w+)/);if(l){let a=gt[l[1].toLowerCase()];a&&(j=a,k=g.replace(/^@\w+\s?/,"").trim())}if(!k){b().activeAgent!==j&&b().setActiveAgent(j);return}b().activeAgent!==j&&a({activeAgent:j});let m=b().activeAgent;switch(m){case"document":e=b().activeDocumentConversationId,f="documentConversations";break;case"code":e=b().activeCodeConversationId,f="codeConversations";break;case"suggestion":e=b().activeSuggestionConversationId,f="suggestionConversations"}if(!e&&(await b().startNewConversation(m),!(e=b()[`active${m.charAt(0).toUpperCase()+m.slice(1)}ConversationId`]))){console.error("Failed to create or find an active conversation."),gz.setState({error:"Falha ao criar ou encontrar uma conversa ativa."});return}let n=(b()[f][e]?.messages.length??0)===0,o={id:crypto.randomUUID(),sender:"user",text:k,createdAt:Date.now()};a(a=>{let b=a[f],c=b?.[e];return c?{[f]:{...b,[e]:{...c,messages:[...c.messages,o]}}}:a}),a({isLoading:!0});let{error:p}=await gs.from("messages").insert({id:o.id,conversation_id:e,sender:"user",text:k,sources:null,created_at:new Date(o.createdAt).toISOString(),user_id:i.id});if(p){let a=gy(p);console.error("Failed to save user message:",a),gz.setState({error:`Falha ao salvar sua mensagem: ${a}`})}n&&d$(k).then(async b=>{let c=b||k.substring(0,30),{error:d}=await gs.from("conversations").update({title:c,user_id:i.id}).match({id:e});if(d){let a=gy(d);console.error("Failed to update title:",a),gz.setState({error:`Falha ao atualizar o t\xedtulo: ${a}`})}a(a=>{let b=a[f],d=b?.[e];return d?{[f]:{...b,[e]:{...d,title:c}}}:a})});let q="",r=k,s=dV,t=!1;try{if("document"===m&&d.length>0){let a=(await dZ([k]))[0],b=d.flatMap(a=>a.chunks);if(b.length>0&&a){let c=b.map(b=>({...b,similarity:d4(a,b.embedding)})).sort((a,b)=>b.similarity-a.similarity),d=[],e=c;if(e.length>0)for(d.push(e[0]),e=e.slice(1);d.length<5&&e.length>0;){let a=-1,b=-1/0;for(let c=0;c<e.length;c++){let f=e[c],g=f.similarity,h=Math.max(...d.map(a=>d4(f.embedding,a.embedding))),i=.7*g-.30000000000000004*h;i>b&&(b=i,a=c)}if(-1!==a)d.push(e[a]),e.splice(a,1);else break}d.length>0&&d[0].similarity>.5&&(q=d.map(a=>a.text).join("\n\n---\n\n"))}}if("document"===m)t=!0,q?(s=dU,r=`${dW}

Com base no seguinte contexto recuperado de seus documentos de conhecimento, responda \xe0 pergunta do usu\xe1rio. Priorize estritamente as informa\xe7\xf5es do contexto. Se o contexto n\xe3o for suficiente, indique isso e use a busca na web para complementar.

Contexto:
${q}

---

Pergunta do usu\xe1rio: ${k}`):(s=dV,r=`${dW}

Responda \xe0 pergunta do usu\xe1rio usando seu conhecimento fundamental e a busca na web, pois nenhum contexto relevante foi encontrado nos documentos enviados. Sempre cite as fontes da web que utilizar.

Pergunta: ${k}`);else if("code"===m){s=dU;let a="",c=b()[f][e];if(c&&c.messages.length>1){let b=c.messages.slice(0,-1).slice(-4);if(b.length>0){let c=b.map(a=>`${"user"===a.sender?"UsuÃ¡rio":"Assistente"}: ${a.text}`).join("\n");a=`Considere o hist\xf3rico recente desta conversa como contexto:

--- HIST\xd3RICO DA CONVERSA ---
${c}
--- FIM DO HIST\xd3RICO ---

`}}r=`${dX}

${a}Tarefa do usu\xe1rio: ${k}`}else"suggestion"===m&&(s=dV,r=`${dY}

Pergunta do usu\xe1rio para melhorar: "${k}"`,t=!1);let c=b().proTokenCount+r.length/4;a({proTokenCount:c});let g=s;s===dU&&c>22937.6&&(g=dV,console.warn(`Token limit for ${dU} is approaching. Switching to ${dV} for this request.`)),a({activeModel:g});let{text:h,sources:j}=await d_(g,r,t),l=Date.now(),n={id:crypto.randomUUID(),sender:"bot",text:h,sources:j,createdAt:l},{error:o}=await gs.from("messages").insert({id:n.id,conversation_id:e,sender:"bot",text:n.text,sources:n.sources,created_at:new Date(n.createdAt).toISOString(),user_id:i.id});if(o){let a=gy(o);console.error("Failed to save bot message:",a),gz.setState({error:`Falha ao salvar a resposta do assistente: ${a}`})}let{error:p}=await gs.from("conversations").update({updated_at:new Date(l).toISOString()}).match({id:e});p&&console.error("Failed to update conversation timestamp:",gy(p)),a(a=>{let b=a[f],c=b?.[e];return c?{[f]:{...b,[e]:{...c,messages:[...c.messages,n],updatedAt:l}}}:a})}catch(h){let b=gy(h);console.error("Error generating response:",b);let c=Date.now(),d={id:crypto.randomUUID(),sender:"bot",text:`Ocorreu um erro ao processar sua solicita\xe7\xe3o. Por favor, tente novamente.

Detalhes do erro:
\`\`\`
${b}
\`\`\``,createdAt:c},{error:g}=await gs.from("conversations").update({updated_at:new Date(c).toISOString()}).match({id:e});g&&console.error("Failed to update conversation timestamp on error:",gy(g)),a(a=>{let b=a[f],g=b?.[e];return g?{[f]:{...b,[e]:{...g,messages:[...g.messages,d],updatedAt:c}}}:a})}finally{a({isLoading:!1})}}})),gB=({className:a})=>(0,br.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:a,"aria-label":"Ãcone do RobÃ´",children:[(0,br.jsx)("path",{d:"M12 2a2 2 0 0 1 2 2v2h-4V4a2 2 0 0 1 2-2zM4.636 8.364A9 9 0 0 1 12 4a9 9 0 0 1 7.364 4.364L20 10v6a2 2 0 0 1-2 2h-1.586l-1.707-1.707A4.002 4.002 0 0 0 12 15a4.002 4.002 0 0 0-2.707 1.293L7.586 18H6a2 2 0 0 1-2-2v-6l.636-1.636zM9 12a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm6 0a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),(0,br.jsx)("path",{d:"M5 20h14a1 1 0 0 1 1 1v1H4v-1a1 1 0 0 1 1-1z"})]}),gC=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:a,children:(0,br.jsx)("path",{fillRule:"evenodd",d:"M18.685 19.097A9.723 9.723 0 0021.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 003.065 7.097A9.716 9.716 0 0012 21.75a9.716 9.716 0 006.685-2.653zm-12.54-1.285A7.486 7.486 0 0112 15a7.486 7.486 0 015.855 2.812A8.224 8.224 0 0112 20.25a8.224 8.224 0 01-5.855-2.438zM15.75 9a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z",clipRule:"evenodd"})}),gD=({className:a})=>(0,br.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,children:[(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a2.25 2.25 0 0 1-2.25 2.25H9.75A2.25 2.25 0 0 1 7.5 4.5v0a2.25 2.25 0 0 1 2.25-2.25h3.879a2.25 2.25 0 0 1 1.95.879Z"}),(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 11.25h6M9 13.5h6M9 15.75h6M4.5 5.25v13.5A2.25 2.25 0 0 0 6.75 21h10.5A2.25 2.25 0 0 0 19.5 18.75V5.25c0-1.076-.874-1.95-1.95-1.95H7.2a1.95 1.95 0 0 0-1.95 1.95Z"})]}),gE=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"})}),gF=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})}),gG=({language:a,code:b})=>{let[c,d]=(0,bs.useState)(!1),e={python:"py",py:"py",javascript:"js",js:"js",typescript:"ts",ts:"ts",html:"html",css:"css",json:"json",delphi:"pas",pascal:"pas"}[a.toLowerCase()],f=!!e;return(0,br.jsxs)("div",{className:"my-4 rounded-lg bg-gray-900 dark:bg-black overflow-hidden",children:[(0,br.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-800 dark:bg-gray-900/50",children:[(0,br.jsx)("span",{className:"text-xs font-semibold text-gray-400 uppercase",children:a}),(0,br.jsxs)("div",{className:"flex items-center gap-4",children:[f&&(0,br.jsxs)("button",{onClick:()=>{let a=new Blob([b],{type:"text/plain;charset=utf-8"}),c=URL.createObjectURL(a),d=document.createElement("a");d.href=c,d.download=`codigo_gerado_${Date.now()}.${e||"txt"}`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c)},className:"flex items-center gap-1.5 text-xs text-gray-400 hover:text-white transition-colors",children:[(0,br.jsx)(gF,{className:"w-4 h-4"}),"Salvar .",e]}),(0,br.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(b).then(()=>{d(!0),setTimeout(()=>d(!1),2e3)})},className:"flex items-center gap-1.5 text-xs text-gray-400 hover:text-white transition-colors",children:c?(0,br.jsxs)(br.Fragment,{children:[(0,br.jsx)(gE,{className:"w-4 h-4 text-green-400"}),"Copiado!"]}):(0,br.jsxs)(br.Fragment,{children:[(0,br.jsx)(gD,{className:"w-4 h-4"}),"Copiar"]})})]})]}),(0,br.jsx)("pre",{className:"p-4 text-sm text-white overflow-x-auto",children:(0,br.jsx)("code",{children:b})})]})},gH=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{d:"M1 8.25a1.25 1.25 0 112.5 0v7.5a1.25 1.25 0 11-2.5 0v-7.5zM11 3V1.7c0-.268.14-.516.372-.658.232-.142.518-.142.75 0l1.823.912a.75.75 0 01.428.656V8.25c0 .285.11.55.293.742l3.08 2.923c.34.323.527.773.527 1.246v1.757a2.25 2.25 0 01-2.25 2.25H9.75a.75.75 0 01-.75-.75V8.25a.75.75 0 00-.75-.75h-.5a.75.75 0 00-.75.75v5.02c0 .357-.184.686-.488.869l-2.096 1.258A.75.75 0 013.5 15.25V8.25a.75.75 0 01.75-.75h2a.75.75 0 01.75.75v2.25c0 .414.336.75.75.75h2.5a.75.75 0 00.75-.75V3z"})}),gI=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{d:"M1 11.75a1.25 1.25 0 102.5 0V4.25a1.25 1.25 0 10-2.5 0v7.5zM11 17v1.3c0 .268-.14.516-.372.658-.232.142-.518.142-.75 0l-1.823-.912a.75.75 0 01-.428-.656V11.75a.75.75 0 00-.293-.742l-3.08-2.923A2.25 2.25 0 014.25 7V5.243a2.25 2.25 0 012.25-2.25H9.25a.75.75 0 01.75.75v7.5a.75.75 0 00.75.75h.5a.75.75 0 00.75-.75V6.48c0-.357.184-.686.488-.869l2.096-1.258a.75.75 0 011.012.82V11.75a.75.75 0 01-.75.75h-2a.75.75 0 01-.75-.75V8.75a.75.75 0 00-.75-.75h-2.5a.75.75 0 00-.75.75V17z"})}),gJ=/```(\w+)?\n([\s\S]+?)```/g,gK=({message:a,onFeedback:b})=>{let{sender:c,text:d,sources:e,feedback:f}=a,g="bot"===c;return(0,br.jsxs)("div",{className:`flex items-start gap-4 my-6 ${!g?"flex-row-reverse":""}`,children:[(0,br.jsx)("div",{className:`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${g?"bg-gray-200 dark:bg-gray-700":"bg-blue-600 text-white"}`,children:g?(0,br.jsx)(gB,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"}):(0,br.jsx)(gC,{className:"w-6 h-6"})}),(0,br.jsxs)("div",{className:`p-4 rounded-lg max-w-2xl shadow ${g?"bg-white dark:bg-gray-800":"bg-blue-500 text-white"}`,children:[(()=>{let a,b=[],c=0;for(;null!==(a=gJ.exec(d));){a.index>c&&b.push((0,br.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none whitespace-pre-wrap",children:d.slice(c,a.index)},`text-${c}`));let e=a[1]||"text",f=a[2];b.push((0,br.jsx)(gG,{language:e,code:f},`code-${a.index}`)),c=a.index+a[0].length}return c<d.length&&b.push((0,br.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none whitespace-pre-wrap",children:d.slice(c)},`text-${c}`)),b.length>0?b:(0,br.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none whitespace-pre-wrap",children:d})})(),e&&e.length>0&&(0,br.jsxs)("div",{className:"mt-4 border-t border-gray-200 dark:border-gray-700 pt-3",children:[(0,br.jsx)("h4",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"Fontes:"}),(0,br.jsx)("ul",{className:"space-y-1",children:e.map((a,b)=>(0,br.jsxs)("li",{className:"flex items-center",children:[(0,br.jsxs)("span",{className:"text-gray-500 dark:text-gray-400 text-xs mr-2",children:[b+1,"."]}),(0,br.jsx)("a",{href:a.uri,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline text-sm truncate",title:a.uri,children:a.title})]},b))})]}),g&&(0,br.jsxs)("div",{className:`mt-3 flex items-center gap-2 ${e&&e.length>0?"pt-3 border-t border-gray-200 dark:border-gray-700":""}`,children:[(0,br.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mr-auto",children:"Avalie esta resposta:"}),(0,br.jsx)("button",{onClick:()=>b("good"),className:`p-1.5 rounded-full transition-colors ${"good"===f?"bg-green-100 text-green-600 dark:bg-green-900/50 dark:text-green-400":"text-gray-500 hover:bg-gray-200 dark:text-gray-400 dark:hover:bg-gray-700"}`,"aria-label":"Resposta boa",children:(0,br.jsx)(gH,{className:"w-4 h-4"})}),(0,br.jsx)("button",{onClick:()=>b("bad"),className:`p-1.5 rounded-full transition-colors ${"bad"===f?"bg-red-100 text-red-600 dark:bg-red-900/50 dark:text-red-400":"text-gray-500 hover:bg-gray-200 dark:text-gray-400 dark:hover:bg-gray-700"}`,"aria-label":"Resposta ruim",children:(0,br.jsx)(gI,{className:"w-4 h-4"})})]})]})]})},gL=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:a,children:(0,br.jsx)("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"})}),gM=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.122 2.122l7.81-7.81"})}),gN=["O que muda com a nova Reforma TributÃ¡ria para o setor de serviÃ§os?","Como funciona o regime de Lucro Presumido?","Quais sÃ£o os principais impostos federais no Brasil?","Explique o que Ã© o SPED Fiscal."],gO=["Gere uma funÃ§Ã£o em Python para calcular o ICMS em uma venda interestadual.","Escreva um trecho de cÃ³digo em Delphi para validar um CNPJ.","Crie uma funÃ§Ã£o Python que retorne a alÃ­quota do ISS para um serviÃ§o em SÃ£o Paulo.","Mostre um exemplo de como gerar um XML de NF-e em Python."],gP=["Melhore a pergunta: 'impostos sobre software'","Como posso perguntar sobre crÃ©ditos de PIS/COFINS de forma mais eficaz?","Otimize minha dÃºvida sobre a tributaÃ§Ã£o de serviÃ§os exportados.","Sugira alternativas para a pergunta: 'reforma tributÃ¡ria'"],gQ=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 15"})}),gR=({className:a})=>(0,br.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:[(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18Z"}),(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75a9.023 9.023 0 0 1 0-7.5M12 3.75c1.62 3.32 1.62 7.18 0 10.5"})]}),gS=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-4.5 6.01 6.01 0 0 0-1.5-4.5m0 9a6.01 6.01 0 0 1-1.5-4.5 6.01 6.01 0 0 1 1.5-4.5M12 6.75v-1.5m0 12.75a3 3 0 0 1-3-3h6a3 3 0 0 1-3 3z"})}),gT=({onSendMessage:a,onUploadClick:b,isLoading:c,activeAgent:d})=>{let[e,f]=(0,bs.useState)(""),[g,h]=(0,bs.useState)([]),[i,j]=(0,bs.useState)(-1),[k,l]=(0,bs.useState)(!1),m=(0,bs.useRef)(null),n=gA(a=>a.setActiveAgent),o=[{name:"Pesquisa na web",description:"Mudar para o agente de documentos.",agent:"document",alias:"web",icon:(0,br.jsx)(gR,{className:"w-5 h-5 mr-3 text-green-500 flex-shrink-0"})},{name:"Gerar CÃ³digo",description:"Mudar para o agente de programaÃ§Ã£o.",agent:"code",alias:"codigo",icon:(0,br.jsx)(gQ,{className:"w-5 h-5 mr-3 text-blue-500 flex-shrink-0"})},{name:"SugestÃ£o",description:"Melhorar a sua pergunta.",agent:"suggestion",alias:"sugestao",icon:(0,br.jsx)(gS,{className:"w-5 h-5 mr-3 text-yellow-500 flex-shrink-0"})}].filter(a=>a.name.toLowerCase().includes(e.substring(1).toLowerCase())||a.alias.toLowerCase().includes(e.substring(1).toLowerCase()));(0,bs.useEffect)(()=>{let a=[];switch(d){case"document":a=gN;break;case"code":a=gO;break;case"suggestion":a=gP}if(e.startsWith("@")&&!e.includes(" ")){l(!0),h([]),j(0);return}l(!1),e.trim().length>0&&!e.startsWith("@")?h(a.filter(a=>a.toLowerCase().includes(e.toLowerCase())).slice(0,5)):h([]),j(-1)},[e,d]),(0,bs.useEffect)(()=>{let a=m.current;a&&(a.style.height="auto",a.style.height=`${a.scrollHeight}px`)},[e]);let p=b=>{b.trim()&&!c&&(a(b.trim()),f(""),h([]))},q=(a,b)=>{n(a),f(`@${b} `),l(!1),m.current?.focus()};return(0,br.jsxs)("div",{className:"w-full max-w-3xl mx-auto relative",children:[k&&o.length>0&&(0,br.jsxs)("div",{className:"absolute bottom-full mb-2 w-full bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-2xl shadow-lg p-2",children:[(0,br.jsx)("p",{className:"px-2 py-1 text-xs font-semibold text-gray-500 dark:text-gray-400",children:"AGENTES"}),(0,br.jsx)("ul",{className:"space-y-1",children:o.map((a,b)=>(0,br.jsxs)("li",{onClick:()=>q(a.agent,a.alias),className:`p-2 rounded-md cursor-pointer flex items-center ${b===i?"bg-blue-100 dark:bg-blue-900/50":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[a.icon,(0,br.jsxs)("div",{children:[(0,br.jsx)("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:a.name}),(0,br.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.description})]})]},a.name))})]}),g.length>0&&!k&&(0,br.jsx)("div",{className:"absolute bottom-full mb-2 w-full bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-2xl shadow-lg p-2",children:(0,br.jsx)("ul",{className:"space-y-1",children:g.map((a,b)=>(0,br.jsx)("li",{onClick:()=>{p(a)},className:`p-2 rounded-md cursor-pointer text-sm text-gray-800 dark:text-gray-200 ${b===i?"bg-blue-100 dark:bg-blue-900/50":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:a},a))})}),(0,br.jsxs)("div",{className:"relative flex items-end p-2 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-2xl shadow-lg",children:[(0,br.jsx)("button",{onClick:b,className:"p-2 text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors mr-2 flex-shrink-0","aria-label":"Anexar documento",children:(0,br.jsx)(gM,{className:"w-6 h-6"})}),(0,br.jsx)("textarea",{ref:m,value:e,onChange:a=>f(a.target.value),onKeyDown:a=>{if(k&&o.length>0){if("ArrowDown"===a.key)a.preventDefault(),j(a=>(a+1)%o.length);else if("ArrowUp"===a.key)a.preventDefault(),j(a=>(a-1+o.length)%o.length);else if("Enter"===a.key){if(a.preventDefault(),o[i]){let{agent:a,alias:b}=o[i];q(a,b)}}else"Escape"===a.key&&(l(!1),f(""));return}g.length>0&&("ArrowDown"===a.key?(a.preventDefault(),j(a=>(a+1)%g.length)):"ArrowUp"===a.key?(a.preventDefault(),j(a=>(a-1+g.length)%g.length)):"Enter"===a.key&&i>-1?(a.preventDefault(),p(g[i])):"Escape"===a.key&&h([])),"Enter"!==a.key||a.shiftKey||-1!==i||(a.preventDefault(),p(e))},placeholder:"Digite sua mensagem ou '@' para mudar de agente...",rows:1,className:"flex-1 w-full bg-transparent resize-none focus:outline-none text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 max-h-52",disabled:c}),(0,br.jsx)("button",{onClick:()=>p(e),disabled:c||!e.trim(),className:"ml-2 p-3 bg-blue-600 text-white rounded-full disabled:bg-gray-400 disabled:dark:bg-gray-600 hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 flex-shrink-0","aria-label":"Enviar mensagem",children:c?(0,br.jsx)("div",{className:"w-5 h-5 border-2 border-t-transparent border-white rounded-full animate-spin"}):(0,br.jsx)(gL,{className:"w-5 h-5"})})]})]})},gU=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})}),gV=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),gW=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.067-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})}),gX=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"})}),gY=({isOpen:a,onClose:b})=>{let c,d,{documentConversations:e,codeConversations:f,suggestionConversations:g,activeDocumentConversationId:h,activeCodeConversationId:i,activeSuggestionConversationId:j,startNewConversation:k,deleteConversation:l,setActiveConversation:m,activeAgent:n}=gA(),[o,p]=(0,bs.useState)(null),q=(0,bs.useRef)(null);switch((0,bs.useEffect)(()=>{let a=a=>{q.current&&!q.current.contains(a.target)&&p(null)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]),n){case"code":c=f,d=i;break;case"suggestion":c=g,d=j;break;default:c=e,d=h}let r=Object.values(c).sort((a,b)=>(b.updatedAt||b.createdAt)-(a.updatedAt||a.createdAt));return(0,br.jsxs)("aside",{className:`fixed inset-y-0 left-0 z-40 w-80 bg-gray-50 dark:bg-gray-900 flex flex-col h-full border-r border-gray-200 dark:border-gray-700 transform transition-transform duration-300 ease-in-out ${a?"translate-x-0":"-translate-x-full"} lg:relative lg:translate-x-0 lg:flex-shrink-0`,children:[(0,br.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,br.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"HistÃ³rico"}),(0,br.jsx)("button",{onClick:b,className:"lg:hidden p-1 text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full","aria-label":"Fechar histÃ³rico",children:(0,br.jsx)(gU,{className:"w-6 h-6"})})]}),(0,br.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:(0,br.jsxs)("button",{onClick:()=>{k(n),b()},className:"w-full flex items-center justify-center p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900",children:[(0,br.jsx)(gV,{className:"w-5 h-5 mr-2"}),(0,br.jsx)("span",{children:"Novo Chat"})]})}),(0,br.jsx)("div",{className:"flex-grow p-2 overflow-y-auto",children:0===r.length?(0,br.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400 mt-8 px-4",children:(0,br.jsxs)("p",{children:['Nenhum histÃ³rico para o agente "',"document"===n?"Consultor":"code"===n?"CÃ³digo":"SugestÃ£o",'".']})}):(0,br.jsx)("ul",{className:"space-y-1",children:r.map(a=>{var c;let e;return(0,br.jsx)("li",{children:(0,br.jsxs)("div",{onClick:()=>{m(n,a.id),b()},className:`w-full text-left p-3 rounded-md group flex items-center justify-between transition-colors duration-200 cursor-pointer ${a.id===d?"bg-blue-100 dark:bg-blue-900/50":"hover:bg-gray-200 dark:hover:bg-gray-800"}`,children:[(0,br.jsxs)("div",{className:"flex-grow overflow-hidden pr-2",children:[(0,br.jsx)("p",{className:"truncate text-sm font-medium text-gray-800 dark:text-gray-200",title:a.title,children:a.title}),(0,br.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:(c=a.updatedAt||a.createdAt,(e=(new Date().getTime()-c)/1e3)<60?"agora mesmo":e<3600?`${Math.round(e/60)}m atr\xe1s`:e<=86400?`${Math.round(e/3600)}h atr\xe1s`:new Date(c).toLocaleDateString("pt-BR",{day:"2-digit",month:"short"}))})]}),(0,br.jsxs)("div",{className:"relative flex-shrink-0",ref:o===a.id?q:null,children:[(0,br.jsx)("button",{onClick:b=>{var c;return c=a.id,void(b.stopPropagation(),p(a=>a===c?null:c))},className:"p-1 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-100 rounded-full opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"OpÃ§Ãµes da conversa",children:(0,br.jsx)(gX,{className:"w-4 h-4"})}),o===a.id&&(0,br.jsx)("div",{className:"absolute right-0 mt-2 w-32 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-10",children:(0,br.jsx)("ul",{className:"py-1",children:(0,br.jsx)("li",{children:(0,br.jsxs)("button",{onClick:b=>{var c;return c=a.id,void(b.stopPropagation(),p(null),window.confirm("Tem certeza que deseja excluir esta conversa?")&&l(n,c))},className:"w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center",children:[(0,br.jsx)(gW,{className:"w-4 h-4 mr-2"})," Excluir"]})})})})]})]})},a.id)})})})]})},gZ=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})}),g$=({className:a,title:b})=>(0,br.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:a,"aria-hidden":"true",children:[b&&(0,br.jsx)("title",{children:b}),(0,br.jsx)("path",{fillRule:"evenodd",d:"M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z",clipRule:"evenodd"})]}),g_=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),g0=({className:a})=>(0,br.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:[(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}),g1=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})}),g2=({content:a})=>(0,br.jsx)("div",{className:"p-3 pt-2 text-sm text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-800/50",children:(0,br.jsx)("div",{className:"max-h-64 overflow-y-auto border-t border-gray-200 dark:border-gray-700 pt-2",children:(0,br.jsx)("pre",{className:"whitespace-pre-wrap font-sans",children:a||"Este documento nÃ£o contÃ©m texto para ser exibido."})})}),g3=({doc:a,isExpanded:b,onDelete:c,onRename:d,onToggleExpand:e})=>{let[f,g]=(0,bs.useState)(!1),[h,i]=(0,bs.useState)(!1),[j,k]=(0,bs.useState)(a.name),l=(0,bs.useRef)(null),m=(0,bs.useRef)(null);(0,bs.useEffect)(()=>{h&&m.current&&(m.current.focus(),m.current.select())},[h]),(0,bs.useEffect)(()=>{let a=a=>{l.current&&!l.current.contains(a.target)&&g(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]);let n=()=>{j.trim()&&j.trim()!==a.name?d(a.id,j.trim()):k(a.name),i(!1),g(!1)};return(0,br.jsxs)("div",{className:"mb-2 rounded-md bg-white dark:bg-gray-800 shadow-sm border border-gray-200 dark:border-gray-700",children:[(0,br.jsxs)("div",{className:"flex items-center justify-between p-2 cursor-pointer",onClick:()=>e(a.id),children:[(0,br.jsxs)("div",{className:"flex items-center overflow-hidden flex-grow",children:[(0,br.jsx)(gZ,{className:"w-5 h-5 mr-2 flex-shrink-0 text-gray-500 dark:text-gray-400"}),h?(0,br.jsx)("input",{ref:m,type:"text",value:j,onClick:a=>a.stopPropagation(),onChange:a=>k(a.target.value),onBlur:n,onKeyDown:b=>{"Enter"===b.key?n():"Escape"===b.key&&(k(a.name),i(!1),g(!1))},className:"text-sm bg-transparent border-b border-blue-500 focus:outline-none text-gray-800 dark:text-gray-200 w-full"}):(0,br.jsx)("span",{className:"truncate text-sm text-gray-800 dark:text-gray-200",title:a.name,children:a.name})]}),(0,br.jsxs)("div",{className:"flex items-center",onClick:a=>a.stopPropagation(),children:[(0,br.jsx)(g1,{className:`w-5 h-5 text-gray-400 dark:text-gray-500 transition-transform duration-300 mr-1 ${b?"rotate-180":""}`}),(0,br.jsxs)("div",{className:"relative flex-shrink-0",ref:l,children:[a.isDeletable?(0,br.jsx)("button",{onClick:()=>g(!f),className:"p-1 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700",children:(0,br.jsx)(gX,{className:"w-5 h-5"})}):(0,br.jsx)(g$,{className:"w-4 h-4 ml-2 flex-shrink-0 text-gray-400 dark:text-gray-500",title:"Este documento faz parte da base de conhecimento e nÃ£o pode ser excluÃ­do."}),f&&(0,br.jsx)("div",{className:"absolute right-0 mt-2 w-40 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-10",children:(0,br.jsxs)("ul",{className:"py-1",children:[(0,br.jsx)("li",{children:(0,br.jsxs)("button",{onClick:()=>{e(a.id),g(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center",children:[(0,br.jsx)(g0,{className:"w-4 h-4 mr-2"})," ",b?"Ocultar":"Visualizar"]})}),(0,br.jsx)("li",{children:(0,br.jsxs)("button",{onClick:()=>{i(!0),g(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center",children:[(0,br.jsx)(g_,{className:"w-4 h-4 mr-2"})," Renomear"]})}),(0,br.jsx)("li",{children:(0,br.jsxs)("button",{onClick:()=>{c(a.id),g(!1)},className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center",children:[(0,br.jsx)(gW,{className:"w-4 h-4 mr-2"})," Excluir"]})})]})})]})]})]}),(0,br.jsx)("div",{className:`grid transition-[grid-template-rows] duration-300 ease-in-out ${b?"grid-rows-[1fr]":"grid-rows-[0fr]"}`,children:(0,br.jsx)("div",{className:"overflow-hidden",children:(0,br.jsx)(g2,{content:a.content||""})})})]})},g4=({isOpen:a,onClose:b})=>{let{documents:c,addDocument:d,deleteDocument:e,renameDocument:f,isLoading:g,error:h}=gz(),i=(0,bs.useRef)(null),[j,k]=(0,bs.useState)(null),l=a=>{k(b=>b===a?null:a)},m=c.filter(a=>!a.isDeletable),n=c.filter(a=>a.isDeletable);return(0,br.jsx)(br.Fragment,{children:(0,br.jsxs)("aside",{className:`fixed inset-y-0 right-0 z-40 w-80 bg-gray-50 dark:bg-gray-900/95 flex flex-col h-full border-l border-gray-200 dark:border-gray-700/50 backdrop-blur-sm transform transition-transform duration-300 ease-in-out ${a?"translate-x-0":"translate-x-full"} lg:relative lg:translate-x-0 lg:flex-shrink-0`,children:[(0,br.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,br.jsxs)("div",{children:[(0,br.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Documentos"}),(0,br.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Contexto do agente."})]}),(0,br.jsx)("button",{onClick:b,className:"lg:hidden p-1 text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full","aria-label":"Fechar documentos",children:(0,br.jsx)(gU,{className:"w-6 h-6"})})]}),(0,br.jsxs)("div",{className:"flex-grow p-4 overflow-y-auto",children:[(0,br.jsx)("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 mb-2 px-1",children:"Base de Conhecimento"}),m.length>0?m.map(a=>(0,br.jsx)(g3,{doc:a,onDelete:()=>{},onRename:()=>{},onToggleExpand:l,isExpanded:j===a.id},a.id)):(0,br.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500 px-1",children:"Nenhum conhecimento base carregado."}),(0,br.jsx)("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 mt-6 mb-2 px-1",children:"Documentos Enviados"}),n.length>0?n.map(a=>(0,br.jsx)(g3,{doc:a,onDelete:e,onRename:f,onToggleExpand:l,isExpanded:j===a.id},a.id)):(0,br.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400 mt-4 py-4 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg",children:[(0,br.jsx)(gZ,{className:"w-8 h-8 mx-auto mb-1 text-gray-400"}),(0,br.jsx)("p",{className:"text-sm",children:"Nenhum documento enviado."})]}),g&&(0,br.jsxs)("div",{className:"flex items-center justify-center mt-4",children:[(0,br.jsx)("div",{className:"w-6 h-6 border-2 border-t-transparent border-blue-500 rounded-full animate-spin"}),(0,br.jsx)("span",{className:"ml-2 text-gray-600 dark:text-gray-300",children:"Processando..."})]}),h&&(0,br.jsx)("p",{className:"text-red-500 text-sm mt-2 p-2 bg-red-100 dark:bg-red-900/20 rounded-md whitespace-pre-wrap",children:h})]}),(0,br.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:[(0,br.jsx)("input",{type:"file",ref:i,onChange:a=>{let b=a.target.files?.[0];b&&d(b),i.current&&(i.current.value="")},className:"hidden",accept:".txt,.md,.pdf"}),(0,br.jsxs)("button",{onClick:()=>{i.current?.click()},disabled:g,className:"w-full flex items-center justify-center p-3 bg-blue-600 text-white rounded-lg disabled:bg-gray-400 disabled:dark:bg-gray-600 hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900",children:[(0,br.jsx)(gM,{className:"w-5 h-5 mr-2"}),(0,br.jsx)("span",{children:"Enviar Documento"})]})]})]})})},g5=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"})}),g6=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"})}),g7=({theme:a,toggleTheme:b})=>(0,br.jsx)("button",{onClick:b,className:"p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800","aria-label":"Alternar tema",children:"light"===a?(0,br.jsx)(g6,{className:"w-6 h-6"}):(0,br.jsx)(g5,{className:"w-6 h-6"})}),g8=()=>{let{activeModel:a,proTokenCount:b,proTokenLimit:c}=gA(),d=b/c*100;return(0,br.jsxs)("div",{className:"flex flex-col items-end",children:[(0,br.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-300 mb-1",children:[(0,br.jsx)("span",{className:"font-semibold hidden sm:inline",children:"Modelo Ativo: "}),(0,br.jsx)("span",{className:`font-bold px-2 py-0.5 rounded-full text-xs ${a===dU?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}`,children:a.includes("pro")?"Pro":"Flash"})]}),a===dU&&(0,br.jsxs)("div",{className:"w-28 sm:w-48",children:[(0,br.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1 text-right whitespace-nowrap",children:[(0,br.jsx)("span",{className:"hidden sm:inline",children:"Uso (Pro): "}),b.toLocaleString(),"/",c.toLocaleString()]}),(0,br.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 dark:bg-gray-700",children:(0,br.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Math.min(d,100)}%`}})})]})]})},g9={document:{title:"Sobre o Consultor de Documentos",description:"Este agente Ã© um especialista em anÃ¡lise de documentos e conhecimento tributÃ¡rio. Sua principal funÃ§Ã£o Ã© responder a perguntas com base no contexto fornecido nos documentos enviados e em sua base de conhecimento interna. Quando necessÃ¡rio, ele utiliza a busca na web para complementar suas respostas.",capabilities:["Analisar arquivos de texto (TXT, MD) e PDF.","Utilizar a tÃ©cnica RAG (Retrieval-Augmented Generation) para encontrar as informaÃ§Ãµes mais relevantes nos documentos.","Buscar informaÃ§Ãµes atualizadas na web para complementar o conhecimento.","Citar as fontes da web utilizadas nas respostas."],limitations:["NÃ£o fornece aconselhamento financeiro ou tributÃ¡rio licenciado.","As respostas sÃ£o baseadas nas informaÃ§Ãµes disponÃ­veis e podem nÃ£o cobrir todas as especificidades de um caso real.","A precisÃ£o depende da qualidade e clareza dos documentos fornecidos.","O conhecimento sobre eventos muito recentes pode ser limitado."]},code:{title:"Sobre o Gerador de CÃ³digo Fiscal",description:'Este agente Ã© um programador sÃªnior especialista em criar trechos de cÃ³digo para resolver problemas tributÃ¡rios e fiscais, com foco em Python e Delphi. Ele pode utilizar o contexto da conversa na aba "Consultor" para gerar um cÃ³digo mais preciso.',capabilities:["Gerar funÃ§Ãµes e scripts em Python e Delphi.","Adicionar comentÃ¡rios explicativos no cÃ³digo.",'Utilizar o histÃ³rico da conversa do "Consultor" como contexto.',"Formatar o cÃ³digo em blocos para fÃ¡cil leitura e cÃ³pia."],limitations:["NÃ£o pode executar ou testar o cÃ³digo gerado.","O cÃ³digo Ã© fornecido como um exemplo e deve ser revisado por um desenvolvedor qualificado antes do uso em produÃ§Ã£o.","NÃ£o compreende a arquitetura completa de um projeto ou sistema existente.","Pode nÃ£o utilizar as bibliotecas ou frameworks mais recentes, a menos que seja especificado."]},suggestion:{title:"Sobre o Otimizador de SugestÃµes",description:"Este agente atua como um especialista em prompts. Em vez de responder diretamente Ã  sua pergunta, ele analisa sua intenÃ§Ã£o e sugere 3 maneiras alternativas e mais eficazes de formular a mesma pergunta para obter melhores resultados de um assistente de IA fiscal. Ideal para refinar suas buscas e obter respostas mais precisas.",capabilities:["Analisar a intenÃ§Ã£o por trÃ¡s de uma pergunta.","Sugerir 3 novas formulaÃ§Ãµes de prompt.","Explicar brevemente por que cada sugestÃ£o Ã© melhor.","Ajudar a treinar o usuÃ¡rio a fazer perguntas mais eficazes."],limitations:["NÃ£o responde Ã  pergunta original diretamente.","As sugestÃµes sÃ£o baseadas em heurÃ­sticas e podem nÃ£o ser sempre perfeitas.","Funciona melhor com perguntas abertas e complexas."]}},ha=({isOpen:a,onClose:b,agentType:c})=>{if(!a)return null;let d=g9[c];return(0,br.jsxs)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:b,"aria-modal":"true",role:"dialog",children:[(0,br.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col transform transition-transform duration-300 animate-slide-up",onClick:a=>a.stopPropagation(),children:[(0,br.jsxs)("header",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,br.jsxs)("div",{className:"flex items-center gap-3",children:[(0,br.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-gray-200 dark:bg-gray-700",children:(0,br.jsx)(gB,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})}),(0,br.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",id:"modal-title",children:d.title})]}),(0,br.jsx)("button",{onClick:b,className:"p-1 text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full","aria-label":"Fechar modal",children:(0,br.jsx)(gU,{className:"w-6 h-6"})})]}),(0,br.jsxs)("main",{className:"p-6 overflow-y-auto text-gray-700 dark:text-gray-300",children:[(0,br.jsx)("p",{className:"text-sm leading-relaxed mb-6",children:d.description}),(0,br.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,br.jsxs)("div",{children:[(0,br.jsx)("h3",{className:"text-md font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Capacidades"}),(0,br.jsx)("ul",{className:"space-y-2 list-disc list-inside text-sm",children:d.capabilities.map((a,b)=>(0,br.jsxs)("li",{className:"flex items-start",children:[(0,br.jsx)("span",{className:"text-green-500 mr-2 mt-1",children:"â"}),(0,br.jsx)("span",{children:a})]},b))})]}),(0,br.jsxs)("div",{children:[(0,br.jsx)("h3",{className:"text-md font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"LimitaÃ§Ãµes"}),(0,br.jsx)("ul",{className:"space-y-2 list-disc list-inside text-sm",children:d.limitations.map((a,b)=>(0,br.jsxs)("li",{className:"flex items-start",children:[(0,br.jsx)("span",{className:"text-red-500 mr-2 mt-1",children:"â"}),(0,br.jsx)("span",{children:a})]},b))})]})]}),(0,br.jsx)("div",{className:"mt-6 p-3 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 dark:border-yellow-500 rounded-r-lg",children:(0,br.jsxs)("p",{className:"text-xs text-yellow-800 dark:text-yellow-300",children:[(0,br.jsx)("strong",{children:"Aviso:"})," As informaÃ§Ãµes e o cÃ³digo gerados por esta IA sÃ£o para fins informativos e nÃ£o substituem o aconselhamento de um profissional qualificado. Verifique sempre as informaÃ§Ãµes com fontes oficiais."]})})]})]}),(0,br.jsx)("style",{children:`
        @keyframes fade-in {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        .animate-fade-in {
          animation: fade-in 0.2s ease-out forwards;
        }
        @keyframes slide-up {
          from { transform: translateY(20px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up {
           animation: slide-up 0.3s ease-out forwards;
        }
      `})]})},hb=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})}),hc=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})}),hd=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"})}),he=({className:a})=>(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:a,"aria-hidden":"true",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.243 4.243L6.228 6.228"})}),hf=({isOpen:a,onClose:b})=>{let[c,d]=(0,bs.useState)(""),{sendPasswordResetEmail:e,authLoading:f,authError:g,authMessage:h}=gA();return a?(0,br.jsx)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:b,children:(0,br.jsxs)("div",{className:"bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md",onClick:a=>a.stopPropagation(),children:[(0,br.jsxs)("header",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[(0,br.jsxs)("div",{className:"flex items-center gap-3",children:[(0,br.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-gray-700",children:(0,br.jsx)(hd,{className:"w-6 h-6 text-yellow-400"})}),(0,br.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Redefinir Senha"})]}),(0,br.jsx)("button",{onClick:b,className:"p-1 text-gray-400 hover:bg-gray-700 rounded-full",children:(0,br.jsx)(gU,{className:"w-6 h-6"})})]}),(0,br.jsx)("div",{className:"p-6",children:h?(0,br.jsxs)("div",{children:[(0,br.jsxs)("div",{className:"p-4 text-sm text-center text-green-300 bg-green-900/20 rounded-lg",children:[(0,br.jsx)("p",{className:"font-bold",children:"Verifique seu E-mail!"}),(0,br.jsx)("p",{className:"mt-2",children:h})]}),(0,br.jsx)("button",{onClick:b,className:"w-full mt-6 px-4 py-2.5 font-semibold text-white bg-gray-600 rounded-lg hover:bg-gray-500",children:"Fechar"})]}):(0,br.jsxs)("form",{onSubmit:a=>{a.preventDefault(),e(c)},children:[(0,br.jsx)("p",{className:"text-sm text-gray-400 mb-4",children:"Digite o endereÃ§o de e-mail associado Ã  sua conta e enviaremos um link para redefinir sua senha."}),(0,br.jsxs)("div",{children:[(0,br.jsx)("label",{htmlFor:"reset-email",className:"block text-sm font-medium text-gray-300",children:"Email"}),(0,br.jsx)("input",{id:"reset-email",name:"email",type:"email",autoComplete:"email",required:!0,value:c,onChange:a=>d(a.target.value),className:"w-full px-4 py-2.5 mt-1 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),g&&(0,br.jsxs)("div",{className:"p-3 mt-4 text-sm text-red-300 bg-red-900/20 rounded-lg",children:[(0,br.jsx)("p",{className:"font-bold",children:"Ocorreu um erro:"}),(0,br.jsx)("pre",{className:"mt-1 font-sans text-xs whitespace-pre-wrap",children:g.message})]}),(0,br.jsx)("div",{className:"mt-6",children:(0,br.jsx)("button",{type:"submit",disabled:f,className:"w-full px-4 py-2.5 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-all duration-300",children:f?"Enviando...":"Enviar Link de RedefiniÃ§Ã£o"})})]})})]})}):null},hg=({onNavigateToSignup:a,onNavigateToForgotPassword:b})=>{let[c,d]=(0,bs.useState)(""),[e,f]=(0,bs.useState)(""),[g,h]=(0,bs.useState)(!1),{signIn:i,authLoading:j,authError:k}=gA();return(0,br.jsx)("div",{className:"min-h-screen bg-gray-900 text-white p-4 flex items-center justify-center",children:(0,br.jsxs)("div",{className:"w-full max-w-4xl mx-auto bg-gray-800 rounded-2xl shadow-2xl flex overflow-hidden",children:[(0,br.jsxs)("div",{className:"hidden md:flex flex-col items-center justify-center w-1/2 bg-blue-600 p-8 text-center",children:[(0,br.jsx)(gB,{className:"w-24 h-24 mb-4"}),(0,br.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"GÃªnesis Agente IA"}),(0,br.jsx)("p",{className:"text-blue-200",children:"Sua expertise fiscal, potencializada por IA."})]}),(0,br.jsxs)("div",{className:"w-full md:w-1/2 p-8 sm:p-12",children:[(0,br.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"Bem-vindo de volta!"}),(0,br.jsx)("p",{className:"mb-8 text-sm text-gray-400",children:"FaÃ§a login para acessar o assistente."}),(0,br.jsxs)("form",{className:"space-y-6",onSubmit:a=>{a.preventDefault(),i(c,e)},children:[(0,br.jsxs)("div",{children:[(0,br.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email"}),(0,br.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:c,onChange:a=>d(a.target.value),className:"w-full px-4 py-2.5 mt-1 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,br.jsxs)("div",{children:[(0,br.jsxs)("div",{className:"flex items-center justify-between",children:[(0,br.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300",children:"Senha"}),(0,br.jsx)("div",{className:"text-sm",children:(0,br.jsx)("button",{type:"button",onClick:b,className:"font-medium text-blue-400 hover:underline",children:"Esqueci minha senha"})})]}),(0,br.jsxs)("div",{className:"relative mt-1",children:[(0,br.jsx)("input",{id:"password",name:"password",type:g?"text":"password",autoComplete:"current-password",required:!0,value:e,onChange:a=>f(a.target.value),className:"w-full px-4 py-2.5 pr-10 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,br.jsx)("button",{type:"button",onClick:()=>h(!g),className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-white","aria-label":g?"Ocultar senha":"Mostrar senha",children:g?(0,br.jsx)(he,{className:"h-5 w-5"}):(0,br.jsx)(g0,{className:"h-5 w-5"})})]})]}),k&&(0,br.jsxs)("div",{className:"p-3 my-2 text-sm text-red-300 bg-red-900/20 rounded-lg",children:[(0,br.jsx)("p",{className:"font-bold",children:"Ocorreu um erro:"}),(0,br.jsx)("pre",{className:"mt-1 font-sans text-xs whitespace-pre-wrap",children:k.message})]}),(0,br.jsx)("div",{children:(0,br.jsx)("button",{type:"submit",disabled:j,className:"w-full px-4 py-2.5 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-all duration-300",children:j?"Entrando...":"Entrar"})})]}),(0,br.jsxs)("p",{className:"text-sm text-center text-gray-400 mt-8",children:["NÃ£o tem uma conta?"," ",(0,br.jsx)("button",{onClick:a,className:"font-medium text-blue-400 hover:underline",children:"Cadastre-se"})]})]})]})})},hh=({onNavigateToLogin:a})=>{let[b,c]=(0,bs.useState)(""),[d,e]=(0,bs.useState)(""),[f,g]=(0,bs.useState)(""),[h,i]=(0,bs.useState)(!1),[j,k]=(0,bs.useState)("Contador"),{signUp:l,authLoading:m,authError:n,authMessage:o}=gA();return(0,br.jsx)("div",{className:"min-h-screen bg-gray-900 text-white p-4 flex items-center justify-center",children:(0,br.jsxs)("div",{className:"w-full max-w-4xl mx-auto bg-gray-800 rounded-2xl shadow-2xl flex overflow-hidden",children:[(0,br.jsxs)("div",{className:"hidden md:flex flex-col items-center justify-center w-1/2 bg-blue-600 p-8 text-center",children:[(0,br.jsx)(gB,{className:"w-24 h-24 mb-4"}),(0,br.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"GÃªnesis Agente IA"}),(0,br.jsx)("p",{className:"text-blue-200",children:"Comece a transformar sua anÃ¡lise tributÃ¡ria."})]}),(0,br.jsxs)("div",{className:"w-full md:w-1/2 p-8 sm:p-12",children:[(0,br.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"Crie sua Conta"}),(0,br.jsx)("p",{className:"mb-6 text-sm text-gray-400",children:"Junte-se a nÃ³s e simplifique suas tarefas fiscais."}),(0,br.jsx)("form",{className:"space-y-4",onSubmit:a=>{a.preventDefault(),l(d,f,{full_name:b,user_type:j})},children:(0,br.jsxs)("fieldset",{disabled:m||!!o,children:[(0,br.jsxs)("div",{children:[(0,br.jsx)("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-300",children:"Nome Completo"}),(0,br.jsx)("input",{id:"fullName",name:"fullName",type:"text",required:!0,value:b,onChange:a=>c(a.target.value),className:"w-full px-4 py-2.5 mt-1 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,br.jsxs)("div",{children:[(0,br.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email"}),(0,br.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:d,onChange:a=>e(a.target.value),className:"w-full px-4 py-2.5 mt-1 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,br.jsxs)("div",{children:[(0,br.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300",children:"Senha"}),(0,br.jsxs)("div",{className:"relative mt-1",children:[(0,br.jsx)("input",{id:"password",name:"password",type:h?"text":"password",required:!0,value:f,onChange:a=>g(a.target.value),className:"w-full px-4 py-2.5 pr-10 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,br.jsx)("button",{type:"button",onClick:()=>i(!h),className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-white","aria-label":h?"Ocultar senha":"Mostrar senha",children:h?(0,br.jsx)(he,{className:"h-5 w-5"}):(0,br.jsx)(g0,{className:"h-5 w-5"})})]})]}),(0,br.jsxs)("div",{children:[(0,br.jsx)("label",{htmlFor:"userType",className:"block text-sm font-medium text-gray-300",children:"Tipo de UsuÃ¡rio"}),(0,br.jsxs)("select",{id:"userType",name:"userType",value:j,onChange:a=>k(a.target.value),className:"w-full px-4 py-2.5 mt-1 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,br.jsx)("option",{children:"Contador"}),(0,br.jsx)("option",{children:"Advogado"}),(0,br.jsx)("option",{children:"EmpresÃ¡rio"}),(0,br.jsx)("option",{children:"Desenvolvedor"}),(0,br.jsx)("option",{children:"Estudante"}),(0,br.jsx)("option",{children:"Outro"})]})]}),o&&!n&&(0,br.jsxs)("div",{className:"p-3 my-2 text-sm text-green-300 bg-green-900/20 rounded-lg",children:[(0,br.jsx)("p",{className:"font-bold",children:"Sucesso!"}),(0,br.jsx)("p",{className:"mt-1",children:o})]}),n&&(0,br.jsxs)("div",{className:"p-3 my-2 text-sm text-red-300 bg-red-900/20 rounded-lg",children:[(0,br.jsx)("p",{className:"font-bold",children:"Ocorreu um erro ao cadastrar:"}),(0,br.jsx)("pre",{className:"mt-1 font-sans text-xs whitespace-pre-wrap",children:n.message})]}),(0,br.jsx)("div",{children:(0,br.jsx)("button",{type:"submit",disabled:m||!!o,className:"w-full px-4 py-2.5 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-all duration-300",children:m?"Cadastrando...":"Cadastrar"})})]})}),(0,br.jsxs)("p",{className:"text-sm text-center text-gray-400 mt-6",children:["JÃ¡ tem uma conta?"," ",(0,br.jsx)("button",{onClick:a,className:"font-medium text-blue-400 hover:underline",children:"FaÃ§a login"})]})]})]})})},hi=()=>{let{documentConversations:a,codeConversations:b,suggestionConversations:c,activeDocumentConversationId:d,activeCodeConversationId:e,activeSuggestionConversationId:f,sendMessage:g,isLoading:h,activeAgent:i,setActiveAgent:j,setMessageFeedback:k,loadInitialData:l,signOut:m}=gA(),{documents:n}=gz(),[o,p]=(0,bs.useState)("dark"),[q,r]=(0,bs.useState)(!1),[s,t]=(0,bs.useState)(!1),[u,v]=(0,bs.useState)(!1),[w,x]=(0,bs.useState)(!0),y=(0,bs.useRef)(null),z=null,A={},B="",C=[];switch(i){case"code":z=e,A=b,B="Gerador de CÃ³digo",C=gO;break;case"suggestion":z=f,A=c,B="Otimizador de Prompt",C=gP;break;default:z=d,A=a,B="Consultor Fiscal",C=gN}let D=z?A[z]:void 0,E=D?.messages||[];(0,bs.useEffect)(()=>{(async()=>{await l(),x(!1)})()},[l]),(0,bs.useEffect)(()=>{"dark"===o?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[o]),(0,bs.useEffect)(()=>{y.current?.scrollIntoView({behavior:"smooth"})},[E]);let F=a=>{g(a,n)},G=({agent:a,label:b})=>(0,br.jsx)("button",{onClick:()=>j(a),className:`px-3 py-1.5 text-sm font-semibold rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900 ${i===a?"bg-blue-600 text-white shadow":"text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:b});return w?(0,br.jsx)("div",{className:"flex h-screen w-full items-center justify-center bg-gray-100 dark:bg-gray-900",children:(0,br.jsxs)("div",{className:"flex flex-col items-center",children:[(0,br.jsx)(gB,{className:"w-16 h-16 text-blue-500 animate-pulse"}),(0,br.jsx)("p",{className:"mt-4 text-lg text-gray-700 dark:text-gray-300",children:"Carregando assistente..."})]})}):(0,br.jsxs)("div",{className:"flex h-screen font-sans bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors",children:[(0,br.jsx)(gY,{isOpen:q,onClose:()=>r(!1)}),(0,br.jsxs)("main",{className:"flex-1 flex flex-col h-screen relative",children:[(0,br.jsxs)("header",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm z-10",children:[(0,br.jsxs)("div",{className:"flex items-center gap-4",children:[(0,br.jsx)("button",{onClick:()=>r(!0),className:"lg:hidden p-1 text-gray-500 dark:text-gray-400",children:(0,br.jsx)(hb,{className:"w-6 h-6"})}),(0,br.jsxs)("div",{className:"flex items-center p-1 bg-gray-200/50 dark:bg-gray-900/50 rounded-lg",children:[(0,br.jsx)(G,{agent:"document",label:"Consultor"}),(0,br.jsx)(G,{agent:"code",label:"CÃ³digo"}),(0,br.jsx)(G,{agent:"suggestion",label:"SugestÃ£o"})]})]}),(0,br.jsxs)("div",{className:"flex items-center gap-2",children:[(0,br.jsx)("button",{onClick:()=>v(!0),className:"p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700",children:(0,br.jsx)(hc,{className:"w-5 h-5"})}),(0,br.jsx)(g8,{}),(0,br.jsx)(g7,{theme:o,toggleTheme:()=>{p("light"===o?"dark":"light")}}),(0,br.jsx)("button",{onClick:m,className:"p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700",title:"Sair",children:(0,br.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:(0,br.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m-3 0-3-3m0 0 3-3m-3 3h12"})})}),"document"===i&&(0,br.jsx)("button",{onClick:()=>t(!0),className:"lg:hidden p-1 text-gray-500 dark:text-gray-400",children:(0,br.jsx)(gZ,{className:"w-6 h-6"})})]})]}),(0,br.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 pb-24",children:[0===E.length?(0,br.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[(0,br.jsx)("div",{className:"w-20 h-20 mb-6 rounded-full flex items-center justify-center bg-gray-200 dark:bg-gray-700",children:(0,br.jsx)(gB,{className:"w-12 h-12 text-gray-600 dark:text-gray-300"})}),(0,br.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:B}),(0,br.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-8 max-w-md",children:"Comece uma conversa, envie um documento ou escolha uma das sugestÃµes abaixo."}),(0,br.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full max-w-2xl",children:C.map((a,b)=>(0,br.jsx)("button",{onClick:()=>{F(a)},className:"p-4 bg-white dark:bg-gray-800 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors shadow",children:(0,br.jsx)("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:a})},b))})]}):(0,br.jsxs)("div",{children:[(0,br.jsx)("h1",{className:"text-center text-xl font-semibold text-gray-700 dark:text-gray-300 mb-6",children:D?.title}),E.map(a=>(0,br.jsx)(gK,{message:a,onFeedback:b=>{var c;return c=a.id,void(z&&k(i,z,c,b))}},a.id))]}),(0,br.jsx)("div",{ref:y})]}),(0,br.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-gray-100 dark:from-gray-900 to-transparent",children:(0,br.jsx)(gT,{onSendMessage:F,isLoading:h,onUploadClick:()=>t(!0),activeAgent:i})})]}),"document"===i&&(0,br.jsx)(g4,{isOpen:s,onClose:()=>t(!1)}),(0,br.jsx)(ha,{isOpen:u,onClose:()=>v(!1),agentType:i})]})},hj=()=>{let{session:a,authLoading:b,initAuth:c,clearAuthFeedback:d}=gA(),[e,f]=(0,bs.useState)("login"),[g,h]=(0,bs.useState)(!1);return((0,bs.useEffect)(()=>{let a=c();return()=>a()},[c]),b)?(0,br.jsx)("div",{className:"flex h-screen w-full items-center justify-center bg-gray-100 dark:bg-gray-900",children:(0,br.jsxs)("div",{className:"flex flex-col items-center",children:[(0,br.jsx)(gB,{className:"w-16 h-16 text-blue-500 animate-pulse"}),(0,br.jsx)("p",{className:"mt-4 text-lg text-gray-700 dark:text-gray-300",children:"Carregando..."})]})}):a?(0,br.jsx)(hi,{}):(0,br.jsxs)(br.Fragment,{children:["login"===e?(0,br.jsx)(hg,{onNavigateToSignup:()=>{d(),f("signup")},onNavigateToForgotPassword:()=>{d(),h(!0)}}):(0,br.jsx)(hh,{onNavigateToLogin:()=>{d(),f("login")}}),(0,br.jsx)(hf,{isOpen:g,onClose:()=>{h(!1),d()}})]})};function hk(){return(0,br.jsx)(hj,{})}a.s(["default",()=>hk],60350)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__fbf469c5._.js.map