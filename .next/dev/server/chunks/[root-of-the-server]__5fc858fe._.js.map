{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///media/elso/dev/projects/genesisEnterprise/genesis.specific/frontend/genesis-agente-tributario-ia/services/supabaseClient.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\n// Supabase configuration for Next.js environment variables\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error(\n    \"NEXT_PUBLIC_SUPABASE_URL e NEXT_PUBLIC_SUPABASE_ANON_KEY devem estar configuradas no .env.local\"\n  );\n}\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n"],"names":[],"mappings":";;;;AAAA;;AAEA,2DAA2D;AAC3D,MAAM;AACN,MAAM;AAEN;;AAMO,MAAM,WAAW,IAAA,yMAAY,EAAC,aAAa"}},
    {"offset": {"line": 62, "column": 0}, "map": {"version":3,"sources":["file:///media/elso/dev/projects/genesisEnterprise/genesis.specific/frontend/genesis-agente-tributario-ia/app/api/search/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { supabase } from '@/services/supabaseClient';\n\nexport async function POST(req: Request) {\n    try {\n        const { embedding, limit = 5, threshold = 0.7, userId } = await req.json();\n\n        if (!embedding || !Array.isArray(embedding)) {\n            return NextResponse.json(\n                { error: 'Valid embedding array is required' },\n                { status: 400 }\n            );\n        }\n\n        // Buscar chunks similares usando a função RPC do Supabase\n        const { data, error } = await supabase.rpc('match_document_chunks', {\n            query_embedding: embedding,\n            match_threshold: threshold,\n            match_count: limit,\n        });\n\n        if (error) {\n            console.error('Supabase RPC error:', error);\n            return NextResponse.json(\n                { error: 'Failed to search documents' },\n                { status: 500 }\n            );\n        }\n\n        // Enriquecer resultados com informações do documento\n        const enrichedResults = await Promise.all(\n            (data || []).map(async (chunk: any) => {\n                // Buscar informações do documento\n                const { data: docData } = await supabase\n                    .from('documents')\n                    .select('name, is_deletable')\n                    .eq('id', chunk.document_id)\n                    .single();\n\n                return {\n                    id: chunk.id,\n                    documentId: chunk.document_id,\n                    documentName: docData?.name || 'Unknown',\n                    chunkText: chunk.chunk_text,\n                    similarity: chunk.similarity,\n                    metadata: chunk.metadata,\n                    isKnowledgeBase: !docData?.is_deletable,\n                };\n            })\n        );\n\n        // Ordenar por similaridade (maior primeiro)\n        enrichedResults.sort((a, b) => b.similarity - a.similarity);\n\n        return NextResponse.json({\n            results: enrichedResults,\n            count: enrichedResults.length\n        });\n    } catch (error: any) {\n        console.error('Search error:', error);\n        return NextResponse.json(\n            { error: error.message || 'Internal server error' },\n            { status: 500 }\n        );\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAY;IACnC,IAAI;QACA,MAAM,EAAE,SAAS,EAAE,QAAQ,CAAC,EAAE,YAAY,GAAG,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,IAAI;QAExE,IAAI,CAAC,aAAa,CAAC,MAAM,OAAO,CAAC,YAAY;YACzC,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAoC,GAC7C;gBAAE,QAAQ;YAAI;QAEtB;QAEA,0DAA0D;QAC1D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,wIAAQ,CAAC,GAAG,CAAC,yBAAyB;YAChE,iBAAiB;YACjB,iBAAiB;YACjB,aAAa;QACjB;QAEA,IAAI,OAAO;YACP,QAAQ,KAAK,CAAC,uBAAuB;YACrC,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAA6B,GACtC;gBAAE,QAAQ;YAAI;QAEtB;QAEA,qDAAqD;QACrD,MAAM,kBAAkB,MAAM,QAAQ,GAAG,CACrC,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,OAAO;YACpB,kCAAkC;YAClC,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,wIAAQ,CACnC,IAAI,CAAC,aACL,MAAM,CAAC,sBACP,EAAE,CAAC,MAAM,MAAM,WAAW,EAC1B,MAAM;YAEX,OAAO;gBACH,IAAI,MAAM,EAAE;gBACZ,YAAY,MAAM,WAAW;gBAC7B,cAAc,SAAS,QAAQ;gBAC/B,WAAW,MAAM,UAAU;gBAC3B,YAAY,MAAM,UAAU;gBAC5B,UAAU,MAAM,QAAQ;gBACxB,iBAAiB,CAAC,SAAS;YAC/B;QACJ;QAGJ,4CAA4C;QAC5C,gBAAgB,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,UAAU,GAAG,EAAE,UAAU;QAE1D,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,OAAO,gBAAgB,MAAM;QACjC;IACJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwB,GAClD;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}