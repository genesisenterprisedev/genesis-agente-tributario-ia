(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,90571,e=>{"use strict";var t=function(e,r){return(t=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,r)};function r(e,r){if("function"!=typeof r&&null!==r)throw TypeError("Class extends value "+String(r)+" is not a constructor or null");function s(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}var s=function(){return(s=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function a(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&0>t.indexOf(s)&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,s=Object.getOwnPropertySymbols(e);a<s.length;a++)0>t.indexOf(s[a])&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(r[s[a]]=e[s[a]]);return r}function i(e,t,r,s){var a,i=arguments.length,n=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,s);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,r,n):a(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n}function n(e,t){return function(r,s){t(r,s,e)}}function o(e,t,r,s,a,i){function n(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var o,l=s.kind,u="getter"===l?"get":"setter"===l?"set":"value",c=!t&&e?s.static?e:e.prototype:null,d=t||(c?Object.getOwnPropertyDescriptor(c,s.name):{}),h=!1,f=r.length-1;f>=0;f--){var p={};for(var m in s)p[m]="access"===m?{}:s[m];for(var m in s.access)p.access[m]=s.access[m];p.addInitializer=function(e){if(h)throw TypeError("Cannot add initializers after decoration has completed");i.push(n(e||null))};var g=(0,r[f])("accessor"===l?{get:d.get,set:d.set}:d[u],p);if("accessor"===l){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw TypeError("Object expected");(o=n(g.get))&&(d.get=o),(o=n(g.set))&&(d.set=o),(o=n(g.init))&&a.unshift(o)}else(o=n(g))&&("field"===l?a.unshift(o):d[u]=o)}c&&Object.defineProperty(c,s.name,d),h=!0}function l(e,t,r){for(var s=arguments.length>2,a=0;a<t.length;a++)r=s?t[a].call(e,r):t[a].call(e);return s?r:void 0}function u(e){return"symbol"==typeof e?e:"".concat(e)}function c(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function d(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function h(e,t,r,s){return new(r||(r=Promise))(function(a,i){function n(e){try{l(s.next(e))}catch(e){i(e)}}function o(e){try{l(s.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(n,o)}l((s=s.apply(e,t||[])).next())})}function f(e,t){var r,s,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},n=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return n.next=o(0),n.throw=o(1),n.return=o(2),"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function o(o){return function(l){var u=[o,l];if(r)throw TypeError("Generator is already executing.");for(;n&&(n=0,u[0]&&(i=0)),i;)try{if(r=1,s&&(a=2&u[0]?s.return:u[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,u[1])).done)return a;switch(s=0,a&&(u=[2&u[0],a.value]),u[0]){case 0:case 1:a=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,s=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!a||u[1]>a[0]&&u[1]<a[3])){i.label=u[1];break}if(6===u[0]&&i.label<a[1]){i.label=a[1],a=u;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(u);break}a[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(e){u=[6,e],s=0}finally{r=a=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}}var p=Object.create?function(e,t,r,s){void 0===s&&(s=r);var a=Object.getOwnPropertyDescriptor(t,r);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,a)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]};function m(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||p(t,e,r)}function g(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function b(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,a,i=r.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)n.push(s.value)}catch(e){a={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return n}function y(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(b(arguments[t]));return e}function w(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var s=Array(e),a=0,t=0;t<r;t++)for(var i=arguments[t],n=0,o=i.length;n<o;n++,a++)s[a]=i[n];return s}function v(e,t,r){if(r||2==arguments.length)for(var s,a=0,i=t.length;a<i;a++)!s&&a in t||(s||(s=Array.prototype.slice.call(t,0,a)),s[a]=t[a]);return e.concat(s||Array.prototype.slice.call(t))}function x(e){return this instanceof x?(this.v=e,this):new x(e)}function _(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var s,a=r.apply(e,t||[]),i=[];return s=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),n("next"),n("throw"),n("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),s[Symbol.asyncIterator]=function(){return this},s;function n(e,t){a[e]&&(s[e]=function(t){return new Promise(function(r,s){i.push([e,t,r,s])>1||o(e,t)})},t&&(s[e]=t(s[e])))}function o(e,t){try{var r;(r=a[e](t)).value instanceof x?Promise.resolve(r.value.v).then(l,u):c(i[0][2],r)}catch(e){c(i[0][3],e)}}function l(e){o("next",e)}function u(e){o("throw",e)}function c(e,t){e(t),i.shift(),i.length&&o(i[0][0],i[0][1])}}function E(e){var t,r;return t={},s("next"),s("throw",function(e){throw e}),s("return"),t[Symbol.iterator]=function(){return this},t;function s(s,a){t[s]=e[s]?function(t){return(r=!r)?{value:x(e[s](t)),done:!1}:a?a(t):t}:a}}function k(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=g(e),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=e[r]&&function(t){return new Promise(function(s,a){var i,n,o;i=s,n=a,o=(t=e[r](t)).done,Promise.resolve(t.value).then(function(e){i({value:e,done:o})},n)})}}}function j(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var S=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},T=function(e){return(T=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)};function O(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=T(e),s=0;s<r.length;s++)"default"!==r[s]&&p(t,e,r[s]);return S(t,e),t}function C(e){return e&&e.__esModule?e:{default:e}}function A(e,t,r,s){if("a"===r&&!s)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)}function N(e,t,r,s,a){if("m"===s)throw TypeError("Private method is not writable");if("a"===s&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,r):a?a.value=r:t.set(e,r),r}function R(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function I(e,t,r){if(null!=t){var s,a;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object expected.");if(r){if(!Symbol.asyncDispose)throw TypeError("Symbol.asyncDispose is not defined.");s=t[Symbol.asyncDispose]}if(void 0===s){if(!Symbol.dispose)throw TypeError("Symbol.dispose is not defined.");s=t[Symbol.dispose],r&&(a=s)}if("function"!=typeof s)throw TypeError("Object not disposable.");a&&(s=function(){try{a.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:s,async:r})}else r&&e.stack.push({async:!0});return t}var P="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var s=Error(r);return s.name="SuppressedError",s.error=e,s.suppressed=t,s};function L(e){function t(t){e.error=e.hasError?new P(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var r,s=0;return function a(){for(;r=e.stack.pop();)try{if(!r.async&&1===s)return s=0,e.stack.push(r),Promise.resolve().then(a);if(r.dispose){var i=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(i).then(a,function(e){return t(e),a()})}else s|=1}catch(e){t(e)}if(1===s)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}function U(e,t){return"string"==typeof e&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(e,r,s,a,i){return r?t?".jsx":".js":!s||a&&i?s+a+"."+i.toLowerCase()+"js":e}):e}let $={__extends:r,__assign:s,__rest:a,__decorate:i,__param:n,__esDecorate:o,__runInitializers:l,__propKey:u,__setFunctionName:c,__metadata:d,__awaiter:h,__generator:f,__createBinding:p,__exportStar:m,__values:g,__read:b,__spread:y,__spreadArrays:w,__spreadArray:v,__await:x,__asyncGenerator:_,__asyncDelegator:E,__asyncValues:k,__makeTemplateObject:j,__importStar:O,__importDefault:C,__classPrivateFieldGet:A,__classPrivateFieldSet:N,__classPrivateFieldIn:R,__addDisposableResource:I,__disposeResources:L,__rewriteRelativeImportExtension:U};e.s(["__addDisposableResource",()=>I,"__assign",()=>s,"__asyncDelegator",()=>E,"__asyncGenerator",()=>_,"__asyncValues",()=>k,"__await",()=>x,"__awaiter",()=>h,"__classPrivateFieldGet",()=>A,"__classPrivateFieldIn",()=>R,"__classPrivateFieldSet",()=>N,"__createBinding",()=>p,"__decorate",()=>i,"__disposeResources",()=>L,"__esDecorate",()=>o,"__exportStar",()=>m,"__extends",()=>r,"__generator",()=>f,"__importDefault",()=>C,"__importStar",()=>O,"__makeTemplateObject",()=>j,"__metadata",()=>d,"__param",()=>n,"__propKey",()=>u,"__read",()=>b,"__rest",()=>a,"__rewriteRelativeImportExtension",()=>U,"__runInitializers",()=>l,"__setFunctionName",()=>c,"__spread",()=>y,"__spreadArray",()=>v,"__spreadArrays",()=>w,"__values",()=>g,"default",0,$])},54385,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}},43173,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let s=e.r(90571).__importDefault(e.r(54385));r.default=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!=(t=e.shouldThrowOnError)&&t,this.signal=e.signal,this.isMaybeSingle=null!=(r=e.isMaybeSingle)&&r,e.fetch?this.fetch=e.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,r,a,i;let n=null,o=null,l=null,u=e.status,c=e.statusText;if(e.ok){if("HEAD"!==this.method){let r=await e.text();""===r||(o="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null==(t=this.headers.get("Accept"))?void 0:t.includes("application/vnd.pgrst.plan+text"))?r:JSON.parse(r))}let s=null==(r=this.headers.get("Prefer"))?void 0:r.match(/count=(exact|planned|estimated)/),i=null==(a=e.headers.get("content-range"))?void 0:a.split("/");s&&i&&i.length>1&&(l=parseInt(i[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(n={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,l=null,u=406,c="Not Acceptable"):o=1===o.length?o[0]:null)}else{let t=await e.text();try{n=JSON.parse(t),Array.isArray(n)&&404===e.status&&(o=[],n=null,u=200,c="OK")}catch(r){404===e.status&&""===t?(u=204,c="No Content"):n={message:t}}if(n&&this.isMaybeSingle&&(null==(i=null==n?void 0:n.details)?void 0:i.includes("0 rows"))&&(n=null,u=200,c="OK"),n&&this.shouldThrowOnError)throw new s.default(n)}return{error:n,data:o,count:l,status:u,statusText:c}});return this.shouldThrowOnError||(r=r.catch(e=>{var t,r,s,a,i,n;let o="",l=null==e?void 0:e.cause;if(l){let i=null!=(t=null==l?void 0:l.message)?t:"",n=null!=(r=null==l?void 0:l.code)?r:"";o=`${null!=(s=null==e?void 0:e.name)?s:"FetchError"}: ${null==e?void 0:e.message}

Caused by: ${null!=(a=null==l?void 0:l.name)?a:"Error"}: ${i}`,n&&(o+=` (${n})`),(null==l?void 0:l.stack)&&(o+=`
${l.stack}`)}else o=null!=(i=null==e?void 0:e.stack)?i:"";return{error:{message:`${null!=(n=null==e?void 0:e.name)?n:"FetchError"}: ${null==e?void 0:e.message}`,details:o,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}}},82191,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let s=e.r(90571).__importDefault(e.r(43173));class a extends s.default{select(e){let t=!1,r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:a=s}={}){let i=a?`${a}.order`:"order",n=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${n?`${n},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){let s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){let a=void 0===s?"offset":`${s}.offset`,i=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(i,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:a=!1,format:i="text"}={}){var n;let o=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,a?"wal":null].filter(Boolean).join("|"),l=null!=(n=this.headers.get("Accept"))?n:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${o};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}}r.default=a},14633,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let s=e.r(90571).__importDefault(e.r(82191)),a=RegExp("[,()]");class i extends s.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}regexMatch(e,t){return this.url.searchParams.append(e,`match.${t}`),this}regexIMatch(e,t){return this.url.searchParams.append(e,`imatch.${t}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}isDistinct(e,t){return this.url.searchParams.append(e,`isdistinct.${t}`),this}in(e,t){let r=Array.from(new Set(t)).map(e=>"string"==typeof e&&a.test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let a="";"plain"===s?a="pl":"phrase"===s?a="ph":"websearch"===s&&(a="w");let i=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${a}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){let s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}}r.default=i},38290,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let s=e.r(90571).__importDefault(e.r(14633));r.default=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=s}select(e,t){let{head:r=!1,count:a}=null!=t?t:{},i=!1,n=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!i?"":('"'===e&&(i=!i),e)).join("");return this.url.searchParams.set("select",n),a&&this.headers.append("Prefer",`count=${a}`),new s.default({method:r?"HEAD":"GET",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var a;if(t&&this.headers.append("Prefer",`count=${t}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new s.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!=(a=this.fetch)?a:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:a,defaultToNull:i=!0}={}){var n;if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),void 0!==t&&this.url.searchParams.set("on_conflict",t),a&&this.headers.append("Prefer",`count=${a}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new s.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!=(n=this.fetch)?n:fetch})}update(e,{count:t}={}){var r;return t&&this.headers.append("Prefer",`count=${t}`),new s.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!=(r=this.fetch)?r:fetch})}delete({count:e}={}){var t;return e&&this.headers.append("Prefer",`count=${e}`),new s.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!=(t=this.fetch)?t:fetch})}}},2259,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});let s=e.r(90571),a=s.__importDefault(e.r(38290)),i=s.__importDefault(e.r(14633));class n{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=s}from(e){if(!e||"string"!=typeof e||""===e.trim())throw Error("Invalid relation name: relation must be a non-empty string.");let t=new URL(`${this.url}/${e}`);return new a.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new n(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:a}={}){var n;let o,l,u=new URL(`${this.url}/rpc/${e}`);r||s?(o=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{u.searchParams.append(e,t)})):(o="POST",l=t);let c=new Headers(this.headers);return a&&c.set("Prefer",`count=${a}`),new i.default({method:o,url:u,headers:c,schema:this.schemaName,body:l,fetch:null!=(n=this.fetch)?n:fetch})}}r.default=n},82215,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.PostgrestError=r.PostgrestBuilder=r.PostgrestTransformBuilder=r.PostgrestFilterBuilder=r.PostgrestQueryBuilder=r.PostgrestClient=void 0;let s=e.r(90571),a=s.__importDefault(e.r(2259));r.PostgrestClient=a.default;let i=s.__importDefault(e.r(38290));r.PostgrestQueryBuilder=i.default;let n=s.__importDefault(e.r(14633));r.PostgrestFilterBuilder=n.default;let o=s.__importDefault(e.r(82191));r.PostgrestTransformBuilder=o.default;let l=s.__importDefault(e.r(43173));r.PostgrestBuilder=l.default;let u=s.__importDefault(e.r(54385));r.PostgrestError=u.default,r.default={PostgrestClient:a.default,PostgrestQueryBuilder:i.default,PostgrestFilterBuilder:n.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:l.default,PostgrestError:u.default}},67034,(e,t,r)=>{var s={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),r=t[0],s=t[1];return(r+s)*3/4-s},t.toByteArray=function(e){var t,r,i=l(e),n=i[0],o=i[1],u=new a((n+o)*3/4-o),c=0,d=o>0?n-4:n;for(r=0;r<d;r+=4)t=s[e.charCodeAt(r)]<<18|s[e.charCodeAt(r+1)]<<12|s[e.charCodeAt(r+2)]<<6|s[e.charCodeAt(r+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===o&&(t=s[e.charCodeAt(r)]<<2|s[e.charCodeAt(r+1)]>>4,u[c++]=255&t),1===o&&(t=s[e.charCodeAt(r)]<<10|s[e.charCodeAt(r+1)]<<4|s[e.charCodeAt(r+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,s=e.length,a=s%3,i=[],n=0,o=s-a;n<o;n+=16383)i.push(function(e,t,s){for(var a,i=[],n=t;n<s;n+=3)a=(e[n]<<16&0xff0000)+(e[n+1]<<8&65280)+(255&e[n+2]),i.push(r[a>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return i.join("")}(e,n,n+16383>o?o:n+16383));return 1===a?i.push(r[(t=e[s-1])>>2]+r[t<<4&63]+"=="):2===a&&i.push(r[(t=(e[s-2]<<8)+e[s-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),i.join("")};for(var r=[],s=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,o=i.length;n<o;++n)r[n]=i[n],s[i.charCodeAt(n)]=n;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var s=r===t?0:4-r%4;return[r,s]}s[45]=62,s[95]=63},72:function(e,t,r){"use strict";var s=r(675),a=r(783),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function n(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,r){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return c(e)}return l(e,t,r)}function l(e,t,r){if("string"==typeof e){var s=e,a=t;if(("string"!=typeof a||""===a)&&(a="utf8"),!o.isEncoding(a))throw TypeError("Unknown encoding: "+a);var i=0|f(s,a),l=n(i),u=l.write(s,a);return u!==i&&(l=l.slice(0,u)),l}if(ArrayBuffer.isView(e))return d(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(C(e,ArrayBuffer)||e&&C(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(C(e,SharedArrayBuffer)||e&&C(e.buffer,SharedArrayBuffer)))return function(e,t,r){var s;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(s=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),o.prototype),s}(e,t,r);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var c=e.valueOf&&e.valueOf();if(null!=c&&c!==e)return o.from(c,t,r);var p=function(e){if(o.isBuffer(e)){var t=0|h(e.length),r=n(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?n(0):d(e):"Buffer"===e.type&&Array.isArray(e.data)?d(e.data):void 0}(e);if(p)return p;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function c(e){return u(e),n(e<0?0:0|h(e))}function d(e){for(var t=e.length<0?0:0|h(e.length),r=n(t),s=0;s<t;s+=1)r[s]=255&e[s];return r}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,r){return l(e,t,r)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,r){return(u(e),e<=0)?n(e):void 0!==t?"string"==typeof r?n(e).fill(t,r):n(e).fill(t):n(e)},o.allocUnsafe=function(e){return c(e)},o.allocUnsafeSlow=function(e){return c(e)};function h(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||C(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,s=arguments.length>2&&!0===arguments[2];if(!s&&0===r)return 0;for(var a=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return T(e).length;default:if(a)return s?-1:j(e).length;t=(""+t).toLowerCase(),a=!0}}function p(e,t,r){var a,i,n,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,r){var s=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>s)&&(r=s);for(var a="",i=t;i<r;++i)a+=A[e[i]];return a}(this,t,r);case"utf8":case"utf-8":return y(this,t,r);case"ascii":return function(e,t,r){var s="";r=Math.min(e.length,r);for(var a=t;a<r;++a)s+=String.fromCharCode(127&e[a]);return s}(this,t,r);case"latin1":case"binary":return function(e,t,r){var s="";r=Math.min(e.length,r);for(var a=t;a<r;++a)s+=String.fromCharCode(e[a]);return s}(this,t,r);case"base64":return a=this,i=t,n=r,0===i&&n===a.length?s.fromByteArray(a):s.fromByteArray(a.slice(i,n));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,r){for(var s=e.slice(t,r),a="",i=0;i<s.length;i+=2)a+=String.fromCharCode(s[i]+256*s[i+1]);return a}(this,t,r);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function m(e,t,r){var s=e[t];e[t]=e[r],e[r]=s}function g(e,t,r,s,a){var i;if(0===e.length)return -1;if("string"==typeof r?(s=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(i=r*=1)!=i&&(r=a?0:e.length-1),r<0&&(r=e.length+r),r>=e.length)if(a)return -1;else r=e.length-1;else if(r<0)if(!a)return -1;else r=0;if("string"==typeof t&&(t=o.from(t,s)),o.isBuffer(t))return 0===t.length?-1:b(e,t,r,s,a);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(a)return Uint8Array.prototype.indexOf.call(e,t,r);else return Uint8Array.prototype.lastIndexOf.call(e,t,r);return b(e,[t],r,s,a)}throw TypeError("val must be string, number or Buffer")}function b(e,t,r,s,a){var i,n=1,o=e.length,l=t.length;if(void 0!==s&&("ucs2"===(s=String(s).toLowerCase())||"ucs-2"===s||"utf16le"===s||"utf-16le"===s)){if(e.length<2||t.length<2)return -1;n=2,o/=2,l/=2,r/=2}function u(e,t){return 1===n?e[t]:e.readUInt16BE(t*n)}if(a){var c=-1;for(i=r;i<o;i++)if(u(e,i)===u(t,-1===c?0:i-c)){if(-1===c&&(c=i),i-c+1===l)return c*n}else -1!==c&&(i-=i-c),c=-1}else for(r+l>o&&(r=o-l),i=r;i>=0;i--){for(var d=!0,h=0;h<l;h++)if(u(e,i+h)!==u(t,h)){d=!1;break}if(d)return i}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(C(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),C(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,s=t.length,a=0,i=Math.min(r,s);a<i;++a)if(e[a]!==t[a]){r=e[a],s=t[a];break}return r<s?-1:+(s<r)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(r=0,t=0;r<e.length;++r)t+=e[r].length;var r,s=o.allocUnsafe(t),a=0;for(r=0;r<e.length;++r){var i=e[r];if(C(i,Uint8Array)&&(i=o.from(i)),!o.isBuffer(i))throw TypeError('"list" argument must be an Array of Buffers');i.copy(s,a),a+=i.length}return s},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?y(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(e+=" ... "),"<Buffer "+e+">"},i&&(o.prototype[i]=o.prototype.inspect),o.prototype.compare=function(e,t,r,s,a){if(C(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===s&&(s=0),void 0===a&&(a=this.length),t<0||r>e.length||s<0||a>this.length)throw RangeError("out of range index");if(s>=a&&t>=r)return 0;if(s>=a)return -1;if(t>=r)return 1;if(t>>>=0,r>>>=0,s>>>=0,a>>>=0,this===e)return 0;for(var i=a-s,n=r-t,l=Math.min(i,n),u=this.slice(s,a),c=e.slice(t,r),d=0;d<l;++d)if(u[d]!==c[d]){i=u[d],n=c[d];break}return i<n?-1:+(n<i)},o.prototype.includes=function(e,t,r){return -1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return g(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return g(this,e,t,r,!1)};function y(e,t,r){r=Math.min(e.length,r);for(var s=[],a=t;a<r;){var i,n,o,l,u=e[a],c=null,d=u>239?4:u>223?3:u>191?2:1;if(a+d<=r)switch(d){case 1:u<128&&(c=u);break;case 2:(192&(i=e[a+1]))==128&&(l=(31&u)<<6|63&i)>127&&(c=l);break;case 3:i=e[a+1],n=e[a+2],(192&i)==128&&(192&n)==128&&(l=(15&u)<<12|(63&i)<<6|63&n)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:i=e[a+1],n=e[a+2],o=e[a+3],(192&i)==128&&(192&n)==128&&(192&o)==128&&(l=(15&u)<<18|(63&i)<<12|(63&n)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,d=1):c>65535&&(c-=65536,s.push(c>>>10&1023|55296),c=56320|1023&c),s.push(c),a+=d}var h=s,f=h.length;if(f<=4096)return String.fromCharCode.apply(String,h);for(var p="",m=0;m<f;)p+=String.fromCharCode.apply(String,h.slice(m,m+=4096));return p}function w(e,t,r){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>r)throw RangeError("Trying to access beyond buffer length")}function v(e,t,r,s,a,i){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw RangeError('"value" argument is out of bounds');if(r+s>e.length)throw RangeError("Index out of range")}function x(e,t,r,s,a,i){if(r+s>e.length||r<0)throw RangeError("Index out of range")}function _(e,t,r,s,i){return t*=1,r>>>=0,i||x(e,t,r,4,34028234663852886e22,-34028234663852886e22),a.write(e,t,r,s,23,4),r+4}function E(e,t,r,s,i){return t*=1,r>>>=0,i||x(e,t,r,8,17976931348623157e292,-17976931348623157e292),a.write(e,t,r,s,52,8),r+8}o.prototype.write=function(e,t,r,s){if(void 0===t)s="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)s=t,r=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(r)?(r>>>=0,void 0===s&&(s="utf8")):(s=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var a,i,n,o,l,u,c,d,h=this.length-t;if((void 0===r||r>h)&&(r=h),e.length>0&&(r<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");s||(s="utf8");for(var f=!1;;)switch(s){case"hex":return function(e,t,r,s){r=Number(r)||0;var a=e.length-r;s?(s=Number(s))>a&&(s=a):s=a;var i=t.length;s>i/2&&(s=i/2);for(var n=0;n<s;++n){var o,l=parseInt(t.substr(2*n,2),16);if((o=l)!=o)break;e[r+n]=l}return n}(this,e,t,r);case"utf8":case"utf-8":return a=t,i=r,O(j(e,this.length-a),this,a,i);case"ascii":return n=t,o=r,O(S(e),this,n,o);case"latin1":case"binary":return function(e,t,r,s){return O(S(t),e,r,s)}(this,e,t,r);case"base64":return l=t,u=r,O(T(e),this,l,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return c=t,d=r,O(function(e,t){for(var r,s,a=[],i=0;i<e.length&&!((t-=2)<0);++i)s=(r=e.charCodeAt(i))>>8,a.push(r%256),a.push(s);return a}(e,this.length-c),this,c,d);default:if(f)throw TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var s=this.subarray(e,t);return Object.setPrototypeOf(s,o.prototype),s},o.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var s=this[e],a=1,i=0;++i<t&&(a*=256);)s+=this[e+i]*a;return s},o.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var s=this[e+--t],a=1;t>0&&(a*=256);)s+=this[e+--t]*a;return s},o.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var s=this[e],a=1,i=0;++i<t&&(a*=256);)s+=this[e+i]*a;return s>=(a*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||w(e,t,this.length);for(var s=t,a=1,i=this[e+--s];s>0&&(a*=256);)i+=this[e+--s]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},o.prototype.readInt8=function(e,t){return(e>>>=0,t||w(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?0xffff0000|r:r},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),a.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),a.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),a.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),a.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,s){if(e*=1,t>>>=0,r>>>=0,!s){var a=Math.pow(2,8*r)-1;v(this,e,t,r,a,0)}var i=1,n=0;for(this[t]=255&e;++n<r&&(i*=256);)this[t+n]=e/i&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,s){if(e*=1,t>>>=0,r>>>=0,!s){var a=Math.pow(2,8*r)-1;v(this,e,t,r,a,0)}var i=r-1,n=1;for(this[t+i]=255&e;--i>=0&&(n*=256);)this[t+i]=e/n&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,r,s){if(e*=1,t>>>=0,!s){var a=Math.pow(2,8*r-1);v(this,e,t,r,a-1,-a)}var i=0,n=1,o=0;for(this[t]=255&e;++i<r&&(n*=256);)e<0&&0===o&&0!==this[t+i-1]&&(o=1),this[t+i]=(e/n|0)-o&255;return t+r},o.prototype.writeIntBE=function(e,t,r,s){if(e*=1,t>>>=0,!s){var a=Math.pow(2,8*r-1);v(this,e,t,r,a-1,-a)}var i=r-1,n=1,o=0;for(this[t+i]=255&e;--i>=0&&(n*=256);)e<0&&0===o&&0!==this[t+i+1]&&(o=1),this[t+i]=(e/n|0)-o&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,r){return e*=1,t>>>=0,r||v(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,r){return _(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return _(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return E(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return E(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,s){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(r||(r=0),s||0===s||(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<r&&(s=r),s===r||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(s<0)throw RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-r&&(s=e.length-t+r);var a=s-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,s);else if(this===e&&r<t&&t<s)for(var i=a-1;i>=0;--i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,s),t);return a},o.prototype.fill=function(e,t,r,s){if("string"==typeof e){if("string"==typeof t?(s=t,t=0,r=this.length):"string"==typeof r&&(s=r,r=this.length),void 0!==s&&"string"!=typeof s)throw TypeError("encoding must be a string");if("string"==typeof s&&!o.isEncoding(s))throw TypeError("Unknown encoding: "+s);if(1===e.length){var a,i=e.charCodeAt(0);("utf8"===s&&i<128||"latin1"===s)&&(e=i)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw RangeError("Out of range index");if(r<=t)return this;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(a=t;a<r;++a)this[a]=e;else{var n=o.isBuffer(e)?e:o.from(e,s),l=n.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<r-t;++a)this[a+t]=n[a%l]}return this};var k=/[^+/0-9A-Za-z-_]/g;function j(e,t){t=t||1/0;for(var r,s=e.length,a=null,i=[],n=0;n<s;++n){if((r=e.charCodeAt(n))>55295&&r<57344){if(!a){if(r>56319||n+1===s){(t-=3)>-1&&i.push(239,191,189);continue}a=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),a=r;continue}r=(a-55296<<10|r-56320)+65536}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return i}function S(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function T(e){return s.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(k,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function O(e,t,r,s){for(var a=0;a<s&&!(a+r>=t.length)&&!(a>=e.length);++a)t[a+r]=e[a];return a}function C(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var A=function(){for(var e="0123456789abcdef",t=Array(256),r=0;r<16;++r)for(var s=16*r,a=0;a<16;++a)t[s+a]=e[r]+e[a];return t}()},783:function(e,t){t.read=function(e,t,r,s,a){var i,n,o=8*a-s-1,l=(1<<o)-1,u=l>>1,c=-7,d=r?a-1:0,h=r?-1:1,f=e[t+d];for(d+=h,i=f&(1<<-c)-1,f>>=-c,c+=o;c>0;i=256*i+e[t+d],d+=h,c-=8);for(n=i&(1<<-c)-1,i>>=-c,c+=s;c>0;n=256*n+e[t+d],d+=h,c-=8);if(0===i)i=1-u;else{if(i===l)return n?NaN:1/0*(f?-1:1);n+=Math.pow(2,s),i-=u}return(f?-1:1)*n*Math.pow(2,i-s)},t.write=function(e,t,r,s,a,i){var n,o,l,u=8*i-a-1,c=(1<<u)-1,d=c>>1,h=5960464477539062e-23*(23===a),f=s?0:i-1,p=s?1:-1,m=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),n=c):(n=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-n))<1&&(n--,l*=2),n+d>=1?t+=h/l:t+=h*Math.pow(2,1-d),t*l>=2&&(n++,l/=2),n+d>=c?(o=0,n=c):n+d>=1?(o=(t*l-1)*Math.pow(2,a),n+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,a),n=0));a>=8;e[r+f]=255&o,f+=p,o/=256,a-=8);for(n=n<<a|o,u+=a;u>0;e[r+f]=255&n,f+=p,n/=256,u-=8);e[r+f-p]|=128*m}}},a={};function i(e){var t=a[e];if(void 0!==t)return t.exports;var r=a[e]={exports:{}},n=!0;try{s[e](r,r.exports,i),n=!1}finally{n&&delete a[e]}return r.exports}i.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=i(72)},31713,e=>{"use strict";var t,r,s,a,i,n,o,l,u,c,d,h,f,p,m,g,b,y,w,v,x,_,E,k,j=e.i(43476),S=e.i(71645);let T=e=>{let t,r=new Set,s=(e,s)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=s?s:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,i={setState:s,getState:a,getInitialState:()=>n,subscribe:e=>(r.add(e),()=>r.delete(e))},n=t=e(s,a,i);return i},O=e=>{let t=e?T(e):T,r=e=>(function(e,t=e=>e){let r=S.default.useSyncExternalStore(e.subscribe,S.default.useCallback(()=>t(e.getState()),[e,t]),S.default.useCallback(()=>t(e.getInitialState()),[e,t]));return S.default.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},C=e=>e?O(e):O;var A=e.i(47167);let N=`${"https://api.openrouter.ai".replace(/\/$/,"")}/api/v1/chat/completions`;async function R(e,t){let r=A.default.env.NEXT_PUBLIC_OPENROUTER_MODEL||t,s=await fetch(N,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer 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"},body:JSON.stringify({model:r,messages:[{role:"user",content:e}]})});if(!s.ok){let e=await s.text();throw Error("OpenRouter request failed with status "+s.status+": "+e)}let a=await s.json();return a.choices?.[0]?.message?.content??""}let I="openai/gpt-4o-mini",P="google/gemini-2.0-flash-001",L=`Voc\xea \xe9 o "G\xeanesis", um assistente de IA especialista em tributa\xe7\xe3o brasileira. Sua principal fonte de conhecimento s\xe3o os documentos fornecidos no contexto. Responda \xe0s perguntas de forma clara, informativa e profissional, priorizando sempre as informa\xe7\xf5es contidas nesses documentos. Quando o contexto n\xe3o for suficiente, use seu conhecimento geral e a busca na web para complementar a resposta. Sempre cite as fontes da web que utilizar.`,U=`Voc\xea \xe9 um programador especialista s\xeanior, fluente em Python e Delphi, com profundo conhecimento em regras tribut\xe1rias e fiscais. Sua tarefa \xe9 gerar fun\xe7\xf5es e trechos de c\xf3digo claros, eficientes e bem documentados para resolver problemas tribut\xe1rios. Sempre que poss\xedvel, adicione coment\xe1rios explicando a l\xf3gica e o c\xe1lculo fiscal implementado. Use blocos de c\xf3digo markdown para formatar sua resposta.`,$=`Voc\xea \xe9 um especialista em otimiza\xe7\xe3o de buscas e prompts. Sua tarefa \xe9 analisar a pergunta do usu\xe1rio e, em vez de respond\xea-la diretamente, sugerir 3 maneiras alternativas e mais eficazes de formular a mesma pergunta para obter melhores resultados de um assistente de IA fiscal. Apresente as sugest\xf5es em uma lista numerada, cada uma com uma breve explica\xe7\xe3o do porqu\xea a nova formula\xe7\xe3o \xe9 melhor. Use markdown para formatar a lista.`;async function D(e){return console.warn("Using mock embeddings. Replace with a real embedding model API call."),e.map(()=>Array(768).fill(0).map(()=>2*Math.random()-1))}async function B(e){try{let t=`Gere um t\xedtulo curto e descritivo (3-5 palavras) para uma conversa que come\xe7a com a seguinte pergunta do usu\xe1rio. Responda apenas com o t\xedtulo. Pergunta: "${e}"`,r=(await R(t,P)).trim().replace(/["']/g,"");if(!r)return console.warn("Gemini title generation returned empty response."),e.substring(0,30)+"...";return r}catch(t){return console.error("Error generating title:",t),e.substring(0,30)+"..."}}async function M(e,t,r=!1){return{text:await R(t,e),sources:Array.from(new Map([].map(e=>[e.uri,e])).values())}}async function q(e){return new Promise((t,r)=>{let s=new FileReader;s.onload=e=>{t(e.target?.result)},s.onerror=e=>{r(e)},s.readAsText(e)})}async function F(e){if("undefined"==typeof pdfjsLib||"function"!=typeof pdfjsLib.getDocument)throw Error("A biblioteca PDF (pdf.js) não foi carregada corretamente. Verifique a conexão com a internet ou recarregue a página.");return new Promise((t,r)=>{let s=new FileReader;s.onload=async e=>{if(!e.target?.result)return r(Error("Falha ao ler o arquivo PDF."));try{let r=new Uint8Array(e.target.result),s=await pdfjsLib.getDocument({data:r}).promise,a="";for(let e=1;e<=s.numPages;e++){let t=await s.getPage(e),r=(await t.getTextContent()).items.map(e=>e.str).join(" ");a+=r+"\n\n"}t(a.trim())}catch(e){console.error("Erro ao analisar o PDF:",e),r(Error("O arquivo PDF está corrompido ou não pôde ser lido."))}},s.onerror=e=>{r(e)},s.readAsArrayBuffer(e)})}async function z(e,t,r){let s=function(e){let t=[];if(!e)return t;let r=0;for(;r<e.length;){let s=e.substring(r,r+1e3);t.push(s),r+=800}return t}(e);if(0===s.length)return{id:`${t}-${Date.now()}`,name:t,chunks:[],isDeletable:r,content:e};let a=await D(s),i=s.map((e,t)=>({text:e,embedding:a[t]}));return{id:`${t}-${Date.now()}`,name:t,chunks:i,isDeletable:r,content:e}}async function W(e){let t="",r=e.type,s=e.name.toLowerCase();if("application/pdf"===r||s.endsWith(".pdf"))t=await F(e);else if("text/plain"===r||"text/markdown"===r||s.endsWith(".txt")||s.endsWith(".md"))t=await q(e);else throw Error("Tipo de arquivo não suportado. Por favor, envie .txt, .md ou .pdf.");return z(t,e.name,!0)}let V=(e,t)=>{if(e.length!==t.length)return 0;let r=0,s=0,a=0;for(let i=0;i<e.length;i++)r+=e[i]*t[i],s+=e[i]*e[i],a+=t[i]*t[i];let i=Math.sqrt(s)*Math.sqrt(a);return 0===i?0:r/i},H=`
Um "agente que tem conhecimento sobre tributa\xe7\xe3o fiscal do Brasil" \xe9 um profissional ou uma empresa especializada em entender, interpretar e aplicar as complexas regras do sistema tribut\xe1rio brasileiro.

No Brasil, a tributa\xe7\xe3o \xe9 notoriamente uma das mais complexas do mundo, envolvendo tr\xeas esferas de governo (Federal, Estadual e Municipal), cada uma com seus pr\xf3prios impostos, regras e prazos. Um agente com este conhecimento \xe9, portanto, uma pe\xe7a-chave para qualquer empresa ou at\xe9 mesmo para pessoas f\xedsicas com patrim\xf4nio mais significativo.

Vamos detalhar o que este agente **\xe9**, o que ele **faz** e o que ele **precisa saber**.

---

### 1. Quem \xe9 este Agente? (Os Perfis)

Este agente pode ser um profissional com diferentes forma\xe7\xf5es, mas com uma especializa\xe7\xe3o em tributos. Os mais comuns s\xe3o:

*   **Contador / Empresa de Contabilidade:** \xc9 o profissional mais pr\xf3ximo do dia a dia das empresas. Respons\xe1vel pela escritura\xe7\xe3o cont\xe1bil, apura\xe7\xe3o dos impostos e entrega das obriga\xe7\xf5es acess\xf3rias.
*   **Advogado Tributarista:** Focado na interpreta\xe7\xe3o da lei, na defesa do cliente em processos administrativos e judiciais (contencioso tribut\xe1rio) e na emiss\xe3o de pareceres legais para opera\xe7\xf5es complexas.
*   **Consultor Tribut\xe1rio:** Pode ser um contador, advogado ou economista com especializa\xe7\xe3o. Geralmente atua de forma estrat\xe9gica, focado em **planejamento tribut\xe1rio** para otimizar e reduzir a carga de impostos de forma legal.
*   **Auditor Fiscal (do lado do Fisco):** \xc9 o agente do governo que fiscaliza o cumprimento das obriga\xe7\xf5es tribut\xe1rias. Conhecer seu trabalho \xe9 fundamental para se preparar para uma fiscaliza\xe7\xe3o.
*   **Gestor Financeiro / Empres\xe1rio:** Embora n\xe3o seja um especialista, um bom gestor precisa ter um conhecimento s\xf3lido dos basics de tributa\xe7\xe3o para tomar decis\xf5es de neg\xf3cio conscientes.

---

### 2. O que ele Faz? (As Principais Atividades)

As fun\xe7\xf5es deste agente v\xe3o muito al\xe9m de apenas "calcular e pagar impostos". Elas se dividem em \xe1reas estrat\xe9gicas e operacionais:

#### a) Planejamento Tribut\xe1rio
*   **O que \xe9:** A atividade mais estrat\xe9gica e valiosa. Consiste em estudar a legisla\xe7\xe3o para encontrar a forma legal mais eficiente de uma empresa operar, pagando menos impostos sem sonegar.
*   **Exemplos:** Escolher o melhor regime tribut\xe1rio (Simples Nacional, Lucro Presumido ou Lucro Real), estruturar opera\xe7\xf5es de fus\xe3o e aquisi\xe7\xe3o, decidir sobre a localiza\xe7\xe3o de uma nova f\xe1brica (levando em conta os benef\xedcios fiscais estaduais).

#### b) Compliance Tribut\xe1rio (Conformidade)
*   **O que \xe9:** \xc9 a \xe1rea operacional que garante que a empresa esteja em dia com todas as suas obriga\xe7\xf5es.
*   **Atividades:**
    *   Apurar e calcular os impostos (PIS, COFINS, IRPJ, ICMS, ISS, etc.).
    *   Preencher e entregar as declara\xe7\xf5es e obriga\xe7\xf5es acess\xf3rias (SPEDs, DCTF, GFIP, GIA, etc.).
    *   Emitir guias de pagamento (DARF, GARE, etc.) e garantir o pagamento dentro do prazo.
    *   Manter a documenta\xe7\xe3o fiscal em ordem.

#### c) Contencioso Tribut\xe1rio
*   **O que \xe9:** A \xe1rea de defesa da empresa. Quando h\xe1 uma autua\xe7\xe3o ou cobran\xe7a indevida por parte do Fisco, este agente atua para reverter a situa\xe7\xe3o.
*   **Atividades:**
    *   Apresentar defesas administrativas.
    *   Negotiar parcelamentos de d\xedvidas.
    *   Entrar com a\xe7\xf5es judiciais para discutir a cobran\xe7a de tributos.

#### d) Consultoria e Assessoria
*   **O que \xe9:** Dar suporte ao dia a dia e a decis\xf5es espec\xedficas.
*   **Exemplos:** "Posso deduzir esta despesa?", "Qual o impacto tribut\xe1rio de vender este produto para outro estado?", "Como tratar este imposto na contabilidade?".

---

### 3. O que ele Precisa Saber? (O Conhecimento Essencial)

O conhecimento deste agente \xe9 vasto e precisa ser constantemente atualizado. Os pilares s\xe3o:

*   **Sistema Tribut\xe1rio Nacional:** Entender a divis\xe3o de compet\xeancias entre Uni\xe3o, Estados e Munic\xedpios.
*   **Regimes Tribut\xe1rios:** Dominar as regras do **Simples Nacional**, **Lucro Presumido** e **Lucro Real**, sabendo qual a vantagem de cada um para um tipo espec\xedfico de empresa.
*   **Principais Tributos:**
    *   **Federais:** IRPJ (Imposto de Renda da Pessoa Jur\xeddrica), CSLL (Contribui\xe7\xe3o Social sobre o Lucro L\xedquido), PIS, COFINS, IPI (Imposto sobre Produtos Industrializados).
    *   **Estaduais:** ICMS (Imposto sobre Circula\xe7\xe3o de Mercadorias e Servi\xe7os).
    *   **Municipais:** ISS (Imposto Sobre Servi\xe7os).
*   **Obriga\xe7\xf5es Acess\xf3rias:** Conhecer a fundo o SPED (Sistema P\xfablico de Escritura\xe7\xe3o Digital) e suas vertentes (EFD-Contribui\xe7\xf5es, EFD-ICMS/IPI, ECF, etc.).
*   **Legisla\xe7\xe3o e Jurisprud\xeancia:** A lei tribut\xe1ria muda constantemente. Al\xe9m das leis, \xe9 preciso acompanhar as decis\xf5es dos tribunais (jurisprud\xeancia), que definem como a lei \xe9 interpretada na pr\xe1tica.
*   **\xc1reas Correlatas:** Ter no\xe7\xf5es de Contabilidade, Direito Empresarial e Finan\xe7as, pois a tributa\xe7\xe3o impacta todas essas \xe1reas.

---

### Conclus\xe3o: Por que este Agente \xe9 Fundamental?

No Brasil, ter um agente com conhecimento profundo em tributa\xe7\xe3o n\xe3o \xe9 um luxo, mas uma **necessidade estrat\xe9gica**. Ele \xe9 fundamental para:

1.  **Evitar Multas e Juros:** O erro no cumprimento de uma obriga\xe7\xe3o pode gerar penalidades alt\xedssimas.
2.  **Otimizar Custos:** Um bom planejamento pode reduzir a carga tribut\xe1ria, aumentando a competitividade e o lucro da empresa.
3.  **Garantir a Sustentabilidade:** A gest\xe3o tribut\xe1ria inadequada \xe9 uma das principais causas de fal\xeancia de empresas no Brasil.
4.  **Proporcionar Seguran\xe7a Jur\xeddica:** Dar tranquilidade ao empres\xe1rio para que ele possa focar no seu neg\xf3cio, sabendo que a parte fiscal est\xe1 sob controle.

Em resumo, este agente \xe9 o **navegador** que ajuda as empresas e indiv\xedduos a atravessar o "mar revolto" da tributa\xe7\xe3o brasileira de forma segura, eficiente e estrat\xe9gica. \xc9 um investimento, n\xe3o um custo.
`,K=`
A nova reforma tribut\xe1ria brasileira, aprovada entre 2023 e 2025, configura-se como a maior mudan\xe7a fiscal das \xfaltimas d\xe9cadas e tem impacto significativo em praticamente todos os setores econ\xf4micos. Ela substitui os antigos tributos sobre consumo por novos impostos, simplificando a estrutura e promovendo maior transpar\xeancia, por\xe9m trazendo desafios espec\xedficos para servi\xe7os, agroneg\xf3cio, ind\xfastria e varejo[1][2][3].

### Principais Mudan\xe7as

- Os impostos federais PIS, Cofins e IPI, o estadual ICMS e o municipal ISS ser\xe3o substitu\xeddos por dois novos tributos:
  - CBS (Contribui\xe7\xe3o sobre Bens e Servi\xe7os), federal.
  - IBS (Imposto sobre Bens e Servi\xe7os), com gest\xe3o compartilhada entre estados e munic\xedpios.
- Implementa\xe7\xe3o do Imposto Seletivo (IS), incidente sobre bens e servi\xe7os nocivos \xe0 sa\xfade ou ao meio ambiente (bebidas alco\xf3licas, cigarros, combust\xedveis f\xf3sseis).
- Fim da cumulatividade e amplia\xe7\xe3o do cr\xe9dito financeiro para os tributos.
- Nova sistem\xe1tica de cobran\xe7a no destino para opera\xe7\xf5es entre estados, eliminando benef\xedcios regionais e simplificando obriga\xe7\xf5es acess\xf3rias[1][3][4][5].

### Impacto nos Setores Econ\xf4micos

- **Servi\xe7os**: Tende a ser o mais impactado negativamente, pois atualmente usufrui de regimes simplificados e al\xedquotas menores. A nova al\xedquota geral, pr\xf3xima de 25%, pode elevar significativamente o custo para empresas com pouca possibilidade de apropria\xe7\xe3o de cr\xe9ditos tribut\xe1rios (como advocacia, educa\xe7\xe3o, sa\xfade, tecnologia)[2][6][7].
- **Agroneg\xf3cio**: Apesar de isen\xe7\xf5es para itens da cesta b\xe1sica, outros insumos essenciais passar\xe3o a ser tributados, demandando readequa\xe7\xe3o fiscal e controle de cr\xe9ditos.
- **Varejo**: Ter\xe1 que investir em sistemas e compliance para lidar com os novos tributos e garantir o correto aproveitamento dos cr\xe9ditos fiscais. A transi\xe7\xe3o oferece oportunidade competitiva para quem se adaptar r\xe1pido[2][4].
- **Transporte**: Mudan\xe7as na incid\xeancia territorial (de origem para destino) e elimina\xe7\xe3o de benef\xedcios podem elevar custos do setor, exigindo reajuste de pre\xe7os e modelos operacionais[2][8].

### Cronograma de Implanta\xe7\xe3o

- **2023-2025**: Aprova\xe7\xe3o constitucional e regulamenta\xe7\xe3o infraconstitucional.
- **2026**: In\xedcio da fase experimental, CBS e IBS com al\xedquotas simb\xf3licas para testes nos sistemas das empresas.
- **2027**: In\xedcio do Imposto Seletivo (IS)[9][5][4].
- **At\xe9 2033**: Transi\xe7\xe3o gradual at\xe9 extin\xe7\xe3o completa dos antigos tributos e consolida\xe7\xe3o do novo modelo, exigindo adapta\xe7\xe3o simult\xe2nea aos sistemas antigos e novos nos pr\xf3ximos anos[9][4].

### Novidades para Empresas

- Obrigatoriedade de atualizar sistemas fiscais, adaptar classifica\xe7\xf5es de produto e processos internos.
- Maior fiscaliza\xe7\xe3o e risco de autua\xe7\xf5es para quem n\xe3o respeitar as novas regras.
- Introdu\xe7\xe3o do cashback, com devolu\xe7\xe3o tribut\xe1ria para fam\xedlias de baixa renda, especialmente via IBS e CBS[10][5].

### Situa\xe7\xe3o Atual e Pr\xf3ximos Passos

Em setembro de 2025, o Senado aprovou a segunda etapa da regulamenta\xe7\xe3o, detalhando a opera\xe7\xe3o e a distribui\xe7\xe3o dos impostos e criando o Comit\xea Gestor do IBS. O texto agora segue para aprova\xe7\xe3o final na C\xe2mara e posterior san\xe7\xe3o presidencial. As empresas precisam acompanhar a regulamenta\xe7\xe3o complementar e j\xe1 preparar migra\xe7\xe3o de sistemas e processos[9][11][12].

***
A reforma tribut\xe1ria brasileira, portanto, mudar\xe1 profundamente a l\xf3gica da tributa\xe7\xe3o sobre consumo no pa\xeds. A simplifica\xe7\xe3o e amplia\xe7\xe3o de controles e cr\xe9ditos fiscais exigir\xe3o atualiza\xe7\xe3o tecnol\xf3gica e estrat\xe9gica por parte de todos os agentes econ\xf4micos — com impactos distintos conforme o perfil de cada atividade[1][3][2][9][5].

Cita\xe7\xf5es:
[1] Reforma tribut\xe1ria 2025: o que pequenos neg\xf3cios ... https://sebrae.com.br/sites/PortalSebrae/ufs/pe/artigos/reforma-tributaria-2025-o-que-pequenos-negocios-precisam-saber,6d772d5ec7b37910VgnVCM1000001b00320aRCRD
[2] Reforma Tribut\xe1ria: o impacto nos setores https://drfiscal.com.br/planejamento-e-gestao/reforma-tributaria-o-impacto-nos-setores/
[3] Reforma Tribut\xe1ria: quais as \xfaltimas atualiza\xe7\xf5es em 2025 https://www.contabeis.com.br/noticias/71673/reforma-tributaria-quais-as-ultimas-atualizacoes-em-2025/
[4] Reforma Tribut\xe1ria 2025 - KPMG Brasil https://kpmg.com/br/pt/home/insights/2025/05/reforma-tributaria-2025-5-passos-essenciais-empresa-preparar.html
[5] Reforma tribut\xe1ria: veja o que muda com aprova\xe7\xe3o no ... https://fin.org.br/reforma-tributaria-veja-o-que-muda-com-aprovacao-no-senado/
[6] Quais setores ser\xe3o mais afetados com a reforma tribut\xe1ria? https://portaldacontabilidade.clmcontroller.com.br/quais-setores-serao-mais-afetados-com-a-reforma-tributaria/
[7] Reforma tribut\xe1ria pode elevar custos e alterar ... https://fenacon.org.br/reforma-tributaria/reforma-tributaria-pode-elevar-custos-e-alterar-competitividade-do-setor-de-servicos/
[8] Reforma Tribut\xe1ria em pr\xe1tica: impactos e pr\xf3ximos passos https://lefosse.com/noticias/reforma-tributaria-em-pratica-impactos-e-proximos-passos/
[9] Cronograma reforma tribut\xe1ria: quando entra em vigor? https://blog.tecnospeed.com.br/cronograma-reforma-tributaria-quando-entra-em-vigor/
[10] Modificada, regulamenta\xe7\xe3o da reforma tribut\xe1ria volta \xe0 ... https://www12.senado.leg.br/noticias/materias/2025/09/30/modificada-regulamentacao-da-reforma-tributaria-volta-a-camara
[11] Reforma Tribut\xe1ria Regulamenta\xe7\xe3o — Minist\xe9rio da Fazenda https://www.gov.br/fazenda/pt-br/acesso-a-informacao/acoes-e-programas/reforma-tributaria
[12] Reforma Tribut\xe1ria: \xfaltimas atualiza\xe7\xf5es de 2025 https://qive.com.br/blog/atualizacoes-reforma-tributaria/
[13] Reforma Tribut\xe1ria - Portal Gov.br https://www.gov.br/fazenda/pt-br/acesso-a-informacao/acoes-e-programas/reforma-tributaria/apresentacoes/apresentacao-reforma-tributaria-para-o-brasil-crescer-ela-precisa-acontecer-02-8-2023
[14] Reforma Tribut\xe1ria: o que \xe9 e quais as mudan\xe7as para 2025 https://nsdocs.com.br/blog/reforma-tributaria
[15] Reforma Tribut\xe1ria - TOTVS - Espa\xe7o Legisla\xe7\xe3o https://espacolegislacao.totvs.com/reforma-tributaria/
[16] Reforma Tribut\xe1ria 2025: Desafios e Impactos Econ\xf4micos ... https://www.ibmec.br/blog/conteudo-gratuito/reforma-tributaria-nos-moldes-dos-desafios-economicos-e-sociais-globais
[17] Reforma Tribut\xe1ria 2025: Impactos e Mudan\xe7as nas ... https://www.mantoanadvogados.com.br/blog/reforma-tributaria-2025-quais-mudancas-afetam-sua-empresa-/374
[18] Veja principais mudan\xe7as na reforma tribut\xe1ria aprovada ... https://www.cnnbrasil.com.br/economia/financas/veja-principais-mudancas-na-reforma-tributaria-aprovada-pelo-senado/
[19] Reforma Tribut\xe1ria – Perguntas e Respostas - Portal Gov.br https://www.gov.br/fazenda/pt-br/acesso-a-informacao/acoes-e-programas/reforma-tributaria/arquivos/perguntas-e-respostas-reforma-tributaria_.pdf
[20] Reforma Tribut\xe1ria 2025: principais pontos e o que falta ... https://www.taxgroup.com.br/intelligence/reforma-tributaria-2025-principais-pontos-e-o-que-falta-para-entrar-em-vigor/
`;var G=e.i(90571);class J extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Y extends J{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class X extends J{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Z extends J{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}(t=h||(h={})).Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2";class Q{constructor(e,{headers:t={},customFetch:r,region:s=h.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=(e=>e?(...t)=>e(...t):(...e)=>fetch(...e))(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return(0,G.__awaiter)(this,arguments,void 0,function*(e,t={}){var r;let s,a;try{let i,{headers:n,method:o,body:l,signal:u,timeout:c}=t,d={},{region:h}=t;h||(h=this.region);let f=new URL(`${this.url}/${e}`);h&&"any"!==h&&(d["x-region"]=h,f.searchParams.set("forceFunctionRegion",h)),l&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)?"undefined"!=typeof Blob&&l instanceof Blob||l instanceof ArrayBuffer?(d["Content-Type"]="application/octet-stream",i=l):"string"==typeof l?(d["Content-Type"]="text/plain",i=l):"undefined"!=typeof FormData&&l instanceof FormData?i=l:(d["Content-Type"]="application/json",i=JSON.stringify(l)):i=l;let p=u;c&&(a=new AbortController,s=setTimeout(()=>a.abort(),c),u?(p=a.signal,u.addEventListener("abort",()=>a.abort())):p=a.signal);let m=yield this.fetch(f.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},d),this.headers),n),body:i,signal:p}).catch(e=>{throw new Y(e)}),g=m.headers.get("x-relay-error");if(g&&"true"===g)throw new X(m);if(!m.ok)throw new Z(m);let b=(null!=(r=m.headers.get("Content-Type"))?r:"text/plain").split(";")[0].trim();return{data:"application/json"===b?yield m.json():"application/octet-stream"===b||"application/pdf"===b?yield m.blob():"text/event-stream"===b?m:"multipart/form-data"===b?yield m.formData():yield m.text(),error:null,response:m}}catch(e){return{data:null,error:e,response:e instanceof Z||e instanceof X?e.context:void 0}}finally{s&&clearTimeout(s)}})}}var ee=e.i(82215);let{PostgrestClient:et,PostgrestQueryBuilder:er,PostgrestFilterBuilder:es,PostgrestTransformBuilder:ea,PostgrestBuilder:ei,PostgrestError:en}=ee.default||ee,eo=class{constructor(){}static detectEnvironment(){var t;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if(void 0!==e.g.WebSocket)return{type:"native",constructor:e.g.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null==(t=navigator.userAgent)?void 0:t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(void 0!==A.default){let e=A.default.versions;if(e&&e.node){let t=parseInt(e.node.replace(/^v/,"").split(".")[0]);return t>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{let e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}},el="1.0.0";(r=f||(f={}))[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed",(s=p||(p={})).closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving",(a=m||(m={})).close="phx_close",a.error="phx_error",a.join="phx_join",a.reply="phx_reply",a.leave="phx_leave",a.access_token="access_token",(g||(g={})).websocket="websocket",(i=b||(b={})).Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed";class eu{constructor(){this.HEADER_LENGTH=1,this.META_LENGTH=4,this.USER_BROADCAST_PUSH_META_LENGTH=5,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast"}encode(e,t){return e.event!==this.BROADCAST_EVENT||e.payload instanceof ArrayBuffer||"string"!=typeof e.payload.event?t(JSON.stringify([e.join_ref,e.ref,e.topic,e.event,e.payload])):t(this._binaryEncodeUserBroadcastPush(e))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer(null==(t=e.payload)?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){let t=e.topic,r=null!=(c=e.ref)?c:"",s=null!=(d=e.join_ref)?d:"",a=e.payload.event,i=null!=(f=null==(h=e.payload)?void 0:h.payload)?f:new ArrayBuffer(0),n=this.USER_BROADCAST_PUSH_META_LENGTH+s.length+r.length+t.length+a.length,o=new ArrayBuffer(this.HEADER_LENGTH+n),l=new DataView(o),u=0;l.setUint8(u++,this.KINDS.userBroadcastPush),l.setUint8(u++,s.length),l.setUint8(u++,r.length),l.setUint8(u++,t.length),l.setUint8(u++,a.length),l.setUint8(u++,this.BINARY_ENCODING),Array.from(s,e=>l.setUint8(u++,e.charCodeAt(0))),Array.from(r,e=>l.setUint8(u++,e.charCodeAt(0))),Array.from(t,e=>l.setUint8(u++,e.charCodeAt(0))),Array.from(a,e=>l.setUint8(u++,e.charCodeAt(0)));var c,d,h,f,p=new Uint8Array(o.byteLength+i.byteLength);return p.set(new Uint8Array(o),0),p.set(new Uint8Array(i),o.byteLength),p.buffer}_encodeJsonUserBroadcastPush(e){let t=e.topic,r=null!=(d=e.ref)?d:"",s=null!=(h=e.join_ref)?h:"",a=e.payload.event,i=null!=(p=null==(f=e.payload)?void 0:f.payload)?p:{},n=new TextEncoder().encode(JSON.stringify(i)).buffer,o=this.USER_BROADCAST_PUSH_META_LENGTH+s.length+r.length+t.length+a.length,l=new ArrayBuffer(this.HEADER_LENGTH+o),u=new DataView(l),c=0;u.setUint8(c++,this.KINDS.userBroadcastPush),u.setUint8(c++,s.length),u.setUint8(c++,r.length),u.setUint8(c++,t.length),u.setUint8(c++,a.length),u.setUint8(c++,this.JSON_ENCODING),Array.from(s,e=>u.setUint8(c++,e.charCodeAt(0))),Array.from(r,e=>u.setUint8(c++,e.charCodeAt(0))),Array.from(t,e=>u.setUint8(c++,e.charCodeAt(0))),Array.from(a,e=>u.setUint8(c++,e.charCodeAt(0)));var d,h,f,p,m=new Uint8Array(l.byteLength+n.byteLength);return m.set(new Uint8Array(l),0),m.set(new Uint8Array(n),l.byteLength),m.buffer}decode(e,t){if(this._isArrayBuffer(e))return t(this._binaryDecode(e));if("string"==typeof e){let[r,s,a,i,n]=JSON.parse(e);return t({join_ref:r,ref:s,topic:a,event:i,payload:n})}return t({})}_binaryDecode(e){let t=new DataView(e),r=t.getUint8(0),s=new TextDecoder;if(r===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,s)}_decodeUserBroadcast(e,t,r){let s=t.getUint8(1),a=t.getUint8(2),i=t.getUint8(3),n=t.getUint8(4),o=this.HEADER_LENGTH+4,l=r.decode(e.slice(o,o+s));o+=s;let u=r.decode(e.slice(o,o+a));o+=a;let c=r.decode(e.slice(o,o+i));o+=i;let d=e.slice(o,e.byteLength),h=n===this.JSON_ENCODING?JSON.parse(r.decode(d)):d,f={type:this.BROADCAST_EVENT,event:u,payload:h};return i>0&&(f.meta=JSON.parse(c)),{join_ref:null,ref:null,topic:l,event:this.BROADCAST_EVENT,payload:f}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||(null==(t=null==e?void 0:e.constructor)?void 0:t.name)==="ArrayBuffer"}}class ec{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(n=y||(y={})).abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange";let ed=(e,t,r={})=>{var s;let a=null!=(s=r.skipTypes)?s:[];return t?Object.keys(t).reduce((r,s)=>(r[s]=eh(s,e,t,a),r),{}):{}},eh=(e,t,r,s)=>{let a=t.find(t=>t.name===e),i=null==a?void 0:a.type,n=r[e];return i&&!s.includes(i)?ef(i,n):ep(n)},ef=(e,t)=>{if("_"===e.charAt(0))return ey(t,e.slice(1,e.length));switch(e){case y.bool:return em(t);case y.float4:case y.float8:case y.int2:case y.int4:case y.int8:case y.numeric:case y.oid:return eg(t);case y.json:case y.jsonb:return eb(t);case y.timestamp:return ew(t);case y.abstime:case y.date:case y.daterange:case y.int4range:case y.int8range:case y.money:case y.reltime:case y.text:case y.time:case y.timestamptz:case y.timetz:case y.tsrange:case y.tstzrange:default:return ep(t)}},ep=e=>e,em=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},eg=e=>{if("string"==typeof e){let t=parseFloat(e);if(!Number.isNaN(t))return t}return e},eb=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){console.log(`JSON parse error: ${e}`)}return e},ey=(e,t)=>{if("string"!=typeof e)return e;let r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s,a=e.slice(1,r);try{s=JSON.parse("["+a+"]")}catch(e){s=a?a.split(","):[]}return s.map(e=>ef(t,e))}return e},ew=e=>"string"==typeof e?e.replace(" ","T"):e,ev=e=>{let t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),""===t.pathname||"/"===t.pathname?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class ex{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null==(r=this.receivedResp)?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}(o=w||(w={})).SYNC="sync",o.JOIN="join",o.LEAVE="leave";class e_{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{let{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=e_.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=e_.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},e=>{let{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=e_.syncDiff(this.state,e,t,r),s())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){let a=this.cloneDeep(e),i=this.transformState(t),n={},o={};return this.map(a,(e,t)=>{i[e]||(o[e]=t)}),this.map(i,(e,t)=>{let r=a[e];if(r){let s=t.map(e=>e.presence_ref),a=r.map(e=>e.presence_ref),i=t.filter(e=>0>a.indexOf(e.presence_ref)),l=r.filter(e=>0>s.indexOf(e.presence_ref));i.length>0&&(n[e]=i),l.length>0&&(o[e]=l)}else n[e]=t}),this.syncDiff(a,{joins:n,leaves:o},r,s)}static syncDiff(e,t,r,s){let{joins:a,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(a,(t,s)=>{var a;let i=null!=(a=e[t])?a:[];if(e[t]=this.cloneDeep(s),i.length>0){let r=e[t].map(e=>e.presence_ref),s=i.filter(e=>0>r.indexOf(e.presence_ref));e[t].unshift(...s)}r(t,i,s)}),this.map(i,(t,r)=>{let a=e[t];if(!a)return;let i=r.map(e=>e.presence_ref);a=a.filter(e=>0>i.indexOf(e.presence_ref)),e[t]=a,s(t,a,r),0===a.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return Object.getOwnPropertyNames(e=this.cloneDeep(e)).reduce((t,r)=>{let s=e[r];return"metas"in s?t[r]=s.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(l=v||(v={})).ALL="*",l.INSERT="INSERT",l.UPDATE="UPDATE",l.DELETE="DELETE",(u=x||(x={})).BROADCAST="broadcast",u.PRESENCE="presence",u.POSTGRES_CHANGES="postgres_changes",u.SYSTEM="system",(c=_||(_={})).SUBSCRIBED="SUBSCRIBED",c.TIMED_OUT="TIMED_OUT",c.CLOSED="CLOSED",c.CHANNEL_ERROR="CHANNEL_ERROR";class eE{constructor(e,t={config:{}},r){var s,a;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=p.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new ex(this,m.join,this.params,this.timeout),this.rejoinTimer=new ec(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=p.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=p.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=p.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=p.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=p.errored,this.rejoinTimer.scheduleTimeout())}),this._on(m.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new e_(this),this.broadcastEndpointURL=ev(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null==(a=null==(s=this.params.config)?void 0:s.broadcast)?void 0:a.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,s,a;if(this.socket.isConnected()||this.socket.connect(),this.state==p.closed){let{config:{broadcast:i,presence:n,private:o}}=this.params,l=null!=(s=null==(r=this.bindings.postgres_changes)?void 0:r.map(e=>e.filter))?s:[],u=!!this.bindings[x.PRESENCE]&&this.bindings[x.PRESENCE].length>0||(null==(a=this.params.config.presence)?void 0:a.enabled)===!0,c={},d={broadcast:i,presence:Object.assign(Object.assign({},n),{enabled:u}),postgres_changes:l,private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(_.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(_.CLOSED)),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var r;if(this.socket.setAuth(),void 0===t){null==e||e(_.SUBSCRIBED);return}{let s=this.bindings.postgres_changes,a=null!=(r=null==s?void 0:s.length)?r:0,i=[];for(let r=0;r<a;r++){let a=s[r],{filter:{event:n,schema:o,table:l,filter:u}}=a,c=t&&t[r];if(c&&c.event===n&&c.schema===o&&c.table===l&&c.filter===u)i.push(Object.assign(Object.assign({},a),{id:c.id}));else{this.unsubscribe(),this.state=p.errored,null==e||e(_.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=i,e&&e(_.SUBSCRIBED);return}}).receive("error",t=>{this.state=p.errored,null==e||e(_.CHANNEL_ERROR,Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(_.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===p.joined&&e===x.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async httpSend(e,t,r={}){var s;let a=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(null==t)return Promise.reject("Payload is required for httpSend()");let i={method:"POST",headers:{Authorization:a,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},n=await this._fetchWithTimeout(this.broadcastEndpointURL,i,null!=(s=r.timeout)?s:this.timeout);if(202===n.status)return{success:!0};let o=n.statusText;try{let e=await n.json();o=e.error||e.message||o}catch(e){}return Promise.reject(Error(o))}async send(e,t={}){var r,s;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var s,a,i;let n=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null==(i=null==(a=null==(s=this.params)?void 0:s.config)?void 0:a.broadcast)?void 0:i.ack)||r("ok"),n.receive("ok",()=>r("ok")),n.receive("error",()=>r("error")),n.receive("timeout",()=>r("timed out"))});{console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");let{event:a,payload:i}=e,n={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:i,private:this.private}]})};try{let e=await this._fetchWithTimeout(this.broadcastEndpointURL,n,null!=(r=t.timeout)?r:this.timeout);return await (null==(s=e.body)?void 0:s.cancel()),e.ok?"ok":"error"}catch(e){if("AbortError"===e.name)return"timed out";return"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=p.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(m.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{(r=new ex(this,m.leave,{},e)).receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=p.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){let s=new AbortController,a=setTimeout(()=>s.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(a),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new ex(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){let e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,a;let i=e.toLocaleLowerCase(),{close:n,error:o,leave:l,join:u}=m;if(r&&[n,o,l,u].indexOf(i)>=0&&r!==this._joinRef())return;let c=this._onMessage(i,t,r);if(t&&!c)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null==(s=this.bindings.postgres_changes)||s.filter(e=>{var t,r,s;return(null==(t=e.filter)?void 0:t.event)==="*"||(null==(s=null==(r=e.filter)?void 0:r.event)?void 0:s.toLocaleLowerCase())===i}).map(e=>e.callback(c,r)):null==(a=this.bindings[i])||a.filter(e=>{var r,s,a,n,o,l;if(!["broadcast","presence","postgres_changes"].includes(i))return e.type.toLocaleLowerCase()===i;if("id"in e){let i=e.id,n=null==(r=e.filter)?void 0:r.event;return i&&(null==(s=t.ids)?void 0:s.includes(i))&&("*"===n||(null==n?void 0:n.toLocaleLowerCase())===(null==(a=t.data)?void 0:a.type.toLocaleLowerCase()))}{let r=null==(o=null==(n=null==e?void 0:e.filter)?void 0:n.event)?void 0:o.toLocaleLowerCase();return"*"===r||r===(null==(l=null==t?void 0:t.event)?void 0:l.toLocaleLowerCase())}}).map(e=>{if("object"==typeof c&&"ids"in c){let e=c.data,{schema:t,table:r,commit_timestamp:s,type:a,errors:i}=e;c=Object.assign(Object.assign({},{schema:t,table:r,commit_timestamp:s,eventType:a,new:{},old:{},errors:i}),this._getPayloadRecords(e))}e.callback(c,r)})}_isClosed(){return this.state===p.closed}_isJoined(){return this.state===p.joined}_isJoining(){return this.state===p.joining}_isLeaving(){return this.state===p.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){let s=e.toLocaleLowerCase(),a={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(a):this.bindings[s]=[a],this}_off(e,t){let r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var s;return!((null==(s=e.type)?void 0:s.toLocaleLowerCase())===r&&eE.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(m.close,{},e)}_onError(e){this._on(m.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=p.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return("INSERT"===e.type||"UPDATE"===e.type)&&(t.new=ed(e.columns,e.record)),("UPDATE"===e.type||"DELETE"===e.type)&&(t.old=ed(e.columns,e.old_record)),t}}let ek=()=>{},ej=[1e3,2e3,5e3,1e4],eS=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class eT{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=1e4,this.transport=null,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ek,this.ref=0,this.reconnectTimer=null,this.vsn=el,this.logger=ek,this.conn=null,this.sendBuffer=[],this.serializer=new eu,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),!(null==(r=null==t?void 0:t.params)?void 0:r.apikey))throw Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${g.websocket}`,this.httpEndpoint=ev(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=eo.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");let e=t.message;if(e.includes("Node.js"))throw Error(`${e}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`);throw Error(`WebSocket not available: ${e}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},"function"==typeof this.conn.close&&(e?this.conn.close(e,null!=t?t:""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case f.connecting:return b.Connecting;case f.open:return b.Open;case f.closing:return b.Closing;default:return b.Closed}}isConnected(){return this.connectionState()===b.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){let r=`realtime:${e}`,s=this.getChannels().find(e=>e.topic===r);if(s)return s;{let r=new eE(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){let{topic:t,event:r,payload:s,ref:a}=e,i=()=>{this.encode(e,e=>{var t;null==(t=this.conn)||t.send(e)})};this.log("push",`${t} ${r} (${a})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(e){this.log("error","error in heartbeat callback",e)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(e){this.log("error","error in heartbeat callback",e)}this._wasManualDisconnect=!1,null==(e=this.conn)||e.close(1e3,"heartbeat timeout"),setTimeout(()=>{var e;this.isConnected()||null==(e=this.reconnectTimer)||e.scheduleTimeout()},100);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(e){this.log("error","error in heartbeat callback",e)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(e){this.log("error","error in heartbeat callback",e)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);let{topic:t,event:r,payload:s,ref:a}=e,i=a?`(${a})`:"",n=s.status||"";this.log("receive",`${n} ${t} ${r} ${i}`.trim(),s),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,s,a)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null==(t=this.reconnectTimer)||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){if(this.conn){if(this.conn.readyState===f.open||this.conn.readyState===f.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(e=>{this.log("error","error waiting for auth on connect",e),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null==(t=this.reconnectTimer)||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(m.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;let r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{let e=new Blob([eS],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;t=e||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{t&&e.updateJoinPayload({access_token:t,version:"realtime-js/2.84.0"}),e.joinedOnce&&e._isJoined()&&e._push(m.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(t){this.log("error",`error in ${e} callback`,t)}})}catch(t){this.log("error",`error triggering ${e} callbacks`,t)}}_setupReconnectionTimer(){this.reconnectTimer=new ec(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},10)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,a,i,n,o,l,u,c,d,h;switch(this.transport=null!=(t=null==e?void 0:e.transport)?t:null,this.timeout=null!=(r=null==e?void 0:e.timeout)?r:1e4,this.heartbeatIntervalMs=null!=(s=null==e?void 0:e.heartbeatIntervalMs)?s:25e3,this.worker=null!=(a=null==e?void 0:e.worker)&&a,this.accessToken=null!=(i=null==e?void 0:e.accessToken)?i:null,this.heartbeatCallback=null!=(n=null==e?void 0:e.heartbeatCallback)?n:ek,this.vsn=null!=(o=null==e?void 0:e.vsn)?o:el,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!=(l=null==e?void 0:e.reconnectAfterMs)?l:e=>ej[e-1]||1e4,this.vsn){case el:this.encode=null!=(u=null==e?void 0:e.encode)?u:(e,t)=>t(JSON.stringify(e)),this.decode=null!=(c=null==e?void 0:e.decode)?c:(e,t)=>t(JSON.parse(e));break;case"2.0.0":this.encode=null!=(d=null==e?void 0:e.encode)?d:this.serializer.encode.bind(this.serializer),this.decode=null!=(h=null==e?void 0:e.decode)?h:this.serializer.decode.bind(this.serializer);break;default:throw Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if("undefined"!=typeof window&&!window.Worker)throw Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}var eO=e.i(67034);class eC extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function eA(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class eN extends eC{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class eR extends eC{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}let eI=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),eP=e=>{if(Array.isArray(e))return e.map(e=>eP(e));if("function"==typeof e||e!==Object(e))return e;let t={};return Object.entries(e).forEach(([e,r])=>{t[e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""))]=eP(r)}),t},eL=e=>{var t;return e.msg||e.message||e.error_description||("string"==typeof e.error?e.error:null==(t=e.error)?void 0:t.message)||JSON.stringify(e)};function eU(e,t,r,s,a,i){return(0,G.__awaiter)(this,void 0,void 0,function*(){return new Promise((n,o)=>{let l;e(r,(l={method:t,headers:(null==s?void 0:s.headers)||{}},"GET"===t||!i?l:((e=>{if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(i)?(l.headers=Object.assign({"Content-Type":"application/json"},null==s?void 0:s.headers),l.body=JSON.stringify(i)):l.body=i,(null==s?void 0:s.duplex)&&(l.duplex=s.duplex),Object.assign(Object.assign({},l),a)))).then(e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()}).then(e=>n(e)).catch(e=>(0,G.__awaiter)(void 0,void 0,void 0,function*(){e instanceof(yield Response)&&!(null==s?void 0:s.noResolveJson)?e.json().then(t=>{let r=e.status||500,s=(null==t?void 0:t.statusCode)||r+"";o(new eN(eL(t),r,s))}).catch(e=>{o(new eR(eL(e),e))}):o(new eR(eL(e),e))}))})})}function e$(e,t,r,s){return(0,G.__awaiter)(this,void 0,void 0,function*(){return eU(e,"GET",t,r,s)})}function eD(e,t,r,s,a){return(0,G.__awaiter)(this,void 0,void 0,function*(){return eU(e,"POST",t,s,a,r)})}function eB(e,t,r,s,a){return(0,G.__awaiter)(this,void 0,void 0,function*(){return eU(e,"PUT",t,s,a,r)})}function eM(e,t,r,s,a){return(0,G.__awaiter)(this,void 0,void 0,function*(){return eU(e,"DELETE",t,s,a,r)})}class eq{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}}E=Symbol.toStringTag;let eF=class{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[E]="BlobDownloadBuilder",this.promise=null}asStream(){return new eq(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{let e=yield this.downloadFn();return{data:yield e.blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}},ez={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},eW={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class eV{constructor(e,t={},r,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=eI(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,s){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{let a,i=Object.assign(Object.assign({},eW),s),n=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)}),o=i.metadata;"undefined"!=typeof Blob&&r instanceof Blob?((a=new FormData).append("cacheControl",i.cacheControl),o&&a.append("metadata",this.encodeMetadata(o)),a.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?((a=r).has("cacheControl")||a.append("cacheControl",i.cacheControl),o&&!a.has("metadata")&&a.append("metadata",this.encodeMetadata(o))):(a=r,n["cache-control"]=`max-age=${i.cacheControl}`,n["content-type"]=i.contentType,o&&(n["x-metadata"]=this.toBase64(this.encodeMetadata(o))),("undefined"!=typeof ReadableStream&&a instanceof ReadableStream||a&&"object"==typeof a&&"pipe"in a&&"function"==typeof a.pipe)&&!i.duplex&&(i.duplex="half")),(null==s?void 0:s.headers)&&(n=Object.assign(Object.assign({},n),s.headers));let l=this._removeEmptyFolders(t),u=this._getFinalPath(l),c=yield("PUT"==e?eB:eD)(this.fetch,`${this.url}/object/${u}`,a,Object.assign({headers:n},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{}));return{data:{path:l,id:c.Id,fullPath:c.Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}upload(e,t,r){return(0,G.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return(0,G.__awaiter)(this,void 0,void 0,function*(){let a=this._removeEmptyFolders(e),i=this._getFinalPath(a),n=new URL(this.url+`/object/upload/sign/${i}`);n.searchParams.set("token",t);try{let e,t=Object.assign({upsert:eW.upsert},s),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?((e=new FormData).append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r).append("cacheControl",t.cacheControl):(e=r,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType);let o=yield eB(this.fetch,n.toString(),e,{headers:i});return{data:{path:a,fullPath:o.Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}createSignedUploadUrl(e,t){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),s=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");let a=yield eD(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),i=new URL(this.url+a.url),n=i.searchParams.get("token");if(!n)throw new eC("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:n},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}update(e,t,r){return(0,G.__awaiter)(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eD(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}copy(e,t,r){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:{path:(yield eD(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}createSignedUrl(e,t,r){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),a=yield eD(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers}),i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:a={signedUrl:encodeURI(`${this.url}${a.signedURL}${i}`)},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}createSignedUrls(e,t,r){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{let s=yield eD(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),a=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${a}`):null})),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}download(e,t){let r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),a=s?`?${s}`:"",i=this._getFinalPath(e);return new eF(()=>e$(this.fetch,`${this.url}/${r}/${i}${a}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{let e=yield e$(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:eP(e),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}exists(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{return yield function(e,t,r,s){return(0,G.__awaiter)(this,void 0,void 0,function*(){return eU(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),void 0)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e)&&e instanceof eR){let t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}})}getPublicUrl(e,t){let r=this._getFinalPath(e),s=[],a=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==a&&s.push(a);let i=void 0!==(null==t?void 0:t.transform),n=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==n&&s.push(n);let o=s.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${i?"render/image":"object"}/public/${r}${o}`)}}}remove(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eM(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}list(e,t,r){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{let s=Object.assign(Object.assign(Object.assign({},ez),t),{prefix:e||""});return{data:yield eD(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}listV2(e,t){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{let r=Object.assign({},e);return{data:yield eD(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return void 0!==eO.Buffer?eO.Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}let eH="2.84.0",eK={"X-Client-Info":`storage-js/${eH}`};class eG{constructor(e,t={},r,s){this.shouldThrowOnError=!1;const a=new URL(e);(null==s?void 0:s.useNewHostname)&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase.")),this.url=a.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eK),t),this.fetch=eI(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{let t=this.listBucketOptionsToQueryString(e);return{data:yield e$(this.fetch,`${this.url}/bucket${t}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}getBucket(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e$(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}createBucket(e){return(0,G.__awaiter)(this,arguments,void 0,function*(e,t={public:!1}){try{return{data:yield eD(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}updateBucket(e,t){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eB(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}emptyBucket(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eD(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}deleteBucket(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eM(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}listBucketOptionsToQueryString(e){let t={};return e&&("limit"in e&&(t.limit=String(e.limit)),"offset"in e&&(t.offset=String(e.offset)),e.search&&(t.search=e.search),e.sortColumn&&(t.sortColumn=e.sortColumn),e.sortOrder&&(t.sortOrder=e.sortOrder)),Object.keys(t).length>0?"?"+new URLSearchParams(t).toString():""}}class eJ{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eK),t),this.fetch=eI(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eD(this.fetch,`${this.url}/bucket`,{name:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}listBuckets(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{let t=new URLSearchParams;(null==e?void 0:e.limit)!==void 0&&t.set("limit",e.limit.toString()),(null==e?void 0:e.offset)!==void 0&&t.set("offset",e.offset.toString()),(null==e?void 0:e.sortColumn)&&t.set("sortColumn",e.sortColumn),(null==e?void 0:e.sortOrder)&&t.set("sortOrder",e.sortOrder),(null==e?void 0:e.search)&&t.set("search",e.search);let r=t.toString(),s=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield e$(this.fetch,s,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}deleteBucket(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield eM(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eA(e))return{data:null,error:e};throw e}})}}let eY={"X-Client-Info":`storage-js/${eH}`,"Content-Type":"application/json"};class eX extends Error{constructor(e){super(e),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function eZ(e){return"object"==typeof e&&null!==e&&"__isStorageVectorsError"in e}class eQ extends eX{constructor(e,t,r){super(e),this.name="StorageVectorsApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class e0 extends eX{constructor(e,t){super(e),this.name="StorageVectorsUnknownError",this.originalError=t}}(d=k||(k={})).InternalError="InternalError",d.S3VectorConflictException="S3VectorConflictException",d.S3VectorNotFoundException="S3VectorNotFoundException",d.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",d.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",d.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded";let e1=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),e2=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e);function e5(e,t,r,s,a){return(0,G.__awaiter)(this,void 0,void 0,function*(){return function(e,t,r,s,a,i){return(0,G.__awaiter)(this,void 0,void 0,function*(){return new Promise((n,o)=>{let l;e(r,(l={method:t,headers:(null==s?void 0:s.headers)||{}},"GET"===t||!i?l:((e=>{if("object"!=typeof e||null===e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)})(i)?(l.headers=Object.assign({"Content-Type":"application/json"},null==s?void 0:s.headers),l.body=JSON.stringify(i)):l.body=i,Object.assign(Object.assign({},l),a)))).then(e=>{if(!e.ok)throw e;if(null==s?void 0:s.noResolveJson)return e;let t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():{}}).then(e=>n(e)).catch(e=>(0,G.__awaiter)(void 0,void 0,void 0,function*(){if(!(e&&"object"==typeof e&&"status"in e&&"ok"in e&&"number"==typeof e.status)||(null==s?void 0:s.noResolveJson))o(new e0(e2(e),e));else{let t=e.status||500;"function"==typeof e.json?e.json().then(e=>{let r=(null==e?void 0:e.statusCode)||(null==e?void 0:e.code)||t+"";o(new eQ(e2(e),t,r))}).catch(()=>{o(new eQ(e.statusText||`HTTP ${t} error`,t,t+""))}):o(new eQ(e.statusText||`HTTP ${t} error`,t,t+""))}}))})})}(e,"POST",t,s,a,r)})}class e3{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eY),t),this.fetch=e1(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield e5(this.fetch,`${this.url}/CreateIndex`,e,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eZ(e))return{data:null,error:e};throw e}})}getIndex(e,t){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eZ(e))return{data:null,error:e};throw e}})}listIndexes(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/ListIndexes`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eZ(e))return{data:null,error:e};throw e}})}deleteIndex(e,t){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield e5(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:e,indexName:t},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eZ(e))return{data:null,error:e};throw e}})}}class e7{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eY),t),this.fetch=e1(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{if(e.vectors.length<1||e.vectors.length>500)throw Error("Vector batch size must be between 1 and 500 items");return{data:(yield e5(this.fetch,`${this.url}/PutVectors`,e,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eZ(e))return{data:null,error:e};throw e}})}getVectors(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/GetVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eZ(e))return{data:null,error:e};throw e}})}listVectors(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{if(void 0!==e.segmentCount){if(e.segmentCount<1||e.segmentCount>16)throw Error("segmentCount must be between 1 and 16");if(void 0!==e.segmentIndex&&(e.segmentIndex<0||e.segmentIndex>=e.segmentCount))throw Error(`segmentIndex must be between 0 and ${e.segmentCount-1}`)}return{data:yield e5(this.fetch,`${this.url}/ListVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eZ(e))return{data:null,error:e};throw e}})}queryVectors(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/QueryVectors`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eZ(e))return{data:null,error:e};throw e}})}deleteVectors(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{if(e.keys.length<1||e.keys.length>500)throw Error("Keys batch size must be between 1 and 500 items");return{data:(yield e5(this.fetch,`${this.url}/DeleteVectors`,e,{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eZ(e))return{data:null,error:e};throw e}})}}class e4{constructor(e,t={},r){this.shouldThrowOnError=!1,this.url=e.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},eY),t),this.fetch=e1(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield e5(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eZ(e))return{data:null,error:e};throw e}})}getBucket(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:yield e5(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:e},{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eZ(e))return{data:null,error:e};throw e}})}listBuckets(){return(0,G.__awaiter)(this,arguments,void 0,function*(e={}){try{return{data:yield e5(this.fetch,`${this.url}/ListVectorBuckets`,e,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eZ(e))return{data:null,error:e};throw e}})}deleteBucket(e){return(0,G.__awaiter)(this,void 0,void 0,function*(){try{return{data:(yield e5(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:e},{headers:this.headers}))||{},error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(eZ(e))return{data:null,error:e};throw e}})}}class e6 extends e4{constructor(e,t={}){super(e,t.headers||{},t.fetch)}from(e){return new e8(this.url,this.headers,e,this.fetch)}}class e8 extends e3{constructor(e,t,r,s){super(e,t,s),this.vectorBucketName=r}createIndex(e){let t=Object.create(null,{createIndex:{get:()=>super.createIndex}});return(0,G.__awaiter)(this,void 0,void 0,function*(){return t.createIndex.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){let e=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return(0,G.__awaiter)(this,arguments,void 0,function*(t={}){return e.listIndexes.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}getIndex(e){let t=Object.create(null,{getIndex:{get:()=>super.getIndex}});return(0,G.__awaiter)(this,void 0,void 0,function*(){return t.getIndex.call(this,this.vectorBucketName,e)})}deleteIndex(e){let t=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return(0,G.__awaiter)(this,void 0,void 0,function*(){return t.deleteIndex.call(this,this.vectorBucketName,e)})}index(e){return new e9(this.url,this.headers,this.vectorBucketName,e,this.fetch)}}class e9 extends e7{constructor(e,t,r,s,a){super(e,t,a),this.vectorBucketName=r,this.indexName=s}putVectors(e){let t=Object.create(null,{putVectors:{get:()=>super.putVectors}});return(0,G.__awaiter)(this,void 0,void 0,function*(){return t.putVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(e){let t=Object.create(null,{getVectors:{get:()=>super.getVectors}});return(0,G.__awaiter)(this,void 0,void 0,function*(){return t.getVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){let e=Object.create(null,{listVectors:{get:()=>super.listVectors}});return(0,G.__awaiter)(this,arguments,void 0,function*(t={}){return e.listVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(e){let t=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return(0,G.__awaiter)(this,void 0,void 0,function*(){return t.queryVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(e){let t=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return(0,G.__awaiter)(this,void 0,void 0,function*(){return t.deleteVectors.call(this,Object.assign(Object.assign({},e),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class te extends eG{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new eV(this.url,this.headers,e,this.fetch)}get vectors(){return new e6(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new eJ(this.url+"/iceberg",this.headers,this.fetch)}}let tt="";tt="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";let tr={headers:{"X-Client-Info":`supabase-js-${tt}/2.84.0`}},ts={schema:"public"},ta={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ti={},tn="2.84.0",to={"X-Client-Info":`gotrue-js/${tn}`},tl="X-Supabase-Api-Version",tu={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},tc=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class td extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function th(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class tf extends td{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class tp extends td{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class tm extends td{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class tg extends tm{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class tb extends tm{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ty extends tm{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class tw extends tm{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class tv extends tm{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class tx extends tm{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function t_(e){return th(e)&&"AuthRetryableFetchError"===e.name}class tE extends tm{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class tk extends tm{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}let tj="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),tS=" 	\n\r=".split(""),tT=(()=>{let e=Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<tS.length;t+=1)e[tS[t].charCodeAt(0)]=-2;for(let t=0;t<tj.length;t+=1)e[tj[t].charCodeAt(0)]=t;return e})();function tO(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;)r(tj[t.queue>>t.queuedBits-6&63]),t.queuedBits-=6;else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;)r(tj[t.queue>>t.queuedBits-6&63]),t.queuedBits-=6}function tC(e,t,r){let s=tT[e];if(s>-1)for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else if(-2===s)return;else throw Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}function tA(e){let t=[],r=e=>{t.push(String.fromCodePoint(e))},s={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=e=>{!function(e,t,r){if(0===t.utf8seq){if(e<=127)return r(e);for(let r=1;r<6;r+=1)if((e>>7-r&1)==0){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else if(4===t.utf8seq)t.codepoint=7&e;else throw Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}}(e,s,r)};for(let t=0;t<e.length;t+=1)tC(e.charCodeAt(t),a,i);return t.join("")}function tN(e){let t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};for(let t=0;t<e.length;t+=1)tC(e.charCodeAt(t),r,s);return new Uint8Array(t)}function tR(e){let t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};return e.forEach(e=>tO(e,r,s)),tO(null,r,s),t.join("")}let tI=()=>"undefined"!=typeof window&&"undefined"!=typeof document,tP={tested:!1,writable:!1},tL=()=>{if(!tI())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(tP.tested)return tP.writable;let e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),tP.tested=!0,tP.writable=!0}catch(e){tP.tested=!0,tP.writable=!1}return tP.writable},tU=e=>e?(...t)=>e(...t):(...e)=>fetch(...e),t$=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},tD=async(e,t)=>{let r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(e){return r}},tB=async(e,t)=>{await e.removeItem(t)};class tM{constructor(){this.promise=new tM.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function tq(e){let t=e.split(".");if(3!==t.length)throw new tk("Invalid JWT structure");for(let e=0;e<t.length;e++)if(!tc.test(t[e]))throw new tk("JWT not in base64url format");return{header:JSON.parse(tA(t[0])),payload:JSON.parse(tA(t[1])),signature:tN(t[2]),raw:{header:t[0],payload:t[1]}}}async function tF(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function tz(e){return("0"+e.toString(16)).substr(-2)}async function tW(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>String.fromCharCode(e)).join("")}async function tV(e){return"undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder?(console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e):btoa(await tW(e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function tH(e,t,r=!1){let s=function(){let e=new Uint32Array(56);if("undefined"==typeof crypto){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length,r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,tz).join("")}(),a=s;r&&(a+="/PASSWORD_RECOVERY"),await t$(e,`${t}-code-verifier`,a);let i=await tV(s),n=s===i?"plain":"s256";return[i,n]}tM.promiseConstructor=Promise;let tK=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,tG=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function tJ(e){if(!tG.test(e))throw Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function tY(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){let e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function tX(e){return JSON.parse(JSON.stringify(e))}let tZ=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),tQ=[502,503,504];async function t0(e){var t;let r,s;if(!("object"==typeof e&&null!==e&&"status"in e&&"ok"in e&&"json"in e&&"function"==typeof e.json))throw new tx(tZ(e),0);if(tQ.includes(e.status))throw new tx(tZ(e),e.status);try{r=await e.json()}catch(e){throw new tp(tZ(e),e)}let a=function(e){let t=e.headers.get(tl);if(!t||!t.match(tK))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(a&&a.getTime()>=tu["2024-01-01"].timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?s=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(s=r.error_code),s){if("weak_password"===s)throw new tE(tZ(r),e.status,(null==(t=r.weak_password)?void 0:t.reasons)||[]);else if("session_not_found"===s)throw new tg}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new tE(tZ(r),e.status,r.weak_password.reasons);throw new tf(tZ(r),e.status||500,s)}async function t1(e,t,r,s){var a;let i=Object.assign({},null==s?void 0:s.headers);i[tl]||(i[tl]=tu["2024-01-01"].name),(null==s?void 0:s.jwt)&&(i.Authorization=`Bearer ${s.jwt}`);let n=null!=(a=null==s?void 0:s.query)?a:{};(null==s?void 0:s.redirectTo)&&(n.redirect_to=s.redirectTo);let o=Object.keys(n).length?"?"+new URLSearchParams(n).toString():"",l=await t2(e,t,r+o,{headers:i,noResolveJson:null==s?void 0:s.noResolveJson},{},null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}async function t2(e,t,r,s,a,i){let n,o,l=(o={method:t,headers:(null==s?void 0:s.headers)||{}},"GET"===t?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==s?void 0:s.headers),o.body=JSON.stringify(i),Object.assign(Object.assign({},o),a)));try{n=await e(r,Object.assign({},l))}catch(e){throw console.error(e),new tx(tZ(e),0)}if(n.ok||await t0(n),null==s?void 0:s.noResolveJson)return n;try{return await n.json()}catch(e){await t0(e)}}function t5(e){var t,r,s;let a=null;(s=e).access_token&&s.refresh_token&&s.expires_in&&(a=Object.assign({},e),e.expires_at||(a.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r)));return{data:{session:a,user:null!=(t=e.user)?t:e},error:null}}function t3(e){let t=t5(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function t7(e){var t;return{data:{user:null!=(t=e.user)?t:e},error:null}}function t4(e){return{data:e,error:null}}function t6(e){let{action_link:t,email_otp:r,hashed_token:s,redirect_to:a,verification_type:i}=e;return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:a,verification_type:i},user:Object.assign({},(0,G.__rest)(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]))},error:null}}function t8(e){return e}let t9=["global","local","others"];class re{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=tU(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=t9[0]){if(0>t9.indexOf(t))throw Error(`@supabase/auth-js: Parameter scope must be one of ${t9.join(", ")}`);try{return await t1(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(th(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await t1(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:t7})}catch(e){if(th(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{let{options:t}=e,r=(0,G.__rest)(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),await t1(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:t6,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(th(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await t1(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:t7})}catch(e){if(th(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,r,s,a,i,n,o;try{let l={nextPage:null,lastPage:0,total:0},u=await t1(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!=(r=null==(t=null==e?void 0:e.page)?void 0:t.toString())?r:"",per_page:null!=(a=null==(s=null==e?void 0:e.perPage)?void 0:s.toString())?a:""},xform:t8});if(u.error)throw u.error;let c=await u.json(),d=null!=(i=u.headers.get("x-total-count"))?i:0,h=null!=(o=null==(n=u.headers.get("link"))?void 0:n.split(","))?o:[];return h.length>0&&(h.forEach(e=>{let t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},c),l),error:null}}catch(e){if(th(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){tJ(e);try{return await t1(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:t7})}catch(e){if(th(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){tJ(e);try{return await t1(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:t7})}catch(e){if(th(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){tJ(e);try{return await t1(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:t7})}catch(e){if(th(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){tJ(e.userId);try{let{data:t,error:r}=await t1(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(e){if(th(e))return{data:null,error:e};throw e}}async _deleteFactor(e){tJ(e.userId),tJ(e.id);try{return{data:await t1(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(th(e))return{data:null,error:e};throw e}}async _listOAuthClients(e){var t,r,s,a,i,n,o;try{let l={nextPage:null,lastPage:0,total:0},u=await t1(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!=(r=null==(t=null==e?void 0:e.page)?void 0:t.toString())?r:"",per_page:null!=(a=null==(s=null==e?void 0:e.perPage)?void 0:s.toString())?a:""},xform:t8});if(u.error)throw u.error;let c=await u.json(),d=null!=(i=u.headers.get("x-total-count"))?i:0,h=null!=(o=null==(n=u.headers.get("link"))?void 0:n.split(","))?o:[];return h.length>0&&(h.forEach(e=>{let t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},c),l),error:null}}catch(e){if(th(e))return{data:{clients:[]},error:e};throw e}}async _createOAuthClient(e){try{return await t1(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(th(e))return{data:null,error:e};throw e}}async _getOAuthClient(e){try{return await t1(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(th(e))return{data:null,error:e};throw e}}async _updateOAuthClient(e,t){try{return await t1(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(th(e))return{data:null,error:e};throw e}}async _deleteOAuthClient(e){try{return await t1(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(e){if(th(e))return{data:null,error:e};throw e}}async _regenerateOAuthClientSecret(e){try{return await t1(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(e){if(th(e))return{data:null,error:e};throw e}}}function rt(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}let rr={debug:!!(globalThis&&tL()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"))};class rs extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ra extends rs{}async function ri(e,t,r){rr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);let s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort(),rr.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async s=>{if(s){rr.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await r()}finally{rr.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}if(0===t)throw rr.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new ra(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(rr.debug)try{let e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}))}function rn(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}class ro extends Error{constructor({message:e,code:t,cause:r,name:s}){var a;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=null!=(a=null!=s?s:r instanceof Error?r.name:void 0)?a:"Unknown Error",this.code=t}}class rl extends ro{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}let ru=new class{createNewAbortSignal(){if(this.controller){let e=Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}let e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){let e=Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function rc(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function rd(){var e,t;return!!(tI()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null==(e=null==navigator?void 0:navigator.credentials)?void 0:e.create)&&"function"==typeof(null==(t=null==navigator?void 0:navigator.credentials)?void 0:t.get))}async function rh(e){try{let t=await navigator.credentials.create(e);if(!t)return{data:null,error:new rl("Empty credential response",t)};if(!(t instanceof PublicKeyCredential))return{data:null,error:new rl("Browser returned unexpected credential type",t)};return{data:t,error:null}}catch(t){return{data:null,error:function({error:e,options:t}){var r,s,a;let{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new ro({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if((null==(r=i.authenticatorSelection)?void 0:r.requireResidentKey)===!0)return new ro({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});else if("conditional"===t.mediation&&(null==(s=i.authenticatorSelection)?void 0:s.userVerification)==="required")return new ro({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});else if((null==(a=i.authenticatorSelection)?void 0:a.userVerification)==="required")return new ro({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else if("InvalidStateError"===e.name)return new ro({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});else if("NotAllowedError"===e.name)return new ro({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("NotSupportedError"===e.name)return new ro(0===i.pubKeyCredParams.filter(e=>"public-key"===e.type).length?{message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}:{message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});else if("SecurityError"===e.name){let t=window.location.hostname;if(!rc(t))return new ro({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(i.rp.id!==t)return new ro({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new ro({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new ro({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return new ro({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}({error:t,options:e})}}}async function rf(e){try{let t=await navigator.credentials.get(e);if(!t)return{data:null,error:new rl("Empty credential response",t)};if(!(t instanceof PublicKeyCredential))return{data:null,error:new rl("Browser returned unexpected credential type",t)};return{data:t,error:null}}catch(t){return{data:null,error:function({error:e,options:t}){let{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new ro({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("NotAllowedError"===e.name)return new ro({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});else if("SecurityError"===e.name){let t=window.location.hostname;if(!rc(t))return new ro({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(r.rpId!==t)return new ro({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new ro({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e});return new ro({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}({error:t,options:e})}}}let rp={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},rm={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function rg(...e){let t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),r=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),s={};for(let a of e)if(a)for(let e in a){let i=a[e];if(void 0!==i)if(Array.isArray(i))s[e]=i;else if(r(i))s[e]=i;else if(t(i)){let r=s[e];t(r)?s[e]=rg(r,i):s[e]=rg(i)}else s[e]=i}return s}class rb{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:s},a){try{var i,n,o,l;let{data:u,error:c}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!u)return{data:null,error:c};let d=null!=s?s:ru.createNewAbortSignal();if("create"===u.webauthn.type){let{user:e}=u.webauthn.credential_options.publicKey;e.name||(e.name=`${e.id}:${r}`),e.displayName||(e.displayName=e.name)}switch(u.webauthn.type){case"create":{let t=(i=u.webauthn.credential_options.publicKey,n=null==a?void 0:a.create,rg(rp,i,n||{})),{data:r,error:s}=await rh({publicKey:t,signal:d});if(r)return{data:{factorId:e,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:r}},error:null};return{data:null,error:s}}case"request":{let t=(o=u.webauthn.credential_options.publicKey,l=null==a?void 0:a.request,rg(rm,o,l||{})),{data:r,error:s}=await rf(Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:t,signal:d}));if(r)return{data:{factorId:e,challengeId:u.id,webauthn:{type:u.webauthn.type,credential_response:r}},error:null};return{data:null,error:s}}}}catch(e){if(th(e))return{data:null,error:e};return{data:null,error:new tp("Unexpected error in challenge",e)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t="undefined"!=typeof window?window.location.hostname:void 0,rpOrigins:r="undefined"!=typeof window?[window.location.origin]:void 0,signal:s}={}},a){if(!t)return{data:null,error:new td("rpId is required for WebAuthn authentication")};try{if(!rd())return{data:null,error:new tp("Browser does not support WebAuthn",null)};let{data:i,error:n}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:s},{request:a});if(!i)return{data:null,error:n};let{webauthn:o}=i;return this._verify({factorId:e,challengeId:i.challengeId,webauthn:{type:o.type,rpId:t,rpOrigins:r,credential_response:o.credential_response}})}catch(e){if(th(e))return{data:null,error:e};return{data:null,error:new tp("Unexpected error in authenticate",e)}}}async _register({friendlyName:e,webauthn:{rpId:t="undefined"!=typeof window?window.location.hostname:void 0,rpOrigins:r="undefined"!=typeof window?[window.location.origin]:void 0,signal:s}={}},a){if(!t)return{data:null,error:new td("rpId is required for WebAuthn registration")};try{if(!rd())return{data:null,error:new tp("Browser does not support WebAuthn",null)};let{data:i,error:n}=await this._enroll({friendlyName:e});if(!i)return await this.client.mfa.listFactors().then(t=>{var r;return null==(r=t.data)?void 0:r.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:n};let{data:o,error:l}=await this._challenge({factorId:i.id,friendlyName:i.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:s},{create:a});if(!o)return{data:null,error:l};return this._verify({factorId:i.id,challengeId:o.challengeId,webauthn:{rpId:t,rpOrigins:r,type:o.webauthn.type,credential_response:o.webauthn.credential_response}})}catch(e){if(th(e))return{data:null,error:e};return{data:null,error:new tp("Unexpected error in register",e)}}}}if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}let ry={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:to,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function rw(e,t,r){return await r()}let rv={};class rx{get jwks(){var e,t;return null!=(t=null==(e=rv[this.storageKey])?void 0:e.jwks)?t:{keys:[]}}set jwks(e){rv[this.storageKey]=Object.assign(Object.assign({},rv[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!=(t=null==(e=rv[this.storageKey])?void 0:e.cachedAt)?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){rv[this.storageKey]=Object.assign(Object.assign({},rv[this.storageKey]),{cachedAt:e})}constructor(e){var t,r,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const a=Object.assign(Object.assign({},ry),e);if(this.storageKey=a.storageKey,this.instanceID=null!=(t=rx.nextInstanceID[this.storageKey])?t:0,rx.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!a.debug,"function"==typeof a.debug&&(this.logger=a.debug),this.instanceID>0&&tI()){const e=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(e),this.logDebugMessages&&console.trace(e)}if(this.persistSession=a.persistSession,this.autoRefreshToken=a.autoRefreshToken,this.admin=new re({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=tU(a.fetch),this.lock=a.lock||rw,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,this.throwOnError=a.throwOnError,a.lock?this.lock=a.lock:tI()&&(null==(r=null==globalThis?void 0:globalThis.navigator)?void 0:r.locks)?this.lock=ri:this.lock=rw,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new rb(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:tL()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=rt(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=rt(this.memoryStorage)),tI()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null==(s=this.broadcastChannel)||s.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${tn}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t={},r="none";if(tI()&&(t=function(e){let t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(e){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href),this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce")),tI()&&this.detectSessionInUrl&&"none"!==r){let{data:s,error:a}=await this._getSessionFromURL(t,r);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),th(a)&&"AuthImplicitGrantRedirectError"===a.name){let t=null==(e=a.details)?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:a}}return await this._removeSession(),{error:a}}let{session:i,redirectType:n}=s;return this._debug("#_initialize()","detected session in URL",i,"redirect type",n),await this._saveSession(i),setTimeout(async()=>{"recovery"===n?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){if(th(e))return this._returnResult({error:e});return this._returnResult({error:new tp("Unexpected error during initialization",e)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{let{data:a,error:i}=await t1(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!=(r=null==(t=null==e?void 0:e.options)?void 0:t.data)?r:{},gotrue_meta_security:{captcha_token:null==(s=null==e?void 0:e.options)?void 0:s.captchaToken}},xform:t5});if(i||!a)return this._returnResult({data:{user:null,session:null},error:i});let n=a.session,o=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",n)),this._returnResult({data:{user:o,session:n},error:null})}catch(e){if(th(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signUp(e){var t,r,s;try{let a;if("email"in e){let{email:r,password:s,options:i}=e,n=null,o=null;"pkce"===this.flowType&&([n,o]=await tH(this.storage,this.storageKey)),a=await t1(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:r,password:s,data:null!=(t=null==i?void 0:i.data)?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:n,code_challenge_method:o},xform:t5})}else if("phone"in e){let{phone:t,password:i,options:n}=e;a=await t1(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!=(r=null==n?void 0:n.data)?r:{},channel:null!=(s=null==n?void 0:n.channel)?s:"sms",gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:t5})}else throw new ty("You must provide either an email or phone number and a password");let{data:i,error:n}=a;if(n||!i)return this._returnResult({data:{user:null,session:null},error:n});let o=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(e){if(th(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithPassword(e){try{let t;if("email"in e){let{email:r,password:s,options:a}=e;t=await t1(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:t3})}else if("phone"in e){let{phone:r,password:s,options:a}=e;t=await t1(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:t3})}else throw new ty("You must provide either an email or phone number and a password");let{data:r,error:s}=t;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!r||!r.session||!r.user){let e=new tb;return this._returnResult({data:{user:null,session:null},error:e})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(e){if(th(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOAuth(e){var t,r,s,a;return await this._handleProviderSignIn(e.provider,{redirectTo:null==(t=e.options)?void 0:t.redirectTo,scopes:null==(r=e.options)?void 0:r.scopes,queryParams:null==(s=e.options)?void 0:s.queryParams,skipBrowserRedirect:null==(a=e.options)?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){let{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,r,s,a,i,n,o,l,u,c,d,h;let f,p;if("message"in e)f=e.message,p=e.signature;else{let c,{chain:d,wallet:m,statement:g,options:b}=e;if(tI())if("object"==typeof m)c=m;else{let e=window;if("ethereum"in e&&"object"==typeof e.ethereum&&"request"in e.ethereum&&"function"==typeof e.ethereum.request)c=e.ethereum;else throw Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if("object"!=typeof m||!(null==b?void 0:b.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");c=m}let y=new URL(null!=(t=null==b?void 0:b.url)?t:window.location.href),w=await c.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!w||0===w.length)throw Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let v=rn(w[0]),x=null==(r=null==b?void 0:b.signInWithEthereum)?void 0:r.chainId;x||(x=parseInt(await c.request({method:"eth_chainId"}),16)),f=function(e){var t;let{chainId:r,domain:s,expirationTime:a,issuedAt:i=new Date,nonce:n,notBefore:o,requestId:l,resources:u,scheme:c,uri:d,version:h}=e;if(!Number.isInteger(r))throw Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!s)throw Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(n&&n.length<8)throw Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${n}`);if(!d)throw Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==h)throw Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(null==(t=e.statement)?void 0:t.includes("\n"))throw Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);let f=rn(e.address),p=c?`${c}://${s}`:s,m=e.statement?`${e.statement}
`:"",g=`${p} wants you to sign in with your Ethereum account:
${f}

${m}`,b=`URI: ${d}
Version: ${h}
Chain ID: ${r}${n?`
Nonce: ${n}`:""}
Issued At: ${i.toISOString()}`;if(a&&(b+=`
Expiration Time: ${a.toISOString()}`),o&&(b+=`
Not Before: ${o.toISOString()}`),l&&(b+=`
Request ID: ${l}`),u){let e="\nResources:";for(let t of u){if(!t||"string"!=typeof t)throw Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`
- ${t}`}b+=e}return`${g}
${b}`}({domain:y.host,address:v,statement:g,uri:y.href,version:"1",chainId:x,nonce:null==(s=null==b?void 0:b.signInWithEthereum)?void 0:s.nonce,issuedAt:null!=(i=null==(a=null==b?void 0:b.signInWithEthereum)?void 0:a.issuedAt)?i:new Date,expirationTime:null==(n=null==b?void 0:b.signInWithEthereum)?void 0:n.expirationTime,notBefore:null==(o=null==b?void 0:b.signInWithEthereum)?void 0:o.notBefore,requestId:null==(l=null==b?void 0:b.signInWithEthereum)?void 0:l.requestId,resources:null==(u=null==b?void 0:b.signInWithEthereum)?void 0:u.resources}),p=await c.request({method:"personal_sign",params:[(h=f,"0x"+Array.from(new TextEncoder().encode(h),e=>e.toString(16).padStart(2,"0")).join("")),v]})}try{let{data:t,error:r}=await t1(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:p},(null==(c=e.options)?void 0:c.captchaToken)?{gotrue_meta_security:{captcha_token:null==(d=e.options)?void 0:d.captchaToken}}:null),xform:t5});if(r)throw r;if(!t||!t.session||!t.user){let e=new tb;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(th(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSolana(e){var t,r,s,a,i,n,o,l,u,c,d,h;let f,p;if("message"in e)f=e.message,p=e.signature;else{let d,{chain:h,wallet:m,statement:g,options:b}=e;if(tI())if("object"==typeof m)d=m;else{let e=window;if("solana"in e&&"object"==typeof e.solana&&("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))d=e.solana;else throw Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if("object"!=typeof m||!(null==b?void 0:b.url))throw Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");d=m}let y=new URL(null!=(t=null==b?void 0:b.url)?t:window.location.href);if("signIn"in d&&d.signIn){let e,t=await d.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},null==b?void 0:b.signInWithSolana),{version:"1",domain:y.host,uri:y.href}),g?{statement:g}:null));if(Array.isArray(t)&&t[0]&&"object"==typeof t[0])e=t[0];else if(t&&"object"==typeof t&&"signedMessage"in t&&"signature"in t)e=t;else throw Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in e&&"signature"in e&&("string"==typeof e.signedMessage||e.signedMessage instanceof Uint8Array)&&e.signature instanceof Uint8Array)f="string"==typeof e.signedMessage?e.signedMessage:new TextDecoder().decode(e.signedMessage),p=e.signature;else throw Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in d)||"function"!=typeof d.signMessage||!("publicKey"in d)||"object"!=typeof d||!d.publicKey||!("toBase58"in d.publicKey)||"function"!=typeof d.publicKey.toBase58)throw Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");f=[`${y.host} wants you to sign in with your Solana account:`,d.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${y.href}`,`Issued At: ${null!=(s=null==(r=null==b?void 0:b.signInWithSolana)?void 0:r.issuedAt)?s:new Date().toISOString()}`,...(null==(a=null==b?void 0:b.signInWithSolana)?void 0:a.notBefore)?[`Not Before: ${b.signInWithSolana.notBefore}`]:[],...(null==(i=null==b?void 0:b.signInWithSolana)?void 0:i.expirationTime)?[`Expiration Time: ${b.signInWithSolana.expirationTime}`]:[],...(null==(n=null==b?void 0:b.signInWithSolana)?void 0:n.chainId)?[`Chain ID: ${b.signInWithSolana.chainId}`]:[],...(null==(o=null==b?void 0:b.signInWithSolana)?void 0:o.nonce)?[`Nonce: ${b.signInWithSolana.nonce}`]:[],...(null==(l=null==b?void 0:b.signInWithSolana)?void 0:l.requestId)?[`Request ID: ${b.signInWithSolana.requestId}`]:[],...(null==(c=null==(u=null==b?void 0:b.signInWithSolana)?void 0:u.resources)?void 0:c.length)?["Resources",...b.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");let e=await d.signMessage(new TextEncoder().encode(f),"utf8");if(!e||!(e instanceof Uint8Array))throw Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{let{data:t,error:r}=await t1(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:f,signature:tR(p)},(null==(d=e.options)?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null==(h=e.options)?void 0:h.captchaToken}}:null),xform:t5});if(r)throw r;if(!t||!t.session||!t.user){let e=new tb;return this._returnResult({data:{user:null,session:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign({},t),error:r})}catch(e){if(th(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _exchangeCodeForSession(e){let t=await tD(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(null!=t?t:"").split("/");try{let{data:t,error:a}=await t1(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:t5});if(await tB(this.storage,`${this.storageKey}-code-verifier`),a)throw a;if(!t||!t.session||!t.user){let e=new tb;return this._returnResult({data:{user:null,session:null,redirectType:null},error:e})}return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),this._returnResult({data:Object.assign(Object.assign({},t),{redirectType:null!=s?s:null}),error:a})}catch(e){if(th(e))return this._returnResult({data:{user:null,session:null,redirectType:null},error:e});throw e}}async signInWithIdToken(e){try{let{options:t,provider:r,token:s,access_token:a,nonce:i}=e,{data:n,error:o}=await t1(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:a,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:t5});if(o)return this._returnResult({data:{user:null,session:null},error:o});if(!n||!n.session||!n.user){let e=new tb;return this._returnResult({data:{user:null,session:null},error:e})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:n,error:o})}catch(e){if(th(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithOtp(e){var t,r,s,a,i;try{if("email"in e){let{email:s,options:a}=e,i=null,n=null;"pkce"===this.flowType&&([i,n]=await tH(this.storage,this.storageKey));let{error:o}=await t1(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!=(t=null==a?void 0:a.data)?t:{},create_user:null==(r=null==a?void 0:a.shouldCreateUser)||r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:i,code_challenge_method:n},redirectTo:null==a?void 0:a.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}if("phone"in e){let{phone:t,options:r}=e,{data:n,error:o}=await t1(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!=(s=null==r?void 0:r.data)?s:{},create_user:null==(a=null==r?void 0:r.shouldCreateUser)||a,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!=(i=null==r?void 0:r.channel)?i:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:o})}throw new ty("You must provide either an email or phone number.")}catch(e){if(th(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async verifyOtp(e){var t,r;try{let s,a;"options"in e&&(s=null==(t=e.options)?void 0:t.redirectTo,a=null==(r=e.options)?void 0:r.captchaToken);let{data:i,error:n}=await t1(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:s,xform:t5});if(n)throw n;if(!i)throw Error("An error occurred on token verification.");let o=i.session,l=i.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),this._returnResult({data:{user:l,session:o},error:null})}catch(e){if(th(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async signInWithSSO(e){var t,r,s,a,i;try{let n=null,o=null;"pkce"===this.flowType&&([n,o]=await tH(this.storage,this.storageKey));let l=await t1(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!=(r=null==(t=e.options)?void 0:t.redirectTo)?r:void 0}),(null==(s=null==e?void 0:e.options)?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:o}),headers:this.headers,xform:t4});return(null==(a=l.data)?void 0:a.url)&&tI()&&!(null==(i=e.options)?void 0:i.skipBrowserRedirect)&&window.location.assign(l.data.url),this._returnResult(l)}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new tg;let{error:s}=await t1(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(th(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{let t=`${this.url}/resend`;if("email"in e){let{email:r,type:s,options:a}=e,{error:i}=await t1(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},redirectTo:null==a?void 0:a.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:i})}if("phone"in e){let{phone:r,type:s,options:a}=e,{data:i,error:n}=await t1(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:n})}throw new ty("You must provide either an email or phone number and a type")}catch(e){if(th(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){let e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let t=null,r=await tD(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),null!==r&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};let s=!!t.expires_at&&1e3*t.expires_at-Date.now()<9e4;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",t.expires_at),!s){if(this.userStorage){let e=await tD(this.userStorage,this.storageKey+"-user");(null==e?void 0:e.user)?t.user=e.user:t.user=tY()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){var e;let r={value:this.suppressGetSessionWarning};t.user=(e=t.user,new Proxy(e,{get:(e,t,s)=>{if("__isInsecureUserWarningProxy"===t)return!0;if("symbol"==typeof t){let r=t.toString();if("Symbol(Symbol.toPrimitive)"===r||"Symbol(Symbol.toStringTag)"===r||"Symbol(util.inspect.custom)"===r||"Symbol(nodejs.util.inspect.custom)"===r)return Reflect.get(e,t,s)}return r.value||"string"!=typeof t||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),r.value=!0),Reflect.get(e,t,s)}})),r.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}let{data:a,error:i}=await this._callRefreshToken(t.refresh_token);if(i)return this._returnResult({data:{session:null},error:i});return this._returnResult({data:{session:a},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{if(e)return await t1(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:t7});return await this._useSession(async e=>{var t,r,s;let{data:a,error:i}=e;if(i)throw i;return(null==(t=a.session)?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await t1(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!=(s=null==(r=a.session)?void 0:r.access_token)?s:void 0,xform:t7}):{data:{user:null},error:new tg}})}catch(e){if(th(e))return th(e)&&"AuthSessionMissingError"===e.name&&(await this._removeSession(),await tB(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:e});throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{let{data:s,error:a}=r;if(a)throw a;if(!s.session)throw new tg;let i=s.session,n=null,o=null;"pkce"===this.flowType&&null!=e.email&&([n,o]=await tH(this.storage,this.storageKey));let{data:l,error:u}=await t1(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:n,code_challenge_method:o}),jwt:i.access_token,xform:t7});if(u)throw u;return i.user=l.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),this._returnResult({data:{user:i.user},error:null})})}catch(e){if(th(e))return this._returnResult({data:{user:null},error:e});throw e}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new tg;let t=Date.now()/1e3,r=t,s=!0,a=null,{payload:i}=tq(e.access_token);if(i.exp&&(s=(r=i.exp)<=t),s){let{data:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return this._returnResult({data:{user:null,session:null},error:r});if(!t)return{data:{user:null,session:null},error:null};a=t}else{let{data:s,error:i}=await this._getUser(e.access_token);if(i)throw i;a={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return this._returnResult({data:{user:a.user,session:a},error:null})}catch(e){if(th(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){let{data:s,error:a}=t;if(a)throw a;e=null!=(r=s.session)?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new tg;let{data:s,error:a}=await this._callRefreshToken(e.refresh_token);return a?this._returnResult({data:{user:null,session:null},error:a}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(e){if(th(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async _getSessionFromURL(e,t){try{if(!tI())throw new tw("No browser detected.");if(e.error||e.error_description||e.error_code)throw new tw(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new tv("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new tw("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new tv("No code detected.");let{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;let s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:t.session,redirectType:null},error:null}}let{provider_token:r,provider_refresh_token:s,access_token:a,refresh_token:i,expires_in:n,expires_at:o,token_type:l}=e;if(!a||!n||!i||!l)throw new tw("No session defined in URL");let u=Math.round(Date.now()/1e3),c=parseInt(n),d=u+c;o&&(d=parseInt(o));let h=d-u;1e3*h<=3e4&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${c}s`);let f=d-c;u-f>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",f,d,u):u-f<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",f,d,u);let{data:p,error:m}=await this._getUser(a);if(m)throw m;let g={provider_token:r,provider_refresh_token:s,access_token:a,expires_in:c,expires_at:d,refresh_token:i,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:g,redirectType:e.type},error:null})}catch(e){if(th(e))return this._returnResult({data:{session:null,redirectType:null},error:e});throw e}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let t=await tD(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;let{data:s,error:a}=t;if(a)return this._returnResult({error:a});let i=null==(r=s.session)?void 0:r.access_token;if(i){let{error:t}=await this.admin.signOut(i,e);if(t&&!(th(t)&&"AuthApiError"===t.name&&(404===t.status||401===t.status||403===t.status)))return this._returnResult({error:t})}return"others"!==e&&(await this._removeSession(),await tB(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){let t=Symbol("auth-callback"),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{let{data:{session:s},error:a}=t;if(a)throw a;await (null==(r=this.stateChangeEmitters.get(e))?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(t){await (null==(s=this.stateChangeEmitters.get(e))?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;"pkce"===this.flowType&&([r,s]=await tH(this.storage,this.storageKey,!0));try{return await t1(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}}async getUserIdentities(){var e;try{let{data:t,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:null!=(e=t.user.identities)?e:[]},error:null})}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{let{data:r,error:s}=await this._useSession(async t=>{var r,s,a,i,n;let{data:o,error:l}=t;if(l)throw l;let u=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null==(r=e.options)?void 0:r.redirectTo,scopes:null==(s=e.options)?void 0:s.scopes,queryParams:null==(a=e.options)?void 0:a.queryParams,skipBrowserRedirect:!0});return await t1(this.fetch,"GET",u,{headers:this.headers,jwt:null!=(n=null==(i=o.session)?void 0:i.access_token)?n:void 0})});if(s)throw s;return!tI()||(null==(t=e.options)?void 0:t.skipBrowserRedirect)||window.location.assign(null==r?void 0:r.url),this._returnResult({data:{provider:e.provider,url:null==r?void 0:r.url},error:null})}catch(t){if(th(t))return this._returnResult({data:{provider:e.provider,url:null},error:t});throw t}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{let{error:s,data:{session:a}}=t;if(s)throw s;let{options:i,provider:n,token:o,access_token:l,nonce:u}=e,{data:c,error:d}=await t1(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!=(r=null==a?void 0:a.access_token)?r:void 0,body:{provider:n,id_token:o,access_token:l,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:t5});if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!c||!c.session||!c.user)return this._returnResult({data:{user:null,session:null},error:new tb});return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("USER_UPDATED",c.session)),this._returnResult({data:c,error:d})}catch(e){if(th(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;let{data:a,error:i}=t;if(i)throw i;return await t1(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!=(s=null==(r=a.session)?void 0:r.access_token)?s:void 0})})}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}}async _refreshAccessToken(e){let t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{var r,s;let a=Date.now();return await (r=async r=>(r>0&&await tF(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await t1(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:t5})),s=(e,t)=>{let r=200*Math.pow(2,e);return t&&t_(t)&&Date.now()+r-a<3e4},new Promise((e,t)=>{(async()=>{for(let a=0;a<1/0;a++)try{let t=await r(a);if(!s(a,null,t))return void e(t)}catch(e){if(!s(a,e))return void t(e)}})()}))}catch(e){if(this._debug(t,"error",e),th(e))return this._returnResult({data:{session:null,user:null},error:e});throw e}finally{this._debug(t,"end")}}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),tI()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let s=await tD(this.storage,this.storageKey);if(s&&this.userStorage){let t=await tD(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!t&&(t={user:s.user},await t$(this.userStorage,this.storageKey+"-user",t)),s.user=null!=(e=null==t?void 0:t.user)?e:tY()}else if(s&&!s.user&&!s.user){let e=await tD(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(s.user=e.user,await tB(this.storage,this.storageKey+"-user"),await t$(this.storage,this.storageKey,s)):s.user=tY()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),null!==s&&await this._removeSession();return}let a=(null!=(t=s.expires_at)?t:1/0)*1e3-Date.now()<9e4;if(this._debug(r,`session has${a?"":" not"} expired with margin of 90000s`),a){if(this.autoRefreshToken&&s.refresh_token){let{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),t_(e)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(s.user&&!0===s.user.__isUserNotAvailableProxy)try{let{data:e,error:t}=await this._getUser(s.access_token);!t&&(null==e?void 0:e.user)?(s.user=e.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(e){console.error("Error getting user data:",e),this._debug(r,"error getting user data, skipping SIGNED_IN notification",e)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(e){this._debug(r,"error",e),console.error(e);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new tg;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new tM;let{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new tg;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);let s={data:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(e){if(this._debug(s,"error",e),th(e)){let r={data:null,error:e};return t_(e)||await this._removeSession(),null==(t=this.refreshingDeferred)||t.resolve(r),r}throw null==(r=this.refreshingDeferred)||r.reject(e),e}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){let s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});let s=[],a=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(e){s.push(e)}});if(await Promise.all(a),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;let t=Object.assign({},e),r=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!r&&t.user&&await t$(this.userStorage,this.storageKey+"-user",{user:t.user});let e=Object.assign({},t);delete e.user;let s=tX(e);await t$(this.storage,this.storageKey,s)}else{let e=tX(t);await t$(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await tB(this.storage,this.storageKey),await tB(this.storage,this.storageKey+"-code-verifier"),await tB(this.storage,this.storageKey+"-user"),this.userStorage&&await tB(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&tI()&&(null==window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");let s=Math.floor((1e3*r.expires_at-e)/3e4);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof rs)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!tI()||!(null==window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null==window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"!==document.visibilityState?this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting"):await this._recoverAndRefresh()}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){let s=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){let[e,t]=await tH(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});s.push(r.toString())}if(null==r?void 0:r.queryParams){let e=new URLSearchParams(r.queryParams);s.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;let{data:s,error:a}=t;return a?this._returnResult({data:null,error:a}):await t1(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null==(r=null==s?void 0:s.session)?void 0:r.access_token})})}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;let{data:a,error:i}=t;if(i)return this._returnResult({data:null,error:i});let n=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:o,error:l}=await t1(this.fetch,"POST",`${this.url}/factors`,{body:n,headers:this.headers,jwt:null==(r=null==a?void 0:a.session)?void 0:r.access_token});return l?this._returnResult({data:null,error:l}):("totp"===e.factorType&&"totp"===o.type&&(null==(s=null==o?void 0:o.totp)?void 0:s.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),this._returnResult({data:o,error:null}))})}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r,s,a;let{data:i,error:n}=t;if(n)return this._returnResult({data:null,error:n});let o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?(s=e.webauthn.credential_response,"toJSON"in s&&"function"==typeof s.toJSON?s.toJSON():{id:s.id,rawId:s.id,response:{attestationObject:tR(new Uint8Array(s.response.attestationObject)),clientDataJSON:tR(new Uint8Array(s.response.clientDataJSON))},type:"public-key",clientExtensionResults:s.getClientExtensionResults(),authenticatorAttachment:null!=(a=s.authenticatorAttachment)?a:void 0}):function(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();let r=e.getClientExtensionResults(),s=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:tR(new Uint8Array(s.authenticatorData)),clientDataJSON:tR(new Uint8Array(s.clientDataJSON)),signature:tR(new Uint8Array(s.signature)),userHandle:s.userHandle?tR(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:null!=(t=e.authenticatorAttachment)?t:void 0}}(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:u}=await t1(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:null==(r=null==i?void 0:i.session)?void 0:r.access_token});return u?this._returnResult({data:null,error:u}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:u}))})}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;let{data:s,error:a}=t;if(a)return this._returnResult({data:null,error:a});let i=await t1(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null==(r=null==s?void 0:s.session)?void 0:r.access_token});if(i.error)return i;let{data:n}=i;if("webauthn"!==n.type)return{data:n,error:null};switch(n.webauthn.type){case"create":return{data:Object.assign(Object.assign({},n),{webauthn:Object.assign(Object.assign({},n.webauthn),{credential_options:Object.assign(Object.assign({},n.webauthn.credential_options),{publicKey:function(e){if(!e)throw Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);let{challenge:t,user:r,excludeCredentials:s}=e,a=(0,G.__rest)(e,["challenge","user","excludeCredentials"]),i=tN(t).buffer,n=Object.assign(Object.assign({},r),{id:tN(r.id).buffer}),o=Object.assign(Object.assign({},a),{challenge:i,user:n});if(s&&s.length>0){o.excludeCredentials=Array(s.length);for(let e=0;e<s.length;e++){let t=s[e];o.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:tN(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return o}(n.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},n),{webauthn:Object.assign(Object.assign({},n.webauthn),{credential_options:Object.assign(Object.assign({},n.webauthn.credential_options),{publicKey:function(e){if(!e)throw Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);let{challenge:t,allowCredentials:r}=e,s=(0,G.__rest)(e,["challenge","allowCredentials"]),a=tN(t).buffer,i=Object.assign(Object.assign({},s),{challenge:a});if(r&&r.length>0){i.allowCredentials=Array(r.length);for(let e=0;e<r.length;e++){let t=r[e];i.allowCredentials[e]=Object.assign(Object.assign({},t),{id:tN(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return i}(n.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}})}async _challengeAndVerify(e){let{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;let{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};let s={all:[],phone:[],totp:[],webauthn:[]};for(let r of null!=(e=null==t?void 0:t.factors)?e:[])s.all.push(r),"verified"===r.status&&s[r.factor_type].push(r);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;let{data:{session:r},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:a}=tq(r.access_token),i=null;a.aal&&(i=a.aal);let n=i;return(null!=(t=null==(e=r.user.factors)?void 0:e.filter(e=>"verified"===e.status))?t:[]).length>0&&(n="aal2"),{data:{currentLevel:i,nextLevel:n,currentAuthenticationMethods:a.amr||[]},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{let{data:{session:r},error:s}=t;return s?this._returnResult({data:null,error:s}):r?await t1(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new tg})})}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}}async _approveAuthorization(e,t){try{return await this._useSession(async r=>{let{data:{session:s},error:a}=r;if(a)return this._returnResult({data:null,error:a});if(!s)return this._returnResult({data:null,error:new tg});let i=await t1(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&tI()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}}async _denyAuthorization(e,t){try{return await this._useSession(async r=>{let{data:{session:s},error:a}=r;if(a)return this._returnResult({data:null,error:a});if(!s)return this._returnResult({data:null,error:new tg});let i=await t1(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:e=>({data:e,error:null})});return i.data&&i.data.redirect_url&&tI()&&!(null==t?void 0:t.skipBrowserRedirect)&&window.location.assign(i.data.redirect_url),i})}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}}async _listOAuthGrants(){try{return await this._useSession(async e=>{let{data:{session:t},error:r}=e;return r?this._returnResult({data:null,error:r}):t?await t1(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:e=>({data:e,error:null})}):this._returnResult({data:null,error:new tg})})}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{let{data:{session:r},error:s}=t;return s?this._returnResult({data:null,error:s}):r?await t1(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},xform:()=>({data:{},error:null})}):this._returnResult({data:null,error:new tg})})}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(t=>t.kid===e);if(r)return r;let s=Date.now();if((r=this.jwks.keys.find(t=>t.kid===e))&&this.jwks_cached_at+6e5>s)return r;let{data:a,error:i}=await t1(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return a.keys&&0!==a.keys.length&&(this.jwks=a,this.jwks_cached_at=s,r=a.keys.find(t=>t.kid===e))?r:null}async getClaims(e,t={}){try{var r;let s,a=e;if(!a){let{data:e,error:t}=await this.getSession();if(t||!e.session)return this._returnResult({data:null,error:t});a=e.session.access_token}let{header:i,payload:n,signature:o,raw:{header:l,payload:u}}=tq(a);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw Error("JWT has expired")}(n.exp);let c=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks);if(!c){let{error:e}=await this.getUser(a);if(e)throw e;return{data:{claims:n,header:i,signature:o},error:null}}let d=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw Error("Invalid alg claim")}}(i.alg),h=await crypto.subtle.importKey("jwk",c,d,!0,["verify"]);if(!await crypto.subtle.verify(d,h,o,(r=`${l}.${u}`,s=[],!function(e,t){for(let r=0;r<e.length;r+=1){let s=e.charCodeAt(r);if(s>55295&&s<=56319){let t=(s-55296)*1024&65535;s=(e.charCodeAt(r+1)-56320&65535|t)+65536,r+=1}!function(e,t){if(e<=127)return t(e);if(e<=2047){t(192|e>>6),t(128|63&e);return}if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|63&e);return}if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|63&e);return}throw Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}(s,t)}}(r,e=>s.push(e)),new Uint8Array(s))))throw new tk("Invalid JWT signature");return{data:{claims:n,header:i,signature:o},error:null}}catch(e){if(th(e))return this._returnResult({data:null,error:e});throw e}}}rx.nextInstanceID={};let r_=rx;class rE extends r_{constructor(e){super(e)}}(function(){if("undefined"!=typeof window||void 0===A.default)return!1;let e=A.default.version;if(null==e)return!1;let t=e.match(/^v(\d+)\./);return!!t&&18>=parseInt(t[1],10)})()&&console.warn(`⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217`);let rk=new class e{constructor(e,t,r){var s,a,i;this.supabaseUrl=e,this.supabaseKey=t;const n=function(e){let t=null==e?void 0:e.trim();if(!t)throw Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(t.endsWith("/")?t:t+"/")}catch(e){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}(e);if(!t)throw Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",n),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",n),this.storageUrl=new URL("storage/v1",n),this.functionsUrl=new URL("functions/v1",n);const o=`sb-${n.hostname.split(".")[0]}-auth-token`,l=function(e,t){var r,s;let{db:a,auth:i,realtime:n,global:o}=e,{db:l,auth:u,realtime:c,global:d}=t,h={db:Object.assign(Object.assign({},l),a),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},c),n),storage:{},global:Object.assign(Object.assign(Object.assign({},d),o),{headers:Object.assign(Object.assign({},null!=(r=null==d?void 0:d.headers)?r:{}),null!=(s=null==o?void 0:o.headers)?s:{})}),accessToken:async()=>""};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=r?r:{},{db:ts,realtime:ti,auth:Object.assign(Object.assign({},ta),{storageKey:o}),global:tr});this.storageKey=null!=(s=l.auth.storageKey)?s:"",this.headers=null!=(a=l.global.headers)?a:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!=(i=l.auth)?i:{},this.headers,l.global.fetch),this.fetch=((e,t,r)=>{let s=r?(...e)=>r(...e):(...e)=>fetch(...e),a=Headers;return async(r,i)=>{var n;let o=null!=(n=await t())?n:e,l=new a(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),s(r,Object.assign(Object.assign({},i),{headers:l}))}})(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(e=>this.realtime.setAuth(e)).catch(e=>console.warn("Failed to set initial Realtime auth token:",e)),this.rest=new et(new URL("rest/v1",n).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new te(this.storageUrl.href,this.headers,this.fetch,null==r?void 0:r.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new Q(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var e,t;if(this.accessToken)return await this.accessToken();let{data:r}=await this.auth.getSession();return null!=(t=null==(e=r.session)?void 0:e.access_token)?t:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:a,storageKey:i,flowType:n,lock:o,debug:l,throwOnError:u},c,d){let h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new rE({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),c),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:a,flowType:n,lock:o,debug:l,throwOnError:u,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new eT(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){("TOKEN_REFRESHED"===e||"SIGNED_IN"===e)&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0)}}("https://pmhztbcyyhcbvxlusxgp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBtaHp0YmN5eWhjYnZ4bHVzeGdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5NzgxOTksImV4cCI6MjA3NzU1NDE5OX0.KN0DhyAd129DWztqRglG-mZD5hK0rBWPxIm2RpBM4HA",void 0),rj={web:"document",codigo:"code",sugestao:"suggestion"},rS=H.replace(/'/g,"''"),rT=K.replace(/'/g,"''"),rO=`-- Habilita a extens\xe3o uuid-ossp se ainda n\xe3o estiver habilitada
CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA extensions;

-- Tabela de perfis de usu\xe1rio
CREATE TABLE IF NOT EXISTS public.user_profiles (
  user_id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  full_name TEXT,
  user_type TEXT,
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
ALTER TABLE public.user_profiles ENABLE ROW LEVEL SECURITY;
DROP POLICY IF EXISTS "Os usu\xe1rios podem gerenciar seu pr\xf3prio perfil." ON public.user_profiles;
CREATE POLICY "Os usu\xe1rios podem gerenciar seu pr\xf3prio perfil."
ON public.user_profiles FOR ALL
USING (auth.uid() = user_id)
WITH CHECK (auth.uid() = user_id);


-- Tabela de documentos
CREATE TABLE IF NOT EXISTS public.documents (
  id UUID PRIMARY KEY DEFAULT extensions.uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE, -- user_id \xe9 nulo para documentos p\xfablicos
  name TEXT NOT NULL,
  content TEXT NOT NULL,
  is_deletable BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
-- Adiciona um \xedndice \xfanico para nomes de documentos p\xfablicos para o ON CONFLICT funcionar de forma confi\xe1vel.
CREATE UNIQUE INDEX IF NOT EXISTS documents_public_name_key ON public.documents (name) WHERE (user_id IS NULL);
ALTER TABLE public.documents ENABLE ROW LEVEL SECURITY;
-- Pol\xedtica SELECT: permite ver documentos pr\xf3prios ou p\xfablicos (user_id IS NULL)
DROP POLICY IF EXISTS "Usu\xe1rios podem visualizar documentos p\xfablicos e os seus pr\xf3prios." ON public.documents;
CREATE POLICY "Usu\xe1rios podem visualizar documentos p\xfablicos e os seus pr\xf3prios."
ON public.documents FOR SELECT
USING (user_id IS NULL OR user_id = auth.uid());
-- Pol\xedtica INSERT: s\xf3 pode criar documentos para si mesmo
DROP POLICY IF EXISTS "Usu\xe1rios podem criar seus pr\xf3prios documentos." ON public.documents;
CREATE POLICY "Usu\xe1rios podem criar seus pr\xf3prios documentos."
ON public.documents FOR INSERT
WITH CHECK (user_id = auth.uid());
-- Pol\xedtica UPDATE: s\xf3 pode modificar seus pr\xf3prios documentos
DROP POLICY IF EXISTS "Usu\xe1rios podem modificar seus pr\xf3prios documentos." ON public.documents;
CREATE POLICY "Usu\xe1rios podem modificar seus pr\xf3prios documentos."
ON public.documents FOR UPDATE
USING (user_id = auth.uid() AND is_deletable = TRUE)
WITH CHECK (user_id = auth.uid());
-- Pol\xedtica DELETE: s\xf3 pode excluir seus pr\xf3prios documentos
DROP POLICY IF EXISTS "Usu\xe1rios podem excluir seus pr\xf3prios documentos." ON public.documents;
CREATE POLICY "Usu\xe1rios podem excluir seus pr\xf3prios documentos."
ON public.documents FOR DELETE
USING (user_id = auth.uid() AND is_deletable = TRUE);


-- Tabela de conversas
CREATE TABLE IF NOT EXISTS public.conversations (
  id UUID PRIMARY KEY DEFAULT extensions.uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  title TEXT NOT NULL,
  agent_type TEXT NOT NULL CHECK (agent_type IN ('document', 'code', 'suggestion')),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
ALTER TABLE public.conversations ADD COLUMN IF NOT EXISTS updated_at TIMESTAMPTZ DEFAULT NOW();
ALTER TABLE public.conversations DISABLE ROW LEVEL SECURITY;
ALTER TABLE public.conversations ENABLE ROW LEVEL SECURITY;

-- Pol\xedticas de seguran\xe7a para conversas
DROP POLICY IF EXISTS "Usu\xe1rios podem visualizar suas pr\xf3prias conversas ou \xf3rf\xe3s." ON public.conversations;
CREATE POLICY "Usu\xe1rios podem visualizar suas pr\xf3prias conversas ou \xf3rf\xe3s."
ON public.conversations FOR SELECT
USING (user_id = auth.uid() OR user_id IS NULL);

DROP POLICY IF EXISTS "Usu\xe1rios podem criar conversas para si mesmos." ON public.conversations;
CREATE POLICY "Usu\xe1rios podem criar conversas para si mesmos."
ON public.conversations FOR INSERT
WITH CHECK (user_id = auth.uid());

DROP POLICY IF EXISTS "Usu\xe1rios podem atualizar suas pr\xf3prias conversas ou reivindicar \xf3rf\xe3s." ON public.conversations;
CREATE POLICY "Usu\xe1rios podem atualizar suas pr\xf3prias conversas ou reivindicar \xf3rf\xe3s."
ON public.conversations FOR UPDATE
USING (user_id = auth.uid() OR user_id IS NULL)
WITH CHECK (user_id = auth.uid());

DROP POLICY IF EXISTS "Usu\xe1rios podem excluir suas pr\xf3prias conversas ou \xf3rf\xe3s." ON public.conversations;
CREATE POLICY "Usu\xe1rios podem excluir suas pr\xf3prias conversas ou \xf3rf\xe3s."
ON public.conversations FOR DELETE
USING (user_id = auth.uid() OR user_id IS NULL);


-- Tabela de mensagens
CREATE TABLE IF NOT EXISTS public.messages (
  id UUID PRIMARY KEY DEFAULT extensions.uuid_generate_v4(),
  user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  conversation_id UUID NOT NULL REFERENCES public.conversations(id) ON DELETE CASCADE,
  sender TEXT NOT NULL CHECK (sender IN ('user', 'bot')),
  text TEXT NOT NULL,
  sources JSONB,
  feedback TEXT CHECK (feedback IN ('good', 'bad')),
  created_at TIMESTAMPTZ DEFAULT NOW()
);
ALTER TABLE public.messages ENABLE ROW LEVEL SECURITY;

/*
 * **REVIS\xc3O PROFUNDA E CORRE\xc7\xc3O DEFINITIVA DA POL\xcdTICA DE MENSAGENS**
 * A causa raiz do problema de exclus\xe3o \xe9 que a pol\xedtica de mensagens verificava a posse
 * da *mensagem* individual. Isso falhava durante uma exclus\xe3o em cascata se alguma
 * mensagem legada tivesse um 'user_id' inconsistente.
 * A nova pol\xedtica resolve isso vinculando a permiss\xe3o para modificar uma mensagem
 * \xe0 posse da *conversa* pai. Se um usu\xe1rio pode excluir a conversa, ele
 * implicitamente pode excluir todas as mensagens contidas nela. Isso garante
 * que a exclus\xe3o em cascata funcione corretamente em todos os casos.
 */
DROP POLICY IF EXISTS "Usu\xe1rios podem gerenciar suas mensagens pr\xf3prias ou \xf3rf\xe3s." ON public.messages;
DROP POLICY IF EXISTS "Usu\xe1rios gerenciam mensagens baseadas na posse da conversa." ON public.messages;
CREATE POLICY "Usu\xe1rios gerenciam mensagens baseadas na posse da conversa."
ON public.messages FOR ALL
USING (
  EXISTS (
    SELECT 1 FROM public.conversations
    WHERE id = messages.conversation_id AND (user_id = auth.uid() OR user_id IS NULL)
  )
)
WITH CHECK (
  -- A verifica\xe7\xe3o (WITH CHECK) para novas inser\xe7\xf5es/atualiza\xe7\xf5es garante que o usu\xe1rio
  -- que est\xe1 agindo seja o dono da mensagem E da conversa, mantendo a integridade.
  user_id = auth.uid() AND
  EXISTS (
    SELECT 1 FROM public.conversations
    WHERE id = messages.conversation_id AND user_id = auth.uid()
  )
);


-- \xcdndices para otimizar buscas
CREATE INDEX IF NOT EXISTS idx_messages_conversation_id ON public.messages(conversation_id);
CREATE INDEX IF NOT EXISTS idx_messages_user_id ON public.messages(user_id);
CREATE INDEX IF NOT EXISTS idx_conversations_updated_at ON public.conversations(updated_at DESC);


-- SEED DE DADOS: Insere os documentos da base de conhecimento inicial.
-- \xc9 seguro rodar isso v\xe1rias vezes por causa do "ON CONFLICT".
-- A execu\xe7\xe3o deste script no painel do Supabase ignora a RLS, permitindo a inser\xe7\xe3o de documentos p\xfablicos (user_id = NULL).
INSERT INTO public.documents (name, content, is_deletable, user_id) VALUES
('Conhecimento - Agente.txt', '${rS}', false, NULL),
('Conhecimento - Reforma.txt', '${rT}', false, NULL)
ON CONFLICT (name) WHERE (user_id IS NULL) DO NOTHING;


-- Coment\xe1rios para clareza
COMMENT ON COLUMN public.documents.user_id IS 'Chave estrangeira para o usu\xe1rio que enviou o documento. NULO para documentos da base de conhecimento global.';
COMMENT ON COLUMN public.conversations.user_id IS 'Chave estrangeira para o usu\xe1rio dono da conversa.';
COMMENT ON COLUMN public.messages.user_id IS 'Chave estrangeira para o usu\xe1rio que criou a mensagem.';
COMMENT ON POLICY "Usu\xe1rios gerenciam mensagens baseadas na posse da conversa." ON public.messages IS 'Permite opera\xe7\xf5es em mensagens se o usu\xe1rio possuir a conversa pai.';
`,rC=e=>`ERRO DE CONFIGURA\xc7\xc3O DO BANCO DE DADOS

Foi detectado um problema com a estrutura do seu banco de dados: **${e}**.

Isso geralmente significa que as tabelas ou pol\xedticas de seguran\xe7a (Row Level Security) necess\xe1rias para separar os dados por usu\xe1rio est\xe3o ausentes ou incorretas.

SOLU\xc7\xc3O:
1. V\xe1 para o seu projeto em supabase.com.
2. No menu \xe0 esquerda, clique no \xedcone de "SQL Editor".
3. Clique em "+ New query".
4. Cole o script SQL abaixo e clique em "RUN". Este script \xe9 seguro para ser executado v\xe1rias vezes e ir\xe1 criar ou corrigir as tabelas, pol\xedticas de seguran\xe7a e dados iniciais.

--- SCRIPT SQL PARA COPIAR ---
${rO}
---------------------------------`;function rA(e){if(e instanceof Error)return e.message;if("object"==typeof e&&null!==e){let t=e.message||"Ocorreu um erro desconhecido.";return e.details&&(t+=`
Detalhes: ${e.details}`),e.hint&&(t+=`
HINT: ${e.hint}`),e.code&&(t+=` (C\xf3digo: ${e.code})`),t}try{let t=JSON.stringify(e);return"{}"===t?String(e):t}catch{return String(e)}}let rN=C((e,t)=>({documents:[],isLoading:!1,error:null,loadInitialDocuments:async()=>{if(!t().isLoading){e({isLoading:!0,error:null});try{let{data:t,error:r}=await rk.from("documents").select("*");if(r)throw r;let s=[];for(let e of t){let t=await z(e.content,e.name,e.is_deletable);t.id=e.id,t.content=e.content,s.push(t)}e({documents:s})}catch(s){let t=rA(s),r=`Erro detalhado ao carregar documentos:
${t}`;"string"==typeof t&&(t.includes("relation")||t.includes("does not exist")||t.includes("violates row-level security policy"))&&(r=rC("A política de segurança (RLS) para `documents` pode estar ausente ou incorreta.")),e({error:r}),console.error("Erro detalhado ao carregar documentos:",s)}finally{e({isLoading:!1})}}},addDocument:async t=>{e({isLoading:!0,error:null});try{let{data:{user:r}}=await rk.auth.getUser();if(!r)throw Error("Usuário não autenticado para adicionar documento.");let s=await W(t);if(0===s.chunks.length)throw Error("O documento está vazio ou não pôde ser processado.");let a=s.content||s.chunks.map(e=>e.text).join(""),{data:i,error:n}=await rk.from("documents").insert({name:s.name,content:a,is_deletable:!0,user_id:r.id}).select().single();if(n)throw n;s.id=i.id,e(e=>({documents:[...e.documents,s]}))}catch(r){let t=rA(r);e({error:`Erro ao adicionar documento: ${t}`}),console.error("Error adding document:",r)}finally{e({isLoading:!1})}},deleteDocument:async t=>{let{error:r}=await rk.from("documents").delete().match({id:t});if(r){let t=rA(r);console.error("Error deleting document:",t),e({error:t});return}e(e=>({documents:e.documents.filter(e=>e.id!==t)}))},renameDocument:async(t,r)=>{let{error:s}=await rk.from("documents").update({name:r}).match({id:t});if(s){let t=rA(s);console.error("Error renaming document:",t),e({error:t});return}e(e=>({documents:e.documents.map(e=>e.id===t?{...e,name:r}:e)}))}})),rR=C((e,t)=>({documentConversations:{},codeConversations:{},suggestionConversations:{},activeDocumentConversationId:null,activeCodeConversationId:null,activeSuggestionConversationId:null,isLoading:!1,activeAgent:"document",activeModel:P,proTokenCount:0,proTokenLimit:32768,session:null,user:null,authLoading:!0,authError:null,authMessage:null,initAuth:()=>{rk.auth.getSession().then(({data:{session:t}})=>{e({session:t,user:t?.user??null,authLoading:!1})});let{data:{subscription:t}}=rk.auth.onAuthStateChange((t,r)=>{e({session:r,user:r?.user??null,authLoading:!1})});return()=>{t.unsubscribe()}},signUp:async(t,r,s)=>{e({authLoading:!0,authError:null,authMessage:null}),rN.setState({error:null});let{data:a,error:i}=await rk.auth.signUp({email:t,password:r,options:{data:s}});if(i){let t=rA(i);t.toLowerCase().includes("database error saving new user")||t.includes('violates row-level security policy for table "user_profiles"')?e({authLoading:!1,authError:{name:"DatabaseSetupError",message:rC("A criação de perfil de usuário falhou, indicando uma configuração de banco de dados incorreta ou políticas de RLS ausentes.")}}):i.message.includes("User already registered")?e({authLoading:!1,authError:{name:"UserAlreadyRegisteredError",message:'Este e-mail já está cadastrado.\n\n1. Se você ainda não ativou sua conta, por favor, verifique sua caixa de entrada e a pasta de spam para encontrar o e-mail de confirmação.\n\n2. Se você já confirmou mas esqueceu a senha, utilize a opção "Esqueci minha senha" na tela de login.'}}):e({authLoading:!1,authError:i});return}a.user&&a.user.identities&&0===a.user.identities.length&&console.log("Cadastro enviado com sucesso. O usuário está aguardando confirmação por e-mail e ainda não aparecerá na tabela auth.users. Verifique o e-mail ou desative a confirmação de e-mail nas configurações de autenticação do Supabase."),e({authLoading:!1,authError:null,authMessage:"Cadastro realizado! Verifique seu e-mail para confirmar a conta e poder fazer o login."})},signIn:async(t,r)=>{e({authLoading:!0,authError:null,authMessage:null});let{error:s}=await rk.auth.signInWithPassword({email:t,password:r});e({authLoading:!1,authError:s||null})},signOut:async()=>{e({authLoading:!0,authError:null}),await rk.auth.signOut(),e({session:null,user:null,authLoading:!1,authError:null})},sendPasswordResetEmail:async t=>{e({authLoading:!0,authError:null,authMessage:null});let{error:r}=await rk.auth.resetPasswordForEmail(t,{});r?e({authLoading:!1,authError:r}):e({authLoading:!1,authMessage:"Se o e-mail estiver correto, você receberá um link para redefinir sua senha em breve."})},clearAuthFeedback:()=>{e({authError:null,authMessage:null})},loadInitialData:async()=>{if(e({isLoading:!0}),rN.setState({error:null}),await rN.getState().loadInitialDocuments(),rN.getState().error)return void e({isLoading:!1});let r=t().user;if(r)try{let{data:e,error:t}=await rk.from("user_profiles").select("user_id, full_name").eq("user_id",r.id).single(),s=r.user_metadata;if(t&&"PGRST116"===t.code&&s?.full_name){console.log("Perfil de usuário não encontrado. Criando agora...");let{error:e}=await rk.from("user_profiles").insert({user_id:r.id,full_name:s.full_name,user_type:s.user_type});if(e)throw e}else if(t&&"PGRST116"!==t.code)throw t}catch(r){let t=rA(r);if(t.includes('relation "public.user_profiles" does not exist')||t.includes("column")&&t.includes("does not exist")||t.includes("violates row-level security policy")){let r="tabela ausente";t.includes("column")&&(r="estrutura de coluna incorreta"),t.includes("security policy")&&(r="políticas de segurança ausentes ou incorretas"),rN.setState({error:rC(`user_profiles (${r})`)}),e({isLoading:!1});return}console.error("Erro durante a verificação/criação do perfil:",t)}try{let{data:r,error:s}=await rk.from("conversations").select("*");if(s)throw s;let{data:a,error:i}=await rk.from("messages").select("*").order("created_at",{ascending:!0});if(i)throw i;let n={},o={},l={};for(let e of r){let t=a.filter(t=>t.conversation_id===e.id).map(e=>({id:e.id,sender:e.sender,text:e.text,feedback:e.feedback,sources:e.sources,createdAt:new Date(e.created_at).getTime()})),r={id:e.id,title:e.title,createdAt:new Date(e.created_at).getTime(),updatedAt:e.updated_at?new Date(e.updated_at).getTime():new Date(e.created_at).getTime(),messages:t};"document"===e.agent_type?n[e.id]=r:"code"===e.agent_type?o[e.id]=r:"suggestion"===e.agent_type&&(l[e.id]=r)}let u=(e,t)=>(t.updatedAt||t.createdAt)-(e.updatedAt||e.createdAt),c=Object.values(n).sort(u).map(e=>e.id),d=Object.values(o).sort(u).map(e=>e.id),h=Object.values(l).sort(u).map(e=>e.id);e({documentConversations:n,codeConversations:o,suggestionConversations:l,activeDocumentConversationId:c[0]||null,activeCodeConversationId:d[0]||null,activeSuggestionConversationId:h[0]||null}),"document"!==t().activeAgent||t().activeDocumentConversationId||await t().startNewConversation("document")}catch(r){let e=rA(r),t=`Erro ao carregar o hist\xf3rico de conversas: ${e}`;"string"==typeof e&&(e.includes("relation")||e.includes("does not exist")||e.includes("violates row-level security policy"))&&(t=rC("A política de segurança (RLS) para `conversations` ou `messages` pode estar ausente ou incorreta.")),rN.setState({error:t}),console.error("Erro detalhado ao carregar conversas:",r)}finally{e({isLoading:!1})}},setActiveAgent:r=>{e({activeAgent:r});let s=t(),a=!1;switch(r){case"document":a=!s.activeDocumentConversationId||!s.documentConversations[s.activeDocumentConversationId];break;case"code":a=!s.activeCodeConversationId||!s.codeConversations[s.activeCodeConversationId];break;case"suggestion":a=!s.activeSuggestionConversationId||!s.suggestionConversations[s.activeSuggestionConversationId]}a&&t().startNewConversation(r)},startNewConversation:async t=>{let{data:{user:r}}=await rk.auth.getUser();if(!r){let e="Usuário não autenticado. Não é possível criar uma nova conversa.";console.error(e),rN.setState({error:e});return}let s=((e="Nova Conversa")=>({id:crypto.randomUUID(),title:e,messages:[],createdAt:Date.now(),updatedAt:Date.now()}))(),{error:a}=await rk.from("conversations").insert({id:s.id,user_id:r.id,title:s.title,agent_type:t,created_at:new Date(s.createdAt).toISOString(),updated_at:new Date(s.updatedAt).toISOString()});if(a){let e=rA(a);if(console.error("Failed to create conversation:",e),"string"==typeof e&&(e.includes("violates row-level security policy")||e.includes("column")&&e.includes("does not exist")||e.includes("PGRST204"))){let e=rC("Falha ao criar conversa. A estrutura da tabela `conversations` parece estar desatualizada ou incorreta.");rN.setState({error:e})}else rN.setState({error:`Falha ao criar a conversa: ${e}`});return}switch(t){case"document":e(e=>({documentConversations:{...e.documentConversations,[s.id]:s},activeDocumentConversationId:s.id}));break;case"code":e(e=>({codeConversations:{...e.codeConversations,[s.id]:s},activeCodeConversationId:s.id}));break;case"suggestion":e(e=>({suggestionConversations:{...e.suggestionConversations,[s.id]:s},activeSuggestionConversationId:s.id}))}},deleteConversation:async(r,s)=>{let a=null,i=null;if("document"===r?(a="documentConversations",i="activeDocumentConversationId"):"code"===r?(a="codeConversations",i="activeCodeConversationId"):"suggestion"===r&&(a="suggestionConversations",i="activeSuggestionConversationId"),!a||!i)return;let n=t()[a],o=t()[i],l={...n};delete l[s];let u=o;u===s&&(u=Object.values(l).sort((e,t)=>(t.updatedAt||t.createdAt)-(e.updatedAt||e.createdAt)).map(e=>e.id)[0]||null),e({[a]:l,[i]:u});let{error:c}=await rk.from("conversations").delete().match({id:s});if(c){let t=rA(c);console.error("Failed to delete conversation:",t),rN.setState({error:`Falha ao excluir a conversa: ${t}`}),e({[a]:n,[i]:o})}0===Object.keys(t()[a]).length&&t().startNewConversation(r)},setActiveConversation:(t,r)=>{switch(t){case"document":e({activeDocumentConversationId:r});break;case"code":e({activeCodeConversationId:r});break;case"suggestion":e({activeSuggestionConversationId:r})}},setMessageFeedback:async(r,s,a,i)=>{let n=null;if("document"===r?n="documentConversations":"code"===r?n="codeConversations":"suggestion"===r&&(n="suggestionConversations"),!n)return;let o=t()[n][s];if(!o)return;let l=o.messages.find(e=>e.id===a);if(!l)return;let u=l.feedback===i?null:i,c=o.messages.map(e=>e.id===a?{...e,feedback:u}:e);e(e=>({[n]:{...e[n],[s]:{...o,messages:c}}}));let{error:d}=await rk.from("messages").update({feedback:u}).match({id:a});if(d){let t=rA(d);console.error("Failed to set feedback:",t),rN.setState({error:`Falha ao salvar o feedback: ${t}`}),e(e=>({[n]:{...e[n],[s]:{...o,messages:o.messages}}}))}},sendMessage:async(r,s)=>{let a,i,n=r.trim();if(!n)return;let o=rN.getState().error;o&&!o.includes("ERRO DE CONFIGURAÇÃO DO BANCO DE DADOS")&&rN.setState({error:null});let l=t().user;if(!l){let t="Usuário não autenticado. A mensagem não pode ser enviada. Por favor, faça o login novamente.";console.error(t),rN.setState({error:t}),e({isLoading:!1});return}let u=t().activeAgent,c=n,d=n.match(/^@(\w+)/);if(d){let e=rj[d[1].toLowerCase()];e&&(u=e,c=n.replace(/^@\w+\s?/,"").trim())}if(!c){t().activeAgent!==u&&t().setActiveAgent(u);return}t().activeAgent!==u&&e({activeAgent:u});let h=t().activeAgent;switch(h){case"document":a=t().activeDocumentConversationId,i="documentConversations";break;case"code":a=t().activeCodeConversationId,i="codeConversations";break;case"suggestion":a=t().activeSuggestionConversationId,i="suggestionConversations"}if(!a&&(await t().startNewConversation(h),!(a=t()[`active${h.charAt(0).toUpperCase()+h.slice(1)}ConversationId`]))){console.error("Failed to create or find an active conversation."),rN.setState({error:"Falha ao criar ou encontrar uma conversa ativa."});return}let f=(t()[i][a]?.messages.length??0)===0,p={id:crypto.randomUUID(),sender:"user",text:c,createdAt:Date.now()};e(e=>{let t=e[i],r=t?.[a];return r?{[i]:{...t,[a]:{...r,messages:[...r.messages,p]}}}:e}),e({isLoading:!0});let{error:m}=await rk.from("messages").insert({id:p.id,conversation_id:a,sender:"user",text:c,sources:null,created_at:new Date(p.createdAt).toISOString(),user_id:l.id});if(m){let e=rA(m);console.error("Failed to save user message:",e),rN.setState({error:`Falha ao salvar sua mensagem: ${e}`})}f&&B(c).then(async t=>{let r=t||c.substring(0,30),{error:s}=await rk.from("conversations").update({title:r,user_id:l.id}).match({id:a});if(s){let e=rA(s);console.error("Failed to update title:",e),rN.setState({error:`Falha ao atualizar o t\xedtulo: ${e}`})}e(e=>{let t=e[i],s=t?.[a];return s?{[i]:{...t,[a]:{...s,title:r}}}:e})});let g="",b=c,y=P,w=!1;try{if("document"===h&&s.length>0){let e=(await D([c]))[0],t=s.flatMap(e=>e.chunks);if(t.length>0&&e){let r=t.map(t=>({...t,similarity:V(e,t.embedding)})).sort((e,t)=>t.similarity-e.similarity),s=[],a=r;if(a.length>0)for(s.push(a[0]),a=a.slice(1);s.length<5&&a.length>0;){let e=-1,t=-1/0;for(let r=0;r<a.length;r++){let i=a[r],n=i.similarity,o=Math.max(...s.map(e=>V(i.embedding,e.embedding))),l=.7*n-.30000000000000004*o;l>t&&(t=l,e=r)}if(-1!==e)s.push(a[e]),a.splice(e,1);else break}s.length>0&&s[0].similarity>.5&&(g=s.map(e=>e.text).join("\n\n---\n\n"))}}if("document"===h)w=!0,g?(y=I,b=`${L}

Com base no seguinte contexto recuperado de seus documentos de conhecimento, responda \xe0 pergunta do usu\xe1rio. Priorize estritamente as informa\xe7\xf5es do contexto. Se o contexto n\xe3o for suficiente, indique isso e use a busca na web para complementar.

Contexto:
${g}

---

Pergunta do usu\xe1rio: ${c}`):(y=I,b=`${L}

Responda \xe0 pergunta do usu\xe1rio usando seu conhecimento fundamental e a busca na web, pois nenhum contexto relevante foi encontrado nos documentos enviados. Sempre cite as fontes da web que utilizar.

Pergunta: ${c}`);else if("code"===h){y="z-ai/glm-4.5-air:free";let e="",r=t()[i][a];if(r&&r.messages.length>1){let t=r.messages.slice(0,-1).slice(-4);if(t.length>0){let r=t.map(e=>`${"user"===e.sender?"Usuário":"Assistente"}: ${e.text}`).join("\n");e=`Considere o hist\xf3rico recente desta conversa como contexto:

--- HIST\xd3RICO DA CONVERSA ---
${r}
--- FIM DO HIST\xd3RICO ---

`}}b=`${U}

${e}Tarefa do usu\xe1rio: ${c}`}else"suggestion"===h&&(y="google/gemma-3-27b-it:free",b=`${$}

Pergunta do usu\xe1rio para melhorar: "${c}"`,w=!1);let r=t().proTokenCount+b.length/4;e({proTokenCount:r});let n=y;y===I&&r>22937.6&&(n=P,console.warn(`Token limit for ${I} is approaching. Switching to ${P} for this request.`)),e({activeModel:n});let{text:o,sources:u}=await M(n,b,w),d=Date.now(),f={id:crypto.randomUUID(),sender:"bot",text:o,sources:u,createdAt:d},{error:p}=await rk.from("messages").insert({id:f.id,conversation_id:a,sender:"bot",text:f.text,sources:f.sources,created_at:new Date(f.createdAt).toISOString(),user_id:l.id});if(p){let e=rA(p);console.error("Failed to save bot message:",e),rN.setState({error:`Falha ao salvar a resposta do assistente: ${e}`})}let{error:m}=await rk.from("conversations").update({updated_at:new Date(d).toISOString()}).match({id:a});m&&console.error("Failed to update conversation timestamp:",rA(m)),e(e=>{let t=e[i],r=t?.[a];return r?{[i]:{...t,[a]:{...r,messages:[...r.messages,f],updatedAt:d}}}:e})}catch(o){let t=rA(o);console.error("Error generating response:",t);let r=Date.now(),s={id:crypto.randomUUID(),sender:"bot",text:`Ocorreu um erro ao processar sua solicita\xe7\xe3o. Por favor, tente novamente.

Detalhes do erro:
\`\`\`
${t}
\`\`\``,createdAt:r},{error:n}=await rk.from("conversations").update({updated_at:new Date(r).toISOString()}).match({id:a});n&&console.error("Failed to update conversation timestamp on error:",rA(n)),e(e=>{let t=e[i],n=t?.[a];return n?{[i]:{...t,[a]:{...n,messages:[...n.messages,s],updatedAt:r}}}:e})}finally{e({isLoading:!1})}}})),rI=({className:e})=>(0,j.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:e,"aria-label":"Ícone do Robô",children:[(0,j.jsx)("path",{d:"M12 2a2 2 0 0 1 2 2v2h-4V4a2 2 0 0 1 2-2zM4.636 8.364A9 9 0 0 1 12 4a9 9 0 0 1 7.364 4.364L20 10v6a2 2 0 0 1-2 2h-1.586l-1.707-1.707A4.002 4.002 0 0 0 12 15a4.002 4.002 0 0 0-2.707 1.293L7.586 18H6a2 2 0 0 1-2-2v-6l.636-1.636zM9 12a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm6 0a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),(0,j.jsx)("path",{d:"M5 20h14a1 1 0 0 1 1 1v1H4v-1a1 1 0 0 1 1-1z"})]}),rP=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:e,children:(0,j.jsx)("path",{fillRule:"evenodd",d:"M18.685 19.097A9.723 9.723 0 0021.75 12c0-5.385-4.365-9.75-9.75-9.75S2.25 6.615 2.25 12a9.723 9.723 0 003.065 7.097A9.716 9.716 0 0012 21.75a9.716 9.716 0 006.685-2.653zm-12.54-1.285A7.486 7.486 0 0112 15a7.486 7.486 0 015.855 2.812A8.224 8.224 0 0112 20.25a8.224 8.224 0 01-5.855-2.438zM15.75 9a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z",clipRule:"evenodd"})}),rL=({className:e})=>(0,j.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,children:[(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a2.25 2.25 0 0 1-2.25 2.25H9.75A2.25 2.25 0 0 1 7.5 4.5v0a2.25 2.25 0 0 1 2.25-2.25h3.879a2.25 2.25 0 0 1 1.95.879Z"}),(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 11.25h6M9 13.5h6M9 15.75h6M4.5 5.25v13.5A2.25 2.25 0 0 0 6.75 21h10.5A2.25 2.25 0 0 0 19.5 18.75V5.25c0-1.076-.874-1.95-1.95-1.95H7.2a1.95 1.95 0 0 0-1.95 1.95Z"})]}),rU=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"})}),r$=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})}),rD=({language:e,code:t})=>{let[r,s]=(0,S.useState)(!1),a={python:"py",py:"py",javascript:"js",js:"js",typescript:"ts",ts:"ts",html:"html",css:"css",json:"json",delphi:"pas",pascal:"pas"}[e.toLowerCase()],i=!!a;return(0,j.jsxs)("div",{className:"my-4 rounded-lg bg-gray-900 dark:bg-black overflow-hidden",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 bg-gray-800 dark:bg-gray-900/50",children:[(0,j.jsx)("span",{className:"text-xs font-semibold text-gray-400 uppercase",children:e}),(0,j.jsxs)("div",{className:"flex items-center gap-4",children:[i&&(0,j.jsxs)("button",{onClick:()=>{let e=new Blob([t],{type:"text/plain;charset=utf-8"}),r=URL.createObjectURL(e),s=document.createElement("a");s.href=r,s.download=`codigo_gerado_${Date.now()}.${a||"txt"}`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r)},className:"flex items-center gap-1.5 text-xs text-gray-400 hover:text-white transition-colors",children:[(0,j.jsx)(r$,{className:"w-4 h-4"}),"Salvar .",a]}),(0,j.jsx)("button",{onClick:()=>{navigator.clipboard.writeText(t).then(()=>{s(!0),setTimeout(()=>s(!1),2e3)})},className:"flex items-center gap-1.5 text-xs text-gray-400 hover:text-white transition-colors",children:r?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(rU,{className:"w-4 h-4 text-green-400"}),"Copiado!"]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(rL,{className:"w-4 h-4"}),"Copiar"]})})]})]}),(0,j.jsx)("pre",{className:"p-4 text-sm text-white overflow-x-auto",children:(0,j.jsx)("code",{children:t})})]})},rB=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{d:"M1 8.25a1.25 1.25 0 112.5 0v7.5a1.25 1.25 0 11-2.5 0v-7.5zM11 3V1.7c0-.268.14-.516.372-.658.232-.142.518-.142.75 0l1.823.912a.75.75 0 01.428.656V8.25c0 .285.11.55.293.742l3.08 2.923c.34.323.527.773.527 1.246v1.757a2.25 2.25 0 01-2.25 2.25H9.75a.75.75 0 01-.75-.75V8.25a.75.75 0 00-.75-.75h-.5a.75.75 0 00-.75.75v5.02c0 .357-.184.686-.488.869l-2.096 1.258A.75.75 0 013.5 15.25V8.25a.75.75 0 01.75-.75h2a.75.75 0 01.75.75v2.25c0 .414.336.75.75.75h2.5a.75.75 0 00.75-.75V3z"})}),rM=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{d:"M1 11.75a1.25 1.25 0 102.5 0V4.25a1.25 1.25 0 10-2.5 0v7.5zM11 17v1.3c0 .268-.14.516-.372.658-.232.142-.518.142-.75 0l-1.823-.912a.75.75 0 01-.428-.656V11.75a.75.75 0 00-.293-.742l-3.08-2.923A2.25 2.25 0 014.25 7V5.243a2.25 2.25 0 012.25-2.25H9.25a.75.75 0 01.75.75v7.5a.75.75 0 00.75.75h.5a.75.75 0 00.75-.75V6.48c0-.357.184-.686.488-.869l2.096-1.258a.75.75 0 011.012.82V11.75a.75.75 0 01-.75.75h-2a.75.75 0 01-.75-.75V8.75a.75.75 0 00-.75-.75h-2.5a.75.75 0 00-.75.75V17z"})}),rq=/```(\w+)?\n([\s\S]+?)```/g,rF=({message:e,onFeedback:t})=>{let{sender:r,text:s,sources:a,feedback:i}=e,n="bot"===r;return(0,j.jsxs)("div",{className:`flex items-start gap-4 my-6 ${!n?"flex-row-reverse":""}`,children:[(0,j.jsx)("div",{className:`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${n?"bg-gray-200 dark:bg-gray-700":"bg-blue-600 text-white"}`,children:n?(0,j.jsx)(rI,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"}):(0,j.jsx)(rP,{className:"w-6 h-6"})}),(0,j.jsxs)("div",{className:`p-4 rounded-lg max-w-2xl shadow ${n?"bg-white dark:bg-gray-800":"bg-blue-500 text-white"}`,children:[(()=>{let e,t=[],r=0;for(;null!==(e=rq.exec(s));){e.index>r&&t.push((0,j.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none whitespace-pre-wrap",children:s.slice(r,e.index)},`text-${r}`));let a=e[1]||"text",i=e[2];t.push((0,j.jsx)(rD,{language:a,code:i},`code-${e.index}`)),r=e.index+e[0].length}return r<s.length&&t.push((0,j.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none whitespace-pre-wrap",children:s.slice(r)},`text-${r}`)),t.length>0?t:(0,j.jsx)("div",{className:"prose prose-sm dark:prose-invert max-w-none whitespace-pre-wrap",children:s})})(),a&&a.length>0&&(0,j.jsxs)("div",{className:"mt-4 border-t border-gray-200 dark:border-gray-700 pt-3",children:[(0,j.jsx)("h4",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"Fontes:"}),(0,j.jsx)("ul",{className:"space-y-1",children:a.map((e,t)=>(0,j.jsxs)("li",{className:"flex items-center",children:[(0,j.jsxs)("span",{className:"text-gray-500 dark:text-gray-400 text-xs mr-2",children:[t+1,"."]}),(0,j.jsx)("a",{href:e.uri,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline text-sm truncate",title:e.uri,children:e.title})]},t))})]}),n&&(0,j.jsxs)("div",{className:`mt-3 flex items-center gap-2 ${a&&a.length>0?"pt-3 border-t border-gray-200 dark:border-gray-700":""}`,children:[(0,j.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mr-auto",children:"Avalie esta resposta:"}),(0,j.jsx)("button",{onClick:()=>t("good"),className:`p-1.5 rounded-full transition-colors ${"good"===i?"bg-green-100 text-green-600 dark:bg-green-900/50 dark:text-green-400":"text-gray-500 hover:bg-gray-200 dark:text-gray-400 dark:hover:bg-gray-700"}`,"aria-label":"Resposta boa",children:(0,j.jsx)(rB,{className:"w-4 h-4"})}),(0,j.jsx)("button",{onClick:()=>t("bad"),className:`p-1.5 rounded-full transition-colors ${"bad"===i?"bg-red-100 text-red-600 dark:bg-red-900/50 dark:text-red-400":"text-gray-500 hover:bg-gray-200 dark:text-gray-400 dark:hover:bg-gray-700"}`,"aria-label":"Resposta ruim",children:(0,j.jsx)(rM,{className:"w-4 h-4"})})]})]})]})},rz=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:e,children:(0,j.jsx)("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"})}),rW=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.122 2.122l7.81-7.81"})}),rV=["O que muda com a nova Reforma Tributária para o setor de serviços?","Como funciona o regime de Lucro Presumido?","Quais são os principais impostos federais no Brasil?","Explique o que é o SPED Fiscal."],rH=["Gere uma função em Python para calcular o ICMS em uma venda interestadual.","Escreva um trecho de código em Delphi para validar um CNPJ.","Crie uma função Python que retorne a alíquota do ISS para um serviço em São Paulo.","Mostre um exemplo de como gerar um XML de NF-e em Python."],rK=["Melhore a pergunta: 'impostos sobre software'","Como posso perguntar sobre créditos de PIS/COFINS de forma mais eficaz?","Otimize minha dúvida sobre a tributação de serviços exportados.","Sugira alternativas para a pergunta: 'reforma tributária'"],rG=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.25 6.75 22.5 12l-5.25 5.25m-10.5 0L1.5 12l5.25-5.25m7.5-3-4.5 15"})}),rJ=({className:e})=>(0,j.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:[(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18Z"}),(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75a9.023 9.023 0 0 1 0-7.5M12 3.75c1.62 3.32 1.62 7.18 0 10.5"})]}),rY=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 18v-5.25m0 0a6.01 6.01 0 0 0 1.5-4.5 6.01 6.01 0 0 0-1.5-4.5m0 9a6.01 6.01 0 0 1-1.5-4.5 6.01 6.01 0 0 1 1.5-4.5M12 6.75v-1.5m0 12.75a3 3 0 0 1-3-3h6a3 3 0 0 1-3 3z"})}),rX=({onSendMessage:e,onUploadClick:t,isLoading:r,activeAgent:s})=>{let[a,i]=(0,S.useState)(""),[n,o]=(0,S.useState)([]),[l,u]=(0,S.useState)(-1),[c,d]=(0,S.useState)(!1),h=(0,S.useRef)(null),f=rR(e=>e.setActiveAgent),p=[{name:"Pesquisa na web",description:"Mudar para o agente de documentos.",agent:"document",alias:"web",icon:(0,j.jsx)(rJ,{className:"w-5 h-5 mr-3 text-green-500 flex-shrink-0"})},{name:"Gerar Código",description:"Mudar para o agente de programação.",agent:"code",alias:"codigo",icon:(0,j.jsx)(rG,{className:"w-5 h-5 mr-3 text-blue-500 flex-shrink-0"})},{name:"Sugestão",description:"Melhorar a sua pergunta.",agent:"suggestion",alias:"sugestao",icon:(0,j.jsx)(rY,{className:"w-5 h-5 mr-3 text-yellow-500 flex-shrink-0"})}].filter(e=>e.name.toLowerCase().includes(a.substring(1).toLowerCase())||e.alias.toLowerCase().includes(a.substring(1).toLowerCase()));(0,S.useEffect)(()=>{let e=[];switch(s){case"document":e=rV;break;case"code":e=rH;break;case"suggestion":e=rK}if(a.startsWith("@")&&!a.includes(" ")){d(!0),o([]),u(0);return}d(!1),a.trim().length>0&&!a.startsWith("@")?o(e.filter(e=>e.toLowerCase().includes(a.toLowerCase())).slice(0,5)):o([]),u(-1)},[a,s]),(0,S.useEffect)(()=>{let e=h.current;e&&(e.style.height="auto",e.style.height=`${e.scrollHeight}px`)},[a]);let m=t=>{t.trim()&&!r&&(e(t.trim()),i(""),o([]))},g=(e,t)=>{f(e),i(`@${t} `),d(!1),h.current?.focus()};return(0,j.jsxs)("div",{className:"w-full max-w-3xl mx-auto relative",children:[c&&p.length>0&&(0,j.jsxs)("div",{className:"absolute bottom-full mb-2 w-full bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-2xl shadow-lg p-2",children:[(0,j.jsx)("p",{className:"px-2 py-1 text-xs font-semibold text-gray-500 dark:text-gray-400",children:"AGENTES"}),(0,j.jsx)("ul",{className:"space-y-1",children:p.map((e,t)=>(0,j.jsxs)("li",{onClick:()=>g(e.agent,e.alias),className:`p-2 rounded-md cursor-pointer flex items-center ${t===l?"bg-blue-100 dark:bg-blue-900/50":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[e.icon,(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:e.name}),(0,j.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.description})]})]},e.name))})]}),n.length>0&&!c&&(0,j.jsx)("div",{className:"absolute bottom-full mb-2 w-full bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-2xl shadow-lg p-2",children:(0,j.jsx)("ul",{className:"space-y-1",children:n.map((e,t)=>(0,j.jsx)("li",{onClick:()=>{m(e)},className:`p-2 rounded-md cursor-pointer text-sm text-gray-800 dark:text-gray-200 ${t===l?"bg-blue-100 dark:bg-blue-900/50":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:e},e))})}),(0,j.jsxs)("div",{className:"relative flex items-end p-2 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-2xl shadow-lg",children:[(0,j.jsx)("button",{onClick:t,className:"p-2 text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors mr-2 flex-shrink-0","aria-label":"Anexar documento",children:(0,j.jsx)(rW,{className:"w-6 h-6"})}),(0,j.jsx)("textarea",{ref:h,value:a,onChange:e=>i(e.target.value),onKeyDown:e=>{if(c&&p.length>0){if("ArrowDown"===e.key)e.preventDefault(),u(e=>(e+1)%p.length);else if("ArrowUp"===e.key)e.preventDefault(),u(e=>(e-1+p.length)%p.length);else if("Enter"===e.key){if(e.preventDefault(),p[l]){let{agent:e,alias:t}=p[l];g(e,t)}}else"Escape"===e.key&&(d(!1),i(""));return}n.length>0&&("ArrowDown"===e.key?(e.preventDefault(),u(e=>(e+1)%n.length)):"ArrowUp"===e.key?(e.preventDefault(),u(e=>(e-1+n.length)%n.length)):"Enter"===e.key&&l>-1?(e.preventDefault(),m(n[l])):"Escape"===e.key&&o([])),"Enter"!==e.key||e.shiftKey||-1!==l||(e.preventDefault(),m(a))},placeholder:"Digite sua mensagem ou '@' para mudar de agente...",rows:1,className:"flex-1 w-full bg-transparent resize-none focus:outline-none text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 max-h-52",disabled:r}),(0,j.jsx)("button",{onClick:()=>m(a),disabled:r||!a.trim(),className:"ml-2 p-3 bg-blue-600 text-white rounded-full disabled:bg-gray-400 disabled:dark:bg-gray-600 hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800 flex-shrink-0","aria-label":"Enviar mensagem",children:r?(0,j.jsx)("div",{className:"w-5 h-5 border-2 border-t-transparent border-white rounded-full animate-spin"}):(0,j.jsx)(rz,{className:"w-5 h-5"})})]})]})},rZ=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})}),rQ=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),r0=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.067-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})}),r1=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"})}),r2=({isOpen:e,onClose:t})=>{let r,s,{documentConversations:a,codeConversations:i,suggestionConversations:n,activeDocumentConversationId:o,activeCodeConversationId:l,activeSuggestionConversationId:u,startNewConversation:c,deleteConversation:d,setActiveConversation:h,activeAgent:f}=rR(),[p,m]=(0,S.useState)(null),g=(0,S.useRef)(null);switch((0,S.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&m(null)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),f){case"code":r=i,s=l;break;case"suggestion":r=n,s=u;break;default:r=a,s=o}let b=Object.values(r).sort((e,t)=>(t.updatedAt||t.createdAt)-(e.updatedAt||e.createdAt));return(0,j.jsxs)("aside",{className:`fixed inset-y-0 left-0 z-40 w-80 bg-gray-50 dark:bg-gray-900 flex flex-col h-full border-r border-gray-200 dark:border-gray-700 transform transition-transform duration-300 ease-in-out ${e?"translate-x-0":"-translate-x-full"} lg:relative lg:translate-x-0 lg:flex-shrink-0`,children:[(0,j.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,j.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Histórico"}),(0,j.jsx)("button",{onClick:t,className:"lg:hidden p-1 text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full","aria-label":"Fechar histórico",children:(0,j.jsx)(rZ,{className:"w-6 h-6"})})]}),(0,j.jsx)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:(0,j.jsxs)("button",{onClick:()=>{c(f),t()},className:"w-full flex items-center justify-center p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900",children:[(0,j.jsx)(rQ,{className:"w-5 h-5 mr-2"}),(0,j.jsx)("span",{children:"Novo Chat"})]})}),(0,j.jsx)("div",{className:"flex-grow p-2 overflow-y-auto",children:0===b.length?(0,j.jsx)("div",{className:"text-center text-gray-500 dark:text-gray-400 mt-8 px-4",children:(0,j.jsxs)("p",{children:['Nenhum histórico para o agente "',"document"===f?"Consultor":"code"===f?"Código":"Sugestão",'".']})}):(0,j.jsx)("ul",{className:"space-y-1",children:b.map(e=>{var r;let a;return(0,j.jsx)("li",{children:(0,j.jsxs)("div",{onClick:()=>{h(f,e.id),t()},className:`w-full text-left p-3 rounded-md group flex items-center justify-between transition-colors duration-200 cursor-pointer ${e.id===s?"bg-blue-100 dark:bg-blue-900/50":"hover:bg-gray-200 dark:hover:bg-gray-800"}`,children:[(0,j.jsxs)("div",{className:"flex-grow overflow-hidden pr-2",children:[(0,j.jsx)("p",{className:"truncate text-sm font-medium text-gray-800 dark:text-gray-200",title:e.title,children:e.title}),(0,j.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:(r=e.updatedAt||e.createdAt,(a=(new Date().getTime()-r)/1e3)<60?"agora mesmo":a<3600?`${Math.round(a/60)}m atr\xe1s`:a<=86400?`${Math.round(a/3600)}h atr\xe1s`:new Date(r).toLocaleDateString("pt-BR",{day:"2-digit",month:"short"}))})]}),(0,j.jsxs)("div",{className:"relative flex-shrink-0",ref:p===e.id?g:null,children:[(0,j.jsx)("button",{onClick:t=>{var r;return r=e.id,void(t.stopPropagation(),m(e=>e===r?null:r))},className:"p-1 text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-100 rounded-full opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Opções da conversa",children:(0,j.jsx)(r1,{className:"w-4 h-4"})}),p===e.id&&(0,j.jsx)("div",{className:"absolute right-0 mt-2 w-32 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-10",children:(0,j.jsx)("ul",{className:"py-1",children:(0,j.jsx)("li",{children:(0,j.jsxs)("button",{onClick:t=>{var r;return r=e.id,void(t.stopPropagation(),m(null),window.confirm("Tem certeza que deseja excluir esta conversa?")&&d(f,r))},className:"w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center",children:[(0,j.jsx)(r0,{className:"w-4 h-4 mr-2"})," Excluir"]})})})})]})]})},e.id)})})})]})},r5=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})}),r3=({className:e,title:t})=>(0,j.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",className:e,"aria-hidden":"true",children:[t&&(0,j.jsx)("title",{children:t}),(0,j.jsx)("path",{fillRule:"evenodd",d:"M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z",clipRule:"evenodd"})]}),r7=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"})}),r4=({className:e})=>(0,j.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:[(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z"}),(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})]}),r6=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})}),r8=({content:e})=>(0,j.jsx)("div",{className:"p-3 pt-2 text-sm text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-800/50",children:(0,j.jsx)("div",{className:"max-h-64 overflow-y-auto border-t border-gray-200 dark:border-gray-700 pt-2",children:(0,j.jsx)("pre",{className:"whitespace-pre-wrap font-sans",children:e||"Este documento não contém texto para ser exibido."})})}),r9=({doc:e,isExpanded:t,onDelete:r,onRename:s,onToggleExpand:a})=>{let[i,n]=(0,S.useState)(!1),[o,l]=(0,S.useState)(!1),[u,c]=(0,S.useState)(e.name),d=(0,S.useRef)(null),h=(0,S.useRef)(null);(0,S.useEffect)(()=>{o&&h.current&&(h.current.focus(),h.current.select())},[o]),(0,S.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&n(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let f=()=>{u.trim()&&u.trim()!==e.name?s(e.id,u.trim()):c(e.name),l(!1),n(!1)};return(0,j.jsxs)("div",{className:"mb-2 rounded-md bg-white dark:bg-gray-800 shadow-sm border border-gray-200 dark:border-gray-700",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between p-2 cursor-pointer",onClick:()=>a(e.id),children:[(0,j.jsxs)("div",{className:"flex items-center overflow-hidden flex-grow",children:[(0,j.jsx)(r5,{className:"w-5 h-5 mr-2 flex-shrink-0 text-gray-500 dark:text-gray-400"}),o?(0,j.jsx)("input",{ref:h,type:"text",value:u,onClick:e=>e.stopPropagation(),onChange:e=>c(e.target.value),onBlur:f,onKeyDown:t=>{"Enter"===t.key?f():"Escape"===t.key&&(c(e.name),l(!1),n(!1))},className:"text-sm bg-transparent border-b border-blue-500 focus:outline-none text-gray-800 dark:text-gray-200 w-full"}):(0,j.jsx)("span",{className:"truncate text-sm text-gray-800 dark:text-gray-200",title:e.name,children:e.name})]}),(0,j.jsxs)("div",{className:"flex items-center",onClick:e=>e.stopPropagation(),children:[(0,j.jsx)(r6,{className:`w-5 h-5 text-gray-400 dark:text-gray-500 transition-transform duration-300 mr-1 ${t?"rotate-180":""}`}),(0,j.jsxs)("div",{className:"relative flex-shrink-0",ref:d,children:[e.isDeletable?(0,j.jsx)("button",{onClick:()=>n(!i),className:"p-1 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700",children:(0,j.jsx)(r1,{className:"w-5 h-5"})}):(0,j.jsx)(r3,{className:"w-4 h-4 ml-2 flex-shrink-0 text-gray-400 dark:text-gray-500",title:"Este documento faz parte da base de conhecimento e não pode ser excluído."}),i&&(0,j.jsx)("div",{className:"absolute right-0 mt-2 w-40 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 z-10",children:(0,j.jsxs)("ul",{className:"py-1",children:[(0,j.jsx)("li",{children:(0,j.jsxs)("button",{onClick:()=>{a(e.id),n(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center",children:[(0,j.jsx)(r4,{className:"w-4 h-4 mr-2"})," ",t?"Ocultar":"Visualizar"]})}),(0,j.jsx)("li",{children:(0,j.jsxs)("button",{onClick:()=>{l(!0),n(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center",children:[(0,j.jsx)(r7,{className:"w-4 h-4 mr-2"})," Renomear"]})}),(0,j.jsx)("li",{children:(0,j.jsxs)("button",{onClick:()=>{r(e.id),n(!1)},className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center",children:[(0,j.jsx)(r0,{className:"w-4 h-4 mr-2"})," Excluir"]})})]})})]})]})]}),(0,j.jsx)("div",{className:`grid transition-[grid-template-rows] duration-300 ease-in-out ${t?"grid-rows-[1fr]":"grid-rows-[0fr]"}`,children:(0,j.jsx)("div",{className:"overflow-hidden",children:(0,j.jsx)(r8,{content:e.content||""})})})]})},se=({isOpen:e,onClose:t})=>{let{documents:r,addDocument:s,deleteDocument:a,renameDocument:i,isLoading:n,error:o}=rN(),l=(0,S.useRef)(null),[u,c]=(0,S.useState)(null),d=e=>{c(t=>t===e?null:e)},h=r.filter(e=>!e.isDeletable),f=r.filter(e=>e.isDeletable);return(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("aside",{className:`fixed inset-y-0 right-0 z-40 w-80 bg-gray-50 dark:bg-gray-900/95 flex flex-col h-full border-l border-gray-200 dark:border-gray-700/50 backdrop-blur-sm transform transition-transform duration-300 ease-in-out ${e?"translate-x-0":"translate-x-full"} lg:relative lg:translate-x-0 lg:flex-shrink-0`,children:[(0,j.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Documentos"}),(0,j.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Contexto do agente."})]}),(0,j.jsx)("button",{onClick:t,className:"lg:hidden p-1 text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full","aria-label":"Fechar documentos",children:(0,j.jsx)(rZ,{className:"w-6 h-6"})})]}),(0,j.jsxs)("div",{className:"flex-grow p-4 overflow-y-auto",children:[(0,j.jsx)("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 mb-2 px-1",children:"Base de Conhecimento"}),h.length>0?h.map(e=>(0,j.jsx)(r9,{doc:e,onDelete:()=>{},onRename:()=>{},onToggleExpand:d,isExpanded:u===e.id},e.id)):(0,j.jsx)("p",{className:"text-xs text-gray-400 dark:text-gray-500 px-1",children:"Nenhum conhecimento base carregado."}),(0,j.jsx)("h3",{className:"text-sm font-semibold text-gray-500 dark:text-gray-400 mt-6 mb-2 px-1",children:"Documentos Enviados"}),f.length>0?f.map(e=>(0,j.jsx)(r9,{doc:e,onDelete:a,onRename:i,onToggleExpand:d,isExpanded:u===e.id},e.id)):(0,j.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400 mt-4 py-4 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg",children:[(0,j.jsx)(r5,{className:"w-8 h-8 mx-auto mb-1 text-gray-400"}),(0,j.jsx)("p",{className:"text-sm",children:"Nenhum documento enviado."})]}),n&&(0,j.jsxs)("div",{className:"flex items-center justify-center mt-4",children:[(0,j.jsx)("div",{className:"w-6 h-6 border-2 border-t-transparent border-blue-500 rounded-full animate-spin"}),(0,j.jsx)("span",{className:"ml-2 text-gray-600 dark:text-gray-300",children:"Processando..."})]}),o&&(0,j.jsx)("p",{className:"text-red-500 text-sm mt-2 p-2 bg-red-100 dark:bg-red-900/20 rounded-md whitespace-pre-wrap",children:o})]}),(0,j.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700",children:[(0,j.jsx)("input",{type:"file",ref:l,onChange:e=>{let t=e.target.files?.[0];t&&s(t),l.current&&(l.current.value="")},className:"hidden",accept:".txt,.md,.pdf"}),(0,j.jsxs)("button",{onClick:()=>{l.current?.click()},disabled:n,className:"w-full flex items-center justify-center p-3 bg-blue-600 text-white rounded-lg disabled:bg-gray-400 disabled:dark:bg-gray-600 hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900",children:[(0,j.jsx)(rW,{className:"w-5 h-5 mr-2"}),(0,j.jsx)("span",{children:"Enviar Documento"})]})]})]})})},st=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"})}),sr=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"})}),ss=({theme:e,toggleTheme:t})=>(0,j.jsx)("button",{onClick:t,className:"p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800","aria-label":"Alternar tema",children:"light"===e?(0,j.jsx)(sr,{className:"w-6 h-6"}):(0,j.jsx)(st,{className:"w-6 h-6"})}),sa=()=>{let{activeModel:e,proTokenCount:t,proTokenLimit:r}=rR(),s=t/r*100;return(0,j.jsxs)("div",{className:"flex flex-col items-end",children:[(0,j.jsxs)("div",{className:"text-sm text-gray-700 dark:text-gray-300 mb-1",children:[(0,j.jsx)("span",{className:"font-semibold hidden sm:inline",children:"Modelo Ativo: "}),(0,j.jsx)("span",{className:`font-bold px-2 py-0.5 rounded-full text-xs ${e===I?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"}`,children:e.includes("pro")?"Pro":"Flash"})]}),e===I&&(0,j.jsxs)("div",{className:"w-28 sm:w-48",children:[(0,j.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1 text-right whitespace-nowrap",children:[(0,j.jsx)("span",{className:"hidden sm:inline",children:"Uso (Pro): "}),t.toLocaleString(),"/",r.toLocaleString()]}),(0,j.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 dark:bg-gray-700",children:(0,j.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Math.min(s,100)}%`}})})]})]})},si={document:{title:"Sobre o Consultor de Documentos",description:"Este agente é um especialista em análise de documentos e conhecimento tributário. Sua principal função é responder a perguntas com base no contexto fornecido nos documentos enviados e em sua base de conhecimento interna. Quando necessário, ele utiliza a busca na web para complementar suas respostas.",capabilities:["Analisar arquivos de texto (TXT, MD) e PDF.","Utilizar a técnica RAG (Retrieval-Augmented Generation) para encontrar as informações mais relevantes nos documentos.","Buscar informações atualizadas na web para complementar o conhecimento.","Citar as fontes da web utilizadas nas respostas."],limitations:["Não fornece aconselhamento financeiro ou tributário licenciado.","As respostas são baseadas nas informações disponíveis e podem não cobrir todas as especificidades de um caso real.","A precisão depende da qualidade e clareza dos documentos fornecidos.","O conhecimento sobre eventos muito recentes pode ser limitado."]},code:{title:"Sobre o Gerador de Código Fiscal",description:'Este agente é um programador sênior especialista em criar trechos de código para resolver problemas tributários e fiscais, com foco em Python e Delphi. Ele pode utilizar o contexto da conversa na aba "Consultor" para gerar um código mais preciso.',capabilities:["Gerar funções e scripts em Python e Delphi.","Adicionar comentários explicativos no código.",'Utilizar o histórico da conversa do "Consultor" como contexto.',"Formatar o código em blocos para fácil leitura e cópia."],limitations:["Não pode executar ou testar o código gerado.","O código é fornecido como um exemplo e deve ser revisado por um desenvolvedor qualificado antes do uso em produção.","Não compreende a arquitetura completa de um projeto ou sistema existente.","Pode não utilizar as bibliotecas ou frameworks mais recentes, a menos que seja especificado."]},suggestion:{title:"Sobre o Otimizador de Sugestões",description:"Este agente atua como um especialista em prompts. Em vez de responder diretamente à sua pergunta, ele analisa sua intenção e sugere 3 maneiras alternativas e mais eficazes de formular a mesma pergunta para obter melhores resultados de um assistente de IA fiscal. Ideal para refinar suas buscas e obter respostas mais precisas.",capabilities:["Analisar a intenção por trás de uma pergunta.","Sugerir 3 novas formulações de prompt.","Explicar brevemente por que cada sugestão é melhor.","Ajudar a treinar o usuário a fazer perguntas mais eficazes."],limitations:["Não responde à pergunta original diretamente.","As sugestões são baseadas em heurísticas e podem não ser sempre perfeitas.","Funciona melhor com perguntas abertas e complexas."]}},sn=({isOpen:e,onClose:t,agentType:r})=>{if(!e)return null;let s=si[r];return(0,j.jsxs)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 animate-fade-in",onClick:t,"aria-modal":"true",role:"dialog",children:[(0,j.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col transform transition-transform duration-300 animate-slide-up",onClick:e=>e.stopPropagation(),children:[(0,j.jsxs)("header",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,j.jsxs)("div",{className:"flex items-center gap-3",children:[(0,j.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-gray-200 dark:bg-gray-700",children:(0,j.jsx)(rI,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})}),(0,j.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",id:"modal-title",children:s.title})]}),(0,j.jsx)("button",{onClick:t,className:"p-1 text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-full","aria-label":"Fechar modal",children:(0,j.jsx)(rZ,{className:"w-6 h-6"})})]}),(0,j.jsxs)("main",{className:"p-6 overflow-y-auto text-gray-700 dark:text-gray-300",children:[(0,j.jsx)("p",{className:"text-sm leading-relaxed mb-6",children:s.description}),(0,j.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("h3",{className:"text-md font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Capacidades"}),(0,j.jsx)("ul",{className:"space-y-2 list-disc list-inside text-sm",children:s.capabilities.map((e,t)=>(0,j.jsxs)("li",{className:"flex items-start",children:[(0,j.jsx)("span",{className:"text-green-500 mr-2 mt-1",children:"✓"}),(0,j.jsx)("span",{children:e})]},t))})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("h3",{className:"text-md font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Limitações"}),(0,j.jsx)("ul",{className:"space-y-2 list-disc list-inside text-sm",children:s.limitations.map((e,t)=>(0,j.jsxs)("li",{className:"flex items-start",children:[(0,j.jsx)("span",{className:"text-red-500 mr-2 mt-1",children:"✗"}),(0,j.jsx)("span",{children:e})]},t))})]})]}),(0,j.jsx)("div",{className:"mt-6 p-3 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-400 dark:border-yellow-500 rounded-r-lg",children:(0,j.jsxs)("p",{className:"text-xs text-yellow-800 dark:text-yellow-300",children:[(0,j.jsx)("strong",{children:"Aviso:"})," As informações e o código gerados por esta IA são para fins informativos e não substituem o aconselhamento de um profissional qualificado. Verifique sempre as informações com fontes oficiais."]})})]})]}),(0,j.jsx)("style",{children:`
        @keyframes fade-in {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        .animate-fade-in {
          animation: fade-in 0.2s ease-out forwards;
        }
        @keyframes slide-up {
          from { transform: translateY(20px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up {
           animation: slide-up 0.3s ease-out forwards;
        }
      `})]})},so=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})}),sl=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"})}),su=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 0 1 3 3m3 0a6 6 0 0 1-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1 1 21.75 8.25Z"})}),sc=({className:e})=>(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:e,"aria-hidden":"true",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.243 4.243L6.228 6.228"})}),sd=({isOpen:e,onClose:t})=>{let[r,s]=(0,S.useState)(""),{sendPasswordResetEmail:a,authLoading:i,authError:n,authMessage:o}=rR();return e?(0,j.jsx)("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",onClick:t,children:(0,j.jsxs)("div",{className:"bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md",onClick:e=>e.stopPropagation(),children:[(0,j.jsxs)("header",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[(0,j.jsxs)("div",{className:"flex items-center gap-3",children:[(0,j.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center bg-gray-700",children:(0,j.jsx)(su,{className:"w-6 h-6 text-yellow-400"})}),(0,j.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Redefinir Senha"})]}),(0,j.jsx)("button",{onClick:t,className:"p-1 text-gray-400 hover:bg-gray-700 rounded-full",children:(0,j.jsx)(rZ,{className:"w-6 h-6"})})]}),(0,j.jsx)("div",{className:"p-6",children:o?(0,j.jsxs)("div",{children:[(0,j.jsxs)("div",{className:"p-4 text-sm text-center text-green-300 bg-green-900/20 rounded-lg",children:[(0,j.jsx)("p",{className:"font-bold",children:"Verifique seu E-mail!"}),(0,j.jsx)("p",{className:"mt-2",children:o})]}),(0,j.jsx)("button",{onClick:t,className:"w-full mt-6 px-4 py-2.5 font-semibold text-white bg-gray-600 rounded-lg hover:bg-gray-500",children:"Fechar"})]}):(0,j.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a(r)},children:[(0,j.jsx)("p",{className:"text-sm text-gray-400 mb-4",children:"Digite o endereço de e-mail associado à sua conta e enviaremos um link para redefinir sua senha."}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"reset-email",className:"block text-sm font-medium text-gray-300",children:"Email"}),(0,j.jsx)("input",{id:"reset-email",name:"email",type:"email",autoComplete:"email",required:!0,value:r,onChange:e=>s(e.target.value),className:"w-full px-4 py-2.5 mt-1 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),n&&(0,j.jsxs)("div",{className:"p-3 mt-4 text-sm text-red-300 bg-red-900/20 rounded-lg",children:[(0,j.jsx)("p",{className:"font-bold",children:"Ocorreu um erro:"}),(0,j.jsx)("pre",{className:"mt-1 font-sans text-xs whitespace-pre-wrap",children:n.message})]}),(0,j.jsx)("div",{className:"mt-6",children:(0,j.jsx)("button",{type:"submit",disabled:i,className:"w-full px-4 py-2.5 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-all duration-300",children:i?"Enviando...":"Enviar Link de Redefinição"})})]})})]})}):null},sh=({onNavigateToSignup:e,onNavigateToForgotPassword:t})=>{let[r,s]=(0,S.useState)(""),[a,i]=(0,S.useState)(""),[n,o]=(0,S.useState)(!1),{signIn:l,authLoading:u,authError:c}=rR();return(0,j.jsx)("div",{className:"min-h-screen bg-gray-900 text-white p-4 flex items-center justify-center",children:(0,j.jsxs)("div",{className:"w-full max-w-4xl mx-auto bg-gray-800 rounded-2xl shadow-2xl flex overflow-hidden",children:[(0,j.jsxs)("div",{className:"hidden md:flex flex-col items-center justify-center w-1/2 bg-blue-600 p-8 text-center",children:[(0,j.jsx)(rI,{className:"w-24 h-24 mb-4"}),(0,j.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Gênesis Agente IA"}),(0,j.jsx)("p",{className:"text-blue-200",children:"Sua expertise fiscal, potencializada por IA."})]}),(0,j.jsxs)("div",{className:"w-full md:w-1/2 p-8 sm:p-12",children:[(0,j.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"Bem-vindo de volta!"}),(0,j.jsx)("p",{className:"mb-8 text-sm text-gray-400",children:"Faça login para acessar o assistente."}),(0,j.jsxs)("form",{className:"space-y-6",onSubmit:e=>{e.preventDefault(),l(r,a)},children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email"}),(0,j.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:r,onChange:e=>s(e.target.value),className:"w-full px-4 py-2.5 mt-1 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,j.jsxs)("div",{children:[(0,j.jsxs)("div",{className:"flex items-center justify-between",children:[(0,j.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300",children:"Senha"}),(0,j.jsx)("div",{className:"text-sm",children:(0,j.jsx)("button",{type:"button",onClick:t,className:"font-medium text-blue-400 hover:underline",children:"Esqueci minha senha"})})]}),(0,j.jsxs)("div",{className:"relative mt-1",children:[(0,j.jsx)("input",{id:"password",name:"password",type:n?"text":"password",autoComplete:"current-password",required:!0,value:a,onChange:e=>i(e.target.value),className:"w-full px-4 py-2.5 pr-10 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,j.jsx)("button",{type:"button",onClick:()=>o(!n),className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-white","aria-label":n?"Ocultar senha":"Mostrar senha",children:n?(0,j.jsx)(sc,{className:"h-5 w-5"}):(0,j.jsx)(r4,{className:"h-5 w-5"})})]})]}),c&&(0,j.jsxs)("div",{className:"p-3 my-2 text-sm text-red-300 bg-red-900/20 rounded-lg",children:[(0,j.jsx)("p",{className:"font-bold",children:"Ocorreu um erro:"}),(0,j.jsx)("pre",{className:"mt-1 font-sans text-xs whitespace-pre-wrap",children:c.message})]}),(0,j.jsx)("div",{children:(0,j.jsx)("button",{type:"submit",disabled:u,className:"w-full px-4 py-2.5 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-all duration-300",children:u?"Entrando...":"Entrar"})})]}),(0,j.jsxs)("p",{className:"text-sm text-center text-gray-400 mt-8",children:["Não tem uma conta?"," ",(0,j.jsx)("button",{onClick:e,className:"font-medium text-blue-400 hover:underline",children:"Cadastre-se"})]})]})]})})},sf=({onNavigateToLogin:e})=>{let[t,r]=(0,S.useState)(""),[s,a]=(0,S.useState)(""),[i,n]=(0,S.useState)(""),[o,l]=(0,S.useState)(!1),[u,c]=(0,S.useState)("Contador"),{signUp:d,authLoading:h,authError:f,authMessage:p}=rR();return(0,j.jsx)("div",{className:"min-h-screen bg-gray-900 text-white p-4 flex items-center justify-center",children:(0,j.jsxs)("div",{className:"w-full max-w-4xl mx-auto bg-gray-800 rounded-2xl shadow-2xl flex overflow-hidden",children:[(0,j.jsxs)("div",{className:"hidden md:flex flex-col items-center justify-center w-1/2 bg-blue-600 p-8 text-center",children:[(0,j.jsx)(rI,{className:"w-24 h-24 mb-4"}),(0,j.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Gênesis Agente IA"}),(0,j.jsx)("p",{className:"text-blue-200",children:"Comece a transformar sua análise tributária."})]}),(0,j.jsxs)("div",{className:"w-full md:w-1/2 p-8 sm:p-12",children:[(0,j.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:"Crie sua Conta"}),(0,j.jsx)("p",{className:"mb-6 text-sm text-gray-400",children:"Junte-se a nós e simplifique suas tarefas fiscais."}),(0,j.jsx)("form",{className:"space-y-4",onSubmit:e=>{e.preventDefault(),d(s,i,{full_name:t,user_type:u})},children:(0,j.jsxs)("fieldset",{disabled:h||!!p,children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-300",children:"Nome Completo"}),(0,j.jsx)("input",{id:"fullName",name:"fullName",type:"text",required:!0,value:t,onChange:e=>r(e.target.value),className:"w-full px-4 py-2.5 mt-1 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email"}),(0,j.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:s,onChange:e=>a(e.target.value),className:"w-full px-4 py-2.5 mt-1 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300",children:"Senha"}),(0,j.jsxs)("div",{className:"relative mt-1",children:[(0,j.jsx)("input",{id:"password",name:"password",type:o?"text":"password",required:!0,value:i,onChange:e=>n(e.target.value),className:"w-full px-4 py-2.5 pr-10 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),(0,j.jsx)("button",{type:"button",onClick:()=>l(!o),className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-400 hover:text-white","aria-label":o?"Ocultar senha":"Mostrar senha",children:o?(0,j.jsx)(sc,{className:"h-5 w-5"}):(0,j.jsx)(r4,{className:"h-5 w-5"})})]})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{htmlFor:"userType",className:"block text-sm font-medium text-gray-300",children:"Tipo de Usuário"}),(0,j.jsxs)("select",{id:"userType",name:"userType",value:u,onChange:e=>c(e.target.value),className:"w-full px-4 py-2.5 mt-1 text-white bg-gray-700 border border-gray-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,j.jsx)("option",{children:"Contador"}),(0,j.jsx)("option",{children:"Advogado"}),(0,j.jsx)("option",{children:"Empresário"}),(0,j.jsx)("option",{children:"Desenvolvedor"}),(0,j.jsx)("option",{children:"Estudante"}),(0,j.jsx)("option",{children:"Outro"})]})]}),p&&!f&&(0,j.jsxs)("div",{className:"p-3 my-2 text-sm text-green-300 bg-green-900/20 rounded-lg",children:[(0,j.jsx)("p",{className:"font-bold",children:"Sucesso!"}),(0,j.jsx)("p",{className:"mt-1",children:p})]}),f&&(0,j.jsxs)("div",{className:"p-3 my-2 text-sm text-red-300 bg-red-900/20 rounded-lg",children:[(0,j.jsx)("p",{className:"font-bold",children:"Ocorreu um erro ao cadastrar:"}),(0,j.jsx)("pre",{className:"mt-1 font-sans text-xs whitespace-pre-wrap",children:f.message})]}),(0,j.jsx)("div",{children:(0,j.jsx)("button",{type:"submit",disabled:h||!!p,className:"w-full px-4 py-2.5 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800 transition-all duration-300",children:h?"Cadastrando...":"Cadastrar"})})]})}),(0,j.jsxs)("p",{className:"text-sm text-center text-gray-400 mt-6",children:["Já tem uma conta?"," ",(0,j.jsx)("button",{onClick:e,className:"font-medium text-blue-400 hover:underline",children:"Faça login"})]})]})]})})},sp=()=>{let{documentConversations:e,codeConversations:t,suggestionConversations:r,activeDocumentConversationId:s,activeCodeConversationId:a,activeSuggestionConversationId:i,sendMessage:n,isLoading:o,activeAgent:l,setActiveAgent:u,setMessageFeedback:c,loadInitialData:d,signOut:h}=rR(),{documents:f}=rN(),[p,m]=(0,S.useState)("dark"),[g,b]=(0,S.useState)(!1),[y,w]=(0,S.useState)(!1),[v,x]=(0,S.useState)(!1),[_,E]=(0,S.useState)(!0),k=(0,S.useRef)(null),T=null,O={},C="",A=[];switch(l){case"code":T=a,O=t,C="Gerador de Código",A=rH;break;case"suggestion":T=i,O=r,C="Otimizador de Prompt",A=rK;break;default:T=s,O=e,C="Consultor Fiscal",A=rV}let N=T?O[T]:void 0,R=N?.messages||[];(0,S.useEffect)(()=>{(async()=>{await d(),E(!1)})()},[d]),(0,S.useEffect)(()=>{"dark"===p?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[p]),(0,S.useEffect)(()=>{k.current?.scrollIntoView({behavior:"smooth"})},[R]);let I=e=>{n(e,f)},P=({agent:e,label:t})=>(0,j.jsx)("button",{onClick:()=>u(e),className:`px-3 py-1.5 text-sm font-semibold rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-900 ${l===e?"bg-blue-600 text-white shadow":"text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"}`,children:t});return _?(0,j.jsx)("div",{className:"flex h-screen w-full items-center justify-center bg-gray-100 dark:bg-gray-900",children:(0,j.jsxs)("div",{className:"flex flex-col items-center",children:[(0,j.jsx)(rI,{className:"w-16 h-16 text-blue-500 animate-pulse"}),(0,j.jsx)("p",{className:"mt-4 text-lg text-gray-700 dark:text-gray-300",children:"Carregando assistente..."})]})}):(0,j.jsxs)("div",{className:"flex h-screen font-sans bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors",children:[(0,j.jsx)(r2,{isOpen:g,onClose:()=>b(!1)}),(0,j.jsxs)("main",{className:"flex-1 flex flex-col h-screen relative",children:[(0,j.jsxs)("header",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 bg-white/50 dark:bg-gray-800/50 backdrop-blur-sm z-10",children:[(0,j.jsxs)("div",{className:"flex items-center gap-4",children:[(0,j.jsx)("button",{onClick:()=>b(!0),className:"lg:hidden p-1 text-gray-500 dark:text-gray-400",children:(0,j.jsx)(so,{className:"w-6 h-6"})}),(0,j.jsxs)("div",{className:"flex items-center p-1 bg-gray-200/50 dark:bg-gray-900/50 rounded-lg",children:[(0,j.jsx)(P,{agent:"document",label:"Consultor"}),(0,j.jsx)(P,{agent:"code",label:"Código"}),(0,j.jsx)(P,{agent:"suggestion",label:"Sugestão"})]})]}),(0,j.jsxs)("div",{className:"flex items-center gap-2",children:[(0,j.jsx)("button",{onClick:()=>x(!0),className:"p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700",children:(0,j.jsx)(sl,{className:"w-5 h-5"})}),(0,j.jsx)(sa,{}),(0,j.jsx)(ss,{theme:p,toggleTheme:()=>{m("light"===p?"dark":"light")}}),(0,j.jsx)("button",{onClick:h,className:"p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700",title:"Sair",children:(0,j.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:(0,j.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m-3 0-3-3m0 0 3-3m-3 3h12"})})}),"document"===l&&(0,j.jsx)("button",{onClick:()=>w(!0),className:"lg:hidden p-1 text-gray-500 dark:text-gray-400",children:(0,j.jsx)(r5,{className:"w-6 h-6"})})]})]}),(0,j.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 pb-24",children:[0===R.length?(0,j.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[(0,j.jsx)("div",{className:"w-20 h-20 mb-6 rounded-full flex items-center justify-center bg-gray-200 dark:bg-gray-700",children:(0,j.jsx)(rI,{className:"w-12 h-12 text-gray-600 dark:text-gray-300"})}),(0,j.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:C}),(0,j.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-8 max-w-md",children:"Comece uma conversa, envie um documento ou escolha uma das sugestões abaixo."}),(0,j.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full max-w-2xl",children:A.map((e,t)=>(0,j.jsx)("button",{onClick:()=>{I(e)},className:"p-4 bg-white dark:bg-gray-800 rounded-lg text-left hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors shadow",children:(0,j.jsx)("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:e})},t))})]}):(0,j.jsxs)("div",{children:[(0,j.jsx)("h1",{className:"text-center text-xl font-semibold text-gray-700 dark:text-gray-300 mb-6",children:N?.title}),R.map(e=>(0,j.jsx)(rF,{message:e,onFeedback:t=>{var r;return r=e.id,void(T&&c(l,T,r,t))}},e.id))]}),(0,j.jsx)("div",{ref:k})]}),(0,j.jsx)("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-gray-100 dark:from-gray-900 to-transparent",children:(0,j.jsx)(rX,{onSendMessage:I,isLoading:o,onUploadClick:()=>w(!0),activeAgent:l})})]}),"document"===l&&(0,j.jsx)(se,{isOpen:y,onClose:()=>w(!1)}),(0,j.jsx)(sn,{isOpen:v,onClose:()=>x(!1),agentType:l})]})},sm=()=>{let{session:e,authLoading:t,initAuth:r,clearAuthFeedback:s}=rR(),[a,i]=(0,S.useState)("login"),[n,o]=(0,S.useState)(!1);return((0,S.useEffect)(()=>{let e=r();return()=>e()},[r]),t)?(0,j.jsx)("div",{className:"flex h-screen w-full items-center justify-center bg-gray-100 dark:bg-gray-900",children:(0,j.jsxs)("div",{className:"flex flex-col items-center",children:[(0,j.jsx)(rI,{className:"w-16 h-16 text-blue-500 animate-pulse"}),(0,j.jsx)("p",{className:"mt-4 text-lg text-gray-700 dark:text-gray-300",children:"Carregando..."})]})}):e?(0,j.jsx)(sp,{}):(0,j.jsxs)(j.Fragment,{children:["login"===a?(0,j.jsx)(sh,{onNavigateToSignup:()=>{s(),i("signup")},onNavigateToForgotPassword:()=>{s(),o(!0)}}):(0,j.jsx)(sf,{onNavigateToLogin:()=>{s(),i("login")}}),(0,j.jsx)(sd,{isOpen:n,onClose:()=>{o(!1),s()}})]})};function sg(){return(0,j.jsx)(sm,{})}e.s(["default",()=>sg],31713)}]);